(function(e){var c={selector:"",dataattr:"src",background:false,each:null,eacherror:null,callback:null,timeout:30000};var g=function(n,s,j){var k=d.getInstance();var p=e(s);var m=e.extend({},c,j||{});var r="_"+(""+(new Date()).valueOf()).slice(-7);var l;var o=0;if(m.selector===""&&p.data(m.dataattr)){l=p;o=1}else{l=p.find([m.selector,"[data-",m.dataattr,"]"].join(""));o=l.length}p.data(r,{each:m.each,eacherror:m.eacherror,callback:m.callback,isLoading:true,loadedImageCounter:0,length:o});if(o===0){h(s,r)}else{l.each(function(q,t){k.add(b(t,s,r,m.background,m.dataattr,m.timeout))});p.on("loadImage."+r,f);k.run()}return s};var f=function(m,o,j,l){var k=m.currentTarget;var n=e(k).data(m.namespace);if(!n.isLoading){return}if(l){if(typeof n.eacherror==="function"){n.eacherror(o)}else{if(o.parentNode!==null){o.parentNode.removeChild(o)}}}else{if(typeof n.each==="function"){n.each(o,j)}}++n.loadedImageCounter;if(n.loadedImageCounter>=n.length){h(k,m.namespace)}};var h=function(k,j){var m=e(k);var l=m.data();var n=l[j].callback;m.off("loadImage."+j,f);delete l[j];if(typeof n==="function"){setTimeout(function(){n(k)},e.imageloader.queueInterval*2)}};var b=function(q,s,n,k,o,r){var m=e(q);var j=m.data(o);var p=false;var l=function(u,t){m.removeAttr(["data-",o].join(""));e(s).triggerHandler("loadImage."+n,[q,t,(u&&u.type==="error")])};return function(){var u;var t=e("<img />");t.bind("error",function(v){p=true;clearTimeout(u);e(this).unbind("error").unbind("load");l(v)}).bind("load",function(v){p=true;clearTimeout(u);e(this).unbind("error").unbind("load");if(k){m.css("background-image",["url(",j,")"].join(""))}else{m.attr("src",j)}l(v,t[0])}).attr("src",j);u=setTimeout(function(){if(p===false){t.trigger("error")}},r)}};var i;var d={getInstance:function(){if(i instanceof a===false){i=new a()}return i}};var a=function(){this.index=0;this.queue=[];this.isRunning=false};a.prototype.add=function(j){if(typeof j!=="function"){throw new Error("you can only pass function.")}this.queue.push(j)};a.prototype.run=function(k){var j=e.proxy(this.run,this);k=k||false;if(this.isRunning&&!k){return}this.isRunning=true;this.queue[this.index++]();if(this.index<this.queue.length){setTimeout(function(){j(true)},e.imageloader.queueInterval)}else{this.isRunning=false}};e.imageloader={queueInterval:17};e.fn.imageloader=function(j){return this.each(function(k,l){g(k,l,j)})}})(jQuery);