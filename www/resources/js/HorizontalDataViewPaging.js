Ext.define("Ext.plugin.HorizontalDataViewPaging",{extend:"Ext.Component",alias:"plugin.hdataviewpaging",config:{autoPaging:false,loadMoreText:"Load More...",noMoreRecordsText:"",loadTpl:['<div class="{cssPrefix}loading-spinner" style="font-size: 180%; margin: 10px auto;">','<span class="{cssPrefix}loading-top"></span>','<span class="{cssPrefix}loading-right"></span>','<span class="{cssPrefix}loading-bottom"></span>','<span class="{cssPrefix}loading-left"></span>',"</div>",'<div class="{cssPrefix}paging-msg">{message}</div>'].join(""),baseCls:"ux-dataview-paging",width:105,loadMoreCmpAdded:false,loadingCls:Ext.baseCSSPrefix+"loading",dataView:null,scroller:null,loading:false,hidden:true},init:function(b){var d=this,a=b.getScrollable().getScroller(),c=b.getStore();d.setDataView(b);d.setScroller(a);d.bindStore(c);b.setScrollToTopOnRefresh(false);b.updateStore=Ext.Function.createInterceptor(b.updateStore,d.bindStore,d);if(d.getAutoPaging()){a.on({scrollend:d.onScrollEnd,scope:d})}else{d.on("tap",d.loadNextPage,d,{element:"element"})}d.addLoadMoreCmp();d.setHtml(d.getLoadTpl().apply({cssPrefix:Ext.baseCSSPrefix,message:this.getLoadMoreText()}))},bindStore:function(a,c){var b={beforeload:this.onStoreBeforeLoad,addrecords:this.onStoreChanges,load:this.onStoreRefresh,removerecords:this.onStoreChanges,scope:this};if(c){c.un(b)}if(a){a.on(b)}},applyLoadTpl:function(a){return(Ext.isObject(a)&&a.isTemplate)?a:new Ext.XTemplate(a)},onScrollEnd:function(b,a,c){if(!this.getLoading()&&a>=b.maxPosition.x){this.loadNextPage()}},onStoreBeforeLoad:function(b,c){var a=this.getDataView().getMasked();if(b.getCount()===0){this.hide()}c._page>1?a.hide():a.show()},onStoreChanges:function(b,a){this.updateSizes();if(this.storeFullyLoaded()){if(this.getNoMoreRecordsText()){this.setHtml(this.getLoadTpl().apply({cssPrefix:Ext.baseCSSPrefix,message:this.getNoMoreRecordsText()}))}else{this.hide()}}},onStoreRefresh:function(a){var b=this;if(a.getId()=="aylook-store-events-1"){console.log(a.getId()+" refresh")}if(b.isHidden()){b.show()}if(a.currentPage==1){b.initPaging(a)}if(a.getCount()){b.updateSizes()}b.setLoading(false);if(b.storeFullyLoaded()){if(b.getNoMoreRecordsText()){b.setHtml(b.getLoadTpl().apply({cssPrefix:Ext.baseCSSPrefix,message:b.getNoMoreRecordsText()}));b.updateSizes()}else{b.hide()}}},initPaging:function(a){var b=this;b.setHtml(b.getLoadTpl().apply({cssPrefix:Ext.baseCSSPrefix,message:b.getLoadMoreText()}));if(b.itemWidth){b.getScroller().scrollToTop()}if(!a.getCount()){b.hide()}},updateLoading:function(a){var b=this,c=b.getLoadingCls();if(a){b.addCls(c)}else{b.removeCls(c)}},addLoadMoreCmp:function(){var a=this.getDataView();if(!this.getLoadMoreCmpAdded()){a.add(this);a.fireEvent("loadmorecmpadded",this,a);this.setLoadMoreCmpAdded(true)}},storeFullyLoaded:function(){var a=this.getDataView().getStore(),b=a.getTotalCount();return b!==null?a.getTotalCount()<=(a.currentPage*a.getPageSize()):false},loadNextPage:function(){if(!this.storeFullyLoaded()){this.setLoading(true);this.getDataView().getStore().nextPage({addRecords:true})}},initSizes:function(){var c=this.getDataView().getItemAt(0),b=Ext.isElement(c)?Ext.get(c):c.element,d=b.getMargin(),a=b.getWidth();if(a===0){b.on("painted",function(e){this.itemWidth=null;this.updateSizes()},this,{single:true})}this.itemWidth=d.left+d.right+a;this.setHeight(b.getHeight())},updateSizes:function(){if(!this.itemWidth){this.initSizes()}var a=this.getDataView(),c=a.getStore().getCount()*this.itemWidth,b=c+this.getWidth();this.element.setLeft(c);a.innerElement.setWidth(b)}});