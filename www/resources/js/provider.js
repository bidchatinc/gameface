!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _streamrootHlsjsP2pBundle=require("streamroot-hlsjs-p2p-bundle"),_streamrootHlsjsP2pBundle2=_interopRequireDefault(_streamrootHlsjsP2pBundle),_streamrootVideoEventPolyfill=require("streamroot-video-event-polyfill"),_streamrootVideoEventPolyfill2=_interopRequireDefault(_streamrootVideoEventPolyfill),MEDIA_TYPE={VOD:0,LIVE:1,DVR:2},attachJWStreamrootProvider=function(jwplayer){function StreamrootProvider(playerId,playerConfig){function _loadHls(url){if(void 0===_hls||_hls.url!==url){var onLevelLoaded=function(event,data){_mediaType=MEDIA_TYPE.VOD,data.details.live&&(_mediaType=data.details.totalduration>120?MEDIA_TYPE.DVR:MEDIA_TYPE.LIVE,_dvrWindow=data.details.totalduration),polyfill.setLive(data.details.live)};_dvrWindow=0,_hls&&_hls.destroy();var p2pConfig=playerConfig.p2pConfig||{},hlsjsConfig=playerConfig.hlsjsConfig||{},hlsjsConfigCopy=playerInstance._.extend({},hlsjsConfig);_hls=new _streamrootHlsjsP2pBundle2.default(hlsjsConfigCopy,p2pConfig),_hls.on(_streamrootHlsjsP2pBundle2.default.Events.MANIFEST_PARSED,_onMetaData),_hls.on(_streamrootHlsjsP2pBundle2.default.Events.ERROR,function(event,data){data.fatal&&self.trigger(events.JWPLAYER_MEDIA_ERROR,{message:data.details})});var polyfill=new _streamrootVideoEventPolyfill2.default(_video);polyfill.on(_streamrootVideoEventPolyfill2.default.Events.WAITING,function(){self.setState(states.BUFFERING)}),polyfill.on(_streamrootVideoEventPolyfill2.default.Events.PLAYING,function(){self.setState(states.PLAYING)}),polyfill.on(_streamrootVideoEventPolyfill2.default.Events.ENDED,function(){self.trigger(events.JWPLAYER_MEDIA_BEFORECOMPLETE),_attached&&(seek(0),self.pause(),self.setState(states.COMPLETE),self.trigger(events.JWPLAYER_MEDIA_COMPLETE))}),_hls.on(_streamrootHlsjsP2pBundle2.default.Events.LEVEL_LOADED,onLevelLoaded),_hls.on(_streamrootHlsjsP2pBundle2.default.Events.DESTROYING,function(){polyfill.dispose()}),_hls.loadSource(url),_hls.attachMedia(_video)}}function load(item){this.setState(states.BUFFERING);var url=item.file;_loadHls(url),item.starttime&&this.seek(item.starttime),this.trigger(events.JWPLAYER_MEDIA_BUFFER_FULL),_bufferInterval=setInterval(_sendBufferUpdate,100)}function mute(s){_video.muted=s}function pause(){_video.pause(),this.setState(states.PAUSED)}function getQualityLevels(){return _levels}function getCurrentQuality(){return _currentQuality}function play(){_video.play(),this.setState(states.BUFFERING),this.setVisibility(!0)}function seek(time){_attached&&(_mediaType===MEDIA_TYPE.DVR&&time<0&&(time+=_video.duration),_video.currentTime=time)}function remove(){_container===_video.parentNode&&_container.removeChild(_video)}function setContainer(element){_container=element,_container.appendChild(_video)}function getContainer(){return _container}function setCurrentQuality(jwIndex){var l=jwIndex-1;_hls.nextLevel=l,setCurrentQualitySkin(jwIndex)}function setCurrentQualitySkin(jwIndex){self._currentQuality=jwIndex,self.trigger(events.JWPLAYER_MEDIA_LEVEL_CHANGED,{currentQuality:jwIndex,levels:_levels})}function setVisibility(state){state=!!state,state?utils.css.style(_container,{visibility:"visible",opacity:1}):utils.css.style(_container,{visibility:"",opacity:0})}function stop(){_video.pause(),this.setState(states.IDLE)}function volume(v){_video.volume=v/100}function supportsFullscreen(){return!0}function getName(){return{name:this.name}}function detachMedia(){if(_attached)return _attached=!1,_hls&&_hls.detachMedia(),clearInterval(_bufferInterval),_video}function attachMedia(){_attached=!0,_hls&&_hls.attachMedia(_video)}function _timeListener(){if(_attached){var p=_video.currentTime,duration=_video.duration;_position=p,_mediaType===MEDIA_TYPE.LIVE&&(duration=1/0),_mediaType===MEDIA_TYPE.DVR&&(p=-(_video.duration-_video.currentTime),duration=-_dvrWindow),self.trigger(events.JWPLAYER_MEDIA_TIME,{position:p,duration:duration})}}function _sendBufferUpdate(){var newBuffer=_getBuffer();newBuffer!=_bufferPercent&&(_bufferPercent=newBuffer,self.trigger(events.JWPLAYER_MEDIA_BUFFER,{bufferPercent:100*_bufferPercent})),newBuffer>=1&&clearInterval(_bufferInterval)}function _getDashMaxTime(buf){for(var i=0;i<buf.length;i++)if(buf.start(i)<=_video.currentTime&&_video.currentTime<=buf.end(i))return buf.end(i);return _position}function _getBuffer(){var r=_video.buffered,max_time=_getDashMaxTime(r);return _video.duration<=0?0:max_time/_video.duration}function _onMetaData(event,data){function _levelLabel(level){return level.height?level.height+"p":level.width?Math.round(9*level.width/16)+"p":level.bitrate?level.bitrate/1e3+"kbps":0}var cleanTracklist=[],videoIndex=0;if(data.levels.length>1){var autoLevel={jwIndex:-1,label:"auto"};cleanTracklist.push(autoLevel)}data.levels.forEach(function(level){var jwLevel={};jwLevel.jwIndex=videoIndex,jwLevel.bitrate=level.bitrate,cleanTracklist.push(jwLevel),videoIndex++,jwLevel.label=_levelLabel(level)}),_levels=cleanTracklist,self.trigger(events.JWPLAYER_MEDIA_LEVELS,{levels:_levels,currentQuality:_currentQuality}),setCurrentQualitySkin(_hls.manualLevel+1)}var _container,_bufferInterval,playerInstance=jwplayer(playerId),self=this,element=document.getElementById(playerId),_video=element&&element.querySelector("video")?element.querySelector("video"):document.createElement("video"),_position=0,_levels=[],_currentQuality=-1,_bufferPercent=-1,_mediaType=MEDIA_TYPE.VOD,_dvrWindow=0,_attached=!0;this.name="streamrootHLS";var _hls;utils.css.style(_video,{height:"100%",width:"100%"});var Events=playerInstance.Events;playerInstance._.extend(this,Events,{load:load,mute:mute,pause:pause,getQualityLevels:getQualityLevels,getCurrentQuality:getCurrentQuality,play:play,seek:seek,remove:remove,setContainer:setContainer,getContainer:getContainer,setCurrentQuality:setCurrentQuality.bind(this),setVisibility:setVisibility,stop:stop,volume:volume,supportsFullscreen:supportsFullscreen,getName:getName,detachMedia:detachMedia,attachMedia:attachMedia}),_video.addEventListener("timeupdate",_timeListener)}var utils=jwplayer.utils,events=jwplayer.events,states=events.state;StreamrootProvider.getName=function(){return{name:"StreamrootProviderHLS"}},StreamrootProvider.supports=function(i){var extSupported,isIEorEdge=_streamrootHlsjsP2pBundle2.default&&("IE"===_streamrootHlsjsP2pBundle2.default.getBrowserName()||"Edge"===_streamrootHlsjsP2pBundle2.default.getBrowserName());return i.file&&(extSupported=i.file.indexOf(".m3u8")!==-1),extSupported&&!isIEorEdge&&_streamrootHlsjsP2pBundle2.default&&_streamrootHlsjsP2pBundle2.default.isSupported()},jwplayer.api.registerProvider(StreamrootProvider)};attachJWStreamrootProvider(window.jwplayer)},{"streamroot-hlsjs-p2p-bundle":2,"streamroot-video-event-polyfill":3}],2:[function(require,module,exports){(function(global){!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.Hls=f()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _hlsjsP2pWrapper=_dereq_("./hlsjs-p2p-wrapper"),_hlsjsP2pWrapper2=_interopRequireDefault(_hlsjsP2pWrapper),_utils=_dereq_("./utils"),_hls=_dereq_("hls.js"),_hls2=_interopRequireDefault(_hls),_lodash=_dereq_("lodash.assigninwith"),_lodash2=_interopRequireDefault(_lodash),_uaParserJs=_dereq_("ua-parser-js"),_uaParserJs2=_interopRequireDefault(_uaParserJs),uaParserResult=(new _uaParserJs2.default).getResult(),StreamrootHlsjsBundle=function e(r,s){return _classCallCheck(this,e),new _hlsjsP2pWrapper2.default(_hls2.default).createPlayer(r,s)};(0,_lodash2.default)(StreamrootHlsjsBundle,_hls2.default),(0,_utils.inheritStaticPropertiesReadOnly)(StreamrootHlsjsBundle,_hls2.default),StreamrootHlsjsBundle.isSupported=function(){var e="Safari"===uaParserResult.browser.name,r="mobile"===uaParserResult.device.type||"tablet"===uaParserResult.device.type||"console"===uaParserResult.device.type||"Android"===uaParserResult.os.name||"iOS"===uaParserResult.os.name;return _hls2.default.isSupported()&&!e&&!r},StreamrootHlsjsBundle.getBrowserName=function(){return uaParserResult.browser.name},exports.default=StreamrootHlsjsBundle,module.exports=exports.default},{"./hlsjs-p2p-wrapper":3,"./utils":9,"hls.js":35,"lodash.assigninwith":49,"ua-parser-js":53}],2:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":_typeof2(e)},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_lodash=_dereq_("lodash.defaults"),_lodash2=_interopRequireDefault(_lodash),_playerInterface=_dereq_("./integration/player-interface"),_playerInterface2=_interopRequireDefault(_playerInterface),_mediaMap=_dereq_("./integration/mapping/media-map"),_mediaMap2=_interopRequireDefault(_mediaMap),_segmentView=_dereq_("./integration/mapping/segment-view"),_segmentView2=_interopRequireDefault(_segmentView),_p2pLoaderGenerator=_dereq_("./integration/p2p-loader-generator"),_p2pLoaderGenerator2=_interopRequireDefault(_p2pLoaderGenerator),HlsjsP2PWrapperPrivate=function(){function e(t,n){if(_classCallCheck(this,e),!n)throw new Error("Constructor needs DI of PeerAgent");this.Hlsjs=t,this.StreamrootPeerAgentModule=n}return _createClass(e,[{key:"createMediaEngine",value:function(e,t){var n=this,r=this.Hlsjs,o=this.newMediaEngine(e||{});return o.on(r.Events.MANIFEST_LOADING,function(){n.startSession(o,e,t,o.url)}),o}},{key:"createPlayer",value:function(e,t){return this.createMediaEngine(e,t)}},{key:"createSRModule",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?null:arguments[3];e.contentId=r,this.createPeerAgent(e,t,n,null)}},{key:"getConfig",value:function(){return{fLoader:(0,_p2pLoaderGenerator2.default)(this),maxBufferSize:0,maxBufferLength:30}}},{key:"onDispose",value:function(){this.stopSession()}},{key:"stopSession",value:function(){this.peerAgentModule&&(this.peerAgentModule.dispose(),delete this.peerAgentModule)}},{key:"startSession",value:function(e,t,n,r){var o=this.Hlsjs;if(!n||"object"!==("undefined"==typeof n?"undefined":_typeof(n)))throw new Error("p2pConfig must be a valid config object");var i=e||this.newMediaEngine(t||{});return this.createPeerAgent(n,e,o.Events,r),i}},{key:"newMediaEngine",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this.Hlsjs;if(!t)throw new Error("Can not create Hls.js instance: dependency was not injected");if(e.fLoader)throw new Error("`fLoader` in Hls.js config must not be defined");return new t((0,_lodash2.default)({},this.getConfig(),e))}},{key:"hasSession",value:function(){return!!this.peerAgentModule}},{key:"_setMediaElement",value:function(e,t){var n=this;e.media?this.peerAgentModule.setMediaElement(e.media):e.on(t.MEDIA_ATTACHING,function(){n.peerAgentModule.setMediaElement(e.media)})}},{key:"createPeerAgent",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?null:arguments[3],o=this.StreamrootPeerAgentModule,i=o.StreamTypes.HLS,a="v1";if(this.hasSession())throw new Error("Streamroot session already started");var s=r||t.url;if(!s)throw new Error("Hls.js instance must have valid `url` property or `contentUrl` must be passed");if(!n)throw new Error("Need valid Hls.js Events enumeration");t.on(n.ERROR,this.onMediaEngineError);var u=new _playerInterface2.default(t,n,e,this.onDispose.bind(this)),l=new _mediaMap2.default(t);this.peerAgentModule=new o(u,s,l,e,_segmentView2.default,i,a),this._setMediaElement(t,n)}},{key:"onMediaEngineError",value:function(e,t){t.fatal}},{key:"P2PLoader",get:function(){return(0,_p2pLoaderGenerator2.default)(this)}}]),e}();exports.default=HlsjsP2PWrapperPrivate,module.exports=exports.default},{"./integration/mapping/media-map":4,"./integration/mapping/segment-view":5,"./integration/p2p-loader-generator":7,"./integration/player-interface":8,"lodash.defaults":50}],3:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _hlsjsP2pWrapperPrivate=_dereq_("./hlsjs-p2p-wrapper-private"),_hlsjsP2pWrapperPrivate2=_interopRequireDefault(_hlsjsP2pWrapperPrivate),_streamrootP2p=_dereq_("streamroot-p2p"),_streamrootP2p2=_interopRequireDefault(_streamrootP2p),HlsjsP2PWrapper=function e(r){_classCallCheck(this,e);var t=new _hlsjsP2pWrapperPrivate2.default(r,_streamrootP2p2.default);this.createPlayer=t.createPlayer.bind(t),this.createSRModule=t.createSRModule.bind(t),this.P2PLoader=t.P2PLoader,Object.defineProperty(this,"stats",{get:function(){return t.peerAgentModule.stats}})};exports.default=HlsjsP2PWrapper,module.exports=exports.default},{"./hlsjs-p2p-wrapper-private":2,"streamroot-p2p":52}],4:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_segmentView=_dereq_("./segment-view"),_segmentView2=_interopRequireDefault(_segmentView),_trackView=_dereq_("./track-view"),_trackView2=_interopRequireDefault(_trackView),MediaMap=function(){function e(t){_classCallCheck(this,e),this.hls=t}return _createClass(e,[{key:"getSegmentTime",value:function(e){if(void 0===e.time)throw new Error("getSegmentTime: segmentView.time is undefined");return e.time}},{key:"getSegmentList",value:function(e,t,r){var n=this.hls.levels[e.level];if(!n)throw new Error("getSegmentList: level doesn't exist");if(!n.details)return[];for(var i=[],a=n.details.fragments,l=0;l<a.length;l++){var s=a[l];t<=s.start&&s.start<=t+r&&i.push(new _segmentView2.default({sn:s.sn,trackView:e,time:s.start}))}return i}},{key:"getTrackList",value:function(){if(!this.hls.levels)return[];for(var e=[],t=0;t<this.hls.levels.length;t++)e.push(new _trackView2.default({level:t}));return e}},{key:"getSegmentDuration",value:function(e){var t=this.hls.levels[e.trackView.level],r=!0,n=!1,i=void 0;try{for(var a,l=t.details.fragments[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var s=a.value;return s.duration}}catch(e){n=!0,i=e}finally{try{!r&&l.return&&l.return()}finally{if(n)throw i}}throw new Error("All segments should have a duration")}}]),e}();exports.default=MediaMap,module.exports=exports.default},{"./segment-view":5,"./track-view":6}],5:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function e(e,r){var t=[],n=!0,i=!1,a=void 0;try{for(var u,l=e[Symbol.iterator]();!(n=(u=l.next()).done)&&(t.push(u.value),!r||t.length!==r);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw a}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_trackView=_dereq_("./track-view"),_trackView2=_interopRequireDefault(_trackView),SegmentView=function(){function e(r){_classCallCheck(this,e),this.sn=r.sn,this.trackView=new _trackView2.default(r.trackView),this.time=r.time}return _createClass(e,null,[{key:"fromArrayBuffer",value:function(r){var t=new Uint32Array(r),n=_slicedToArray(t,2),i=n[0],a=n[1];return new e({trackView:new _trackView2.default({level:i}),sn:a})}}]),_createClass(e,[{key:"isEqual",value:function(e){if(!e)return!1;var r=e.sn,t=e.trackView;return this.sn===r&&this.trackView.isEqual(t)}},{key:"isInTrack",value:function(e){return this.trackView.isEqual(e)}},{key:"viewToString",value:function(){return this.trackView.viewToString()+"S"+this.sn}},{key:"toArrayBuffer",value:function(){return new Uint32Array([this.trackView.level,this.sn]).buffer}},{key:"getId",value:function(){return this.sn}}]),e}();exports.default=SegmentView,module.exports=exports.default},{"./track-view":6}],6:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),TrackView=function(){function e(t){_classCallCheck(this,e),this.level=t.level}return _createClass(e,[{key:"viewToString",value:function(){return"L"+this.level}},{key:"isEqual",value:function(e){return!!e&&e.level===this.level}}]),e}();exports.default=TrackView,module.exports=exports.default},{}],7:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,r,s){return r&&t(e.prototype,r),s&&t(e,s),e}}(),_segmentView=_dereq_("./mapping/segment-view"),_segmentView2=_interopRequireDefault(_segmentView),_trackView=_dereq_("./mapping/track-view"),_trackView2=_interopRequireDefault(_trackView),_utils=_dereq_("../utils"),P2PLoaderGenerator=function(t){return function(){function e(t){_classCallCheck(this,e),t&&(this.xhrSetup=t.xhrSetup),this.reset()}return _createClass(e,[{key:"destroy",value:function(){this.abort()}},{key:"abort",value:function(){this.peerAgentLoader&&(this.stats.aborted=!0,this.peerAgentLoader.abort()),this.reset()}},{key:"reset",value:function(){var t=arguments.length<=0||void 0===arguments[0]||arguments[0];clearTimeout(this.requestTimeout),this.requestTimeout=null,t&&(clearTimeout(this.retryTimeout),this.retryTimeout=null),this.peerAgentLoader=null}},{key:"load",value:function(e,r,s,i,a,n,o,u,l,h){if(!l)throw new Error("P2P loader expects progress-callback to be passed for ABR stats (use only as `fLoader` in config)");if(!h)throw new Error("P2P loader can only be used for media fragments (use only as `fLoader` in config)");if(!t.peerAgentModule)throw new Error("Peer agent is not existing yet");isNaN(h.byteRangeStartOffset)||isNaN(h.byteRangeEndOffset)||(this.byteRange=h.byteRangeStartOffset+"-"+h.byteRangeEndOffset),this.frag=h,this.url=e,this.responseType=r,this.onSuccess=s,this.onProgress=l,this.onTimeout=a,this.onError=i,this.stats={trequest:performance.now(),retry:0},this.timeout=n,this.maxRetry=o,this.retryDelay=u,this.loadInternal()}},{key:"loadSuccess",value:function(t){if(!this.stats.aborted){var e={currentTarget:{response:t}};this.stats.tload=performance.now(),this.onSuccess(e,this.stats),this.reset()}}},{key:"loadError",value:function(t){this.stats.aborted||(t.target.status,this.stats.retry<this.maxRetry?(this.retryTimeout=setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++,this.reset(!1)):(this.onError(t),this.reset()))}},{key:"loadInternal",value:function(){if(this.peerAgentLoader)throw new Error("P2P loader was not reset correctly, internal state indicates unfinalized request");var e=this.url,r=this.xhrSetup,s=(0,_utils.extractInfoFromXhrSetup)(r,e),i=s.headers,a=s.withCredentials;this.byteRange&&(i.Range="bytes="+this.frag.byteRangeStartOffset+"-"+(this.frag.byteRangeEndOffset-1));var n=new _trackView2.default({level:this.frag.level}),o=new _segmentView2.default({sn:this.frag.sn,trackView:n,time:this.frag.start}),u={url:e,headers:i,withCredentials:a},l={onSuccess:this.loadSuccess.bind(this),onError:this.loadError.bind(this),onProgress:this.loadProgress.bind(this)};this.stats.tfirst=null,this.stats.loaded=0,this.requestTimeout=setTimeout(this.loadTimeout.bind(this),this.timeout),this.peerAgentLoader=t.peerAgentModule.getSegment(u,l,o)}},{key:"loadProgress",value:function(t){var e=0;if(t.cdnDownloaded&&(e+=t.cdnDownloaded),t.p2pDownloaded&&(e+=t.p2pDownloaded),this.stats.loaded=e,null===this.stats.tfirst){var r=performance.now();if(t.p2pDuration+t.cdnDuration>0&&t.p2pDownloaded>0){var s=t.p2pDuration+t.cdnDuration;this.stats.trequest=r-s,this.stats.tfirst=this.stats.trequest+Math.min(Math.round(s/2),10)}else this.stats.tfirst=r}this.onProgress(t,this.stats)}},{key:"loadTimeout",value:function(){this.onTimeout(null,this.stats)}}]),e}()};exports.default=P2PLoaderGenerator,module.exports=exports.default},{"../utils":9,"./mapping/segment-view":5,"./mapping/track-view":6}],8:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_events=_dereq_("events"),_events2=_interopRequireDefault(_events),_trackView=_dereq_("./mapping/track-view"),_trackView2=_interopRequireDefault(_trackView),PlayerInterface=function(e){function t(e,n,r,i){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return o.hls=e,o.liveMinBufferMargin=r.liveMinBufferMargin||10,o.onDispose=i,o.hls.on(n.LEVEL_SWITCH,function(e,t){o.emit("onTrackChange",{video:new _trackView2.default({level:t.level})})}),o.hls.on(n.DESTROYING,function(){o.onDispose()}),o}return _inherits(t,e),_createClass(t,[{key:"isLive",value:function(){if(!this.hls.levels)throw new Error("Called isLive before the master playlist was parsed");var e=!0,t=!1,n=void 0;try{for(var r,i=this.hls.levels[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;if(o.details)return!!o.details.live}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}throw new Error("Called isLive before any levelplaylist was parsed")}},{key:"getBufferLevelMax",value:function(){var e=void 0,t=void 0;if(this.hls.config.liveSyncDuration?(e="liveSyncDuration",t=this.hls.config.liveSyncDuration-this.liveMinBufferMargin):(e="maxBufferLength",t=this.hls.config.maxBufferLength-this.liveMinBufferMargin),t<0)throw Error("Invalid configuration: hlsjsConfig."+e+" must be greater than p2pConfig.liveMinBufferMargin");return t}},{key:"setBufferMarginLive",value:function(e){this.hls.config.maxBufferSize=0,this.hls.config.maxBufferLength=e+this.liveMinBufferMargin}},{key:"addEventListener",value:function(e,t){"onTrackChange"===e&&this.on(e,t)}},{key:"removeEventListener",value:function(e,t){"onTrackChange"===e&&this.removeListener(e,t)}}]),t}(_events2.default);exports.default=PlayerInterface,module.exports=exports.default},{"./mapping/track-view":6,events:10}],9:[function(_dereq_,module,exports){"use strict";function inheritStaticPropertiesReadOnly(e,r){function t(t){Object.defineProperty(e,t,{get:function(){return r[t]},set:void 0})}var o=!0,n=!1,a=void 0;try{for(var i,s=Object.getOwnPropertyNames(r)[Symbol.iterator]();!(o=(i=s.next()).done);o=!0){var c=i.value;["prototype","name","length","caller","arguments","isSupported"].indexOf(c)===-1&&t(c)}}catch(e){n=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(n)throw a}}}function extractInfoFromXhrSetup(e,r,t){var o=t||{},n=new _xhrShaper.BaseXHR({setRequestHeader:function(e,r){o[e]=r},withCredentials:!1});try{e&&e(n,r)}catch(e){throw new Error("xhrSetup is trying to acces a forbidden property/method of XHR mock. Please contact Streamroot support. Internal mock error: "+e.message)}return{headers:o,withCredentials:n.withCredentials}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.extractInfoFromXhrSetup=exports.inheritStaticPropertiesReadOnly=void 0;var _xhrShaper=_dereq_("xhr-shaper");exports.inheritStaticPropertiesReadOnly=inheritStaticPropertiesReadOnly,exports.extractInfoFromXhrSetup=extractInfoFromXhrSetup},{"xhr-shaper":55}],10:[function(_dereq_,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,i,n,s,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(i=this._events[e],isUndefined(i))return!1;if(isFunction(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),i.apply(this,s)}else if(isObject(i))for(s=Array.prototype.slice.call(arguments,1),o=i.slice(),n=o.length,r=0;r<n;r++)o[r].apply(this,s);return!0},EventEmitter.prototype.addListener=function(e,t){var i;if(!isFunction(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned&&(i=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,"function"==typeof console.trace)),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},EventEmitter.prototype.removeListener=function(e,t){var i,n,s,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],s=i.length,n=-1,i===t||isFunction(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(i)){for(r=s;r-- >0;)if(i[r]===t||i[r].listener&&i[r].listener===t){n=r;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],isFunction(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(isFunction(t))return 1;if(t)return t.length}return 0},EventEmitter.listenerCount=function(e,t){return e.listenerCount(t)}},{}],11:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t;
}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_bufferHelper=_dereq_("../helper/buffer-helper"),_bufferHelper2=_interopRequireDefault(_bufferHelper),_errors=_dereq_("../errors"),_logger=_dereq_("../utils/logger"),_ewmaBandwidthEstimator=_dereq_("./ewma-bandwidth-estimator"),_ewmaBandwidthEstimator2=_interopRequireDefault(_ewmaBandwidthEstimator),AbrController=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2.default.FRAG_LOADING,_events2.default.FRAG_LOADED,_events2.default.ERROR));return r.lastLoadedFragLevel=0,r._autoLevelCapping=-1,r._nextAutoLevel=-1,r.hls=e,r.onCheck=r.abandonRulesCheck.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this.clearTimer(),_eventHandler2.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this.bwEstimator){var t=this.hls,r=e.frag.level,a=t.levels[r].details.live,o=t.config,i=void 0,n=void 0;a?(i=o.abrEwmaFastLive,n=o.abrEwmaSlowLive):(i=o.abrEwmaFastVoD,n=o.abrEwmaSlowVoD),this.bwEstimator=new _ewmaBandwidthEstimator2.default(t,n,i,o.abrEwmaDefaultEstimate)}var l=e.frag;l.trequest=performance.now(),this.fragCurrent=l}},{key:"abandonRulesCheck",value:function(){var e=this.hls,t=e.media,r=this.fragCurrent;if(!r.loader||r.loader.stats&&r.loader.stats.aborted)return _logger.logger.warn("frag loader destroy or aborted, disarm abandonRulesCheck"),void this.clearTimer();if(t&&(!t.paused||!t.readyState)&&r.autoLevel&&r.level){var a=performance.now()-r.trequest;if(a>500*r.duration){var o=e.levels,i=Math.max(1,1e3*r.loaded/a),n=Math.max(r.loaded,Math.round(r.duration*o[r.level].bitrate/8)),l=t.currentTime,s=(n-r.loaded)/i,u=_bufferHelper2.default.bufferInfo(t,l,e.config.maxBufferHole).end-l;if(u<2*r.duration&&s>u){var d=void 0,f=void 0;for(f=r.level-1;f>=0&&(d=r.duration*o[f].bitrate/(6.4*i),_logger.logger.log("fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay["+f+"] :"+s.toFixed(1)+"/"+u.toFixed(1)+"/"+d.toFixed(1)),!(d<u));f--);d<s&&(f=Math.max(0,f),e.nextLoadLevel=f,this.bwEstimator.sample(a,r.loaded),_logger.logger.warn("loading too slow, abort fragment loading and switch to level "+f),r.loader.abort(),this.clearTimer(),e.trigger(_events2.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r}))}}}}},{key:"onFragLoaded",value:function(e){var t=e.stats;void 0===t.aborted&&1===e.frag.loadCounter&&this.bwEstimator.sample(performance.now()-t.trequest,t.loaded),this.clearTimer(),this.lastLoadedFragLevel=e.frag.level,this._nextAutoLevel=-1}},{key:"onError",value:function(e){switch(e.details){case _errors.ErrorDetails.FRAG_LOAD_ERROR:case _errors.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e,t,r=this.hls,a=r.levels,o=r.config;if(t=this._autoLevelCapping===-1&&a&&a.length?a.length-1:this._autoLevelCapping,this._nextAutoLevel!==-1)return Math.min(this._nextAutoLevel,t);var i=this.bwEstimator?this.bwEstimator.getEstimate():o.abrEwmaDefaultEstimate,n=void 0;for(e=0;e<=t;e++)if(n=e<=this.lastLoadedFragLevel?o.abrBandWidthFactor*i:o.abrBandWidthUpFactor*i,n<a[e].bitrate)return Math.max(0,e-1);return e-1},set:function(e){this._nextAutoLevel=e}}]),t}(_eventHandler2.default);exports.default=AbrController},{"../errors":29,"../event-handler":30,"../events":31,"../helper/buffer-helper":32,"../utils/logger":46,"./ewma-bandwidth-estimator":14}],12:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=_dereq_("../utils/logger"),_errors=_dereq_("../errors"),BufferController=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e,_events2.default.MEDIA_ATTACHING,_events2.default.MEDIA_DETACHING,_events2.default.BUFFER_RESET,_events2.default.BUFFER_APPENDING,_events2.default.BUFFER_CODECS,_events2.default.BUFFER_EOS,_events2.default.BUFFER_FLUSHING,_events2.default.LEVEL_UPDATED));return t._msDuration=null,t._levelDuration=null,t.onsbue=t.onSBUpdateEnd.bind(t),t.onsbe=t.onSBUpdateError.bind(t),t}return _inherits(r,e),_createClass(r,[{key:"destroy",value:function(){_eventHandler2.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){var r=this.media=e.media;if(r){var t=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),t.addEventListener("sourceopen",this.onmso),t.addEventListener("sourceended",this.onmse),t.addEventListener("sourceclose",this.onmsc),r.src=URL.createObjectURL(t)}}},{key:"onMediaDetaching",value:function(){var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){_logger.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc);try{this.media.src="",this.media.removeAttribute("src")}catch(e){_logger.logger.warn("onMediaDetaching:"+e.message+" while unlinking video.src")}this.mediaSource=null,this.media=null,this.pendingTracks=null,this.sourceBuffer=null}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(_events2.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){_logger.logger.log("media source opened"),this.hls.trigger(_events2.default.MEDIA_ATTACHED,{media:this.media}),this.mediaSource.removeEventListener("sourceopen",this.onmso);var e=this.pendingTracks;e&&(this.onBufferCodecs(e),this.pendingTracks=null,this.doAppending())}},{key:"onMediaSourceClose",value:function(){_logger.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){_logger.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){this._needsFlush&&this.doFlush(),this._needsEos&&this.onBufferEos(),this.hls.trigger(_events2.default.BUFFER_APPENDED),this.doAppending()}},{key:"onSBUpdateError",value:function(e){_logger.logger.error("sourceBuffer error:"+e),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;if(e){for(var r in e){var t=e[r];try{this.mediaSource.removeSourceBuffer(t),t.removeEventListener("updateend",this.onsbue),t.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer=null}this.flushRange=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){var r=this.mediaSource;if(!r||"open"!==r.readyState)return void(this.pendingTracks=e);if(!this.sourceBuffer){var t={};for(var n in e){var o=e[n],i=o.levelCodec||o.codec,s=o.container+";codecs="+i;_logger.logger.log("creating sourceBuffer with mimeType:"+s);var a=t[n]=r.addSourceBuffer(s);a.addEventListener("updateend",this.onsbue),a.addEventListener("error",this.onsbe)}this.sourceBuffer=t}}},{key:"onBufferAppending",value:function(e){this.segments?this.segments.push(e):this.segments=[e],this.doAppending()}},{key:"onBufferAppendFail",value:function(e){_logger.logger.error("sourceBuffer error:"+e.event),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(){var e=this.sourceBuffer,r=this.mediaSource;r&&"open"===r.readyState&&(e.audio&&e.audio.updating||e.video&&e.video.updating?this._needsEos=!0:(_logger.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment"),r.endOfStream(),this._needsEos=!1))}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(e){var r=e.details;0!==r.fragments.length&&(this._levelDuration=r.totalduration+r.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){if(null!==this._levelDuration){var e=this.media,r=this.mediaSource,t=this.sourceBuffer;if(e&&r&&t&&0!==e.readyState&&"open"===r.readyState){for(var n in t)if(t[n].updating)return;null===this._msDuration&&(this._msDuration=r.duration),this._levelDuration>this._msDuration&&(_logger.logger.log("Updating mediasource duration to "+this._levelDuration),r.duration=this._levelDuration,this._msDuration=this._levelDuration)}}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var r=0,t=this.sourceBuffer;if(t)for(var n in t)r+=t[n].buffered.length;this.appended=r,this.hls.trigger(_events2.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,r=this.sourceBuffer,t=this.segments;if(r){if(this.media.error)return t=[],void _logger.logger.error("trying to append although a media error occured, flush segment and abort");for(var n in r)if(r[n].updating)return;if(t.length){var o=t.shift();try{r[o.type].appendBuffer(o.data),this.appendError=0,this.appended++}catch(r){_logger.logger.error("error while trying to append buffer:"+r.message),t.unshift(o);var i={type:_errors.ErrorTypes.MEDIA_ERROR};if(22===r.code)return this.segments=[],i.details=_errors.ErrorDetails.BUFFER_FULL_ERROR,void e.trigger(_events2.default.ERROR,i);if(this.appendError?this.appendError++:this.appendError=1,i.details=_errors.ErrorDetails.BUFFER_APPEND_ERROR,i.frag=this.fragCurrent,this.appendError>e.config.appendErrorMaxRetry)return _logger.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),t=[],i.fatal=!0,void e.trigger(_events2.default.ERROR,i);i.fatal=!1,e.trigger(_events2.default.ERROR,i)}}}}},{key:"flushBuffer",value:function(e,r){var t,n,o,i,s,a;if(this.flushBufferCounter<this.appended&&this.sourceBuffer)for(var u in this.sourceBuffer){if(t=this.sourceBuffer[u],t.updating)return _logger.logger.warn("cannot flush, sb updating in progress"),!1;for(n=0;n<t.buffered.length;n++)if(o=t.buffered.start(n),i=t.buffered.end(n),navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&r===Number.POSITIVE_INFINITY?(s=e,a=r):(s=Math.max(o,e),a=Math.min(i,r)),Math.min(a,i)-s>.5)return this.flushBufferCounter++,_logger.logger.log("flush "+u+" ["+s+","+a+"], of ["+o+","+i+"], pos:"+this.media.currentTime),t.remove(s,a),!1}else _logger.logger.warn("abort flushing too many retries");return _logger.logger.log("buffer flushed"),!0}}]),r}(_eventHandler2.default);exports.default=BufferController},{"../errors":29,"../event-handler":30,"../events":31,"../utils/logger":46}],13:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),CapLevelController=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2.default.MEDIA_ATTACHING,_events2.default.MANIFEST_PARSED))}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){this.hls.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,this.hls.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;e&&(this.hls.autoLevelCapping=this.getMaxLevel(e-1),this.hls.autoLevelCapping>this.autoLevelCapping&&this.hls.streamController.nextLevelSwitch(),this.autoLevelCapping=this.hls.autoLevelCapping)}}},{key:"getMaxLevel",value:function(e){var t=void 0,i=void 0,n=void 0,r=this.mediaWidth,a=this.mediaHeight,l=0,o=0;for(i=0;i<=e&&(n=this.levels[i],t=i,l=n.width,o=n.height,!(r<=l||a<=o));i++);return t}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}},{key:"mediaWidth",get:function(){var e=void 0;return this.media&&(e=this.media.width||this.media.clientWidth||this.media.offsetWidth,e*=this.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0;return this.media&&(e=this.media.height||this.media.clientHeight||this.media.offsetHeight,e*=this.contentScaleFactor),e}}]),t}(_eventHandler2.default);exports.default=CapLevelController},{"../event-handler":30,"../events":31}],14:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}(),_ewma=_dereq_("../utils/ewma"),_ewma2=_interopRequireDefault(_ewma),EwmaBandWidthEstimator=function(){function t(e,a,i,s){_classCallCheck(this,t),this.hls=e,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _ewma2.default(a),this.fast_=new _ewma2.default(i)}return _createClass(t,[{key:"sample",value:function(t,e){t=Math.max(t,this.minDelayMs_);var a=8e3*e/t,i=t/1e3;this.fast_.sample(i,a),this.slow_.sample(i,a)}},{key:"getEstimate",value:function(){return!this.fast_||!this.slow_||this.fast_.getTotalWeight()<this.minWeight_?this.defaultEstimate_:Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())}},{key:"destroy",value:function(){}}]),t}();exports.default=EwmaBandWidthEstimator},{"../utils/ewma":45}],15:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,r,l){return r&&e(t.prototype,r),l&&e(t,l),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=_dereq_("../utils/logger"),_errors=_dereq_("../errors"),LevelController=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2.default.MANIFEST_LOADED,_events2.default.LEVEL_LOADED,_events2.default.ERROR));return r.ontick=r.tick.bind(r),r._manualLevel=r._autoLevelCapping=-1,r}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0,this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t,r,l=[],i=[],s={},o=!1,n=!1,a=this.hls;if(e.levels.forEach(function(e){e.videoCodec&&(o=!0),e.audioCodec&&(n=!0);var t=s[e.bitrate];void 0===t?(s[e.bitrate]=l.length,e.url=[e.url],e.urlId=0,l.push(e)):l[t].url.push(e.url)}),o&&n?l.forEach(function(e){e.videoCodec&&i.push(e)}):i=l,i=i.filter(function(e){var t=function(e){return MediaSource.isTypeSupported("audio/mp4;codecs="+e)},r=function(e){return MediaSource.isTypeSupported("video/mp4;codecs="+e)},l=e.audioCodec,i=e.videoCodec;return(!l||t(l))&&(!i||r(i))}),i.length){for(t=i[0].bitrate,i.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=i,r=0;r<i.length;r++)if(i[r].bitrate===t){this._firstLevel=r,_logger.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+t);break}a.trigger(_events2.default.MANIFEST_PARSED,{levels:this._levels,firstLevel:this._firstLevel,stats:e.stats})}else a.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){var t=this._levels;if(e>=0&&e<t.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level=e,_logger.logger.log("switching to level "+e),this.hls.trigger(_events2.default.LEVEL_SWITCH,{level:e});var r=t[e];if(void 0===r.details||r.details.live===!0){_logger.logger.log("(re)loading playlist for level "+e);var l=r.urlId;this.hls.trigger(_events2.default.LEVEL_LOADING,{url:r.url[l],level:e,id:l})}}else this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.OTHER_ERROR,details:_errors.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(!e.fatal){var t=e.details,r=this.hls,l=void 0,i=void 0,s=!1;switch(t){case _errors.ErrorDetails.FRAG_LOAD_ERROR:case _errors.ErrorDetails.FRAG_LOAD_TIMEOUT:case _errors.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case _errors.ErrorDetails.KEY_LOAD_ERROR:case _errors.ErrorDetails.KEY_LOAD_TIMEOUT:l=e.frag.level;break;case _errors.ErrorDetails.LEVEL_LOAD_ERROR:case _errors.ErrorDetails.LEVEL_LOAD_TIMEOUT:l=e.level,s=!0}if(void 0!==l)if(i=this._levels[l],i.urlId<i.url.length-1)i.urlId++,i.details=void 0,_logger.logger.warn("level controller,"+t+" for level "+l+": switching to redundant stream id "+i.urlId);else{var o=this._manualLevel===-1&&l;o?(_logger.logger.warn("level controller,"+t+": emergency switch-down for next fragment"),r.abrController.nextAutoLevel=0):i&&i.details&&i.details.live?(_logger.logger.warn("level controller,"+t+" on live stream, discard"),s&&(this._level=void 0)):t!==_errors.ErrorDetails.FRAG_LOAD_ERROR&&t!==_errors.ErrorDetails.FRAG_LOAD_TIMEOUT&&(_logger.logger.error("cannot recover "+t+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),e.fatal=!0,r.trigger(_events2.default.ERROR,e))}}}},{key:"onLevelLoaded",value:function(e){if(e.level===this._level){var t=e.details;if(t.live){var r=1e3*t.targetduration,l=this._levels[e.level],i=l.details;i&&t.endSN===i.endSN&&(r/=2,_logger.logger.log("same live playlist, reload twice faster")),r-=performance.now()-e.stats.trequest,r=Math.max(1e3,Math.round(r)),_logger.logger.log("live playlist, reload in "+r+" ms"),this.timer=setTimeout(this.ontick,r)}else this.timer=null}}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var t=this._levels[e],r=t.urlId;this.hls.trigger(_events2.default.LEVEL_LOADING,{url:t.url[r],level:e,id:r})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){var t=this._levels;t&&t.length>e&&(this._level===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,void 0===this._startLevel&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){return void 0===this._startLevel?this._firstLevel:this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return this._manualLevel!==-1?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,this._manualLevel===-1&&(this.hls.abrController.nextAutoLevel=e)}}]),t}(_eventHandler2.default);exports.default=LevelController},{"../errors":29,"../event-handler":30,"../events":31,"../utils/logger":46}],16:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),_demuxer=_dereq_("../demux/demuxer"),_demuxer2=_interopRequireDefault(_demuxer),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=_dereq_("../utils/logger"),_binarySearch=_dereq_("../utils/binary-search"),_binarySearch2=_interopRequireDefault(_binarySearch),_bufferHelper=_dereq_("../helper/buffer-helper"),_bufferHelper2=_interopRequireDefault(_bufferHelper),_levelHelper=_dereq_("../helper/level-helper"),_levelHelper2=_interopRequireDefault(_levelHelper),_errors=_dereq_("../errors"),State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR"},StreamController=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2.default.MEDIA_ATTACHED,_events2.default.MEDIA_DETACHING,_events2.default.MANIFEST_LOADING,_events2.default.MANIFEST_PARSED,_events2.default.LEVEL_LOADED,_events2.default.KEY_LOADED,_events2.default.FRAG_LOADED,_events2.default.FRAG_LOAD_EMERGENCY_ABORTED,_events2.default.FRAG_PARSING_INIT_SEGMENT,_events2.default.FRAG_PARSING_DATA,_events2.default.FRAG_PARSED,_events2.default.ERROR,_events2.default.BUFFER_APPENDED,_events2.default.BUFFER_FLUSHED));return a.config=e.config,a.audioCodecSwap=!1,a.ticks=0,a.ontick=a.tick.bind(a),a}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),_eventHandler2.default.prototype.destroy.call(this),this.state=State.STOPPED}},{key:"startLoad",value:function(e){if(this.levels){var t=this.media,a=this.lastCurrentTime;this.stopLoad(),this.demuxer=new _demuxer2.default(this.hls),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,t&&a>0?(_logger.logger.log("configure startPosition @"+a),this.lastPaused||(_logger.logger.log("resuming video"),t.play()),this.state=State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else _logger.logger.warn("cannot start loading as manifest not parsed yet"),this.state=State.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=State.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var e,t,a,r=this.hls,i=r.config,s=this.media,o=s&&s.seeking;switch(this.state){case State.ERROR:case State.PAUSED:break;case State.STARTING:var n=r.startLevel;n===-1&&(n=0,this.fragBitrateTest=!0),this.level=r.nextLoadLevel=n,this.state=State.WAITING_LEVEL,this.loadedmetadata=!1;break;case State.IDLE:if(!s&&(this.startFragRequested||!i.startFragPrefetch))break;e=this.loadedmetadata?s.currentTime:this.nextLoadPosition,t=r.nextLoadLevel;var l,d=_bufferHelper2.default.bufferInfo(s,e,i.maxBufferHole),g=d.len,f=d.end,u=this.fragPrevious;if(this.levels[t].hasOwnProperty("bitrate")?(l=Math.max(8*i.maxBufferSize/this.levels[t].bitrate,i.maxBufferLength),l=Math.min(l,i.maxMaxBufferLength)):l=i.maxBufferLength,g<l){if(r.nextLoadLevel=t,this.level=t,a=this.levels[t].details,"undefined"==typeof a||a.live&&this.levelLastLoaded!==t){this.state=State.WAITING_LEVEL;break}var h=a.fragments,c=h.length,v=h[0].start,_=h[c-1].start+h[c-1].duration,E=void 0;if(a.live){var S=void 0!==i.liveMaxLatencyDuration?i.liveMaxLatencyDuration:i.liveMaxLatencyDurationCount*a.targetduration;if(f<Math.max(v,_-S)){var R=void 0!==i.liveSyncDuration?i.liveSyncDuration:i.liveSyncDurationCount*a.targetduration,p=v+Math.max(0,a.totalduration-R);_logger.logger.log("buffer end: "+f+" is located too far from the end of live sliding playlist, reset currentTime to : "+p.toFixed(3)),f=p,s&&s.readyState&&s.duration>p&&(s.currentTime=p)}if(a.PTSKnown&&f>_)break;if(this.startFragRequested&&!a.PTSKnown){if(u){var m=u.sn+1;m>=a.startSN&&m<=a.endSN&&(E=h[m-a.startSN],_logger.logger.log("live playlist, switching playlist, load frag with next SN: "+E.sn))}E||(E=h[Math.min(c-1,Math.round(c/2))],_logger.logger.log("live playlist, switching playlist, unknown, load middle frag : "+E.sn))}}else f<v&&(E=h[0]);if(E||!function(){var e=i.maxFragLookUpTolerance;f<_?((f>_-e||o)&&(e=0),E=_binarySearch2.default.search(h,function(t){return t.start+t.duration-e<=f?1:t.start-e>f?-1:0})):E=h[c-1]}(),E){if(v=E.start,u&&E.level===u.level&&E.sn===u.sn){if(!(E.sn<a.endSN)){a.live||(this.hls.trigger(_events2.default.BUFFER_EOS),o||(this.state=State.ENDED));break}var L=u.deltaPTS,D=E.sn-a.startSN;if(L&&L>i.maxBufferHole&&u.dropped?(E=h[D-1],_logger.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),u.loadCounter--):(E=h[D+1],_logger.logger.log("SN just loaded, load next one: "+E.sn)),!E)break}if(null!=E.decryptdata.uri&&null==E.decryptdata.key)_logger.logger.log("Loading key for "+E.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+t),this.state=State.KEY_LOADING,r.trigger(_events2.default.KEY_LOADING,{frag:E});else{if(_logger.logger.log("Loading "+E.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+t+", currentTime:"+e+",bufferEnd:"+f.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,E.loadCounter){E.loadCounter++;var A=i.fragLoadingLoopThreshold;if(E.loadCounter>A&&Math.abs(this.fragLoadIdx-E.loadIdx)<A)return void r.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:E})}else E.loadCounter=1;E.loadIdx=this.fragLoadIdx,this.fragCurrent=E,this.startFragRequested=!0,E.autoLevel=r.autoLevelEnabled,r.trigger(_events2.default.FRAG_LOADING,{frag:E}),this.state=State.FRAG_LOADING}}}break;case State.WAITING_LEVEL:t=this.levels[this.level],t&&t.details&&(this.state=State.IDLE);break;case State.FRAG_LOADING_WAITING_RETRY:var y=performance.now(),T=this.retryDate;(!T||y>=T||o)&&(_logger.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=State.IDLE);break;case State.STOPPED:case State.FRAG_LOADING:case State.PARSING:case State.PARSED:case State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"getBufferRange",value:function(e){var t,a,r=this.bufferRange;if(r)for(t=r.length-1;t>=0;t--)if(a=r[t],e>=a.start&&e<=a.end)return a;return null}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"isBuffered",value:function(e){var t=this.media;if(t)for(var a=t.buffered,r=0;r<a.length;r++)if(e>=a.start(r)&&e<=a.end(r))return!0;return!1}},{key:"_checkFragmentChanged",value:function(){var e,t,a=this.media;if(a&&a.seeking===!1&&(t=a.currentTime,t>a.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),this.isBuffered(t)?e=this.getBufferRange(t):this.isBuffered(t+.1)&&(e=this.getBufferRange(t+.1)),
e)){var r=e.frag;r!==this.fragPlaying&&(this.fragPlaying=r,this.hls.trigger(_events2.default.FRAG_CHANGED,{frag:r}))}}},{key:"immediateLevelSwitch",value:function(){if(_logger.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var a=this.fragCurrent;a&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=State.PAUSED,this.hls.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY})}},{key:"immediateLevelSwitchEnd",value:function(){this.immediateSwitch=!1;var e=this.media;e&&e.readyState&&(e.currentTime-=1e-4,this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var e=this.media;if(e&&e.readyState){var t=void 0,a=void 0,r=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,a=this.getBufferRange(e.currentTime),a&&a.start>1&&(this.state=State.PAUSED,this.hls.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:0,endOffset:a.start-1})),e.paused)t=0;else{var i=this.hls.nextLoadLevel,s=this.levels[i],o=this.fragLastKbps;t=o&&this.fragCurrent?this.fragCurrent.duration*s.bitrate/(1e3*o)+1:0}if(r=this.getBufferRange(e.currentTime+t),r&&(r=this.followingBufferRange(r))){var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.state=State.PAUSED,this.hls.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:r.start,endOffset:Number.POSITIVE_INFINITY})}}}},{key:"onMediaAttached",value:function(e){var t=this.media=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var a=this.config;this.levels&&a.autoStartLoad&&this.hls.startLoad(a.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(_logger.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){if(this.state===State.FRAG_LOADING){if(0===_bufferHelper2.default.bufferInfo(this.media,this.media.currentTime,this.config.maxBufferHole).len){_logger.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load");var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.state=State.IDLE}}else this.state===State.ENDED&&(this.state=State.IDLE);this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaSeeked",value:function(){this.tick()}},{key:"onMediaEnded",value:function(){_logger.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){_logger.logger.log("trigger BUFFER_RESET"),this.hls.trigger(_events2.default.BUFFER_RESET),this.bufferRange=[],this.stalled=!1}},{key:"onManifestParsed",value:function(e){var t,a=!1,r=!1;e.levels.forEach(function(e){t=e.audioCodec,t&&(t.indexOf("mp4a.40.2")!==-1&&(a=!0),t.indexOf("mp4a.40.5")!==-1&&(r=!0))}),this.audioCodecSwitch=a&&r,this.audioCodecSwitch&&_logger.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var i=this.config;i.autoStartLoad&&this.hls.startLoad(i.startPosition)}},{key:"onLevelLoaded",value:function(e){var t=e.details,a=e.level,r=this.levels[a],i=t.totalduration,s=0;if(_logger.logger.log("level "+a+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),this.levelLastLoaded=a,t.live){var o=r.details;o?(_levelHelper2.default.mergeDetails(o,t),s=t.fragments[0].start,t.PTSKnown?_logger.logger.log("live playlist sliding:"+s.toFixed(3)):_logger.logger.log("live playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,_logger.logger.log("live playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,this.hls.trigger(_events2.default.LEVEL_UPDATED,{details:t,level:a}),this.startFragRequested===!1){if(this.startPosition===-1){var n=t.startTimeOffset;if(isNaN(n))if(t.live){var l=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;this.startPosition=Math.max(0,s+i-l)}else this.startPosition=0;else _logger.logger.log("start time offset found in playlist, adjust startPosition to "+n),this.startPosition=n}this.nextLoadPosition=this.startPosition}this.state===State.WAITING_LEVEL&&(this.state=State.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===State.KEY_LOADING&&(this.state=State.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent;if(this.state===State.FRAG_LOADING&&t&&e.frag.level===t.level&&e.frag.sn===t.sn)if(_logger.logger.log("Loaded  "+t.sn+" of level "+t.level),this.fragBitrateTest===!0)this.state=State.IDLE,this.fragBitrateTest=!1,this.startFragRequested=!1,e.stats.tparsed=e.stats.tbuffered=performance.now(),this.hls.trigger(_events2.default.FRAG_BUFFERED,{stats:e.stats,frag:t});else{this.state=State.PARSING,this.stats=e.stats;var a=this.levels[this.level],r=a.details,i=r.totalduration,s=void 0===t.startDTS||isNaN(t.startDTS)?t.start:t.startDTS,o=t.level,n=t.sn,l=a.audioCodec||this.config.defaultAudioCodec;this.audioCodecSwap&&(_logger.logger.log("swapping playlist audio codec"),void 0===l&&(l=this.lastAudioCodec),l&&(l=l.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5")),this.pendingAppending=0,_logger.logger.log("Demuxing "+n+" of ["+r.startSN+" ,"+r.endSN+"],level "+o+", cc "+t.cc);var d=this.demuxer;d&&d.push(e.payload,l,a.videoCodec,s,t.cc,o,n,i,t.decryptdata)}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){if(this.state===State.PARSING){var t,a,r=e.tracks;if(a=r.audio){var i=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();i&&this.audioCodecSwap&&(_logger.logger.log("swapping playlist audio codec"),i=i.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&s.indexOf("firefox")===-1&&(i="mp4a.40.5"),s.indexOf("android")!==-1&&(i="mp4a.40.2",_logger.logger.log("Android: force audio codec to"+i)),a.levelCodec=i}if(a=r.video,a&&(a.levelCodec=this.levels[this.level].videoCodec),e.unique){var o={codec:"",levelCodec:""};for(t in e.tracks)a=r[t],o.container=a.container,o.codec&&(o.codec+=",",o.levelCodec+=","),a.codec&&(o.codec+=a.codec),a.levelCodec&&(o.levelCodec+=a.levelCodec);r={audiovideo:o}}this.hls.trigger(_events2.default.BUFFER_CODECS,r);for(t in r){a=r[t],_logger.logger.log("track:"+t+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var n=a.initSegment;n&&(this.pendingAppending++,this.hls.trigger(_events2.default.BUFFER_APPENDING,{type:t,data:n}))}this.tick()}}},{key:"onFragParsingData",value:function(e){var t=this;if(this.state===State.PARSING){this.tparse2=Date.now();var a=this.levels[this.level],r=this.fragCurrent;_logger.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0));var i=_levelHelper2.default.updateFragPTSDTS(a.details,r.sn,e.startPTS,e.endPTS,e.startDTS,e.endDTS),s=this.hls;s.trigger(_events2.default.LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:i}),"video"===e.type&&(r.dropped=e.dropped),[e.data1,e.data2].forEach(function(a){a&&(t.pendingAppending++,s.trigger(_events2.default.BUFFER_APPENDING,{type:e.type,data:a}))}),this.nextLoadPosition=e.endPTS,this.bufferRange.push({type:e.type,start:e.startPTS,end:e.endPTS,frag:r}),this.tick()}else _logger.logger.warn("not in PARSING state but "+this.state+", ignoring FRAG_PARSING_DATA event")}},{key:"onFragParsed",value:function(){this.state===State.PARSING&&(this.stats.tparsed=performance.now(),this.state=State.PARSED,this._checkAppendedParsed())}},{key:"onBufferAppended",value:function(){switch(this.state){case State.PARSING:case State.PARSED:this.pendingAppending--,this._checkAppendedParsed()}}},{key:"_checkAppendedParsed",value:function(){if(this.state===State.PARSED&&0===this.pendingAppending){var e=this.fragCurrent,t=this.stats;e&&(this.fragPrevious=e,t.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*t.length/(t.tbuffered-t.tfirst)),this.hls.trigger(_events2.default.FRAG_BUFFERED,{stats:t,frag:e}),_logger.logger.log("media buffered : "+this.timeRangesToString(this.media.buffered)),this.state=State.IDLE),this.tick()}}},{key:"onError",value:function(e){switch(e.details){case _errors.ErrorDetails.FRAG_LOAD_ERROR:case _errors.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!e.fatal){var t=this.fragLoadError;if(t?t++:t=1,t<=this.config.fragLoadingMaxRetry||this.media&&this.isBuffered(this.media.currentTime)){this.fragLoadError=t,e.frag.loadCounter=0;var a=Math.min(Math.pow(2,t-1)*this.config.fragLoadingRetryDelay,64e3);_logger.logger.warn("mediaController: frag loading failed, retry in "+a+" ms"),this.retryDate=performance.now()+a,this.state=State.FRAG_LOADING_WAITING_RETRY}else _logger.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(_events2.default.ERROR,e),this.state=State.ERROR}break;case _errors.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case _errors.ErrorDetails.LEVEL_LOAD_ERROR:case _errors.ErrorDetails.LEVEL_LOAD_TIMEOUT:case _errors.ErrorDetails.KEY_LOAD_ERROR:case _errors.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==State.ERROR&&(this.state=e.fatal?State.ERROR:State.IDLE,_logger.logger.warn("mediaController: "+e.details+" while loading frag,switch to "+this.state+" state ..."));break;case _errors.ErrorDetails.BUFFER_FULL_ERROR:this.state!==State.PARSING&&this.state!==State.PARSED||(this.config.maxMaxBufferLength/=2,_logger.logger.warn("reduce max buffer length to "+this.config.maxMaxBufferLength+"s and switch to IDLE state"),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=State.IDLE)}}},{key:"_checkBuffer",value:function(){var e=this.media;if(e&&e.readyState){var t=e.currentTime,a=e.buffered;if(!this.loadedmetadata&&a.length){this.loadedmetadata=!0;var r=this.startPosition;if(!t&&t!==r&&r){_logger.logger.log("target start position:"+r);var i=a.start(0),s=a.end(0);(r<i||r>s)&&(r=i,_logger.logger.log("target start position not buffered, seek to buffered.start(0) "+i)),_logger.logger.log("adjust currentTime from "+t+" to "+r),e.currentTime=r}}else{var o=_bufferHelper2.default.bufferInfo(e,t,0),n=!(e.paused||e.ended||0===e.buffered.length),l=.4,d=t>e.playbackRate*this.lastCurrentTime;if(this.stalled&&d&&(this.stalled=!1,_logger.logger.log("playback not stuck anymore @"+t)),n&&o.len<=l&&(d?(l=0,this.seekHoleNudgeDuration=0):this.stalled?this.seekHoleNudgeDuration+=this.config.seekHoleNudgeDuration:(this.seekHoleNudgeDuration=0,_logger.logger.log("playback seems stuck @"+t),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1}),this.stalled=!0),o.len<=l)){var g=o.nextStart,f=g-t;if(g&&f<this.config.maxSeekHole&&f>0){_logger.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+g+" + nudge "+this.seekHoleNudgeDuration);var u=g+this.seekHoleNudgeDuration-e.currentTime;e.currentTime=g+this.seekHoleNudgeDuration,this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:u})}}}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=State.IDLE,this.tick()}},{key:"onBufferFlushed",value:function(){var e,t,a=[];for(t=0;t<this.bufferRange.length;t++)e=this.bufferRange[t],this.isBuffered((e.start+e.end)/2)&&a.push(e);this.bufferRange=a,this.immediateSwitch&&this.immediateLevelSwitchEnd(),this.state=State.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"timeRangesToString",value:function(e){for(var t="",a=e.length,r=0;r<a;r++)t+="["+e.start(r)+","+e.end(r)+"]";return t}},{key:"currentLevel",get:function(){if(this.media){var e=this.getBufferRange(this.media.currentTime);if(e)return e.frag.level}return-1}},{key:"nextBufferRange",get:function(){return this.media?this.followingBufferRange(this.getBufferRange(this.media.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}}]),t}(_eventHandler2.default);exports.default=StreamController},{"../demux/demuxer":25,"../errors":29,"../event-handler":30,"../events":31,"../helper/buffer-helper":32,"../helper/level-helper":33,"../utils/binary-search":43,"../utils/logger":46}],17:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_cea708Interpreter=_dereq_("../utils/cea-708-interpreter"),_cea708Interpreter2=_interopRequireDefault(_cea708Interpreter),TimelineController=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2.default.MEDIA_ATTACHING,_events2.default.MEDIA_DETACHING,_events2.default.FRAG_PARSING_USERDATA,_events2.default.MANIFEST_LOADING,_events2.default.FRAG_LOADED));return r.hls=e,r.config=e.config,r.config.enableCEA708Captions&&(r.cea708Interpreter=new _cea708Interpreter2.default),r}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){_eventHandler2.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;this.cea708Interpreter.attach(t)}},{key:"onMediaDetaching",value:function(){this.cea708Interpreter.detach()}},{key:"onManifestLoading",value:function(){this.lastPts=Number.POSITIVE_INFINITY}},{key:"onFragLoaded",value:function(e){var t=e.frag.start;t<=this.lastPts&&this.cea708Interpreter.clear(),this.lastPts=t}},{key:"onFragParsingUserdata",value:function(e){for(var t=0;t<e.samples.length;t++)this.cea708Interpreter.push(e.samples[t].pts,e.samples[t].bytes)}}]),t}(_eventHandler2.default);exports.default=TimelineController},{"../event-handler":30,"../events":31,"../utils/cea-708-interpreter":44}],18:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),AES=function(){function e(t){_classCallCheck(this,e),this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],this._precompute();var r,a,s,n,l,o=this._tables[0][4],i=this._tables[1],c=t.length,f=1;if(4!==c&&6!==c&&8!==c)throw new Error("Invalid aes key size="+c);for(n=t.slice(0),l=[],this._key=[n,l],r=c;r<4*c+28;r++)s=n[r-1],(r%c===0||8===c&&r%c===4)&&(s=o[s>>>24]<<24^o[s>>16&255]<<16^o[s>>8&255]<<8^o[255&s],r%c===0&&(s=s<<8^s>>>24^f<<24,f=f<<1^283*(f>>7))),n[r]=n[r-c]^s;for(a=0;r;a++,r--)s=n[3&a?r:r-4],r<=4||a<4?l[a]=s:l[a]=i[0][o[s>>>24]]^i[1][o[s>>16&255]]^i[2][o[s>>8&255]]^i[3][o[255&s]]}return _createClass(e,[{key:"_precompute",value:function(){var e,t,r,a,s,n,l,o,i,c=this._tables[0],f=this._tables[1],u=c[4],h=f[4],_=[],b=[];for(e=0;e<256;e++)b[(_[e]=e<<1^283*(e>>7))^e]=e;for(t=r=0;!u[t];t^=a||1,r=b[r]||1)for(l=r^r<<1^r<<2^r<<3^r<<4,l=l>>8^255&l^99,u[t]=l,h[l]=t,n=_[s=_[a=_[t]]],i=16843009*n^65537*s^257*a^16843008*t,o=257*_[l]^16843008*l,e=0;e<4;e++)c[e][t]=o=o<<24^o>>>8,f[e][l]=i=i<<24^i>>>8;for(e=0;e<5;e++)c[e]=c[e].slice(0),f[e]=f[e].slice(0)}},{key:"decrypt",value:function(e,t,r,a,s,n){var l,o,i,c,f=this._key[1],u=e^f[0],h=a^f[1],_=r^f[2],b=t^f[3],p=f.length/4-2,v=4,y=this._tables[1],k=y[0],C=y[1],d=y[2],w=y[3],g=y[4];for(c=0;c<p;c++)l=k[u>>>24]^C[h>>16&255]^d[_>>8&255]^w[255&b]^f[v],o=k[h>>>24]^C[_>>16&255]^d[b>>8&255]^w[255&u]^f[v+1],i=k[_>>>24]^C[b>>16&255]^d[u>>8&255]^w[255&h]^f[v+2],b=k[b>>>24]^C[u>>16&255]^d[h>>8&255]^w[255&_]^f[v+3],v+=4,u=l,h=o,_=i;for(c=0;c<4;c++)s[(3&-c)+n]=g[u>>>24]<<24^g[h>>16&255]<<16^g[_>>8&255]<<8^g[255&b]^f[v++],l=u,u=h,h=_,_=b,b=l}}]),e}();exports.default=AES},{}],19:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_aes=_dereq_("./aes"),_aes2=_interopRequireDefault(_aes),AES128Decrypter=function(){function e(t,r){_classCallCheck(this,e),this.key=t,this.iv=r}return _createClass(e,[{key:"ntoh",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"doDecrypt",value:function(e,t,r){var n,a,i,o,s,u,h,l,c,y=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),f=new _aes2.default(Array.prototype.slice.call(t)),p=new Uint8Array(e.byteLength),b=new Int32Array(p.buffer);for(n=~~r[0],a=~~r[1],i=~~r[2],o=~~r[3],c=0;c<y.length;c+=4)s=~~this.ntoh(y[c]),u=~~this.ntoh(y[c+1]),h=~~this.ntoh(y[c+2]),l=~~this.ntoh(y[c+3]),f.decrypt(s,u,h,l,b,c),b[c]=this.ntoh(b[c]^n),b[c+1]=this.ntoh(b[c+1]^a),b[c+2]=this.ntoh(b[c+2]^i),b[c+3]=this.ntoh(b[c+3]^o),n=s,a=u,i=h,o=l;return p}},{key:"localDecrypt",value:function(e,t,r,n){var a=this.doDecrypt(e,t,r);n.set(a,e.byteOffset)}},{key:"decrypt",value:function(e){var t=32e3,r=new Int32Array(e),n=new Uint8Array(e.byteLength),a=0,i=this.key,o=this.iv;for(this.localDecrypt(r.subarray(a,a+t),i,o,n),a=t;a<r.length;a+=t)o=new Uint32Array([this.ntoh(r[a-4]),this.ntoh(r[a-3]),this.ntoh(r[a-2]),this.ntoh(r[a-1])]),this.localDecrypt(r.subarray(a,a+t),i,o,n);return n}}]),e}();exports.default=AES128Decrypter},{"./aes":18}],20:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_aes128Decrypter=_dereq_("./aes128-decrypter"),_aes128Decrypter2=_interopRequireDefault(_aes128Decrypter),_errors=_dereq_("../errors"),_logger=_dereq_("../utils/logger"),Decrypter=function(){function e(r){_classCallCheck(this,e),this.hls=r;try{var t=window?window.crypto:crypto;this.subtle=t.subtle||t.webkitSubtle,this.disableWebCrypto=!this.subtle}catch(e){this.disableWebCrypto=!0}}return _createClass(e,[{key:"destroy",value:function(){}},{key:"decrypt",value:function(e,r,t,n){this.disableWebCrypto&&this.hls.config.enableSoftwareAES?this.decryptBySoftware(e,r,t,n):this.decryptByWebCrypto(e,r,t,n)}},{key:"decryptByWebCrypto",value:function(e,r,t,n){var o=this;_logger.logger.log("decrypting by WebCrypto API"),this.subtle.importKey("raw",r,{name:"AES-CBC",length:128},!1,["decrypt"]).then(function(i){o.subtle.decrypt({name:"AES-CBC",iv:t.buffer},i,e).then(n).catch(function(i){o.onWebCryptoError(i,e,r,t,n)})}).catch(function(i){o.onWebCryptoError(i,e,r,t,n)})}},{key:"decryptBySoftware",value:function(e,r,t,n){_logger.logger.log("decrypting by JavaScript Implementation");var o=new DataView(r.buffer),i=new Uint32Array([o.getUint32(0),o.getUint32(4),o.getUint32(8),o.getUint32(12)]);o=new DataView(t.buffer);var a=new Uint32Array([o.getUint32(0),o.getUint32(4),o.getUint32(8),o.getUint32(12)]),s=new _aes128Decrypter2.default(i,a);n(s.decrypt(e).buffer)}},{key:"onWebCryptoError",value:function(e,r,t,n,o){this.hls.config.enableSoftwareAES?(_logger.logger.log("disabling to use WebCrypto API"),this.disableWebCrypto=!0,this.decryptBySoftware(r,t,n,o)):(_logger.logger.error("decrypting error : "+e.message),this.hls.trigger(Event.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}}]),e}();exports.default=Decrypter},{"../errors":29,"../utils/logger":46,"./aes128-decrypter":19}],21:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(a,t,r){return t&&e(a.prototype,t),r&&e(a,r),a}}(),_adts=_dereq_("./adts"),_adts2=_interopRequireDefault(_adts),_logger=_dereq_("../utils/logger"),_id=_dereq_("../demux/id3"),_id2=_interopRequireDefault(_id),AACDemuxer=function(){function e(a,t){_classCallCheck(this,e),this.observer=a,this.remuxerClass=t,this.remuxer=new this.remuxerClass(a),this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0}}return _createClass(e,[{key:"push",value:function(e,a,t,r,n,u,s,i){var l,o,c,d,f,p,h,m,_,g=this._aacTrack,C=new _id2.default(e),b=90*C.timeStamp;for(f=C.length,m=e.length;f<m-1&&(255!==e[f]||240!==(240&e[f+1]));f++);for(g.audiosamplerate||(l=_adts2.default.getAudioConfig(this.observer,e,f,a),g.config=l.config,g.audiosamplerate=l.samplerate,g.channelCount=l.channelCount,g.codec=l.codec,g.duration=i,_logger.logger.log("parsed codec:"+g.codec+",rate:"+l.samplerate+",nb channel:"+l.channelCount)),d=0,c=9216e4/g.audiosamplerate;f+5<m&&(p=1&e[f+1]?7:9,o=(3&e[f+3])<<11|e[f+4]<<3|(224&e[f+5])>>>5,o-=p,o>0&&f+p+o<=m);)for(h=b+d*c,_={unit:e.subarray(f+p,f+p+o),pts:h,dts:h},g.samples.push(_),g.len+=o,f+=o+p,d++;f<m-1&&(255!==e[f]||240!==(240&e[f+1]));f++);this.remuxer.remux(this._aacTrack,{samples:[]},{samples:[{pts:b,dts:b,unit:C.payload}]},{samples:[]},r)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var a,t,r=new _id2.default(e);if(r.hasTimeStamp)for(a=r.length,t=e.length;a<t-1;a++)if(255===e[a]&&240===(240&e[a+1]))return!0;return!1}}]),e}();exports.default=AACDemuxer},{"../demux/id3":27,"../utils/logger":46,"./adts":22}],22:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var a=r[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,n,a){return n&&e(r.prototype,n),a&&e(r,a),r}}(),_logger=_dereq_("../utils/logger"),_errors=_dereq_("../errors"),ADTS=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getAudioConfig",value:function(e,r,n,a){var t,o,i,l,s,c=navigator.userAgent.toLowerCase(),u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return t=((192&r[n+2])>>>6)+1,o=(60&r[n+2])>>>2,o>u.length-1?void e.trigger(Event.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o}):(l=(1&r[n+2])<<2,l|=(192&r[n+3])>>>6,_logger.logger.log("manifest codec:"+a+",ADTS data:type:"+t+",sampleingIndex:"+o+"["+u[o]+"Hz],channelConfig:"+l),c.indexOf("firefox")!==-1?o>=6?(t=5,s=new Array(4),i=o-3):(t=2,s=new Array(2),i=o):c.indexOf("android")!==-1?(t=2,s=new Array(2),i=o):(t=5,s=new Array(4),a&&(a.indexOf("mp4a.40.29")!==-1||a.indexOf("mp4a.40.5")!==-1)||!a&&o>=6?i=o-3:((a&&a.indexOf("mp4a.40.2")!==-1&&o>=6&&1===l||!a&&1===l)&&(t=2,s=new Array(2)),i=o)),s[0]=t<<3,s[0]|=(14&o)>>1,s[1]|=(1&o)<<7,s[1]|=l<<3,5===t&&(s[1]|=(14&i)>>1,s[2]=(1&i)<<7,s[2]|=8,s[3]=0),{config:s,samplerate:u[o],channelCount:l,codec:"mp4a.40."+t})}}]),e}();exports.default=ADTS},{"../errors":29,"../utils/logger":46}],23:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var u=0;u<r.length;u++){var t=r[u];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,u,t){return u&&e(r.prototype,u),t&&e(r,t),r}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_errors=_dereq_("../errors"),_aacdemuxer=_dereq_("../demux/aacdemuxer"),_aacdemuxer2=_interopRequireDefault(_aacdemuxer),_tsdemuxer=_dereq_("../demux/tsdemuxer"),_tsdemuxer2=_interopRequireDefault(_tsdemuxer),_mp4Remuxer=_dereq_("../remux/mp4-remuxer"),_mp4Remuxer2=_interopRequireDefault(_mp4Remuxer),_passthroughRemuxer=_dereq_("../remux/passthrough-remuxer"),_passthroughRemuxer2=_interopRequireDefault(_passthroughRemuxer),DemuxerInline=function(){function e(r,u){_classCallCheck(this,e),this.hls=r,this.typeSupported=u}return _createClass(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,r,u,t,a,s,n,i){var o=this.demuxer;if(!o){var l=this.hls;if(_tsdemuxer2.default.probe(e))o=this.typeSupported.mp2t===!0?new _tsdemuxer2.default(l,_passthroughRemuxer2.default):new _tsdemuxer2.default(l,_mp4Remuxer2.default);else{if(!_aacdemuxer2.default.probe(e))return void l.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});o=new _aacdemuxer2.default(l,_mp4Remuxer2.default)}this.demuxer=o}o.push(e,r,u,t,a,s,n,i)}}]),e}();exports.default=DemuxerInline},{"../demux/aacdemuxer":21,"../demux/tsdemuxer":28,"../errors":29,"../events":31,"../remux/mp4-remuxer":40,"../remux/passthrough-remuxer":41}],24:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _demuxerInline=_dereq_("../demux/demuxer-inline"),_demuxerInline2=_interopRequireDefault(_demuxerInline),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_events3=_dereq_("events"),_events4=_interopRequireDefault(_events3),DemuxerWorker=function(e){var t=new _events4.default;t.trigger=function(e){for(var n=arguments.length,a=Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];t.emit.apply(t,[e,e].concat(a))},t.off=function(e){for(var n=arguments.length,a=Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];t.removeListener.apply(t,[e].concat(a))},e.addEventListener("message",function(n){var a=n.data;switch(a.cmd){case"init":e.demuxer=new _demuxerInline2.default(t,a.typeSupported);break;case"demux":e.demuxer.push(new Uint8Array(a.data),a.audioCodec,a.videoCodec,a.timeOffset,a.cc,a.level,a.sn,a.duration)}}),t.on(_events2.default.FRAG_PARSING_INIT_SEGMENT,function(t,n){e.postMessage({event:t,tracks:n.tracks,unique:n.unique})}),t.on(_events2.default.FRAG_PARSING_DATA,function(t,n){var a={event:t,type:n.type,startPTS:n.startPTS,endPTS:n.endPTS,startDTS:n.startDTS,endDTS:n.endDTS,data1:n.data1.buffer,data2:n.data2.buffer,nb:n.nb,dropped:n.dropped};e.postMessage(a,[a.data1,a.data2])}),t.on(_events2.default.FRAG_PARSED,function(t){e.postMessage({event:t})}),t.on(_events2.default.ERROR,function(t,n){e.postMessage({event:t,data:n})}),t.on(_events2.default.FRAG_PARSING_METADATA,function(t,n){var a={event:t,samples:n.samples};e.postMessage(a)}),t.on(_events2.default.FRAG_PARSING_USERDATA,function(t,n){var a={event:t,samples:n.samples};e.postMessage(a)})};exports.default=DemuxerWorker},{"../demux/demuxer-inline":23,"../events":31,events:10}],25:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var s=r[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(r,t,s){return t&&e(r.prototype,t),s&&e(r,s),r}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_demuxerInline=_dereq_("../demux/demuxer-inline"),_demuxerInline2=_interopRequireDefault(_demuxerInline),_demuxerWorker=_dereq_("../demux/demuxer-worker"),_demuxerWorker2=_interopRequireDefault(_demuxerWorker),_logger=_dereq_("../utils/logger"),_decrypter=_dereq_("../crypt/decrypter"),_decrypter2=_interopRequireDefault(_decrypter),_errors=_dereq_("../errors"),Demuxer=function(){function e(r){_classCallCheck(this,e),this.hls=r;var t={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:r.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t")};if(r.config.enableWorker&&"undefined"!=typeof Worker){_logger.logger.log("demuxing in webworker");try{var s=_dereq_("webworkify"),n=this.w=s(_demuxerWorker2.default);this.onwmsg=this.onWorkerMessage.bind(this),n.addEventListener("message",this.onwmsg),n.onerror=function(e){r.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.OTHER_ERROR,details:_errors.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},n.postMessage({cmd:"init",typeSupported:t})}catch(e){_logger.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),this.demuxer=new _demuxerInline2.default(r,t)}}else this.demuxer=new _demuxerInline2.default(r,t);this.demuxInitialized=!0}return _createClass(e,[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var r=this.demuxer;r&&(r.destroy(),this.demuxer=null)}var t=this.decrypter;t&&(t.destroy(),this.decrypter=null)}},{key:"pushDecrypted",value:function(e,r,t,s,n,i,a,u){var l=this.w;if(l)l.postMessage({cmd:"demux",
data:e,audioCodec:r,videoCodec:t,timeOffset:s,cc:n,level:i,sn:a,duration:u},[e]);else{var d=this.demuxer;d&&d.push(new Uint8Array(e),r,t,s,n,i,a,u)}}},{key:"push",value:function(e,r,t,s,n,i,a,u,l){if(e.byteLength>0&&null!=l&&null!=l.key&&"AES-128"===l.method){null==this.decrypter&&(this.decrypter=new _decrypter2.default(this.hls));var d=this;this.decrypter.decrypt(e,l.key,l.iv,function(e){d.pushDecrypted(e,r,t,s,n,i,a,u)})}else this.pushDecrypted(e,r,t,s,n,i,a,u)}},{key:"onWorkerMessage",value:function(e){var r=e.data;switch(r.event){case _events2.default.FRAG_PARSING_INIT_SEGMENT:var t={};t.tracks=r.tracks,t.unique=r.unique,this.hls.trigger(_events2.default.FRAG_PARSING_INIT_SEGMENT,t);break;case _events2.default.FRAG_PARSING_DATA:this.hls.trigger(_events2.default.FRAG_PARSING_DATA,{data1:new Uint8Array(r.data1),data2:new Uint8Array(r.data2),startPTS:r.startPTS,endPTS:r.endPTS,startDTS:r.startDTS,endDTS:r.endDTS,type:r.type,nb:r.nb,dropped:r.dropped});break;case _events2.default.FRAG_PARSING_METADATA:this.hls.trigger(_events2.default.FRAG_PARSING_METADATA,{samples:r.samples});break;case _events2.default.FRAG_PARSING_USERDATA:this.hls.trigger(_events2.default.FRAG_PARSING_USERDATA,{samples:r.samples});break;default:this.hls.trigger(r.event,r.data)}}}]),e}();exports.default=Demuxer},{"../crypt/decrypter":20,"../demux/demuxer-inline":23,"../demux/demuxer-worker":24,"../errors":29,"../events":31,"../utils/logger":46,webworkify:54}],26:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var a=i[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(i,t,a){return t&&e(i.prototype,t),a&&e(i,a),i}}(),_logger=_dereq_("../utils/logger"),ExpGolomb=function(){function e(i){_classCallCheck(this,e),this.data=i,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return _createClass(e,[{key:"loadWord",value:function(){var e=this.data.byteLength-this.bytesAvailable,i=new Uint8Array(4),t=Math.min(4,this.bytesAvailable);if(0===t)throw new Error("no bytes available");i.set(this.data.subarray(e,e+t)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*t,this.bytesAvailable-=t}},{key:"skipBits",value:function(e){var i;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,i=e>>3,e-=i>>3,this.bytesAvailable-=i,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var i=Math.min(this.bitsAvailable,e),t=this.word>>>32-i;return e>32&&_logger.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=i,this.bitsAvailable>0?this.word<<=i:this.bytesAvailable>0&&this.loadWord(),i=e-i,i>0?t<<i|this.readBits(i):t}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var i,t,a=8,s=8;for(i=0;i<e;i++)0!==s&&(t=this.readEG(),s=(a+t+256)%256),a=0===s?a:s}},{key:"readSPS",value:function(){var e,i,t,a,s,r,h,l,n,o=0,d=0,b=0,u=0,k=1;if(this.readUByte(),e=this.readUByte(),i=this.readBits(5),this.skipBits(3),t=this.readUByte(),this.skipUEG(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var c=this.readUEG();if(3===c&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(l=3!==c?8:12,n=0;n<l;n++)this.readBoolean()&&(n<6?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var v=this.readUEG();if(0===v)this.readUEG();else if(1===v)for(this.skipBits(1),this.skipEG(),this.skipEG(),a=this.readUEG(),n=0;n<a;n++)this.skipEG();if(this.skipUEG(),this.skipBits(1),s=this.readUEG(),r=this.readUEG(),h=this.readBits(1),0===h&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(o=this.readUEG(),d=this.readUEG(),b=this.readUEG(),u=this.readUEG()),this.readBoolean()&&this.readBoolean()){var f=void 0,y=this.readUByte();switch(y){case 1:f=[1,1];break;case 2:f=[12,11];break;case 3:f=[10,11];break;case 4:f=[16,11];break;case 5:f=[40,33];break;case 6:f=[24,11];break;case 7:f=[20,11];break;case 8:f=[32,11];break;case 9:f=[80,33];break;case 10:f=[18,11];break;case 11:f=[15,11];break;case 12:f=[64,33];break;case 13:f=[160,99];break;case 14:f=[4,3];break;case 15:f=[3,2];break;case 16:f=[2,1];break;case 255:f=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()]}f&&(k=f[0]/f[1])}return{width:Math.ceil((16*(s+1)-2*o-2*d)*k),height:(2-h)*(r+1)*16-(h?2:4)*(b+u)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();exports.default=ExpGolomb},{"../utils/logger":46}],27:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_logger=_dereq_("../utils/logger"),ID3=function(){function e(t){_classCallCheck(this,e),this._hasTimeStamp=!1;for(var r,a,n,i,o,s,l,u,h=0;;)if(l=this.readUTF(t,h,3),h+=3,"ID3"===l)h+=3,r=127&t[h++],a=127&t[h++],n=127&t[h++],i=127&t[h++],o=(r<<21)+(a<<14)+(n<<7)+i,s=h+o,this._parseID3Frames(t,h,s),h=s;else{if("3DI"!==l)return h-=3,u=h,void(u&&(this.hasTimeStamp||_logger.logger.warn("ID3 tag found, but no timestamp"),this._length=u,this._payload=t.subarray(0,u)));h+=7,_logger.logger.log("3DI footer found, end: "+h)}}return _createClass(e,[{key:"readUTF",value:function(e,t,r){var a="",n=t,i=t+r;do a+=String.fromCharCode(e[n++]);while(n<i);return a}},{key:"_parseID3Frames",value:function(e,t,r){for(var a,n,i,o,s;t+8<=r;)switch(a=this.readUTF(e,t,4),t+=4,n=e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++],o=e[t++]<<8+e[t++],i=t,a){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(e,t,44)){t+=44,t+=4;var l=1&e[t++];this._hasTimeStamp=!0,s=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,l&&(s+=47721858.84),s=Math.round(s),_logger.logger.trace("ID3 timestamp found: "+s),this._timeStamp=s}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),e}();exports.default=ID3},{"../utils/logger":46}],28:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),_adts=_dereq_("./adts"),_adts2=_interopRequireDefault(_adts),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_expGolomb=_dereq_("./exp-golomb"),_expGolomb2=_interopRequireDefault(_expGolomb),_logger=_dereq_("../utils/logger"),_errors=_dereq_("../errors"),TSDemuxer=function(){function e(t,a){_classCallCheck(this,e),this.observer=t,this.remuxerClass=a,this.lastCC=0,this.remuxer=new this.remuxerClass(t)}return _createClass(e,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,nbNalu:0,dropped:0},this._aacTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcNaluState=0,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(e,t,a,s,r,i,n,u){var l,h,o,c,d,p,g,_,f=e.length,v=this.remuxer.passthrough,y=!1;this.audioCodec=t,this.videoCodec=a,this.timeOffset=s,this._duration=u,this.contiguous=!1,r!==this.lastCC&&(_logger.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=r),i!==this.lastLevel?(_logger.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=i):n===this.lastSN+1&&(this.contiguous=!0),this.lastSN=n;var b=this.pmtParsed,k=this._avcTrack.id,m=this._aacTrack.id,T=this._id3Track.id;for(f-=f%188,c=0;c<f;c+=188)if(71===e[c]){if(d=!!(64&e[c+1]),p=((31&e[c+1])<<8)+e[c+2],g=(48&e[c+3])>>4,g>1){if(_=c+5+e[c+4],_===c+188)continue}else _=c+4;if(b)if(p===k){if(d){if(l&&(this._parseAVCPES(this._parsePES(l)),v&&this._avcTrack.codec&&(m===-1||this._aacTrack.codec)))return void this.remux(e);l={data:[],size:0}}l&&(l.data.push(e.subarray(_,c+188)),l.size+=c+188-_)}else if(p===m){if(d){if(h&&(this._parseAACPES(this._parsePES(h)),v&&this._aacTrack.codec&&(k===-1||this._avcTrack.codec)))return void this.remux(e);h={data:[],size:0}}h&&(h.data.push(e.subarray(_,c+188)),h.size+=c+188-_)}else p===T&&(d&&(o&&this._parseID3PES(this._parsePES(o)),o={data:[],size:0}),o&&(o.data.push(e.subarray(_,c+188)),o.size+=c+188-_));else d&&(_+=e[_]+1),0===p?this._parsePAT(e,_):p===this._pmtId?(this._parsePMT(e,_),b=this.pmtParsed=!0,k=this._avcTrack.id,m=this._aacTrack.id,T=this._id3Track.id,y&&(_logger.logger.log("reparse from beginning"),y=!1,c=-188)):(_logger.logger.log("unknown PID found before PAT/PMT"),y=!0)}else this.observer.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});l&&this._parseAVCPES(this._parsePES(l)),h&&this._parseAACPES(this._parsePES(h)),o&&this._parseID3PES(this._parsePES(o)),this.remux(null)}},{key:"remux",value:function(e){this.remuxer.remux(this._aacTrack,this._avcTrack,this._id3Track,this._txtTrack,this.timeOffset,this.contiguous,e)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){this._pmtId=(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t){var a,s,r,i;for(a=(15&e[t+1])<<8|e[t+2],s=t+3+a-4,r=(15&e[t+10])<<8|e[t+11],t+=12+r;t<s;){switch(i=(31&e[t+1])<<8|e[t+2],e[t]){case 15:this._aacTrack.id=i;break;case 21:this._id3Track.id=i;break;case 27:this._avcTrack.id=i;break;default:_logger.logger.log("unkown stream type:"+e[t])}t+=((15&e[t+3])<<8|e[t+4])+5}}},{key:"_parsePES",value:function(e){var t,a,s,r,i,n,u,l,h,o=0,c=e.data;if(t=c[0],s=(t[0]<<16)+(t[1]<<8)+t[2],1===s){for(r=(t[4]<<8)+t[5],a=t[7],192&a&&(u=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,u>4294967295&&(u-=8589934592),64&a?(l=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,l>4294967295&&(l-=8589934592)):l=u),i=t[8],h=i+9,e.size-=h,n=new Uint8Array(e.size);c.length;){t=c.shift();var d=t.byteLength;if(h){if(h>d){h-=d;continue}t=t.subarray(h),d-=h,h=0}n.set(t,o),o+=d}return{data:n,pts:u,dts:l,len:r}}return null}},{key:"_parseAVCPES",value:function(e){var t,a,s,r,i=this,n=this._avcTrack,u=n.samples,l=this._parseAVCNALu(e.data),h=[],o=!1,c=!1,d=0;if(0===l.length&&u.length>0){var p=u[u.length-1],g=p.units.units[p.units.units.length-1],_=new Uint8Array(g.data.byteLength+e.data.byteLength);_.set(g.data,0),_.set(e.data,g.data.byteLength),g.data=_,p.units.length+=e.data.byteLength,n.len+=e.data.byteLength}e.data=null;var f="",v=function(){h.length&&(c===!0||n.sps&&(u.length||this.contiguous)?(a={units:{units:h,length:d},pts:e.pts,dts:e.dts,key:c},u.push(a),n.len+=d,n.nbNalu+=h.length):n.dropped++,h=[],d=0)}.bind(this);l.forEach(function(a){switch(a.type){case 1:s=!0,o&&(f+="NDR ");break;case 5:s=!0,o&&(f+="IDR "),c=!0;break;case 6:s=!0,o&&(f+="SEI "),t=new _expGolomb2.default(a.data),t.readUByte();var u=t.readUByte();if(4===u){var l=0;do l=t.readUByte();while(255===l);var p=t.readUByte();if(181===p){var g=t.readUShort();if(49===g){var _=t.readUInt();if(1195456820===_){var y=t.readUByte();if(3===y){var b=t.readUByte(),k=t.readUByte(),m=31&b,T=[b,k];for(r=0;r<m;r++)T.push(t.readUByte()),T.push(t.readUByte()),T.push(t.readUByte());i._txtTrack.samples.push({type:3,pts:e.pts,bytes:T})}}}}}break;case 7:if(s=!0,o&&(f+="SPS "),!n.sps){t=new _expGolomb2.default(a.data);var S=t.readSPS();n.width=S.width,n.height=S.height,n.sps=[a.data],n.duration=i._duration;var P=a.data.subarray(1,4),A="avc1.";for(r=0;r<3;r++){var C=P[r].toString(16);C.length<2&&(C="0"+C),A+=C}n.codec=A}break;case 8:s=!0,o&&(f+="PPS "),n.pps||(n.pps=[a.data]);break;case 9:s=!1,o&&(f+="AUD "),v();break;default:s=!1,f+="unknown NAL "+a.type+" "}s&&(h.push(a),d+=a.data.byteLength)}),(o||f.length)&&_logger.logger.log(f),v()}},{key:"_parseAVCNALu",value:function(e){for(var t,a,s,r,i,n,u=0,l=e.byteLength,h=this.avcNaluState,o=[];u<l;)switch(t=e[u++],h){case 0:0===t&&(h=1);break;case 1:h=0===t?2:0;break;case 2:case 3:if(0===t)h=3;else if(1===t&&u<l){if(r=31&e[u],i)s={data:e.subarray(i,u-h-1),type:n},o.push(s);else{var c=this.avcNaluState;if(c&&u<=4-c){var d=this._avcTrack,p=d.samples;if(p.length){var g=p[p.length-1],_=g.units.units,f=_[_.length-1];f.state&&(f.data=f.data.subarray(0,f.data.byteLength-c),g.units.length-=c,d.len-=c)}}if(a=u-h-1,a>0){var v=this._avcTrack,y=v.samples;if(y.length){var b=y[y.length-1],k=b.units.units,m=k[k.length-1],T=new Uint8Array(m.data.byteLength+a);T.set(m.data,0),T.set(e.subarray(0,a),m.data.byteLength),m.data=T,b.units.length+=a,v.len+=a}}}i=u,n=r,h=0}else h=0}return i&&(s={data:e.subarray(i,l),type:n,state:h},o.push(s),this.avcNaluState=h),o}},{key:"_parseAACPES",value:function(e){var t,a,s,r,i,n,u,l,h,o=this._aacTrack,c=e.data,d=e.pts,p=0,g=this._duration,_=this.audioCodec,f=this.aacOverFlow,v=this.aacLastPTS;if(f){var y=new Uint8Array(f.byteLength+c.byteLength);y.set(f,0),y.set(c,f.byteLength),c=y}for(i=p,l=c.length;i<l-1&&(255!==c[i]||240!==(240&c[i+1]));i++);if(i){var b,k;if(i<l-1?(b="AAC PES did not start with ADTS header,offset:"+i,k=!1):(b="no ADTS header found in AAC PES",k=!0),this.observer.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:k,reason:b}),k)return}if(o.audiosamplerate||(t=_adts2.default.getAudioConfig(this.observer,c,i,_),o.config=t.config,o.audiosamplerate=t.samplerate,o.channelCount=t.channelCount,o.codec=t.codec,o.duration=g,_logger.logger.log("parsed codec:"+o.codec+",rate:"+t.samplerate+",nb channel:"+t.channelCount)),r=0,s=9216e4/o.audiosamplerate,f&&v){var m=v+s;Math.abs(m-d)>1&&(_logger.logger.log("AAC: align PTS for overlapping frames by "+Math.round((m-d)/90)),d=m)}for(;i+5<l&&(n=1&c[i+1]?7:9,a=(3&c[i+3])<<11|c[i+4]<<3|(224&c[i+5])>>>5,a-=n,a>0&&i+n+a<=l);)for(u=d+r*s,h={unit:c.subarray(i+n,i+n+a),pts:u,dts:u},o.samples.push(h),o.len+=a,i+=a+n,r++;i<l-1&&(255!==c[i]||240!==(240&c[i+1]));i++);f=i<l?c.subarray(i,l):null,this.aacOverFlow=f,this.aacLastPTS=u}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]}}]),e}();exports.default=TSDemuxer},{"../errors":29,"../events":31,"../utils/logger":46,"./adts":22,"./exp-golomb":26}],29:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"},exports.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",INTERNAL_EXCEPTION:"internalException"}},{}],30:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_logger=_dereq_("./utils/logger"),_errors=_dereq_("./errors"),_events=_dereq_("./events"),_events2=_interopRequireDefault(_events),EventHandler=function(){function e(t){_classCallCheck(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}return _createClass(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===_typeof(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var n=function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)};try{n.call(this,e,t).call()}catch(t){_logger.logger.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.OTHER_ERROR,details:_errors.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();exports.default=EventHandler},{"./errors":29,"./events":31,"./utils/logger":46}],31:[function(_dereq_,module,exports){"use strict";module.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded"}},{}],32:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),BufferHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"bufferInfo",value:function(e,r,t){if(e){var n,a=e.buffered,f=[];for(n=0;n<a.length;n++)f.push({start:a.start(n),end:a.end(n)});return this.bufferedInfo(f,r,t)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,r,t){var n,a,f,u,l,s=[];for(e.sort(function(e,r){var t=e.start-r.start;return t?t:r.end-e.end}),l=0;l<e.length;l++){var o=s.length;if(o){var i=s[o-1].end;e[l].start-i<t?e[l].end>i&&(s[o-1].end=e[l].end):s.push(e[l])}else s.push(e[l])}for(l=0,n=0,a=f=r;l<s.length;l++){var c=s[l].start,d=s[l].end;if(r+t>=c&&r<d)a=c,f=d,n=f-r;else if(r+t<c){u=c;break}}return{len:n,start:a,end:f,nextStart:u}}}]),e}();exports.default=BufferHelper},{}],33:[function(_dereq_,module,exports){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),_logger=_dereq_("../utils/logger"),LevelHelper=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"mergeDetails",value:function(e,r){var a,n=Math.max(e.startSN,r.startSN)-r.startSN,s=Math.min(e.endSN,r.endSN)-r.startSN,o=r.startSN-e.startSN,l=e.fragments,i=r.fragments,u=0;if(s<n)return void(r.PTSKnown=!1);for(var d=n;d<=s;d++){var S=l[o+d],f=i[d];f&&S&&(u=S.cc-f.cc,isNaN(S.startPTS)||(f.start=f.startPTS=S.startPTS,f.endPTS=S.endPTS,f.duration=S.duration,a=f))}if(u)for(_logger.logger.log("discontinuity sliding from playlist, take drift into account"),d=0;d<i.length;d++)i[d].cc+=u;if(a)t.updateFragPTSDTS(r,a.sn,a.startPTS,a.endPTS,a.startDTS,a.endDTS);else if(o>=0&&o<l.length){var g=l[o].start;for(d=0;d<i.length;d++)i[d].start+=g}r.PTSKnown=e.PTSKnown}},{key:"updateFragPTSDTS",value:function(e,r,a,n,s,o){var l,i,u,d;if(r<e.startSN||r>e.endSN)return 0;if(l=r-e.startSN,i=e.fragments,u=i[l],!isNaN(u.startPTS)){var S=Math.abs(u.startPTS-a);isNaN(u.deltaPTS)?u.deltaPTS=S:u.deltaPTS=Math.max(S,u.deltaPTS),a=Math.min(a,u.startPTS),n=Math.max(n,u.endPTS),s=Math.min(s,u.startDTS),o=Math.max(o,u.endDTS)}var f=a-u.start;for(u.start=u.startPTS=a,u.endPTS=n,u.startDTS=s,u.endDTS=o,u.duration=n-a,d=l;d>0;d--)t.updatePTS(i,d,d-1);for(d=l;d<i.length-1;d++)t.updatePTS(i,d,d+1);return e.PTSKnown=!0,f}},{key:"updatePTS",value:function(t,e,r){var a=t[e],n=t[r],s=n.startPTS;isNaN(s)?r>e?n.start=a.start+a.duration:n.start=a.start-n.duration:r>e?(a.duration=s-a.start,a.duration<0&&_logger.logger.error("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")):(n.duration=a.start-s,n.duration<0&&_logger.logger.error("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!"))}}]),t}();exports.default=LevelHelper},{"../utils/logger":46}],34:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var l=r[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(r,t,l){return t&&e(r.prototype,t),l&&e(r,l),r}}(),_events=_dereq_("./events"),_events2=_interopRequireDefault(_events),_errors=_dereq_("./errors"),_playlistLoader=_dereq_("./loader/playlist-loader"),_playlistLoader2=_interopRequireDefault(_playlistLoader),_fragmentLoader=_dereq_("./loader/fragment-loader"),_fragmentLoader2=_interopRequireDefault(_fragmentLoader),_abrController=_dereq_("./controller/abr-controller"),_abrController2=_interopRequireDefault(_abrController),_bufferController=_dereq_("./controller/buffer-controller"),_bufferController2=_interopRequireDefault(_bufferController),_capLevelController=_dereq_("./controller/cap-level-controller"),_capLevelController2=_interopRequireDefault(_capLevelController),_streamController=_dereq_("./controller/stream-controller"),_streamController2=_interopRequireDefault(_streamController),_levelController=_dereq_("./controller/level-controller"),_levelController2=_interopRequireDefault(_levelController),_timelineController=_dereq_("./controller/timeline-controller"),_timelineController2=_interopRequireDefault(_timelineController),_logger=_dereq_("./utils/logger"),_xhrLoader=_dereq_("./utils/xhr-loader"),_xhrLoader2=_interopRequireDefault(_xhrLoader),_events3=_dereq_("events"),_events4=_interopRequireDefault(_events3),_keyLoader=_dereq_("./loader/key-loader"),_keyLoader2=_interopRequireDefault(_keyLoader),Hls=function(){function e(){var r=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,e);var t=e.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var l in t)l in r||(r[l]=t[l]);if(void 0!==r.liveMaxLatencyDurationCount&&r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==r.liveMaxLatencyDuration&&(r.liveMaxLatencyDuration<=r.liveSyncDuration||void 0===r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,_logger.enableLogs)(r.debug),this.config=r;var o=this.observer=new _events4.default;o.trigger=function(e){for(var r=arguments.length,t=Array(r>1?r-1:0),l=1;l<r;l++)t[l-1]=arguments[l];o.emit.apply(o,[e,e].concat(t))},o.off=function(e){for(var r=arguments.length,t=Array(r>1?r-1:0),l=1;l<r;l++)t[l-1]=arguments[l];o.removeListener.apply(o,[e].concat(t))},this.on=o.on.bind(o),this.off=o.off.bind(o),this.trigger=o.trigger.bind(o),this.playlistLoader=new _playlistLoader2.default(this),this.fragmentLoader=new _fragmentLoader2.default(this),this.levelController=new _levelController2.default(this),this.abrController=new r.abrController(this),this.bufferController=new r.bufferController(this),this.capLevelController=new r.capLevelController(this),this.streamController=new r.streamController(this),this.timelineController=new r.timelineController(this),this.keyLoader=new _keyLoader2.default(this)}return _createClass(e,null,[{key:"isSupported",value:function(){return window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"Events",get:function(){return _events2.default}},{key:"ErrorTypes",get:function(){return _errors.ErrorTypes}},{key:"ErrorDetails",get:function(){return _errors.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,debug:!1,capLevelToPlayerSize:!1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,seekHoleNudgeDuration:.01,stalledInBufferedNudgeThreshold:10,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,appendErrorMaxRetry:3,loader:_xhrLoader2.default,fLoader:void 0,pLoader:void 0,abrController:_abrController2.default,bufferController:_bufferController2.default,capLevelController:_capLevelController2.default,streamController:_streamController2.default,timelineController:_timelineController2.default,enableCEA708Captions:!0,enableMP2TPassThrough:!1,abrEwmaFastLive:5,abrEwmaSlowLive:9,abrEwmaFastVoD:4,abrEwmaSlowVoD:15,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.8,abrBandWidthUpFactor:.7}),e.defaultConfig},set:function(r){e.defaultConfig=r}}]),_createClass(e,[{key:"destroy",value:function(){_logger.logger.log("destroy"),this.trigger(_events2.default.DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.streamController.destroy(),this.timelineController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(e){_logger.logger.log("attachMedia"),this.media=e,this.trigger(_events2.default.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){_logger.logger.log("detachMedia"),this.trigger(_events2.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){_logger.logger.log("loadSource:"+e),this.url=e,this.trigger(_events2.default.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length<=0||void 0===arguments[0]?-1:arguments[0];_logger.logger.log("startLoad"),this.levelController.startLoad(),this.streamController.startLoad(e)}},{key:"stopLoad",value:function(){_logger.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad()}},{key:"swapAudioCodec",value:function(){_logger.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){_logger.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){_logger.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){_logger.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){_logger.logger.log("set loadLevel:"+e),
this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return this.levelController.firstLevel},set:function(e){_logger.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){_logger.logger.log("set startLevel:"+e),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(e){_logger.logger.log("set autoLevelCapping:"+e),this.abrController.autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}}]),e}();exports.default=Hls},{"./controller/abr-controller":11,"./controller/buffer-controller":12,"./controller/cap-level-controller":13,"./controller/level-controller":15,"./controller/stream-controller":16,"./controller/timeline-controller":17,"./errors":29,"./events":31,"./loader/fragment-loader":36,"./loader/key-loader":37,"./loader/playlist-loader":38,"./utils/logger":46,"./utils/xhr-loader":48,events:10}],35:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./hls.js").default},{"./hls.js":34}],36:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_errors=_dereq_("../errors"),FragmentLoader=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2.default.FRAG_LOADING))}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),_eventHandler2.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;this.frag=t,this.frag.loaded=0;var r=this.hls.config;t.loader=this.loader="undefined"!=typeof r.fLoader?new r.fLoader(r):new r.loader(r),this.loader.load(t.url,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),r.fragLoadingTimeOut,0,0,this.loadprogress.bind(this),t)}},{key:"loadsuccess",value:function(e,t){var r=e.currentTarget.response;t.length=r.byteLength,this.frag.loader=void 0,this.hls.trigger(_events2.default.FRAG_LOADED,{payload:r,frag:this.frag,stats:t})}},{key:"loaderror",value:function(e){this.loader&&this.loader.abort(),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:this.frag,response:e})}},{key:"loadtimeout",value:function(){this.loader&&this.loader.abort(),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:this.frag})}},{key:"loadprogress",value:function(e,t){this.frag.loaded=t.loaded,this.hls.trigger(_events2.default.FRAG_LOAD_PROGRESS,{frag:this.frag,stats:t})}}]),t}(_eventHandler2.default);exports.default=FragmentLoader},{"../errors":29,"../event-handler":30,"../events":31}],37:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_errors=_dereq_("../errors"),KeyLoader=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e,_events2.default.KEY_LOADING));return t.decryptkey=null,t.decrypturl=null,t}return _inherits(r,e),_createClass(r,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),_eventHandler2.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var r=this.frag=e.frag,t=r.decryptdata,o=t.uri;if(o!==this.decrypturl||null===this.decryptkey){var a=this.hls.config;r.loader=this.loader=new a.loader(a),this.decrypturl=o,this.decryptkey=null,r.loader.load(o,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),a.fragLoadingTimeOut,a.fragLoadingMaxRetry,a.fragLoadingRetryDelay,this.loadprogress.bind(this),r)}else this.decryptkey&&(t.key=this.decryptkey,this.hls.trigger(_events2.default.KEY_LOADED,{frag:r}))}},{key:"loadsuccess",value:function(e){var r=this.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(e.currentTarget.response),r.loader=void 0,this.hls.trigger(_events2.default.KEY_LOADED,{frag:r})}},{key:"loaderror",value:function(e){this.loader&&this.loader.abort(),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:this.frag,response:e})}},{key:"loadtimeout",value:function(){this.loader&&this.loader.abort(),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:this.frag})}},{key:"loadprogress",value:function(){}}]),r}(_eventHandler2.default);exports.default=KeyLoader},{"../errors":29,"../event-handler":30,"../events":31}],38:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,r,l){return r&&e(t.prototype,r),l&&e(t,l),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_errors=_dereq_("../errors"),_url=_dereq_("../utils/url"),_url2=_interopRequireDefault(_url),_attrList=_dereq_("../utils/attr-list"),_attrList2=_interopRequireDefault(_attrList),_logger=_dereq_("../utils/logger"),PlaylistLoader=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2.default.MANIFEST_LOADING,_events2.default.LEVEL_LOADING))}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),this.url=this.id=null,_eventHandler2.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,null)}},{key:"onLevelLoading",value:function(e){this.load(e.url,e.level,e.id)}},{key:"load",value:function(e,t,r){var l,a,i,n=this.hls.config;if(this.loading&&this.loader){if(this.url===e&&this.id===t&&this.id2===r)return;this.loader.abort()}this.url=e,this.id=t,this.id2=r,null===this.id?(l=n.manifestLoadingMaxRetry,a=n.manifestLoadingTimeOut,i=n.manifestLoadingRetryDelay):(l=n.levelLoadingMaxRetry,a=n.levelLoadingTimeOut,i=n.levelLoadingRetryDelay),this.loader="undefined"!=typeof n.pLoader?new n.pLoader(n):new n.loader(n),this.loading=!0,this.loader.load(e,"",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),a,l,i)}},{key:"resolve",value:function(e,t){return _url2.default.buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(e,t){for(var r=[],l=void 0,a=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g;null!=(l=a.exec(e));){var i={},n=i.attrs=new _attrList2.default(l[1]);i.url=this.resolve(l[2],t);var s=n.decimalResolution("RESOLUTION");s&&(i.width=s.width,i.height=s.height),i.bitrate=n.decimalInteger("AVERAGE-BANDWIDTH")||n.decimalInteger("BANDWIDTH"),i.name=n.NAME;var o=n.CODECS;if(o){o=o.split(",");for(var u=0;u<o.length;u++){var d=o[u];d.indexOf("avc1")!==-1?i.videoCodec=this.avc1toavcoti(d):i.audioCodec=d}}r.push(i)}return r}},{key:"createInitializationVector",value:function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,t){var r=e;return e&&e.method&&e.uri&&!e.iv&&(r=this.cloneObj(e),r.iv=this.createInitializationVector(t)),r}},{key:"avc1toavcoti",value:function(e){var t,r=e.split(".");return r.length>2?(t=r.shift()+".",t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"parseLevelPlaylist",value:function(e,t,r){var l,a,i,n=0,s=0,o={version:null,type:null,url:t,fragments:[],live:!0,startSN:0},u={method:null,key:null,iv:null,uri:null},d=0,f=null,c=null,h=null,E=null,v=null,_=null;for(i=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT(INF):(\d+(?:\.\d+)?)(?:,(.*))?)|(?:(?!#)()(\S.+))|(?:#EXT-X-(BYTERANGE):(\d+(?:@\d+(?:\.\d+)?))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(PROGRAM-DATE-TIME):(.+))|(?:#EXT-X-(VERSION):(\d+))|(?:(#)(.*):(.*))|(?:(#)(.*)))(?:.*)\r?\n?/g;null!==(a=i.exec(e));)switch(a.shift(),a=a.filter(function(e){return void 0!==e}),a[0]){case"VERSION":o.version=parseInt(a[1]);break;case"PLAYLIST-TYPE":o.type=a[1].toUpperCase();break;case"MEDIA-SEQUENCE":n=o.startSN=parseInt(a[1]);break;case"TARGETDURATION":o.targetduration=parseFloat(a[1]);break;case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"DIS":d++;break;case"BYTERANGE":var p=a[1].split("@");_=1===p.length?v:parseInt(p[1]),v=parseInt(p[0])+_;break;case"INF":h=parseFloat(a[1]),E=a[2]?a[2]:null;break;case"":if(!isNaN(h)){var R=n++;l=this.fragmentDecryptdataFromLevelkey(u,R);var T=a[1]?this.resolve(a[1],t):null;c={url:T,duration:h,title:E,start:s,sn:R,level:r,cc:d,decryptdata:l,programDateTime:f},null!==_&&(c.byteRangeStartOffset=_,c.byteRangeEndOffset=v),o.fragments.push(c),s+=h,h=null,E=null,_=null,f=null}break;case"KEY":var g=a[1],y=new _attrList2.default(g),O=y.enumeratedString("METHOD"),I=y.URI,L=y.hexadecimalInteger("IV");O&&(u={method:null,key:null,iv:null,uri:null},I&&"AES-128"===O&&(u.method=O,u.uri=this.resolve(I,t),u.key=null,u.iv=L));break;case"START":var b=a[1],D=new _attrList2.default(b),A=D.decimalFloatingPoint("TIME-OFFSET");A&&(o.startTimeOffset=A);break;case"PROGRAM-DATE-TIME":f=new Date(Date.parse(a[1]));break;case"#":a.shift();break;default:_logger.logger.warn("line parsed but not handled: "+a)}return c&&!c.url&&(o.fragments.pop(),s-=c.duration),o.totalduration=s,o.endSN=n-1,o}},{key:"loadsuccess",value:function(e,t){var r,l=e.currentTarget,a=l.responseText,i=l.responseURL,n=this.id,s=this.id2,o=this.hls;if(this.loading=!1,void 0===i&&(i=this.url),t.tload=performance.now(),t.mtime=new Date(l.getResponseHeader("Last-Modified")),0===a.indexOf("#EXTM3U"))if(a.indexOf("#EXTINF:")>0){var u=this.parseLevelPlaylist(a,i,n||0);null===n?o.trigger(_events2.default.MANIFEST_LOADED,{levels:[{url:i,details:u}],url:i,stats:t}):(t.tparsed=performance.now(),o.trigger(_events2.default.LEVEL_LOADED,{details:u,level:n,id:s,stats:t}))}else r=this.parseMasterPlaylist(a,i),r.length?o.trigger(_events2.default.MANIFEST_LOADED,{levels:r,url:i,stats:t}):o.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"no level found in manifest"});else o.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(e){var t,r;null===this.id?(t=_errors.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0):(t=_errors.ErrorDetails.LEVEL_LOAD_ERROR,r=!1),this.loader&&this.loader.abort(),this.loading=!1,this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:t,fatal:r,url:this.url,loader:this.loader,response:e.currentTarget,level:this.id,id:this.id2})}},{key:"loadtimeout",value:function(){var e,t;null===this.id?(e=_errors.ErrorDetails.MANIFEST_LOAD_TIMEOUT,t=!0):(e=_errors.ErrorDetails.LEVEL_LOAD_TIMEOUT,t=!1),this.loader&&this.loader.abort(),this.loading=!1,this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:e,fatal:t,url:this.url,loader:this.loader,level:this.id,id:this.id2})}}]),t}(_eventHandler2.default);exports.default=PlaylistLoader},{"../errors":29,"../event-handler":30,"../events":31,"../utils/attr-list":42,"../utils/logger":46,"../utils/url":47}],39:[function(_dereq_,module,exports){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),MP4=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"init",value:function(){t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var e;for(e in t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:n,audio:r};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=o,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),y=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,s,i,s,y),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,a))}},{key:"box",value:function(t){for(var e,n=Array.prototype.slice.call(arguments,1),r=8,a=n.length,o=a;a--;)r+=n[a].byteLength;for(e=new Uint8Array(r),e[0]=r>>24&255,e[1]=r>>16&255,e[2]=r>>8&255,e[3]=255&r,e.set(t,4),a=0,r=8;a<o;a++)e.set(n[a],r),r+=n[a].byteLength;return e}},{key:"hdlr",value:function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])}},{key:"mdat",value:function(e){return t.box(t.types.mdat,e)}},{key:"mdhd",value:function(e,n){return n*=e,t.box(t.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))}},{key:"mfhd",value:function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}},{key:"minf",value:function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))}},{key:"moof",value:function(e,n,r){return t.box(t.types.moof,t.mfhd(e),t.traf(r,n))}},{key:"moov",value:function(e){for(var n=e.length,r=[];n--;)r[n]=t.trak(e[n]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(t.mvex(e)))}},{key:"mvex",value:function(e){for(var n=e.length,r=[];n--;)r[n]=t.trex(e[n]);return t.box.apply(null,[t.types.mvex].concat(r))}},{key:"mvhd",value:function(e,n){n*=e;var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24&255,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,r)}},{key:"sdtp",value:function(e){var n,r,a=e.samples||[],o=new Uint8Array(4+a.length);for(r=0;r<a.length;r++)n=a[r].flags,o[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return t.box(t.types.sdtp,o)}},{key:"stbl",value:function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))}},{key:"avc1",value:function(e){var n,r,a,o=[],s=[];for(n=0;n<e.sps.length;n++)r=e.sps[n],a=r.byteLength,o.push(a>>>8&255),o.push(255&a),o=o.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)r=e.pps[n],a=r.byteLength,s.push(a>>>8&255),s.push(255&a),s=s.concat(Array.prototype.slice.call(r));var y=t.box(t.types.avcC,new Uint8Array([1,o[3],o[4],o[5],255,224|e.sps.length].concat(o).concat([e.pps.length]).concat(s))),i=e.width,u=e.height;return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),y,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}},{key:"mp4a",value:function(e){var n=e.audiosamplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),t.box(t.types.esds,t.esds(e)))}},{key:"stsd",value:function(e){return"audio"===e.type?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))}},{key:"tkhd",value:function(e){var n=e.id,r=e.duration*e.timescale,a=e.width,o=e.height;return t.box(t.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,o>>8&255,255&o,0,0]))}},{key:"traf",value:function(e,n){var r=t.sdtp(e),a=e.id;return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),t.box(t.types.tfdt,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),t.trun(e,r.length+16+16+8+16+8+8),r)}},{key:"trak",value:function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))}},{key:"trex",value:function(e){var n=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(e,n){var r,a,o,s,y,i,u=e.samples||[],d=u.length,c=12+16*d,p=new Uint8Array(c);for(n+=8+c,p.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<d;r++)a=u[r],o=a.duration,s=a.size,y=a.flags,i=a.cts,p.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,s>>>24&255,s>>>16&255,s>>>8&255,255&s,y.isLeading<<2|y.dependsOn,y.isDependedOn<<6|y.hasRedundancy<<4|y.paddingValue<<1|y.isNonSync,61440&y.degradPrio,15&y.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*r);return t.box(t.types.trun,p)}},{key:"initSegment",value:function(e){t.types||t.init();var n,r=t.moov(e);return n=new Uint8Array(t.FTYP.byteLength+r.byteLength),n.set(t.FTYP),n.set(r,t.FTYP.byteLength),n}}]),t}();exports.default=MP4},{}],40:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_logger=_dereq_("../utils/logger"),_mp4Generator=_dereq_("../remux/mp4-generator"),_mp4Generator2=_interopRequireDefault(_mp4Generator),_errors=_dereq_("../errors"),MP4Remuxer=function(){function e(t){_classCallCheck(this,e),this.observer=t,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return _createClass(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,s,i,a,n){this.ISGenerated||this.generateIS(e,t,a),this.ISGenerated&&(t.samples.length&&this.remuxVideo(t,a,n),e.samples.length&&this.remuxAudio(e,a,n)),s.samples.length&&this.remuxID3(s,a),i.samples.length&&this.remuxText(i,a),this.observer.trigger(_events2.default.FRAG_PARSED)}},{key:"generateIS",value:function(e,t,s){var i,a,n=this.observer,r=e.samples,o=t.samples,l=this.PES_TIMESCALE,u={},d={tracks:u,unique:!1},h=void 0===this._initPTS;h&&(i=a=1/0),e.config&&r.length&&(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)&&!function(){var t=function e(t,s){return s?e(s,t%s):t};e.timescale=e.audiosamplerate/t(e.audiosamplerate,1024)}(),_logger.logger.log("audio mp4 timescale :"+e.timescale),u.audio={container:"audio/mp4",codec:e.codec,initSegment:_mp4Generator2.default.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(i=a=r[0].pts-l*s)),t.sps&&t.pps&&o.length&&(t.timescale=this.MP4_TIMESCALE,u.video={container:"video/mp4",codec:t.codec,initSegment:_mp4Generator2.default.initSegment([t]),metadata:{width:t.width,height:t.height}},h&&(i=Math.min(i,o[0].pts-l*s),a=Math.min(a,o[0].dts-l*s))),Object.keys(u).length?(n.trigger(_events2.default.FRAG_PARSING_INIT_SEGMENT,d),this.ISGenerated=!0,h&&(this._initPTS=i,this._initDTS=a)):n.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,s){var i,a,n,r,o,l,u,d,h,g,m,p,_,c,f,S=8,v=this.PES_TIMESCALE,T=this.PES2MP4SCALEFACTOR,A=[],P=e.samples.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);for(P<0&&_logger.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(P/90)+" ms to overcome this issue"),l=new Uint8Array(e.len+4*e.nbNalu+8),i=new DataView(l.buffer),i.setUint32(0,l.byteLength),l.set(_mp4Generator2.default.types.mdat,4);e.samples.length;){for(a=e.samples.shift(),r=0;a.units.units.length;)o=a.units.units.shift(),i.setUint32(S,o.data.byteLength),S+=4,l.set(o.data,S),S+=o.data.byteLength,r+=4+o.data.byteLength;if(m=a.pts-this._initDTS,p=a.dts-this._initDTS+P,p=Math.min(m,p),void 0!==g){_=this._PTSNormalize(m,g),c=this._PTSNormalize(p,g);var E=(c-g)/T;E<=0&&(_logger.logger.log("invalid sample duration at PTS/DTS: "+a.pts+"/"+a.dts+":"+E),E=1),n.duration=E}else{var y=void 0,M=void 0;y=s?this.nextAvcDts:t*v,_=this._PTSNormalize(m,y),c=this._PTSNormalize(p,y),M=Math.round((c-y)/90),s&&M&&(M>1?_logger.logger.log("AVC:"+M+" ms hole between fragments detected,filling it"):M<-1&&_logger.logger.log("AVC:"+-M+" ms overlapping between fragments detected"),c=y,_=Math.max(_-M,c),_logger.logger.log("Video/PTS/DTS adjusted: "+_+"/"+c+",delta:"+M)),d=Math.max(0,_),h=Math.max(0,c)}n={size:r,duration:0,cts:(_-c)/T,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0}},f=n.flags,a.key===!0?(f.dependsOn=2,f.isNonSync=0):(f.dependsOn=1,f.isNonSync=1),A.push(n),g=c}var b=0;A.length>=2&&(b=A[A.length-2].duration,n.duration=b),this.nextAvcDts=c+b*T;var D=e.dropped;e.len=0,e.nbNalu=0,e.dropped=0,A.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(f=A[0].flags,f.dependsOn=2,f.isNonSync=0),e.samples=A,u=_mp4Generator2.default.moof(e.sequenceNumber++,h/T,e),e.samples=[],this.observer.trigger(_events2.default.FRAG_PARSING_DATA,{data1:u,data2:l,startPTS:d/v,endPTS:(_+T*b)/v,startDTS:h/v,endDTS:this.nextAvcDts/v,type:"video",nb:A.length,dropped:D})}},{key:"remuxAudio",value:function(e,t,s){var i,a,n,r,o,l,u,d,h,g,m,p,_,c=8,f=this.PES_TIMESCALE,S=e.timescale,v=f/S,T=1024*e.timescale/e.audiosamplerate,A=[],P=[];for(e.samples.sort(function(e,t){return e.pts-t.pts}),P=e.samples;P.length;){if(a=P.shift(),r=a.unit,g=a.pts-this._initDTS,m=a.dts-this._initDTS,void 0!==h)p=this._PTSNormalize(g,h),_=this._PTSNormalize(m,h),n.duration=(_-h)/v,Math.abs(n.duration-T)>T/10&&_logger.logger.log("invalid AAC sample duration at PTS "+Math.round(g/90)+",should be 1024,found :"+Math.round(n.duration*e.audiosamplerate/e.timescale)),n.duration=T,p=_=T*v+h;else{var E=void 0,y=void 0;if(E=s?this.nextAacPts:t*f,p=this._PTSNormalize(g,E),_=this._PTSNormalize(m,E),y=Math.round(1e3*(p-E)/f),s&&y){if(y>0)_logger.logger.log(y+" ms hole between AAC samples detected,filling it");else if(y<-12){_logger.logger.log(-y+" ms overlapping between AAC samples detected, drop frame"),e.len-=r.byteLength;continue}p=_=E}if(u=Math.max(0,p),d=Math.max(0,_),!(e.len>0))return;o=new Uint8Array(e.len+8),i=new DataView(o.buffer),i.setUint32(0,o.byteLength),o.set(_mp4Generator2.default.types.mdat,4)}o.set(r,c),c+=r.byteLength,n={size:r.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(n),h=_}var M=0,b=A.length;b>=2&&(M=A[b-2].duration,n.duration=M),b&&(this.nextAacPts=p+v*M,e.len=0,e.samples=A,l=_mp4Generator2.default.moof(e.sequenceNumber++,d/v,e),e.samples=[],this.observer.trigger(_events2.default.FRAG_PARSING_DATA,{data1:l,data2:o,startPTS:u/f,endPTS:this.nextAacPts/f,startDTS:d/f,endDTS:(_+v*M)/f,type:"audio",nb:b}))}},{key:"remuxID3",value:function(e,t){var s,i=e.samples.length;if(i){for(var a=0;a<i;a++)s=e.samples[a],s.pts=(s.pts-this._initPTS)/this.PES_TIMESCALE,s.dts=(s.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(_events2.default.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var s,i=e.samples.length;if(i){for(var a=0;a<i;a++)s=e.samples[a],s.pts=(s.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(_events2.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var s;if(void 0===t)return e;for(s=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=s;return e}},{key:"passthrough",get:function(){return!1}}]),e}();exports.default=MP4Remuxer},{"../errors":29,"../events":31,"../remux/mp4-generator":39,"../utils/logger":46}],41:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),PassThroughRemuxer=function(){function e(t){_classCallCheck(this,e),this.observer=t,this.ISGenerated=!1}return _createClass(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,n,r,a,i){var u=this.observer;if(!this.ISGenerated){var o={},s={tracks:o,unique:!0},c=t,l=c.codec;l&&(s.tracks.video={container:c.container,codec:l,metadata:{width:c.width,height:c.height}}),c=e,l=c.codec,l&&(s.tracks.audio={container:c.container,codec:l,metadata:{channelCount:c.channelCount}}),this.ISGenerated=!0,u.trigger(_events2.default.FRAG_PARSING_INIT_SEGMENT,s)}u.trigger(_events2.default.FRAG_PARSING_DATA,{data1:i,startPTS:a,startDTS:a,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function(){return!0}}]),e}();exports.default=PassThroughRemuxer},{"../events":31}],42:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),AttrList=function(){function e(t){_classCallCheck(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var r in t)t.hasOwnProperty(r)&&(this[r]=t[r])}return _createClass(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(2*n,2*n+2),16);return r}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=/^(\d+)x(\d+)$/.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),
height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){for(var t,r=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,n={};null!==(t=r.exec(e));){var a=t[2],i='"';0===a.indexOf(i)&&a.lastIndexOf(i)===a.length-1&&(a=a.slice(1,-1)),n[t[1]]=a}return n}}]),e}();exports.default=AttrList},{}],43:[function(_dereq_,module,exports){"use strict";var BinarySearch={search:function(r,e){for(var n=0,l=r.length-1,a=null,u=null;n<=l;){a=(n+l)/2|0,u=r[a];var t=e(u);if(t>0)n=a+1;else{if(!(t<0))return u;l=a-1}}return null}};module.exports=BinarySearch},{}],44:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),CEA708Interpreter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"attach",value:function(e){this.media=e,this.display=[],this.memory=[]}},{key:"detach",value:function(){this.clear()}},{key:"destroy",value:function(){}},{key:"_createCue",value:function(){var e=window.VTTCue||window.TextTrackCue,t=this.cue=new e(-1,-1,"");t.text="",t.pauseOnExit=!1,t.startTime=Number.MAX_VALUE,t.endTime=Number.MAX_VALUE,this.memory.push(t)}},{key:"clear",value:function(){var e=this._textTrack;if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"push",value:function(e,t){this.cue||this._createCue();for(var a,r,s,c,i,u=31&t[0],n=2,h=0;h<u;h++)if(a=t[n++],r=127&t[n++],s=127&t[n++],c=0!==(4&a),i=3&a,(0!==r||0!==s)&&c&&0===i){if(32&r||64&r)this.cue.text+=this._fromCharCode(r)+this._fromCharCode(s);else if((17===r||25===r)&&s>=48&&s<=63)switch(s){case 48:this.cue.text+="®";break;case 49:this.cue.text+="°";break;case 50:this.cue.text+="½";break;case 51:this.cue.text+="¿";break;case 52:this.cue.text+="™";break;case 53:this.cue.text+="¢";break;case 54:this.cue.text+="";break;case 55:this.cue.text+="£";break;case 56:this.cue.text+="♪";break;case 57:this.cue.text+=" ";break;case 58:this.cue.text+="è";break;case 59:this.cue.text+="â";break;case 60:this.cue.text+="ê";break;case 61:this.cue.text+="î";break;case 62:this.cue.text+="ô";break;case 63:this.cue.text+="û"}if((17===r||25===r)&&s>=32&&s<=47)switch(s){case 32:break;case 33:break;case 34:break;case 35:break;case 36:break;case 37:break;case 38:break;case 39:break;case 40:break;case 41:break;case 42:break;case 43:break;case 44:break;case 45:break;case 46:break;case 47:}if((20===r||28===r)&&s>=32&&s<=47)switch(s){case 32:this._clearActiveCues(e);break;case 33:this.cue.text=this.cue.text.substr(0,this.cue.text.length-1);break;case 34:break;case 35:break;case 36:break;case 37:break;case 38:break;case 39:break;case 40:break;case 41:this._clearActiveCues(e);break;case 42:break;case 43:break;case 44:this._clearActiveCues(e);break;case 45:break;case 46:this._text="";break;case 47:this._flipMemory(e)}if((23===r||31===r)&&s>=33&&s<=35)switch(s){case 33:break;case 34:break;case 35:}}}},{key:"_fromCharCode",value:function(e){switch(e){case 42:return"á";case 2:return"á";case 2:return"é";case 4:return"í";case 5:return"ó";case 6:return"ú";case 3:return"ç";case 4:return"÷";case 5:return"Ñ";case 6:return"ñ";case 7:return"█";default:return String.fromCharCode(e)}}},{key:"_flipMemory",value:function(e){this._clearActiveCues(e),this._flushCaptions(e)}},{key:"_flushCaptions",value:function(e){this._has708||(this._textTrack=this.media.addTextTrack("captions","English","en"),this._has708=!0);var t=!0,a=!1,r=void 0;try{for(var s,c=this.memory[Symbol.iterator]();!(t=(s=c.next()).done);t=!0){var i=s.value;i.startTime=e,this._textTrack.addCue(i),this.display.push(i)}}catch(e){a=!0,r=e}finally{try{!t&&c.return&&c.return()}finally{if(a)throw r}}this.memory=[],this.cue=null}},{key:"_clearActiveCues",value:function(e){var t=!0,a=!1,r=void 0;try{for(var s,c=this.display[Symbol.iterator]();!(t=(s=c.next()).done);t=!0){var i=s.value;i.endTime=e}}catch(e){a=!0,r=e}finally{try{!t&&c.return&&c.return()}finally{if(a)throw r}}this.display=[]}},{key:"_clearBufferedCues",value:function(){}}]),e}();exports.default=CEA708Interpreter},{}],45:[function(_dereq_,module,exports){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}(),EWMA=function(){function t(e){_classCallCheck(this,t),this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}return _createClass(t,[{key:"sample",value:function(t,e){var a=Math.pow(this.alpha_,t);this.estimate_=e*(1-a)+a*this.estimate_,this.totalWeight_+=t}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_}}]),t}();exports.default=EWMA},{}],46:[function(_dereq_,module,exports){"use strict";function noop(){}function formatMsg(o,e){return e="["+o+"] > "+e}function consolePrintFn(o){var e=window.console[o];return e?function(){for(var r=arguments.length,n=Array(r),t=0;t<r;t++)n[t]=arguments[t];n[0]&&(n[0]=formatMsg(o,n[0])),e.apply(window.console,n)}:noop}function exportLoggerFunctions(o){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];r.forEach(function(e){exportedLogger[e]=o[e]?o[e].bind(o):consolePrintFn(e)})}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol?"symbol":typeof o},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop},exportedLogger=fakeLogger;exports.enableLogs=function(o){if(o===!0||"object"===("undefined"==typeof o?"undefined":_typeof(o))){exportLoggerFunctions(o,"debug","log","info","warn","error");try{exportedLogger.log()}catch(o){exportedLogger=fakeLogger}}else exportedLogger=fakeLogger},exports.logger=exportedLogger},{}],47:[function(_dereq_,module,exports){"use strict";var URLHelper={buildAbsoluteURL:function(e,r){if(r=r.trim(),/^[a-z]+:/i.test(r))return r;var t=null,l=null,u=/^([^#]*)(.*)$/.exec(r);u&&(l=u[2],r=u[1]);var s=/^([^\?]*)(.*)$/.exec(r);s&&(t=s[2],r=s[1]);var a=/^([^#]*)(.*)$/.exec(e);a&&(e=a[1]);var i=/^([^\?]*)(.*)$/.exec(e);i&&(e=i[1]);var n=/^(([a-z]+:)?\/\/[a-z0-9\.\-_~]+(:[0-9]+)?)?(\/.*)$/i.exec(e);if(!n)throw new Error("Error trying to parse base URL.");var b=n[2]||"",o=n[1]||"",c=n[4],p=null;return p=/^\/\//.test(r)?b+"//"+URLHelper.buildAbsolutePath("",r.substring(2)):/^\//.test(r)?o+"/"+URLHelper.buildAbsolutePath("",r.substring(1)):URLHelper.buildAbsolutePath(o+c,r),t&&(p+=t),l&&(p+=l),p},buildAbsolutePath:function(e,r){for(var t,l,u=r,s="",a=e.replace(/[^\/]*$/,u.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),i=0;l=a.indexOf("/../",i),l>-1;i=l+t)t=/^\/(?:\.\.\/)*/.exec(a.slice(l))[0].length,s=(s+a.substring(i,l)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(t-1)/3+"}$"),"/");return s+a.substr(i)}};module.exports=URLHelper},{}],48:[function(_dereq_,module,exports){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,r,s){return r&&t(e.prototype,r),s&&t(e,s),e}}(),_logger=_dereq_("../utils/logger"),XhrLoader=function(){function t(e){_classCallCheck(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return _createClass(t,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var t=this.loader,e=this.timeoutHandle;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),e&&window.clearTimeout(e)}},{key:"load",value:function(t,e,r,s,i,o,a,n){var l=arguments.length<=8||void 0===arguments[8]?null:arguments[8],h=arguments.length<=9||void 0===arguments[9]?null:arguments[9];this.url=t,!h||isNaN(h.byteRangeStartOffset)||isNaN(h.byteRangeEndOffset)||(this.byteRange=h.byteRangeStartOffset+"-"+(h.byteRangeEndOffset-1)),this.responseType=e,this.onSuccess=r,this.onProgress=l,this.onTimeout=i,this.onError=s,this.stats={trequest:performance.now(),retry:0},this.timeout=o,this.maxRetry=a,this.retryDelay=n,this.loadInternal()}},{key:"loadInternal",value:function(){var t;t="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,t.onloadend=this.loadend.bind(this),t.onprogress=this.loadprogress.bind(this),t.open("GET",this.url,!0),this.byteRange&&t.setRequestHeader("Range","bytes="+this.byteRange),t.responseType=this.responseType;var e=this.stats;e.tfirst=0,e.loaded=0,this.xhrSetup&&this.xhrSetup(t,this.url),this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),this.timeout),t.send()}},{key:"loadend",value:function(t){var e=t.currentTarget,r=e.status,s=this.stats;s.aborted||(r>=200&&r<300?(window.clearTimeout(this.timeoutHandle),s.tload=Math.max(s.tfirst,performance.now()),this.onSuccess(t,s)):s.retry>=this.maxRetry||r>=400&&r<499?(window.clearTimeout(this.timeoutHandle),_logger.logger.error(r+" while loading "+this.url),this.onError(t)):(_logger.logger.warn(r+" while loading "+this.url+", retrying in "+this.retryDelay+"..."),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),s.retry++))}},{key:"loadtimeout",value:function(t){_logger.logger.warn("timeout while loading "+this.url),this.onTimeout(t,this.stats)}},{key:"loadprogress",value:function(t){var e=this.stats;0===e.tfirst&&(e.tfirst=Math.max(performance.now(),e.trequest)),e.loaded=t.loaded,this.onProgress&&this.onProgress(t,e)}}]),t}();exports.default=XhrLoader},{"../utils/logger":46}],49:[function(_dereq_,module,exports){function apply(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}function baseTimes(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}function arrayLikeKeys(r,e){var t=isArray(r)||isArguments(r)?baseTimes(r.length,String):[],n=t.length,i=!!n;for(var o in r)!e&&!hasOwnProperty.call(r,o)||i&&("length"==o||isIndex(o,n))||t.push(o);return t}function assignValue(r,e,t){var n=r[e];hasOwnProperty.call(r,e)&&eq(n,t)&&(void 0!==t||e in r)||(r[e]=t)}function baseKeysIn(r){if(!isObject(r))return nativeKeysIn(r);var e=isPrototype(r),t=[];for(var n in r)("constructor"!=n||!e&&hasOwnProperty.call(r,n))&&t.push(n);return t}function baseRest(r,e){return e=nativeMax(void 0===e?r.length-1:e,0),function(){for(var t=arguments,n=-1,i=nativeMax(t.length-e,0),o=Array(i);++n<i;)o[n]=t[e+n];n=-1;for(var a=Array(e+1);++n<e;)a[n]=t[n];return a[e]=o,apply(r,this,a)}}function copyObject(r,e,t,n){t||(t={});for(var i=-1,o=e.length;++i<o;){var a=e[i],s=n?n(t[a],r[a],a,t,r):void 0;assignValue(t,a,void 0===s?r[a]:s)}return t}function createAssigner(r){return baseRest(function(e,t){var n=-1,i=t.length,o=i>1?t[i-1]:void 0,a=i>2?t[2]:void 0;for(o=r.length>3&&"function"==typeof o?(i--,o):void 0,a&&isIterateeCall(t[0],t[1],a)&&(o=i<3?void 0:o,i=1),e=Object(e);++n<i;){var s=t[n];s&&r(e,s,n,o)}return e})}function isIndex(r,e){return e=null==e?MAX_SAFE_INTEGER:e,!!e&&("number"==typeof r||reIsUint.test(r))&&r>-1&&r%1==0&&r<e}function isIterateeCall(r,e,t){if(!isObject(t))return!1;var n=typeof e;return!!("number"==n?isArrayLike(t)&&isIndex(e,t.length):"string"==n&&e in t)&&eq(t[e],r)}function isPrototype(r){var e=r&&r.constructor,t="function"==typeof e&&e.prototype||objectProto;return r===t}function nativeKeysIn(r){var e=[];if(null!=r)for(var t in Object(r))e.push(t);return e}function eq(r,e){return r===e||r!==r&&e!==e}function isArguments(r){return isArrayLikeObject(r)&&hasOwnProperty.call(r,"callee")&&(!propertyIsEnumerable.call(r,"callee")||objectToString.call(r)==argsTag)}function isArrayLike(r){return null!=r&&isLength(r.length)&&!isFunction(r)}function isArrayLikeObject(r){return isObjectLike(r)&&isArrayLike(r)}function isFunction(r){var e=isObject(r)?objectToString.call(r):"";return e==funcTag||e==genTag}function isLength(r){return"number"==typeof r&&r>-1&&r%1==0&&r<=MAX_SAFE_INTEGER}function isObject(r){var e=typeof r;return!!r&&("object"==e||"function"==e)}function isObjectLike(r){return!!r&&"object"==typeof r}function keysIn(r){return isArrayLike(r)?arrayLikeKeys(r,!0):baseKeysIn(r)}var MAX_SAFE_INTEGER=9007199254740991,argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]",reIsUint=/^(?:0|[1-9]\d*)$/,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,propertyIsEnumerable=objectProto.propertyIsEnumerable,nativeMax=Math.max,isArray=Array.isArray,assignInWith=createAssigner(function(r,e,t,n){copyObject(e,keysIn(e),r,n)});module.exports=assignInWith},{}],50:[function(_dereq_,module,exports){function apply(t,e,r){var n=r.length;switch(n){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function assignInDefaults(t,e,r,n){return void 0===t||eq(t,objectProto[r])&&!hasOwnProperty.call(n,r)?e:t}function eq(t,e){return t===e||t!==t&&e!==e}var assignInWith=_dereq_("lodash.assigninwith"),rest=_dereq_("lodash.rest"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,defaults=rest(function(t){return t.push(void 0,assignInDefaults),apply(assignInWith,void 0,t)});module.exports=defaults},{"lodash.assigninwith":49,"lodash.rest":51}],51:[function(_dereq_,module,exports){function apply(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function baseRest(t,e){return e=nativeMax(void 0===e?t.length-1:e,0),function(){for(var r=arguments,n=-1,o=nativeMax(r.length-e,0),i=Array(o);++n<o;)i[n]=r[e+n];n=-1;for(var a=Array(e+1);++n<e;)a[n]=r[n];return a[e]=i,apply(t,this,a)}}function rest(t,e){if("function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT);return e=void 0===e?e:toInteger(e),baseRest(t,e)}function isFunction(t){var e=isObject(t)?objectToString.call(t):"";return e==funcTag||e==genTag}function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function isObjectLike(t){return!!t&&"object"==typeof t}function isSymbol(t){return"symbol"==typeof t||isObjectLike(t)&&objectToString.call(t)==symbolTag}function toFinite(t){if(!t)return 0===t?t:0;if(t=toNumber(t),t===INFINITY||t===-INFINITY){var e=t<0?-1:1;return e*MAX_INTEGER}return t===t?t:0}function toInteger(t){var e=toFinite(t),r=e%1;return e===e?r?e-r:e:0}function toNumber(t){if("number"==typeof t)return t;if(isSymbol(t))return NAN;if(isObject(t)){var e=isFunction(t.valueOf)?t.valueOf():t;t=isObject(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(reTrim,"");var r=reIsBinary.test(t);return r||reIsOctal.test(t)?freeParseInt(t.slice(2),r?2:8):reIsBadHex.test(t)?NAN:+t}var FUNC_ERROR_TEXT="Expected a function",INFINITY=1/0,MAX_INTEGER=1.7976931348623157e308,NAN=NaN,funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max;module.exports=rest},{}],52:[function(_dereq_,module,exports){(function(global){!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.Streamroot||(t.Streamroot={})).Downloader=e()}}(function(){var e;return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof _dereq_&&_dereq_;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof _dereq_&&_dereq_,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e){for(var t=e.from,n=e.to,r=e.step,i=[],o=t;o<n;o+=r)i.push(o);return i.push(n),i}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./js/utils/ObjectHelper"),o={SIGNALING_URL:"wss://sig.streamroot.io/websocket/",ABTEST_DATA_URL:"//files.streamroot.io/p2p/static/tracker-split.json",TRACKER_URL:"https://tracker-beta.streamroot.io",CLIENT_TRACKER_PROTOCOL_VERSION:"3.0.0",P2P_PROTOCOL_VERSION:"3.0.0",CHUNK_SIZE:15360,P2P_CACHE_MAX_SIZE:136314880,GETSEGMENTTIME_CACHE_MAX_SIZE:1e3,MAX_DL_REQUEST_SPEED:1e3,TIME_BETWEEN_CHUNK_DL:50,NB_CHUNK_DL_GROUP:10,MAX_CHUNK_BY_SEEDER:300,NB_SEGMENT_P2P_PREBUFFER:6,MAX_SEGMENT_REQUEST_STORE:6,NB_SEGMENT_P2P_SKIP:2,MAX_BUFFER_DURATION:300,MAX_UP_SPEED:600,CHUNK_UP_RETRY_DELAY:10,PEER_CONNECTION_TIMEOUT:5e4,PEER_UP_TIMEOUT:5e3,SEND_HEARTBEAT_INTERVAL:5e3,CHECK_HEARTBEAT_INTERVAL:1e4,MAX_USELESS_COUNT:100,MIN_USEFUL_SPEED:5,MIN_NUMBER_OF_PEERS:8,MAX_NUMBER_OF_PEERS:13,MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE:10,ASK_PEERS_INTERVAL:6e4,SEND_TRACKS_INTERVAL:6e4,CHECK_USELESS_INTERVAL:6e4,SPEED_MONITOR_INTERVAL:1e3,MEAN_SPEED_CALCULATION_INTERVAL:500,CHUNK_TIMEOUT:2500,CHUNK_UP_TIMEOUT:1900,ICECANDIDATES_TIMEOUT:1e3,UP_MAX_BUFFERED_AMOUNT:10,OFFER_DECLINED_TIMEOUT:6e4,PEER_REMOVED_TIMEOUT:9e5,PEER_CONNEXION_ATTEMPT_TIMEOUT:9e5,GEOLOCATION_REQUEST_TIMEOUT:3e3,GEOLOCATION_REQUEST_MAX_RETRY:1,MAX_P2P_PREBUFFERING_TIME:720,RETRY_P2P_START_DL_SEGMENT_DELAY:5e3,ANALYTICS:{KLARA_URL:"https://klara.streamroot.io",RETRY_NUMBER:3,RETRY_DELAY:1e4,TRAFFIC_INTERVAL_ARRAY:r({from:5e3,to:12e4,step:1e4}),STATS_INTERVAL:12e4,CONTROL_INTERVAL:6e5},ERRORS:{API_KEY:"d04c6fa616c255ac55dec6b068ad7172",HANDLER:"xhr",STAGES:["staging","qa","production"]},RY_TRACK:!0,RY_TRACKER:"srTracker",ABR_DEL_T:30,LIVE:{P2P_CACHE_MAX_SIZE:62914560},ENABLE_TURN:!1,STUNSERVERS:[{urls:"stun:stun.l.google.com:19302"}],TURNSERVERS:[{urls:"turn:23.97.160.254:3478?transport=udp",credential:"streamroot",username:"streamroot"}],ALLOW_P2P:!0,RANGE_REQUEST_ALLOWED:!0,DISPLAY_ERROR:!1,PEER_INSTANT_SPEED_CALCULATION_INTERVAL:100,PEER_INSTANT_SPEED_CALCULATION_WINDOW:1e4,PEER_COMPUTE_RTT_INTERVAL:5e3,USE_SIGNALING_SERVER:!0,SIGNALING_DELAY_STEP:2e3,SIGNALING_DELAY_MAX:3e5,TRACKER_DELAY_MAX:3e5,TRACKER_DELAY_INIT:2e3,LOCKED_RETRY_INTERVAL:30,LOCKED_RETRY_TIMEOUT:500,TIMEOUT_GET_FULL_SEGMENT:500,RETURN_COPY_SEGMENT:!0,DEBUG:!1,DEVICE_INFO:"",ID_CLIENT:"",MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH:300};(0,i.deepFreeze)(o),n.default=o,t.exports=n.default},{"./js/utils/ObjectHelper":89}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/json/stringify"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=e("./MetricSender"),f=r(c),d=e("../utils/url"),h=Math.random().toString().substring(2),p=Math.random().toString().substring(2),_=Math.random().toString().substring(2);window.Streamroot=window.Streamroot||{},window.Streamroot.klaraToken=window.Streamroot.klaraToken||h+p+_;var m=function(){function e(t,n,r,i,o){(0,s.default)(this,e),this._serverURL=(0,d.formatUrl)(t),this._clientID=n,this._namespace=i,this._content=r,this._conf=o}return(0,l.default)(e,[{key:"send",value:function(e,t){e.customer=this._clientID,e.content=this._content,e.peerAgentVersion="4.3.0",e.token=window.Streamroot.klaraToken;var n=(0,o.default)(e),r=""+this._serverURL+this._namespace;t&&(r+="/"+t);var i=new f.default(r,n,this._conf);i.send(n)}}]),e}();n.default=m,t.exports=n.default},{"../utils/url":101,"./MetricSender":5,"babel-runtime/core-js/json/stringify":108,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=function e(){(0,o.default)(this,e),this.open=0,this.match=0,this.offer=0,this.active=0,this.transfer=0,this.denied=0,this.dropped=0,this.timeout=0,this.disconnected=0,this.p2p=0,this.cdn=0};n.default=a,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("./TrafficAnalytics"),l=r(u),c=e("./StatsAnalytics"),f=r(c),d=e("../utils/Timers"),h=r(d),p=function(){function e(t,n,r){var i=this;(0,o.default)(this,e),this._playerInterface=t,this._trafficIntervalCounter=0,this._conf=r.conf,this._timers=new h.default,this._trafficAnalytics=new l.default(this._playerInterface,r),this._statsAnalytics=new f.default(this._playerInterface,n,r),this._scheduleTrafficReport(),this._scheduleStatReport(),this._scheduleControlReport(),window.onbeforeunload=function(){i._trafficAnalytics.sendUsage(!0)}}return(0,s.default)(e,[{key:"dispose",value:function(){this._timers.clearAll(),this._statsAnalytics.dispose()}},{key:"_scheduleTrafficReport",value:function(){var e=this;if(this._trafficIntervalCounter<this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY.length-1)this._timers.setTimeout(function(){e._trafficAnalytics.sendUsage(),e._scheduleTrafficReport()},this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY[this._trafficIntervalCounter]),this._trafficIntervalCounter++;else{var t=this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY[this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY.length-1],n=this._trafficAnalytics.sendUsage.bind(this._trafficAnalytics,!1);this._timers.setInterval(n,t)}}},{key:"_scheduleStatReport",value:function(){this._timers.setInterval(this._statsAnalytics.sendStats.bind(this._statsAnalytics),this._conf.ANALYTICS.STATS_INTERVAL)}},{key:"_scheduleControlReport",value:function(){this._timers.setInterval(this._statsAnalytics.sendControl.bind(this._statsAnalytics),this._conf.ANALYTICS.CONTROL_INTERVAL)}}]),e}();n.default=p,t.exports=n.default},{"../utils/Timers":95,"./StatsAnalytics":7,"./TrafficAnalytics":8,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=function(){function e(t,n,r){(0,o.default)(this,e),this._serverURL=t,this._payload=n,this._conf=r,this._retryCount=0}return(0,s.default)(e,[{key:"_retry",value:function(){this._retryCount<this._conf.ANALYTICS.RETRY_NUMBER&&setTimeout(this.send.bind(this),this._conf.ANALYTICS.RETRY_DELAY)}},{key:"_onLoad",value:function(e){e.target.status>=500&&e.target.status<600&&this._retry()}},{key:"_onError",value:function(){this._retry()}},{key:"send",value:function(){var e=new XMLHttpRequest;e.open("POST",this._serverURL),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.onload=this._onLoad.bind(this),e.onerror=this._onError.bind(this),e.send(this._payload),this._retryCount++}}]),e}();n.default=u,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return e===1/0||e===-(1/0)?-1:e}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/get-iterator"),a=r(o),s=e("babel-runtime/core-js/map"),u=r(s),l=e("babel-runtime/helpers/classCallCheck"),c=r(l),f=e("babel-runtime/helpers/createClass"),d=r(f),h=e("../utils/StaircaseFunctionIntegral"),p=r(h),_=e("../utils/Number"),m=function(){function e(t){(0,c.default)(this,e),this._bufferLevels=new u.default,this._destroyedPeerIds=[],this._peerCountStaircaseFunctionIntegral=new p.default,t.eventBus.on("info",this._onPeerInfo,this),t.eventBus.on("peerOpen",this._onPeerOpen,this),t.eventBus.on("peerDestroyed",this._onPeerDestroyed,this)}return(0,d.default)(e,[{key:"_onPeerInfo",value:function(e){var t=e.remotePeer;this._bufferLevels.set(t.getId(),t.getBufferLevel())}},{key:"_onPeerOpen",value:function(e){var t=e.peerCount;this._peerCountStaircaseFunctionIntegral.updateMetric(t)}},{key:"_onPeerDestroyed",value:function(e){var t=e.remotePeer,n=e.peerCount;this._destroyedPeerIds.push(t.getId()),this._peerCountStaircaseFunctionIntegral.updateMetric(n)}},{key:"_calculateBufferLevelStats",value:function(e){var t=1/0,n=-(1/0),r=-(1/0),o=1/0,s=0,u=0,l=0,c=!0,f=!1,d=void 0;try{for(var h,p=(0,a.default)(this._bufferLevels.values());!(c=(h=p.next()).done);c=!0){var _=h.value;t=Math.min(t,_),n=Math.max(n,_),_<e?(r=Math.max(r,_),s++):_>e?(o=Math.min(o,_),l++):u++}}catch(e){f=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(f)throw d}}t=i(t),n=i(n),r=i(r),o=i(o);var m={minLevel:t,maxLevel:n,closestLowerLevel:r,closestHigherLevel:o,lowerLevelCount:s,sameLevelCount:u,higherLevelCount:l};return m}},{key:"_removedDestroyedPeers",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,a.default)(this._destroyedPeerIds);!(e=(r=i.next()).done);e=!0){var o=r.value;this._bufferLevels.delete(o)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this._destroyedPeerIds=[]}},{key:"getAndFlushBufferLevels",value:function(e){var t=this._calculateBufferLevelStats(e);return this._removedDestroyedPeers(),t}},{key:"getAveragePeerCount",value:function(){return(0,_.toDecimal)(this._peerCountStaircaseFunctionIntegral.getAverage(),2)}}]),e}();n.default=m,t.exports=n.default},{"../utils/Number":88,"../utils/StaircaseFunctionIntegral":91,"babel-runtime/core-js/get-iterator":106,"babel-runtime/core-js/map":109,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("./AnalyticsClient"),l=r(u),c=e("./UploadQueueObserver"),f=r(c),d=e("./PeerPoolObserver"),h=r(d),p=e("../utils/Delta"),_=e("./qos/QoSAnalyticsHandler"),m=r(_),v=function(){function e(t,n,r){(0,o.default)(this,e);var i=r.conf,a=r.moduleState,s=r.status;this._conf=i,this._status=s,this._playerInterface=t,this._analyticsClient=new l.default(i.ANALYTICS.KLARA_URL,i.ID_CLIENT,a.content,"stats",i),this._analyticsData=r.analyticsData,this._sessionStartTime=Date.now(),this._p2pUseful=new p.Delta,this._cdnDownloaded=new p.Delta,this._p2pConsumed=new p.Delta,this._cdnConsumed=new p.Delta,this._rawP2PDownloaded=new p.Delta,this._p2pUploaded=new p.Delta,this._PP=new p.Delta,this._PC=new p.Delta,this._CP=new p.Delta,this._CC=new p.Delta,this._HP=new p.Delta,this._HD=new p.Delta,this._M=new p.Delta,this._total=new p.Delta,this._uploadQueueObserver=new f.default(r),this._peerPoolObserver=new h.default(r),this._receivedChunkRequest=new p.Delta,this._hitReceivedChunkRequest=new p.Delta,this._sentChunkRequest=new p.Delta,this._timeoutSentChunkRequest=new p.Delta,this._attemptToSendChunkCount=new p.Delta,this._sentChunkCount=new p.Delta,this._expiredChunksToUpload=new p.Delta,this._addedChunksToUpload=new p.Delta,this._open=new p.Delta,this._match=new p.Delta,this._offer=new p.Delta,this._active=new p.Delta,this._transfer=new p.Delta,this._denied=new p.Delta,this._dropped=new p.Delta,this._timeout=new p.Delta,this._disconnected=new p.Delta,this._missedIceCandidate=new p.Delta,this._newPeerConnectionCount=new p.Delta,this._p2pSgtCheckSuccess=new p.Delta,this._p2pSgtCheckFail=new p.Delta,this._hybridSgtCheckSuccess=new p.Delta,this._hybridSgtCheckFail=new p.Delta,this._checkHeartbeatFailed=new p.Delta,this._counterControl=0,this._qosAnalyticsHandler=new m.default(n,r),this._lastPayloadTimestamps={}}return(0,s.default)(e,[{key:"_getSessionDuration",value:function(){return Date.now()-this._sessionStartTime}},{key:"_getTimespanSinceLastPayload",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"main":arguments[0];return isNaN(this._lastPayloadTimestamps[e])?this._getSessionDuration():Date.now()-this._lastPayloadTimestamps[e]}},{key:"_updateLastPayloadTimestamp",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"main":arguments[0];this._lastPayloadTimestamps[e]=Date.now()}},{key:"_getPeerStats",value:function(){return{count:this._peerPoolObserver.getAveragePeerCount(),open:this._open.calcDelta(this._analyticsData.open),match:this._match.calcDelta(this._analyticsData.match),offer:this._offer.calcDelta(this._analyticsData.offer),active:this._active.calcDelta(this._analyticsData.active),transfer:this._transfer.calcDelta(this._analyticsData.transfer),denied:this._denied.calcDelta(this._analyticsData.denied),dropped:this._dropped.calcDelta(this._analyticsData.dropped),timeout:this._timeout.calcDelta(this._analyticsData.timeout),disconnected:this._disconnected.calcDelta(this._analyticsData.disconnected)}}},{key:"_calculateStatsPayload",value:function(){var e=this._status.getConnectedToSignalingServer(),t=this._status.getConnected(),n=this._status.getUpgraded(),r=this._status.getTrackerVersion(),i=this._status.getTrackerId(),o={PP:this._status.getDataDownloadedTwice_PP(),PC:this._status.getDataDownloadedTwice_PC(),CP:this._status.getDataDownloadedTwice_CP(),CC:this._status.getDataDownloadedTwice_CC(),HP:this._status.getDataDownloadedTwice_HP(),HD:this._status.getDataDownloadedTwice_HD(),M:this._status.getDataDownloadedTwice_M()},a=o.PP+o.PC+o.CP+o.CC+o.HP+o.HD+o.M,s=this._cdnDownloaded.calcDelta(this._status.getCDNDownloaded()),u=s,l=this._p2pUseful.calcDelta(this._status.getP2PDownloaded()),c=this._p2pConsumed.calcDelta(this._analyticsData.p2p),f=this._cdnConsumed.calcDelta(this._analyticsData.cdn),d=this._rawP2PDownloaded.calcDelta(this._status.getP2PDownloadedUncorrected()),h=this._p2pUploaded.calcDelta(this._status.getP2PUploaded()),p={rawP2PDownloaded:d,cdnDownloaded:s,p2pUseful:l,cdnUseful:u,p2pConsumed:c,cdnConsumed:f,p2pUploaded:h,multipleDl:{PP:this._PP.calcDelta(o.PP),PC:this._PC.calcDelta(o.PC),CP:this._CP.calcDelta(o.CP),CC:this._CC.calcDelta(o.CC),HP:this._HP.calcDelta(o.HP),HD:this._HD.calcDelta(o.HD),M:this._M.calcDelta(o.M),total:this._total.calcDelta(a)}},_=this._receivedChunkRequest.calcDelta(this._status.getReceivedChunkRequestCount()),m=this._hitReceivedChunkRequest.calcDelta(this._status.getHitReceivedChunkRequestCount()),v=this._timeoutSentChunkRequest.calcDelta(this._status.getTimeoutSentChunkRequestCount()),b=this._sentChunkRequest.calcDelta(this._status.getSentChunkRequestCount()),g=this._attemptToSendChunkCount.calcDelta(this._status.getAttemptToSendChunkCount()),y=this._sentChunkCount.calcDelta(this._status.getSentChunkCount()),C=this._expiredChunksToUpload.calcDelta(this._status.getExpiredChunksToUpload()),w=this._addedChunksToUpload.calcDelta(this._status.getAddedChunksToUpload()),S={receivedChunkRequestsMissedRatio:_>0?1-m/_:0,sentChunkRequestsTimeoutRatio:b>0?v/b:0,uploadSaturationRatio:g>0?1-y/g:0,uploadSaturationFrequency:(g-y)/(this._conf.ANALYTICS.STATS_INTERVAL/6e4),
averageUploadLimitation:this._uploadQueueObserver.getAverageUploadLimitation(),uploadQueueExpirationRatio:w?C/w:0},k=void 0;this._qosAnalyticsHandler.initialized&&(k=this._qosAnalyticsHandler.getQoSAnalytics());var E={transfers:p,efficiency:S,qos:k,live:this._playerInterface.isLive(),signalingServerConnected:e,trackerConnected:t,trackerUpgraded:n,trackerVersion:r,peers:this._getPeerStats(),trackerId:i,sessionDuration:this._getSessionDuration(),timespan:this._getTimespanSinceLastPayload()};if(this._playerInterface.isLive()){var T=this._calculateBufferLevelStats();E.bufferLevel=T}return this._updateLastPayloadTimestamp(),E}},{key:"_calculateBufferLevelStats",value:function(){var e=this._status.getMyBufferLevel(),t=this._peerPoolObserver.getAndFlushBufferLevels(e),n=t.minLevel,r=t.maxLevel,i=t.closestLowerLevel,o=t.closestHigherLevel,a=t.lowerLevelCount,s=t.sameLevelCount,u=t.higherLevelCount,l={currentLevel:e,minLevel:n,maxLevel:r,closestLowerLevel:i,closestHigherLevel:o,lowerLevelCount:a,sameLevelCount:s,higherLevelCount:u};return l}},{key:"_calculateControlPayload",value:function(){var e=this._missedIceCandidate.calcDelta(this._status.getMissedIceCandidateCount()),t=this._newPeerConnectionCount.calcDelta(this._status.getNewPeerConnectionCount()),n=t>0?e/t:0,r=this._p2pSgtCheckSuccess.calcDelta(this._status.getNbRightHashP2P()),i=this._p2pSgtCheckFail.calcDelta(this._status.getNbWrongHashP2P()),o=this._hybridSgtCheckSuccess.calcDelta(this._status.getNbRightHashDLM()),a=this._hybridSgtCheckFail.calcDelta(this._status.getNbWrongHashDLM()),s=this._checkHeartbeatFailed.calcDelta(this._status.getCheckHeartbeatFailed()),u={live:this._playerInterface.isLive(),meanMissedIceCandidate:n,p2pSgtCheckSuccess:r,p2pSgtCheckFail:i,hybridSgtCheckSuccess:o,hybridSgtCheckFail:a,checkHeartbeatFailed:s,sessionDuration:this._getSessionDuration(),timespan:this._getTimespanSinceLastPayload("control")};return this._updateLastPayloadTimestamp("control"),u}},{key:"sendStats",value:function(){var e=this._calculateStatsPayload();this._analyticsClient.send(e)}},{key:"sendControl",value:function(){var e=this._calculateControlPayload();this._analyticsClient.send(e,"control")}},{key:"dispose",value:function(){this._qosAnalyticsHandler.dispose()}}]),e}();n.default=v,t.exports=n.default},{"../utils/Delta":85,"./AnalyticsClient":2,"./PeerPoolObserver":6,"./UploadQueueObserver":9,"./qos/QoSAnalyticsHandler":12,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("./AnalyticsClient"),l=r(u),c=e("../utils/Delta"),f=function(){function e(t,n){(0,o.default)(this,e);var r=n.conf,i=n.analyticsData,a=n.status,s=n.moduleState;this._analyticsClient=new l.default(r.ANALYTICS.KLARA_URL,r.ID_CLIENT,s.content,"traffic",r),this._playerInterface=t,this._analyticsData=i,this._status=a,this._p2p=new c.Delta,this._cdn=new c.Delta,this._upload=new c.Delta,this._timespan=new c.Delta,this._timespan.calcDelta(Date.now())}return(0,s.default)(e,[{key:"_calculateUsagePayload",value:function(){var e=this._p2p.calcDelta(this._status.getP2PDownloaded()),t=this._cdn.calcDelta(this._status.getCDNDownloaded()),n=this._upload.calcDelta(this._status.getP2PUploaded()),r=this._timespan.calcDelta(Date.now()),i={live:this._playerInterface.isLive(),cdn:t,p2p:e,upload:n,timespan:r};return i}},{key:"sendUsage",value:function(e){var t=this._calculateUsagePayload();e&&(t.unload=!0),this._analyticsClient.send(t,"usage")}}]),e}();n.default=f,t.exports=n.default},{"../utils/Delta":85,"./AnalyticsClient":2,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("../utils/StaircaseFunctionIntegral"),l=r(u),c=function(){function e(t){(0,o.default)(this,e);var n=t.eventBus;this._staircaseFunctionIntegral=new l.default,n.on("uploadLimitationChange",this._staircaseFunctionIntegral.updateMetric,this._staircaseFunctionIntegral)}return(0,s.default)(e,[{key:"getAverageUploadLimitation",value:function(){return this._staircaseFunctionIntegral.getAverage()}}]),e}();n.default=c,t.exports=n.default},{"../utils/StaircaseFunctionIntegral":91,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=function(){function e(){(0,o.default)(this,e),this._mediaElement=null}return(0,s.default)(e,[{key:"mediaElement",get:function(){return this._mediaElement},set:function(e){this._mediaElement=e}}]),e}();n.default=u,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("../../utils/Delta"),l=e("../../utils/Number"),c=function(){function e(){(0,o.default)(this,e),this._timeSpentPlayingDelta=new u.Delta,this._timeSpentRebufferingDelta=new u.Delta,this._timeSpentSeekingDelta=new u.Delta,this._rebufferingCountDelta=new u.Delta,this._lastTimeDelta=new u.Delta(Date.now()),this._droppedFrameCountDelta=new u.Delta,this._trackSwitchCountDelta=new u.Delta}return(0,s.default)(e,[{key:"_normalizePerMinute",value:function(e,t,n){var r=this._lastTimeDelta.calcDelta(Date.now()),i=this._rebufferingCountDelta.calcDelta(e),o=i/(r/6e4),a=this._droppedFrameCountDelta.calcDelta(t),s=a/(r/6e4),u=this._trackSwitchCountDelta.calcDelta(n),c=u/(r/6e4);return{rebufferingCPM:(0,l.toDecimal)(o,2),droppedFrameCPM:(0,l.toDecimal)(s,2),trackSwitchCPM:(0,l.toDecimal)(c,2)}}},{key:"format",value:function(e,t){var n=this._normalizePerMinute(e.rebufferingCount,e.droppedFrameCount,t),r=n.rebufferingCPM,i=n.droppedFrameCPM,o=n.trackSwitchCPM;return{rebufferingCPM:r,droppedFrameCPM:i,trackSwitchCPM:o,timeSpentPlaying:(0,l.toDecimal)(this._timeSpentPlayingDelta.calcDelta(e.timeSpentPlaying),2),timeSpentRebuffering:(0,l.toDecimal)(this._timeSpentRebufferingDelta.calcDelta(e.timeSpentRebuffering),2),timeSpentSeeking:(0,l.toDecimal)(this._timeSpentSeekingDelta.calcDelta(e.timeSpentSeeking),2),startupTime:e.startupTime,endedOnce:e.endedOnce}}}]),e}();n.default=c,t.exports=n.default},{"../../utils/Delta":85,"../../utils/Number":88,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("streamroot-qos-analytics"),l=r(u),c=e("./QoSAnalyticsFormatter"),f=r(c),d=e("../../utils/EventEnum"),h=r(d),p=function(){function e(t,n){(0,o.default)(this,e),this._trackSwitchCount=-1,n.eventBus.on(h.default.Metrics.TRACK_SWITCH,this._onTrackSwitch.bind(this)),null!==t.mediaElement&&(this._initialized=!0,this._qosAnalytics=new l.default(t.mediaElement),this._qoSAnalyticsFormatter=new f.default)}return(0,s.default)(e,[{key:"_onTrackSwitch",value:function(){this._trackSwitchCount++}},{key:"getQoSAnalytics",value:function(){if(!this._initialized)throw new Error("getQoSAnalytics was called on non-initialized QoSAnalyticsHandler");var e=this._qosAnalytics.getQoSAnalytics();return this._qoSAnalyticsFormatter.format(e,this._trackSwitchCount)}},{key:"dispose",value:function(){this._qosAnalytics&&this._qosAnalytics.dispose()}},{key:"initialized",get:function(){return this._initialized}}]),e}();n.default=p,t.exports=n.default},{"../../utils/EventEnum":86,"./QoSAnalyticsFormatter":11,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,"streamroot-qos-analytics":224}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/assign"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=e("./bugsnag"),f=r(c),d=e("../../defaultConf"),h=r(d),p=function(){function e(){(0,s.default)(this,e),this._metadata={},this._scriptOrigin=null,f.default.apiKey=h.default.ERRORS.API_KEY,f.default.notifyHandler=h.default.ERRORS.HANDLER,f.default.notifyReleaseStages=h.default.ERRORS.STAGES,f.default.disableLog=!0,f.default.releaseStage="production",f.default.autoNotify=!1,f.default.appVersion=this._getAppVersion(),f.default.beforeNotify=this._beforeNotify()}return(0,l.default)(e,[{key:"notify",value:function(e,t,n){var r="warning";!n||"error"!==n&&"info"!==n||(r=n),f.default.notify(e,t,this._metadata,r)}},{key:"notifyError",value:function(e){f.default.notifyException(e,{groupingHash:e.message})}},{key:"resetRateLimit",value:function(){f.default.refresh()}},{key:"_beforeNotify",value:function(){var e=this;return function(t){return!(!t.file||t.file!==e._scriptOrigin)}}},{key:"_getAppVersion",value:function(){var e="4.3.0";return e.split("-")[0]}},{key:"setMetadata",value:function(e){(0,o.default)(this._metadata,e),f.default.metaData=this._metadata}},{key:"setCustomer",value:function(e){f.default.userId=e}},{key:"setScriptOrigin",value:function(e){this._scriptOrigin=e}}]),e}();n.default=new p,t.exports=n.default},{"../../defaultConf":1,"./bugsnag":14,"babel-runtime/core-js/object/assign":110,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],14:[function(t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var o=t("babel-runtime/helpers/typeof"),a=i(o);!function(t,r){function i(){j=!1}function o(){var e=document.currentScript||C;if(!e&&j){var t=document.scripts||document.getElementsByTagName("script");e=t[t.length-1]}return e}function s(e){var t=o();t&&(e.script={src:t.src,content:h("inlineScript",!0)?t.innerHTML:""})}function u(e){var n=h("disableLog"),r=t.console;void 0===r||void 0===r.log||n||r.log("[Bugsnag] "+e)}function l(e,n,r){var i=h("maxDepth",T);if(r>=i)return encodeURIComponent(n)+"=[RECURSIVE]";r=r+1||1;try{if(t.Node&&e instanceof t.Node)return encodeURIComponent(n)+"="+encodeURIComponent(g(e));var o=[];for(var s in e)if(e.hasOwnProperty(s)&&null!=s&&null!=e[s]){var u=n?n+"["+s+"]":s,c=e[s];o.push("object"===("undefined"==typeof c?"undefined":(0,a.default)(c))?l(c,u,r):encodeURIComponent(u)+"="+encodeURIComponent(c))}return o.join("&")}catch(e){return encodeURIComponent(n)+"="+encodeURIComponent(""+e)}}function c(e,t,n){if(null==t)return e;if(n>=h("maxDepth",T))return"[RECURSIVE]";e=e||{};for(var r in t)if(t.hasOwnProperty(r))try{t[r].constructor===Object?e[r]=c(e[r],t[r],n+1||1):e[r]=t[r]}catch(n){e[r]=t[r]}return e}function f(e,t){if(e+="?"+l(t)+"&ct=img&cb="+(new Date).getTime(),"undefined"!=typeof BUGSNAG_TESTING&&S.testRequest)S.testRequest(e,t);else{var n=h("notifyHandler");if("xhr"===n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.send()}else{var i=new Image;i.src=e}}}function d(e){var t={},n=/^data\-([\w\-]+)$/;if(e)for(var r=e.attributes,i=0;i<r.length;i++){var o=r[i];if(n.test(o.nodeName)){var a=o.nodeName.match(n)[1];t[a]=o.value||o.nodeValue}}return t}function h(e,t){D=D||d(O);var n=void 0!==S[e]?S[e]:D[e.toLowerCase()];return"false"===n&&(n=!1),void 0!==n?n:t}function p(e){return!(!e||!e.match(P))||(u("Invalid API key '"+e+"'"),!1)}function _(e,n){var r=h("apiKey");if(p(r)&&E){E-=1;var i=h("releaseStage","production"),o=h("notifyReleaseStages");if(o){for(var a=!1,s=0;s<o.length;s++)if(i===o[s]){a=!0;break}if(!a)return}var l=[e.name,e.message,e.stacktrace].join("|");if(l!==w){w=l,y&&(n=n||{},n["Last Event"]=b(y));var d={notifierVersion:R,apiKey:r,projectRoot:h("projectRoot")||t.location.protocol+"//"+t.location.host,context:h("context")||t.location.pathname,userId:h("userId"),user:h("user"),metaData:c(c({},h("metaData")),n),releaseStage:i,appVersion:h("appVersion"),url:t.location.href,userAgent:navigator.userAgent,language:navigator.language||navigator.userLanguage,severity:e.severity,name:e.name,message:e.message,stacktrace:e.stacktrace,file:e.file,lineNumber:e.lineNumber,columnNumber:e.columnNumber,payloadVersion:"2"},_=S.beforeNotify;if("function"==typeof _){var m=_(d,d.metaData);if(m===!1)return}return 0===d.lineNumber&&/Script error\.?/.test(d.message)?u("Ignoring cross-domain script error. See https://bugsnag.com/docs/notifiers/js/cors"):void f(h("endpoint")||A,d)}}}function m(){var e,t,n=10,r="[anonymous]";try{throw new Error("")}catch(n){e="<generated>\n",t=v(n)}if(!t){e="<generated-ie>\n";var i=[];try{for(var o=arguments.callee.caller.caller;o&&i.length<n;){var a=I.test(o.toString())?RegExp.$1||r:r;i.push(a),o=o.caller}}catch(e){u(e)}t=i.join("\n")}return e+t}function v(e){return e.stack||e.backtrace||e.stacktrace}function b(e){var t={millisecondsAgo:new Date-e.timeStamp,type:e.type,which:e.which,target:g(e.target)};return t}function g(e){if(e){var t=e.attributes;if(t){for(var n="<"+e.nodeName.toLowerCase(),r=0;r<t.length;r++)t[r].value&&"null"!==t[r].value.toString()&&(n+=" "+t[r].name+'="'+t[r].value+'"');return n+">"}return e.nodeName}}var y,C,w,S={},k=!0,E=10,T=5;S.noConflict=function(){return t.Bugsnag=r,"undefined"==typeof r&&delete t.Bugsnag,S},S.refresh=function(){E=10},S.notifyException=function(e,t,n,r){e&&(t&&"string"!=typeof t&&(n=t,t=void 0),n||(n={}),s(n),_({name:t||e.name,message:e.message||e.description,stacktrace:v(e)||m(),file:e.fileName||e.sourceURL,lineNumber:e.lineNumber||e.line,columnNumber:e.columnNumber?e.columnNumber+1:void 0,severity:r||"warning"},n))},S.notify=function(e,n,r,i){_({name:e,message:n,stacktrace:m(),file:t.location.toString(),lineNumber:1,severity:i||"warning"},r)};var j="complete"!==document.readyState;document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!0),t.addEventListener("load",i,!0)):t.attachEvent("onload",i);var D,P=/^[0-9a-f]{32}$/i,I=/function\s*([\w\-$]+)?\s*\(/i,M="https://notify.bugsnag.com/",A=M+"js",R="2.5.0",x=document.getElementsByTagName("script"),O=x[x.length-1];if(t.atob){if(t.ErrorEvent)try{0===new t.ErrorEvent("test").colno&&(k=!1)}catch(e){}}else k=!1;t.Bugsnag=S,"function"==typeof e&&e.amd?e([],function(){return S}):"object"===("undefined"==typeof n?"undefined":(0,a.default)(n))&&"object"===(0,a.default)(n.exports)&&(n.exports=S)}(window,window.Bugsnag)},{"babel-runtime/helpers/typeof":129}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./TimedValue"),o=r(i),a=function(e){var t=[],n=e,r=function(){for(var e=-1,r=Date.now(),i=0;i<t.length&&r-t[i].timestamp()>n;i++)e=i;return e},i=function(){var e=r();e>-1&&t.splice(0,e+1)},a=function(e){if(0!==e){i();var n=new o.default(e);t.push(n)}},s=function(){if(i(),!t.length)return 0;for(var e=0,n=0;n<t.length;n++)e+=t[n].value();return e/t.length};this.addPoint=a,this.compute=s};n.default=a,t.exports=n.default},{"./TimedValue":16}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){var t=e,n=Date.now();this.timestamp=function(){return n},this.value=function(){return t}};n.default=r,t.exports=n.default},{}],17:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/typeof"),o=r(i),a=e("babel-runtime/core-js/get-iterator"),s=r(a),u=e("../utils/Timers"),l=r(u),c=(e("../utils/nativeTimers"),function(e,t,n){function r(){var e=p.getSegmentListToDownload().slice(0,d.NB_SEGMENT_P2P_PREBUFFER);if(a()+d.NB_CHUNK_DL_GROUP*d.CHUNK_SIZE/1024<d.MAX_DL_REQUEST_SPEED)for(var t=0;t<d.NB_CHUNK_DL_GROUP;t++)i(e)}function i(e){var t=!0,n=!1,r=void 0;try{for(var i,a=function(){var e=i.value,t=_.getOrCreateSegmentHandler(e),n=t.seeders.getNextSeeder(t.chunkManager.chunkNumber);if(n){var r=function(){var r=t.chunkManager.getNextChunk();if(r>=0)return n.requestChunk(e,r),c(),h.setTimeout(function(){t.chunkManager.timeOut(r),n.getHeuristic().incrementNbChunkTimeOut()},d.CHUNK_TIMEOUT),{v:{v:void 0}}}();if("object"===("undefined"==typeof r?"undefined":(0,o.default)(r)))return r.v}},u=(0,s.default)(e);!(t=(i=u.next()).done);t=!0){var l=a();if("object"===("undefined"==typeof l?"undefined":(0,o.default)(l)))return l.v}}catch(e){n=!0,r=e}finally{try{!t&&u.return&&u.return()}finally{if(n)throw r}}}function a(){var e=u();return e===!1?m=[]:e>0&&m.splice(0,e),m.length*d.CHUNK_SIZE/1024}function u(){for(var e=Date.now(),t=0;t<m.length;t++)if(e-m[t]<=1e3)return t;return!1}function c(){var e=Date.now();m.push(e)}function f(){h.clearAll()}var d=n.conf,h=new l.default,p=t,_=e,m=[];h.setInterval(r,d.TIME_BETWEEN_CHUNK_DL),this.dispose=f});n.default=c,t.exports=n.default},{"../utils/Timers":95,"../utils/nativeTimers":99,"babel-runtime/core-js/get-iterator":106,"babel-runtime/helpers/typeof":129}],18:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("./PartialSegment/PartialSegmentP2P"),l=r(u),c=e("eventemitter3"),f=r(c),d=e("./binaryAbstraction/Segment"),h=r(d),p=function(){function e(t,n,r,i,a){(0,o.default)(this,e),this._sharedState=a,this._conf=a.conf,this._status=a.status,this._workerHelper=a.workerHelper,this.p2pCache=n,this.dataLocked=!1,this._isEmpty=!0,this._partialSegmentRequested=!1,this._segmentCoord=t,this.downloadStatus=[],this._peerPool=r,this._segmentInfoMap=i;var s=new f.default;this.getEE=function(){return s}}return(0,s.default)(e,[{key:"setSegmentSize",value:function(e){if(!this.size){this.size=e,this.chunkNumber=Math.ceil(this.size/this._conf.CHUNK_SIZE);for(var t=0;t<this.chunkNumber;t++)this.downloadStatus.push("pending");this.segment=new h.default(e)}}},{key:"getChunk",value:function(e,t){if(this.dataLocked||"downloaded"!==this.downloadStatus[e]&&"CDNdownloaded"!==this.downloadStatus[e])this.dataLocked,t(null);else{var n=this._conf.CHUNK_SIZE,r=e*this._conf.CHUNK_SIZE;r+n>this.size&&(n=this.size-r),this.segment.getBinaryData(r,n,t)}}},{key:"getNextChunk",value:function(){var e=this.downloadStatus.indexOf("failed");return e<0&&(e=this.downloadStatus.indexOf("pending")),e>=0&&(this.downloadStatus[e]="downloading"),e}},{key:"chunkDownloaded",value:function(e,t){if(this._isEmpty=!1,"downloaded"===this.downloadStatus[t])this._status.correctP2PDownloaded(e.byteLength,"PP");else if("CDNdownloaded"===this.downloadStatus[t]||this._writeLock)this._status.correctP2PDownloaded(e.byteLength,"CP");else if(this.downloadStatus[t]="downloaded",this._status.setp2pDownloadedNewAnalytics(this._status.getp2pDownloadedNewAnalytics()+e.byteLength),this.segment.setBinaryData(e,t*this._conf.CHUNK_SIZE),this.isSegmentDownloaded()){var n=this.segment,r=this.p2pCache.getSegmentHandler(this._segmentCoord);r.seeders.cleanAfterDownloaded(),this.lockSegmentData(),this._checkHashP2P(n)}}},{key:"timeOut",value:function(e){"downloading"===this.downloadStatus[e]&&(this.downloadStatus[e]="failed",this._status.incrementTimeoutSentChunkRequestCount()),this._status.incrementSentChunkRequestCount()}},{key:"isSegmentDownloaded",value:function(){if(this.size){for(var e=this.downloadStatus.length-1;e>=0;e--)if("downloaded"!==this.downloadStatus[e]&&"CDNdownloaded"!==this.downloadStatus[e])return!1;return!0}return!1}},{key:"shouldDownloadSegment",value:function(){return!this.isSegmentDownloaded()&&!this.partialSegment&&!this._partialSegmentRequested}},{key:"getPartialSegment",value:function(){var e=this,t=function(){e.partialSegment||e.dataLocked||(e.partialSegment=new l.default(e._segmentCoord,e.p2pCache,e.segment,e.downloadStatus,e.size,e,e.isSegmentDownloaded(),e._segmentInfoMap,e._sharedState))};return this._partialSegmentRequested=!0,!(this._isEmpty||!this.size)&&(t(),this.dataLocked||(this._writeLock=!0),this.partialSegment)}},{key:"getIndexLastChunkInARow",value:function(){for(var e=0;e<this.downloadStatus.length;e++)if("downloaded"!==this.downloadStatus[e]&&"CDNdownloaded"!==this.downloadStatus[e])return e-1;return this.downloadStatus.length-1}},{key:"storeSegment",value:function(e){this._isEmpty=!1,this.size||this.setSegmentSize(e.byteLength),this.segment=e,this._updateDownloadStatus()}},{key:"_updateDownloadStatus",value:function(){var e;e={start:0,end:this.chunkNumber},this.partialSegment&&this.partialSegment.getCDNIndexRange()&&(e=this.partialSegment.getCDNIndexRange());for(var t=e.start;t<e.end;t++){if("downloaded"===this.downloadStatus[t]||"CDNdownloaded"===this.downloadStatus[t]){var n=this._conf.CHUNK_SIZE;t===this.chunkNumber-1&&(n=this.size-(this.chunkNumber-1)*this._conf.CHUNK_SIZE),"downloaded"===this.downloadStatus[t]?this._status.correctP2PDownloaded(n,"PC"):"CDNdownloaded"===this.downloadStatus[t]&&this._status.correctP2PDownloaded(n,"CC")}this.downloadStatus[t]="CDNdownloaded"}}},{key:"getP2PDownload_CDNDownload",value:function(){var e=0,t=0;if(this.size){for(var n=0,r=this.downloadStatus.length-1;n<r;n++)"downloaded"===this.downloadStatus[n]?e+=this._conf.CHUNK_SIZE:"CDNdownloaded"===this.downloadStatus[n]&&(t+=this._conf.CHUNK_SIZE);var i=this.size-(this.chunkNumber-1)*this._conf.CHUNK_SIZE;"downloaded"===this.downloadStatus[this.chunkNumber-1]?e+=i:"CDNdownloaded"===this.downloadStatus[this.chunkNumber-1]&&(t+=i)}return{p2pDownloaded:e,cdnDownloaded:t}}},{key:"lockSegmentData",value:function(){this.dataLocked=!0}},{key:"unlockSegmentData",value:function(){this.dataLocked=!1}},{key:"removePartialSegment",value:function(){delete this.partialSegment}},{key:"_checkHashP2P",value:function(e){var t=this,n=this._segmentInfoMap.getSegmentInfo(this._segmentCoord),r=function(e,r){n.hash===r?(t._status.setNbRightHashP2P(t._status.getNbRightHashP2P()+1),t.segment=new h.default(e),t.unlockSegmentData(),t._peerPool.broadcastSegmentInfo(n.segmentCoord)):(t._status.setNbWrongHashP2P(t._status.getNbWrongHashP2P()+1),t.p2pCache.removeSegmentHandler(n.segmentCoord),t._status.correctP2PDownloaded(t.size,"HP"))};e.getBinaryData(0,e.byteLength,function(e){t._workerHelper.callHashWorker(e,r)})}}]),e}();n.default=p,t.exports=n.default},{"./PartialSegment/PartialSegmentP2P":33,"./binaryAbstraction/Segment":47,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,eventemitter3:219}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t){function n(e,t,n,o){var a=r.getSegmentHandler(t).chunkManager;a?a.chunkDownloaded(o,n):i.correctP2PDownloaded(o.byteLength,"M"),e.getHeuristic().incrementNbChunkDownloaded()}var r=e,i=t.status;t.eventBus.on("chunkReceived",n)};n.default=r,t.exports=n.default},{}],20:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./UploadQueue"),o=r(i),a=function(e,t){function n(e,t,n){i.incrementReceivedChunkRequestCount();var o=Date.now(),s=r.getSegmentHandler(t).chunkManager;s&&s.getChunk(n,function(r){r&&(i.incrementHitReceivedChunkRequestCount(),a.add(e,t,n,r,o))})}var r=e,i=t.status,a=new o.default(t);t.eventBus.on("chunkRequested",n)};n.default=a,t.exports=n.default},{"./UploadQueue":46}],21:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/slicedToArray"),o=r(i),a=e("babel-runtime/core-js/get-iterator"),s=r(a),u=e("babel-runtime/core-js/map"),l=r(u),c=e("babel-runtime/helpers/classCallCheck"),f=r(c),d=e("babel-runtime/helpers/createClass"),h=r(d),p=e("../utils/Options"),_=e("../../defaultConf"),m=(r(_),function(){function e(t,n){var r=this;(0,f.default)(this,e),this._segmentListMap=new l.default,this._conf=n.conf;var i=t.getTrackList();i.forEach(function(e){r._segmentListMap.set(e,[])})}return(0,h.default)(e,[{key:"insert",value:function(e){var t=this._getMatchingTrack(e),n=(0,p.unwrap)(this._segmentListMap.get(t));if(0===n.length)n.push(e);else if(n[0].getId()>e.getId())n.unshift(e);else for(var r=n.length;r>0;r--)if(e.getId()>n[r-1].getId()){n.splice(r,0,e);break}var i=n.length;if(i>this._conf.MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH){var o=n.slice(i-this._conf.MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH);this._segmentListMap.set(t,o)}}},{key:"getSegmentListAfter",value:function(e){var t=this._getMatchingTrack(e),n=(0,p.unwrap)(this._segmentListMap.get(t)),r=n.filter(function(t){return t.getId()>e.getId()});return this._segmentListMap.set(t,r),r}},{key:"_getMatchingTrack",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=(0,s.default)(this._segmentListMap);!(t=(i=a.next()).done);t=!0){var u=(0,o.default)(i.value,1),l=u[0];if(e.isInTrack(l))return l}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}throw new Error("The segment "+e.viewToString()+" belongs to no track")}}]),e}());n.default=m,t.exports=n.default},{"../../defaultConf":1,"../utils/Options":90,"babel-runtime/core-js/get-iterator":106,"babel-runtime/core-js/map":109,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,"babel-runtime/helpers/slicedToArray":127}],22:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("../utils/Timers"),l=r(u),c=function(){function e(t){(0,o.default)(this,e),this._exclusionArray=[],this._timers=new l.default,this._retentionTime=t}return(0,s.default)(e,[{key:"add",value:function(e){var t=this;this._exclusionArray.push(e),this._timers.setTimeout(function(){t._exclusionArray.splice(0,1)},this._retentionTime)}},{key:"getExclusionList",value:function(){return this._exclusionArray}},{key:"dispose",value:function(){this._timers.clearAll()}}]),e}();n.default=c,t.exports=n.default},{"../utils/Timers":95,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){var t=e,n={},r=[],i=[],o=function(e,n){r.push({eventName:e,fn:n}),t.addEventListener(e,n)},a=function(e,t){i.push({eventName:e,fn:t}),window.addEventListener(e,t)},s=function(){for(var e=0;e<r.length;e++){var n=r[e].eventName,i=r[e].fn;t.removeEventListener(n,i)}r=[]},u=function(){for(var e=0;e<i.length;e++){var t=i[e].eventName,n=i[e].fn;window.removeEventListener(t,n)}i=[]},l=function(){s(),u()},c=function(e){function t(){n[e].arguments=arguments}return n[e]={arguments:void 0,handler:t},t},f=function(e){t.addEventListener(e,c(e))},d=function(e,r){if(!n[e])throw new Error("You are trying to trigger an event that have not been cached before");t.removeEventListener(e,n[e].handler),n[e].arguments&&r.apply(void 0,n[e].arguments)};this.addMediaEventListener=o,this.addWindowEventListener=a,this.removeAllExternalEventListener=l,this.cacheMediaEvent=f,this.triggerCachedEvent=d};n.default=r,t.exports=n.default},{}],24:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../utils/Timers"),o=r(i),a=function(){var e=.3,t=0,n=4e3,r=0,i=0,a=0,s=.5,u=0,l=new o.default,c=function(){r++},f=function(){i++},d=function(){a++},h=function(){var e,n=i/r;return e=isNaN(n)?t:Math.min(n,1),u=e,e},p=function(){var t;return 0!==r&&(t=(1-e)*s+e*h(),s=t),s},_=function(){r=0,i=0,a=0},m=function(){p(),_()},v=function(){l.setInterval(m,n)},b=function(){l.clearAll()};this.incrementNbChunkRequested=function(){return c()},this.incrementNbChunkDownloaded=function(){return f()},this.incrementNbChunkTimeOut=function(){return d()},this.heurisInst=function(){return h()},this.mean=function(){return p()},this.getNbChunkRequested=function(){return r},this.getHeuristicScore=function(){return s},this.getLastHeuristInst=function(){return u},this.dispose=function(){b()},v()};n.default=a,t.exports=n.default},{"../utils/Timers":95}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r){this.city=e,this.country=t,this.latitude=n,this.longitude=r};n.default=r,t.exports=n.default},{}],26:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/map"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=e("../../defaultConf"),f=(r(c),e("../utils/Options")),d=function(){function e(t,n){(0,s.default)(this,e),this._mediaMap=t,this._conf=n.conf,this._cachedSegmentList=new o.default,this._cachedSegmentTime=new o.default}return(0,l.default)(e,[{key:"getSegmentList",value:function(e,t,n){var r=this._cachedSegmentList.get(e.viewToString());if(r&&r.beginTime===t&&r.duration===n)return r.cachedSegmentList;var i=this._mediaMap.getSegmentList(e,t,n);return this._cachedSegmentList.set(e.viewToString(),{beginTime:t,cachedSegmentList:i,duration:n}),i}},{key:"getSegmentTime",value:function(e){var t=this._cachedSegmentTime.get(e.viewToString());if(void 0!==t)return t;var n=this._mediaMap.getSegmentTime(e);if(this._cachedSegmentTime.set(e.viewToString(),n),this._cachedSegmentTime.size>this._conf.GETSEGMENTTIME_CACHE_MAX_SIZE){var r=this._cachedSegmentTime.keys(),i=r.next().value,o=(0,f.unwrap)(i);this._cachedSegmentTime.delete(o)}return n}}]),e}();n.default=d,t.exports=n.default},{"../../defaultConf":1,"../utils/Options":90,"babel-runtime/core-js/map":109,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],27:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=function(){function e(){(0,o.default)(this,e)}return(0,s.default)(e,[{key:"updateCurrentTracks",value:function(e){var t=e.video;t&&(this._currentVideoTrack=t)}},{key:"getVideoTrackHash",value:function(){return this._currentVideoTrack?this._currentVideoTrack.viewToString():"defaultTrackHash"}}]),e}();n.default=u,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],28:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/slicedToArray"),o=r(i),a=e("babel-runtime/helpers/toConsumableArray"),s=r(a),u=e("babel-runtime/core-js/get-iterator"),l=r(u),c=e("babel-runtime/core-js/map"),f=r(c),d=e("./structures/SegmentHandler"),h=r(d),p=e("../utils/Timers"),_=r(p),m=e("./binaryAbstraction/Segment"),v=r(m),b=function(e,t,n,r){function i(e){var t=k.get(e.viewToString());return!!t&&t}function a(e){var t=!0,n=!1,r=void 0;try{for(var i,o=(0,l.default)(k.values());!(t=(i=o.next()).done);t=!0){var a=i.value;a.seeders.removeSeeder(e)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}function u(e){var t=i(e);return t===!1&&(t=new h.default(e,this,j,T,r),k.set(t.segmentCoord.viewToString(),t),j.requestHasSegment(e),c()),t}function c(){var e,t=0,n=E()?S.LIVE.P2P_CACHE_MAX_SIZE:S.P2P_CACHE_MAX_SIZE,r=0,i=!0,o=!1,a=void 0;try{for(var s,u=(0,l.default)(k.values());!(i=(s=u.next()).done);i=!0){var c=s.value;if(c.chunkManager.size&&(t+=c.chunkManager.size),t>n){e=k.size-r;break}r++}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return();
}finally{if(o)throw a}}if(e){var f=k.keys(),d=!0,h=!1,p=void 0;try{for(var _,m=(0,l.default)(f);!(d=(_=m.next()).done);d=!0){var v=_.value;if(0===e)break;var b=k.get(v);k.delete(v),T.removeSegmentInfo(b.segmentCoord),e--}}catch(e){h=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(h)throw p}}}}function d(e){k.delete(e.viewToString())}function p(){var e=0,t=0,n=!0,r=!1,i=void 0;try{for(var o,a=(0,l.default)(k.values());!(n=(o=a.next()).done);n=!0){var s=o.value,u=s.chunkManager.getP2PDownload_CDNDownload();e+=u.p2pDownloaded,t+=u.cdnDownloaded}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return{p2pDownloaded:e,cdnDownloaded:t}}function m(e,t){var n=u(e),r=n.chunkManager,i=new v.default(t);r.storeSegment(i),j.broadcastSegmentInfo(e)}function b(e){var t=i(e).chunkManager;return!!t&&t.getPartialSegment()}function g(e){return[].concat((0,s.default)(k)).filter(function(t){var n=(0,o.default)(t,2),r=(n[0],n[1]);return r.segmentCoord.isInTrack(e)&&!r.chunkManager.shouldDownloadSegment()}).map(function(e){var t=(0,o.default)(e,2),n=(t[0],t[1]);return n.segmentCoord})}function y(){return[].concat((0,s.default)(k)).map(function(e){var t=(0,o.default)(e,2),n=(t[0],t[1]);return{segmentcoord:n.segmentCoord,downloadStatusList:n.chunkManager.downloadStatus,seederCount:n.seeders.getLength()}})}function C(e){return[].concat((0,s.default)(k)).filter(function(t){var n=(0,o.default)(t,2),r=(n[0],n[1]);return r.segmentCoord.isInTrack(e)&&r.chunkManager.isSegmentDownloaded()}).map(function(e){var t=(0,o.default)(e,2),n=(t[0],t[1]);return n.segmentCoord})}function w(){D.clearAll(),k=new f.default}var S=r.conf,k=new f.default,E=e,T=n,j=t,D=new _.default;p(),D.setInterval(p,1e4),this.dispose=w,this.getOrCreateSegmentHandler=u,this.removeSegmentHandler=d,this.doubleCheckP2PDownload_CDNDownload=p,this.fillSegment=m,this.getSegmentHandler=i,this.getPartialSegment=b,this.removePeer=a,this.listSegmentsToSkipForTrack=g,this.listSegmentsDownloadStatus=y,this.listDownloadedSegmentsForTrack=C};n.default=b,t.exports=n.default},{"../utils/Timers":95,"./binaryAbstraction/Segment":47,"./structures/SegmentHandler":73,"babel-runtime/core-js/get-iterator":106,"babel-runtime/core-js/map":109,"babel-runtime/helpers/slicedToArray":127,"babel-runtime/helpers/toConsumableArray":128}],29:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=function(){function e(t,n,r,i){(0,o.default)(this,e),this._scheduler=t,this._p2pCache=n,this._segmentInfoMap=r,this._distributedSegmentList=i}return(0,s.default)(e,[{key:"_onHasSegment",value:function(e,t,n){var r=n.pushed;if(this._segmentInfoMap.addSegmentInfo(t),r&&this._distributedSegmentList.insert(t.segmentCoord),this._scheduler.isSegmentRequested(t.segmentCoord)){var i=this._p2pCache.getOrCreateSegmentHandler(t.segmentCoord);i.chunkManager.setSegmentSize(t.size),i.seeders.insertSeeder(e)}}},{key:"_onPeerDestroyed",value:function(e){var t=e.remotePeer;this._p2pCache.removePeer(t)}}],[{key:"listenEvents",value:function(t,n,r,i,o){var a=new e(t,n,r,i);o.eventBus.on("hasSegment",a._onHasSegment.bind(a)),o.eventBus.on("peerDestroyed",a._onPeerDestroyed.bind(a))}}]),e}();n.default=u,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],30:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/get-prototype-of"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(c),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("./PartialSegmentInterface"),_=r(p),m=function(e){function t(e){(0,s.default)(this,t);var n=(0,f.default)(this,(0,o.default)(t).call(this));return n._segmentCoord=e,n}return(0,h.default)(t,e),(0,l.default)(t,[{key:"getUpdatedRange",value:function(e){return e}},{key:"getFullSegment",value:function(e,t){t(e,this._segmentCoord)}},{key:"isComplete",value:function(){return!1}},{key:"isLocked",value:function(){return!1}},{key:"p2pSpeed",get:function(){return 0}},{key:"p2pAmount",get:function(){return 0}}]),t}(_.default);n.default=m,t.exports=n.default},{"./PartialSegmentInterface":31,"babel-runtime/core-js/object/get-prototype-of":116,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,"babel-runtime/helpers/inherits":125,"babel-runtime/helpers/possibleConstructorReturn":126}],31:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u="Method not implemented",l=function(){function e(){(0,o.default)(this,e)}return(0,s.default)(e,[{key:"getUpdatedRange",value:function(e){throw new Error(u)}},{key:"getFullSegment",value:function(e,t,n){throw new Error(u)}},{key:"isComplete",value:function(){throw new Error(u)}},{key:"isLocked",value:function(){throw new Error(u)}},{key:"p2pSpeed",get:function(){throw new Error(u)}},{key:"p2pAmount",get:function(){throw new Error(u)}}]),e}();n.default=l,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],32:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/get-prototype-of"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(c),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("./PartialSegmentInterface"),_=r(p),m=e("../structures/SegmentInfo"),v=r(m),b=function(e){function t(e,n,r,i){function a(e,t){function i(i,o){e.response=i;var a=new v.default(h,i.byteLength,o);r.addSegmentInfo(a),n.fillSegment(h,e.response),l.emit("piece_downloaded_prtl",h),t(e,h)}c.callHashWorker(e.response,i)}(0,s.default)(this,t);var u=i.status,l=i.eventBus,c=i.workerHelper,d=(0,f.default)(this,(0,o.default)(t).call(this)),h=e;return d.getFullSegment=function(e,t){l.emit("CDNSegmentDownloaded",h);var n=e.response;u.increaseCDNDownloadedBy(n.byteLength),a(e,t)},d}return(0,h.default)(t,e),(0,l.default)(t,[{key:"isComplete",value:function(){return!1}},{key:"isLocked",value:function(){return!1}},{key:"getUpdatedRange",value:function(e){return e}},{key:"p2pSpeed",get:function(){return 0}},{key:"p2pAmount",get:function(){return 0}}]),t}(_.default);n.default=b,t.exports=n.default},{"../structures/SegmentInfo":74,"./PartialSegmentInterface":31,"babel-runtime/core-js/object/get-prototype-of":116,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,"babel-runtime/helpers/inherits":125,"babel-runtime/helpers/possibleConstructorReturn":126}],33:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/define-properties"),o=r(i),a=e("babel-runtime/core-js/object/get-prototype-of"),s=r(a),u=e("babel-runtime/helpers/classCallCheck"),l=r(u),c=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(c),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("../../errors/ErrorFunnel"),_=r(p),m=e("./PartialSegmentInterface"),v=r(m),b=function(e){function t(e,n,r,i,a,u,c,d,h){function p(e,t,r,i){function o(o,a){t.hash===a?(M.setNbRightHashDLM(M.getNbRightHashDLM()+1),e.response=o,m(e),r(e,N)):(M.setNbWrongHashDLM(M.getNbWrongHashDLM()+1),M.increaseCdnDataDiscardedBy($),n.removeSegmentHandler(N),M.correctP2PDownloaded(T,"HD"),i(e,N))}R.callHashWorker(e.response,o)}function m(e){D=e.response,n.fillSegment(N,e.response),A.emit("piece_downloaded_prtl",N),u.unlockSegmentData(),u.removePartialSegment()}function v(){O?T=a:(T=E.start*I.CHUNK_SIZE,E.end<P.length&&(T+=(P.length-E.end-1)*I.CHUNK_SIZE,T+=a-(P.length-1)*I.CHUNK_SIZE))}function b(){for(var e=0;e<P.length;e++)if("downloaded"!==P[e]&&"CDNdownloaded"!==P[e])return e}function g(){for(var e=P.length-1;e>=0;e--)if("downloaded"!==P[e]&&"CDNdownloaded"!==P[e])return e+1}function y(){E=I.RANGE_REQUEST_ALLOWED?{start:b(),end:g()}:{start:0,end:P.length}}function C(e){if(!I.RANGE_REQUEST_ALLOWED)return e;var t,n;if(void 0===E.start||void 0===E.end)throw new Error("PartialSegmentP2P: getUpdatedRange called with complete segment");return t=e?e.start+E.start*I.CHUNK_SIZE:E.start*I.CHUNK_SIZE,E.end===P.length&&e?n=e.end:E.end<P.length&&(n=e?e.start+E.end*I.CHUNK_SIZE-1:E.end*I.CHUNK_SIZE-1),{start:t,end:n}}function w(){if(D=r,!i.length)throw new Error("PartialSegmentP2P should not be instantiated with an empty segment");P=i.slice(),y(),v(),j=M.getMeanInstantSpeed()}function S(e){if(void 0===E)throw new Error("assertion: _cdnIndexRange is not defined");if(void 0===D)throw new Error("assertion: _segmentData is not defined");try{D.setBinaryData(e,E.start*I.CHUNK_SIZE)}catch(e){throw _.default.notifyError(e),new Error("Invalid configuration: The current stream has no range request enabled and the p2p configuration has range request set to true.")}return D}function k(e){M.increaseCDNDownloadedBy(e.byteLength)}(0,l.default)(this,t);var E,T,j,D,P,I=h.conf,M=h.status,A=h.eventBus,R=h.workerHelper,x=(0,f.default)(this,(0,s.default)(t).call(this)),O=c,N=e,L=d,$=0;return x.getFullSegment=function(e,t,n){if(this.isComplete())D.getBinaryData(0,D.byteLength,function(n){e.response=n,u.removePartialSegment(),t(e,null)});else{A.emit("CDNSegmentDownloaded",N);var r=e.response;k(r),$=r.byteLength,S(r).getBinaryData(0,D.byteLength,function(r){if(e.response=r,0!==T){u.lockSegmentData();var i=L.getSegmentInfo(N);p(e,i,t,n)}else m(e),t(e,N)})}},x.getUpdatedRange=C,x.getCDNIndexRange=function(){return E},x.isComplete=function(){return O},x.isLocked=function(){return u.dataLocked},w(),(0,o.default)(x,{p2pSpeed:{get:function(){return j},set:void 0},p2pAmount:{get:function(){return T},set:void 0}}),x}return(0,h.default)(t,e),t}(v.default);n.default=b,t.exports=n.default},{"../../errors/ErrorFunnel":13,"./PartialSegmentInterface":31,"babel-runtime/core-js/object/define-properties":112,"babel-runtime/core-js/object/get-prototype-of":116,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/inherits":125,"babel-runtime/helpers/possibleConstructorReturn":126}],34:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./Heuristic"),o=r(i),a=e("../utils/Timers"),s=r(a),u=e("../utils/Cartography"),l=r(u),c=e("../metrics/MovingAverage"),f=r(c),d=e("./structures/SegmentInfo"),h=r(d),p=function(e,t,n,r){var i,a,u,c,d,p=r.conf,_=r.status,m=r.analyticsData,v=0,b=0,g=0,y=0,C=Date.now(),w=0,S=0,k=Date.now(),E=r.eventBus,T=e,j=!1,D=m,P=0,I=0,M=new o.default,A=this,R=new s.default,x=0,O=new f.default(p.PEER_INSTANT_SPEED_CALCULATION_WINDOW),N=function(){return l.default.getDistanceFromLatitudeLongitude(u,_.getMyLocation().latitude,c,_.getMyLocation().longitude)},L=function(){var e=Date.now(),t=e-C;P=g/1024/(t/1e3),I=y/1024/(t/1e3),g=0,y=0,C=e},$=function(){O.addPoint(v-x),x=v},U=function(){return O.compute()/(p.PEER_INSTANT_SPEED_CALCULATION_INTERVAL/1e3)},H=function(){var e=Date.now(),t=(e-k)/1e3,n=v+b-(w+S);n<p.MIN_USEFUL_SPEED*t&&(E.emit("remove_peer",A,!1),K()),w=v,S=b,k=e},B=function e(){_.getMyLocation().city?n.sendMessage("info",{bufferLevel:_.getMyBufferLevel(),city:_.getMyLocation().city,country:_.getMyLocation().country,latitude:_.getMyLocation().latitude,longitude:_.getMyLocation().longitude}):_.getEE().once("location_updated",e)},F=function(e){n.sendMessage("requestHasSegment",e)},q=function(e,t){var r=t.pushed;n.sendMessage("hasSegment",{segmentInfo:e,pushed:r})},V=function(e,t){n.sendMessage("requestChunk",{segmentCoord:e,id_chunk:t}),M.incrementNbChunkRequested()},z=function(){return M.getNbChunkRequested()<p.MAX_CHUNK_BY_SEEDER},K=function(){R.clearAll(),M.dispose(),n.close()},G=function(){R.clearAll(),M.dispose(),n.destroy()},W=function(){R.setInterval(L,1e3),R.setInterval(H,p.CHECK_USELESS_INTERVAL),R.setInterval($,p.PEER_INSTANT_SPEED_CALCULATION_INTERVAL),B(),_.incrementNewPeerConnectionCount(),n.once("disconnected",function(){D.disconnected++,E.emit("remove_peer",A,!1),G()}),n.on("binarydata_received",X),n.on("message_received",Y)},Y=function(e,n){switch(e){case"info":i=n.city,a=n.country,u=n.latitude,c=n.longitude,d=n.bufferLevel,D.active++,E.emit("info",{remotePeer:A});break;case"requestHasSegment":E.emit("segmentRequested",A,new t(n));break;case"hasSegment":var r=new t(n.segmentInfo.segmentCoord),o=new h.default(r,n.segmentInfo.size,n.segmentInfo.hash),s=!!n.pushed;E.emit("hasSegment",A,o,{pushed:s});break;case"requestChunk":E.emit("chunkRequested",A,new t(n.segmentCoord),n.id_chunk);break;default:throw new Error("wrong message sent by peerConnection")}},X=function(e,t,n){g+=e.byteLength,v+=e.byteLength,_.increaseP2PDownloadedUncorrectedBy(e.byteLength),_.setP2PDownloaded(_.getP2PDownloaded()+e.byteLength),E.emit("chunkReceived",A,n,t,e),Z()},Q=function(e,t,r){var i=r.byteLength,o=n.sendBinaryData(r,t,e);return!!o&&(y+=i,b+=i,_.increaseP2PUploadedBy(i),void Z())},Z=function(){j||(D.transfer++,j=!0)};A.getRtt=n.getRtt.bind(n),A.getDistance=N,A.requestHasSegment=F,A.answerHasSegment=q,A.requestChunk=V,A.sendChunk=Q,A.canBeAskedChunk=z,A.close=K,A.getDataDownloaded=function(){return v},A.getDataUploaded=function(){return b},A.getBufferLevel=function(){return d},A.getId=function(){return T},A.getDlSpeed=function(){return P},A.getUpSpeed=function(){return I},A.getBufferedAmount=n.getBufferedAmount.bind(n),A.getHeuristic=function(){return M},A.getDebugInfos=function(){return{country:a,city:i,bufferLevel:d,dlSpeed:P,upSpeed:I,dataDownloaded:v,dataUploaded:b,rtt:n.getRtt(),distance:N()}},A.getMeanInstantSpeed=U,W()};n.default=p,t.exports=n.default},{"../metrics/MovingAverage":15,"../utils/Cartography":82,"../utils/Timers":95,"./Heuristic":24,"./structures/SegmentInfo":74}],35:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/get-iterator"),o=r(i),a=e("underscore"),s=r(a),u=e("../utils/Timers"),l=r(u),c=e("./Peer"),f=r(c),d=e("./communication/PeerConnector"),h=r(d),p=e("./ExclusionCollection"),_=r(p),m=function(e,t,n,r){var i,a=r.conf,u=r.status,c=r.analyticsData,d=e,p=n,m=!1,v=[],b=this,g=r.eventBus,y=new _.default(a.OFFER_DECLINED_TIMEOUT),C=new _.default(a.PEER_REMOVED_TIMEOUT),w=new _.default(a.PEER_CONNEXION_ATTEMPT_TIMEOUT),S=null,k=new l.default,E=function(){k.setInterval(T,a.SPEED_MONITOR_INTERVAL),g.on("remove_peer",M),k.setInterval(D,a.MEAN_SPEED_CALCULATION_INTERVAL),d.getEE().on("tracker_ready",P,b),d.getEE().on("tracker_disconnected",I,b)},T=function(){var e=0,t=0;s.default.forEach(v,function(n){e+=n.getDlSpeed(),t+=n.getUpSpeed()}),u.setDlSpeed(e),u.setUpSpeed(t),u.computeMaxAndAvgSpeed()},j=function(){var e=0;s.default.forEach(v,function(t){e+=t.getMeanInstantSpeed()});var t=Math.max(0,u.getp2pDownloadedNewAnalytics()),n=u.getP2PDownloadedUncorrected();return n&&(e*=t/n),e},D=function(){var e=j();u.setMeanInstantSpeed(e)},P=function(){null!==S&&S.dispose(),S=new h.default(u.getMyPeerId(),this,t,r),i||(i=k.setInterval(A,a.ASK_PEERS_INTERVAL)),m||A(),m=!0},I=function(){i&&(k.clearInterval(i),i=void 0)},M=function(e){C.add(e.getId()),c.dropped++,v=s.default.without(v,e),g.emit("peerDestroyed",{remotePeer:e,peerCount:v.length})},A=function(){if(v.length<a.MIN_NUMBER_OF_PEERS){var e=R();u.onPeerUpdateRequest();var t=Date.now();d.askPeers(e,function(e,n){if(null===e){var r=Date.now()-t;u.onPeerUpdateResponse(r);var i=0;n.forEach(function(e){e.peers.forEach(function(e){v.length+i<a.MIN_NUMBER_OF_PEERS&&(S.createPeerConnection(e),i++,c.match++)})})}})}},R=function(){var e,t=[];for(e=0;e<v.length;e++)t.push(v[e].getId());return t=t.concat(C.getExclusionList(),y.getExclusionList(),w.getExclusionList())},x=function(){return v.length>=a.MAX_NUMBER_OF_PEERS},O=function(e){v.forEach(function(t){t.requestHasSegment(e)})},N=function(){v.forEach(function(e,t){e.close(),g.emit("peerDestroyed",{remotePeer:e,peerCount:v.length-t-1})}),v=[]},L=function(e,n){if(x())n.destroy();else{var i=new f.default(e,t,n,r);v.push(i),c.open++,g.emit("peerOpen",{remotePeer:i,peerCount:v.length})}},$=function(e){y.add(e),c.denied++},U=function(e){w.add(e),c.timeout++},H=function(e){var t=p.getSegmentInfo(e),n=!0,r=!1,i=void 0;try{for(var a,s=(0,o.default)(v);!(n=(a=s.next()).done);n=!0){var u=a.value;u.answerHasSegment(t,{pushed:!0})}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}},B=function(){d.dispose(),null!==S&&S.dispose(),k.clearAll(),N(),y.dispose(),C.dispose(),w.dispose()};b.getPeerArray=function(){return v},b.getPendingConnectionDebugInfos=function(){return S?S.getPendingConnectionDebugInfos():[]},b.requestHasSegment=O,b.isFull=x,b.addPeerConnection=L,this.offerDeclined=$,this.connectionAttemptTimeout=U,b.broadcastSegmentInfo=H,b.dispose=B,E()};n.default=m,t.exports=n.default},{"../utils/Timers":95,"./ExclusionCollection":22,"./Peer":34,"./communication/PeerConnector":55,"babel-runtime/core-js/get-iterator":106,underscore:226}],36:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=function e(t,n){(0,o.default)(this,e),this.cdn=n.getCDNDownloaded(),this.p2p=n.getP2PDownloaded(),this.upload=n.getP2PUploaded(),t?this.peers=t.getPeerArray().length:this.peers=0};n.default=a,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123}],37:[function(e,t,n){(function(r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(){var e=window.RTCPeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection;return!(!e||oe.default.isMobile())}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./structures/CurrentTracks"),s=e("./P2PDownloader"),u=i(s),l=e("./ChunkDownloader"),c=i(l),f=e("./ExternalEventManager"),d=i(f),h=e("./PartialSegment/PartialSegmentNoP2P"),p=i(h),_=e("./PartialSegment/PartialSegmentDisableP2P"),m=i(_),v=e("./display/DisplayInterface"),b=i(v),g=e("./TrackerManager"),y=i(g),C=e("../analytics/AnalyticsReporter"),w=i(C),S=e("./PeerPool"),k=i(S),E=e("./P2PCache"),T=i(E),j=e("./SegmentUploader"),D=i(j),P=e("./ChunkUploader"),I=i(P),M=e("./ChunkReceivedObserver"),A=i(M),R=e("./schedulers/factory"),x=e("./SegmentInfoMap"),O=i(x),N=e("./DistributedSegmentList"),L=i(N),$=e("../utils/Timers"),U=i($),H=e("./SRModuleInterface"),B=i(H),F=e("../../../graphs/private/BufferDisplay"),q=(i(F),e("../../../graphs/private/chunkDisplay")),V=(i(q),e("./expectedInterfaces/SegmentCoordInterface")),z=i(V),K=e("./expectedInterfaces/MapInterface"),G=i(K),W=e("./expectedInterfaces/TrackCoordInterface"),Y=i(W),X=e("../utils/Interface"),Q=e("./SharedState"),Z=i(Q),J=e("../utils/StreamTypes"),ee=e("./PublicStatsAPI"),te=i(ee),ne=e("../errors/ErrorFunnel"),re=i(ne),ie=e("../utils/uaHelper"),oe=i(ie),ae=e("../analytics/qos/MediaElementPlaceholder"),se=i(ae),ue=e("../utils/EventEnum"),le=i(ue);re.default.setScriptOrigin(window.document.currentScript&&window.document.currentScript.src?window.document.currentScript.src:null);var ce=function(e,t,n,r,i,s,l){if("string"!=typeof l||""===l||l.length>10)throw new Error("Unvalid argument in PeerAgent constructor: integration version must be a non-empty string of less than 10 characters");var f=new Z.default(r,t,l);re.default.setCustomer(f.conf.ID_CLIENT),re.default.setMetadata({stream:f.moduleState.content}),(0,X.checkInterface)(G.default,n),(0,X.checkInterface)(z.default,i.prototype),(0,J.assertStreamType)(s);var h,_,v,g,C,S,E,j,P,M,x,N,$,H,F=new U.default,q=!1,V=s,K=new se.default,W=function(e){var t=e.audio,n=e.video;t&&(0,X.checkInterface)(Y.default,t),n&&(0,X.checkInterface)(Y.default,n),f.eventBus.emit(le.default.Metrics.TRACK_SWITCH),H.updateCurrentTracks({audio:t,video:n}),f.moduleState.updateCurrentTracks({video:n})},Q=function(){var e=new a.CurrentTracks;H=(0,R.createScheduler)(n,g,C,V,e,f)},ee=function(){P&&(M=new O.default,_=new y.default(e,f),v=new k.default(_,i,M,f),g=new T.default(e.isLive.bind(e),v,M,f),S=new A.default(g,f),E=new D.default(M,g,f),j=new I.default(g,f),C=new L.default(n,f),Q(),h=new c.default(g,H,f),N=new w.default(e,K,f),$.addMediaEventListener("onTrackChange",W),$.triggerCachedEvent("onTrackChange",W),u.default.listenEvents(H,g,M,C,f),ne()),q=!0},ne=function t(){!e.areBuffersInitialized||e.areBuffersInitialized()?f.conf.DEBUG&&(x=new b.default(v,e.isLive.bind(e),f)):F.setTimeout(t,300)},ie=function(){P=o()&&f.conf.ALLOW_P2P,P&&($=new d.default(e),$.cacheMediaEvent("onTrackChange"))},oe=function(e){if(!P)throw new Error("P2P is not activated, getP2PData can't be called");var t;return q?t=P?g.getPartialSegment(e)||new p.default(e,g,M,f):new m.default(e):(ee(),t=new m.default(e)),H.updateTrackEdge(e),t},ae=function(e,t,n){return null!==n&&(0,X.checkInterface)(z.default,n),B.default.getSegment(this,e,t,n,f)},ue=function(){P&&(q&&($.removeAllExternalEventListener(),N.dispose(),h.dispose(),g.dispose(),F.clearAll(),v.dispose(),x&&x.dispose()),f.dispose())};ie(),this.getSegment=ae,this.getP2PData=oe,this.dispose=ue,this.setMediaElement=function(e){K.mediaElement=e},Object.defineProperty(this,"stats",{get:function(){return new te.default(v,f.status)}})};Object.defineProperty(ce,"StreamTypes",{get:function(){return J.StreamTypes}}),n.default=ce,r.Streamroot=r.Streamroot||{},r.Streamroot.uaHelper=oe.default,Object.defineProperty(r.Streamroot,"p2pAvailable",{get:function(){return o()}}),t.exports=n.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../graphs/private/BufferDisplay":102,"../../../graphs/private/chunkDisplay":104,"../analytics/AnalyticsReporter":4,"../analytics/qos/MediaElementPlaceholder":10,"../errors/ErrorFunnel":13,"../utils/EventEnum":86,"../utils/Interface":87,"../utils/StreamTypes":92,"../utils/Timers":95,"../utils/uaHelper":100,"./ChunkDownloader":17,"./ChunkReceivedObserver":19,"./ChunkUploader":20,"./DistributedSegmentList":21,"./ExternalEventManager":23,"./P2PCache":28,"./P2PDownloader":29,"./PartialSegment/PartialSegmentDisableP2P":30,"./PartialSegment/PartialSegmentNoP2P":32,"./PeerPool":35,"./PublicStatsAPI":36,"./SRModuleInterface":38,"./SegmentInfoMap":40,"./SegmentUploader":41,"./SharedState":42,"./TrackerManager":45,"./display/DisplayInterface":60,"./expectedInterfaces/MapInterface":61,"./expectedInterfaces/SegmentCoordInterface":62,"./expectedInterfaces/TrackCoordInterface":63,"./schedulers/factory":71,"./structures/CurrentTracks":72}],38:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/object/keys"),o=r(i),a=e("babel-runtime/core-js/object/assign"),s=r(a),u=e("babel-runtime/helpers/classCallCheck"),l=r(u),c=e("babel-runtime/helpers/createClass"),f=r(c),d=e("../errors/ErrorFunnel"),h=r(d),p=e("./httpRequestAbstraction/HttpRequest"),_=r(p),m=e("../utils/nativeCalls"),v=function(){},b=function(){function e(t,n,r,i,o){var a=r.onProgress,s=void 0===a?v:a,u=r.onError,c=void 0===u?v:u,f=r.onSuccess,d=void 0===f?v:f,h=this;(0,l.default)(this,e),this._request=n,this._handlers={onProgress:s,onError:c,onSuccess:d},this._srModule=t,this._analyticsData=o.analyticsData,this._conf=o.conf,this._conf.RETURN_COPY_SEGMENT&&!function(){var e=h._handlers.onSuccess;h._handlers.onSuccess=function(t,n,r){h._analyticsData.p2p+=n.p2pDownloaded,h._analyticsData.cdn+=n.cdnDownloaded;var i=t.slice(0);e(i,n,r)}}(),this._stats={cdnDownloaded:0,cdnDuration:0},this._segmentCoord=i}return(0,f.default)(e,[{key:"getSegment",value:function(){try{null===this._segmentCoord?this._getFullSegmentFromCDN():(this._partialSegment=this._srModule.getP2PData(this._segmentCoord),this._setP2PStats(),this._handlers.onProgress(this._stats,this._request),this._partialSegment.isComplete()?this._getFullP2PSegment():this._getRemainingRangeFromCDN())}catch(e){h.default.notifyError(e),(0,m.nativeError)(e),this._getFullSegmentFromCDN()}return{abort:this._abort.bind(this)}}},{key:"_abort",value:function(){this._httpRequest&&this._httpRequest.abort(),this._handlers.onSuccess=v}},{key:"_getFullP2PSegment",value:function(){var e=this;this._waitSegmentUnlocked(function(t){t?e._fillSegment(void 0):e._getFullSegmentFromCDN()})}},{key:"_getRemainingRangeFromCDN",value:function(){var e=this,t=this._getRangeFromRequest();this._fallbackRange=t,this._rangeToDownload=this._partialSegment.getUpdatedRange(t),this._downloadFromCDN(this._rangeToDownload,function(t,n){return t?void e._handlers.onError(t,e._request):void e._fillSegment(n)})}},{key:"_downloadFromCDN",value:function(e,t){this._httpRequest=new _.default("GET",this._request.url),this._httpRequest.validStatusCodeRange={start:200,end:206},this._setHttpRequestHandlers(t),this._setHttpRequestHeaders(e),this._httpRequest.setWithCredentials(!!this._request.withCredentials),this._httpRequest.send(),this._startDownloadCdn=new Date}},{key:"_setHttpRequestHandlers",value:function(e){var t=this;this._httpRequest.onresponse=function(n,r){return n?void e(n,null):(t._stats.cdnDownloaded=r.byteLength||0,t._stats.cdnDuration=new Date-t._startDownloadCdn,void e(null,r))},this._httpRequest.onprogress=function(e){t._stats.cdnDownloaded=e,t._stats.cdnDuration=new Date-t._startDownloadCdn,t._handlers.onProgress(t._stats,t._request)}}},{key:"_setHttpRequestHeaders",value:function(e){var t={},n=this._request.headers;if(n&&void 0!==n.length)throw new Error("Custom headers object should not have a `length` attribute (you might use the previous API format)");n&&((0,s.default)(t,n),this._rangeToDownload&&delete t.Range),void 0===t.Range&&e&&(t.Range=this._rangeValue(e)),(0,o.default)(t).length>0&&this._httpRequest.setHeaders(t)}},{key:"_rangeValue",value:function(e){var t=e.start,n=e.end||"";return"bytes="+t+"-"+n}},{key:"_fillSegment",value:function(e){var t=this,n=!1,r=function(e){return function(r,i){n||(n=!0,e.call(t,r,i))}};try{this._partialSegment.getFullSegment({response:e},r(this._onSuccessAsynchronous),r(this._getFullSegmentFromCDN))}catch(e){return h.default.notifyError(e),(0,m.nativeError)(e),void this._getFullSegmentFromCDN()}setTimeout(function(){n||(n=!0,t._getFullSegmentFromCDN())},this._conf.TIMEOUT_GET_FULL_SEGMENT)}},{key:"_waitSegmentUnlocked",value:function(e){var t=this;if(!this._partialSegment.isLocked())return void e(!0);var n=0,r=setInterval(function(){return t._partialSegment=t._srModule.getP2PData(t._segmentCoord),t._partialSegment.isLocked()?(n+=t._conf.LOCKED_RETRY_INTERVAL,void(n>t._conf.LOCKED_RETRY_TIMEOUT&&(clearInterval(r),e(!1)))):(clearInterval(r),void e(!0))},this._conf.LOCKED_RETRY_INTERVAL)}},{key:"_getRangeFromRequest",value:function(){var e=this._request.headers;if(e&&void 0!==e.Range){var t=e.Range.split("="),n=t[1].split("-");return{start:parseInt(n[0],10),end:parseInt(n[1],10)}}}},{key:"_getFullSegmentFromCDN",value:function(){var e=this;this._stats={p2pDownloaded:0,p2pDuration:0},this._downloadFromCDN(this._fallbackRange,function(t,n){return t?void e._handlers.onError(t,e._request):void e._handlers.onSuccess(n,e._stats,e._request)})}},{key:"_setP2PStats",value:function(){this._stats.p2pDownloaded=this._partialSegment.p2pAmount,this._stats.p2pDuration=0===this._partialSegment.p2pSpeed?0:Math.round(this._partialSegment.p2pAmount/this._partialSegment.p2pSpeed*1e3)}},{key:"_onSuccessAsynchronous",value:function(e){var t=this;setTimeout(function(){t._handlers.onSuccess(e.response,t._stats,t._request)},0)}}]),e}();t.exports={getSegment:function(e,t,n,r,i){var o=new b(e,t,n,r,i);return o.getSegment()}}},{"../errors/ErrorFunnel":13,"../utils/nativeCalls":98,"./httpRequestAbstraction/HttpRequest":64,"babel-runtime/core-js/object/assign":110,"babel-runtime/core-js/object/keys":118,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],39:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("underscore"),o=r(i),a=function(){var e=[],t=0,n=function(t){for(var n=e.length,r=0;r<n;r++)if(e[r]===t){e.splice(r,1);break}n=e.length;for(var i=0;i<n;i++){var o=e[i].getHeuristic().getHeuristicScore(),a=t.getHeuristic().getHeuristicScore();if(o<=a)return void e.splice(i,0,t)}e.push(t)},r=function(t){e=o.default.reject(e,function(e){return e===t})},i=function(){for(var t=0,n=0;n<e.length;n++)t+=e[n].getHeuristic().getHeuristicScore();return t},a=function(n){var r,o=Math.floor(Math.random()*e.length);switch(t){case 0:if(0!==e.length){r=e[o];for(var a=0;a<e.length;a++)if(e[a].getHeuristic().getNbChunkRequested()/e[a].getHeuristic().getHeuristicScore()<=e[e.length-1].getHeuristic().getNbChunkRequested()/e[e.length-1].getHeuristic().getHeuristicScore()&&e[a].canBeAskedChunk()){r=e[a];break}}break;case 1:if(0!==e.length){r=e[o];for(var s=0;s<e.length;s++)if(Math.random()<=e[s].getHeuristic().getHeuristicScore()&&e[s].canBeAskedChunk()){r=e[s];break}}break;case 2:if(0!==e.length){r=e[o];for(var u=0;u<e.length;u++)if(e[u].getHeuristic().getNbChunkRequested()<=Math.floor(e[u].getHeuristic().getHeuristicScore()/i()*n+1)&&e[u].canBeAskedChunk()){r=e[u];break}}break;case 3:if(0!==e.length){r=e[o];for(var l=0;l<e.length;l++)if(e[l].getHeuristic().getNbChunkRequested()/e[l].getHeuristic().getHeuristicScore()<=e[l+1].getHeuristic().getNbChunkRequested()/e[l+1].getHeuristic().getHeuristicScore()&&e[l].canBeAskedChunk()){r=e[l];break}}break;default:r=!1}return r},s=function(){e=[]};this.getNextSeeder=function(e){return a(e)},this.insertSeeder=function(e){n(e)},this.removeSeeder=function(e){r(e)},this.cleanAfterDownloaded=function(){s()},this.getLength=function(){return e.length}};n.default=a,t.exports=n.default},{underscore:226}],40:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/map"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=function(){function e(){(0,s.default)(this,e),this._map=new o.default}return(0,l.default)(e,[{key:"addSegmentInfo",value:function(e){var t=e.segmentCoord.viewToString();this._map.set(t,e)}},{key:"getSegmentInfo",value:function(e){var t=e.viewToString(),n=this._map.get(t);if(!n)throw new Error("segmentInfo not found in the map");return n}},{key:"removeSegmentInfo",value:function(e){var t=e.viewToString();this._map.delete(t)}}]),e}();n.default=c,t.exports=n.default},{"babel-runtime/core-js/map":109,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){function r(e,t){var n=o.getSegmentHandler(t).chunkManager;if(n){var r=n.getIndexLastChunkInARow();if(r>-1){var a=i.getSegmentInfo(t);return void e.answerHasSegment(a,{pushed:!1})}}}var i=e,o=t;n.eventBus.on("segmentRequested",r)};n.default=r,t.exports=n.default},{}],42:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/json/stringify"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=e("./Status"),f=r(c),d=e("../../defaultConf"),h=r(d),p=e("./ModuleState"),_=r(p),m=e("eventemitter3"),v=r(m),b=e("../analytics/AnalyticsData"),g=r(b),y=e("../security/WorkerHelper"),C=r(y),w=e("../utils/confHelper"),S=r(w),k=e("../utils/ContentId"),E=function(){function e(t,n,r){
(0,s.default)(this,e),this.analyticsData=new g.default;var i=JSON.parse((0,o.default)(h.default));(0,S.default)(i,t,r),this.conf=i,this.status=new f.default;var a=(0,k.formatContentId)({contentId:t.contentId,contentUrl:n});this.moduleState=new _.default,this.moduleState.content=a,this.eventBus=new v.default,this.workerHelper=new C.default}return(0,l.default)(e,[{key:"dispose",value:function(){this.workerHelper.dispose()}}]),e}();n.default=E,t.exports=n.default},{"../../defaultConf":1,"../analytics/AnalyticsData":3,"../security/WorkerHelper":76,"../utils/ContentId":84,"../utils/confHelper":97,"./ModuleState":27,"./Status":44,"babel-runtime/core-js/json/stringify":108,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,eventemitter3:219}],43:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("../../defaultConf"),l=(r(u),function(){function e(t){(0,o.default)(this,e),this.transferedChunks=[],this._conf=t}return(0,s.default)(e,[{key:"calculateSpeed",value:function(){var e=this._getIndexTransferOneSecondAgo();return null===e?this.transferedChunks=[]:e>0&&this.transferedChunks.splice(0,e),this.transferedChunks.length*this._conf.CHUNK_SIZE/1024}},{key:"_getIndexTransferOneSecondAgo",value:function(){for(var e=Date.now(),t=0;t<this.transferedChunks.length;t++)if(e-this.transferedChunks[t]<=1e3)return t;return null}},{key:"addChunkTransfer",value:function(){var e=Date.now();this.transferedChunks.push(e)}}]),e}());n.default=l,t.exports=n.default},{"../../defaultConf":1,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],44:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("eventemitter3"),o=r(i),a=function(){var e=!1,t={city:null,country:null,latitude:null,longitude:null},n=void 0,r=0,i=0,a=0,s=0,u=0,l=0,c=0,f=0,d=0,h=0,p=0,_=0,m=0,v=0,b=0,g=0,y=0,C=0,w=0,S=0,k=0,E=0,T=0,j=0,D=0,P=0,I=0,M="",A=0,R=0,x=0,O=0,N=!0,L=0,$=0,U=[],H=!1,B="",F=0,q=0,V=0,z=0,K=0,G=0,W=0,Y=0,X=0,Q=0,Z=0,J=this,ee=void 0,te=void 0,ne=new o.default,re=void 0,ie=function(){var e,t,n,o;r&&(r>a&&(a=r),e=i?(i*ee+r)/(ee+1):r,t=ee?ee+1:1,ee=t,i=e),s&&(s>l&&(l=s),n=u?(u*te+s)/(te+1):s,o=te?te+1:1,te=o,u=n)},oe=function(){L++},ae=function(){return L},se=function(e){$++,U.push(e)},ue=function(){return $},le=function(){var e=0,t=0;if(U.length>0){for(var n=0;n<U.length;n++)e+=U[n];t=e/U.length}return U=[],t};J.getMyPeerId=function(){return n},J.setMyPeerId=function(e){n!==e&&(n=e)},J.getMyLocation=function(){return t},J.setMyLocation=function(e){t=e,ne.emit("location_updated",e)},J.correctP2PDownloaded=function(e,t){isNaN(e)||("PP"===t?(g+=e,f-=e):"PC"===t?(y+=e,f-=e,f=d-e):"CP"===t?(C+=e,f-=e):"CC"===t?w+=e:"HP"===t?(S+=e,f-=e):"HD"===t?(k+=e,f-=e):"M"===t&&(E+=e,f-=e))},J.getDlSpeed=function(){return r},J.setDlSpeed=function(e){r=e},J.getAvgDlSpeed=function(){return i},J.getMaxDlSpeed=function(){return a},J.getUpSpeed=function(){return s},J.setUpSpeed=function(e){s=e},J.getAvgUpSpeed=function(){return u},J.getMaxUpSpeed=function(){return l},J.getP2PDownloaded=function(){return f},J.setP2PDownloaded=function(e){"number"!=typeof e||isNaN(e)||(f=e)},J.getp2pDownloadedNewAnalytics=function(){return d},J.setp2pDownloadedNewAnalytics=function(e){"number"!=typeof e||isNaN(e)||(d=e)},J.getP2PDownloadedUncorrected=function(){return h},J.increaseP2PDownloadedUncorrectedBy=function(e){h+=e},J.getP2PUploaded=function(){return p},J.increaseP2PUploadedBy=function(e){p+=e},J.getRawDataDownloaded=function(){return _},J.increaseRawDataDownloadedBy=function(e){_+=e},J.getRawDataUploaded=function(){return m},J.increaseRawDataUploadedBy=function(e){m+=e},J.getCDNDownloaded=function(){return v},J.increaseCDNDownloadedBy=function(e){v+=e},J.getCdnCancelled=function(){return b},J.increaseCdnCancelledBy=function(e){b+=e},J.getDataDownloadedTwice_PP=function(){return g},J.getDataDownloadedTwice_PC=function(){return y},J.getDataDownloadedTwice_CP=function(){return C},J.getDataDownloadedTwice_CC=function(){return w},J.getDataDownloadedTwice_HP=function(){return S},J.getDataDownloadedTwice_HD=function(){return k},J.getDataDownloadedTwice_M=function(){return E},J.getCdnDataDiscarded=function(){return T},J.increaseCdnDataDiscardedBy=function(e){T+=e},J.getNbRightHashP2P=function(){return j},J.setNbRightHashP2P=function(e){j=e},J.getNbWrongHashP2P=function(){return D},J.setNbWrongHashP2P=function(e){D=e},J.getNbRightHashDLM=function(){return P},J.setNbRightHashDLM=function(e){P=e},J.getNbWrongHashDLM=function(){return I},J.setNbWrongHashDLM=function(e){I=e},J.getTrackerConnectionCount=function(){return A},J.incrementTrackerConnectionCount=function(){A++},J.getTrackerReconnectionCount=function(){return x},J.incrementTrackerReconnectionCount=function(){x++},J.getTrackerDeconnectionCount=function(){return R},J.incrementTrackerDeconnectionCount=function(){R++},J.incrementNewPeerConnectionCount=function(){q++},J.getNewPeerConnectionCount=function(){return q},J.incrementReceivedChunkRequestCount=function(){V++},J.getReceivedChunkRequestCount=function(){return V},J.incrementHitReceivedChunkRequestCount=function(){z++},J.getHitReceivedChunkRequestCount=function(){return z},J.incrementSentChunkRequestCount=function(){K++},J.getSentChunkRequestCount=function(){return K},J.incrementTimeoutSentChunkRequestCount=function(){G++},J.getTimeoutSentChunkRequestCount=function(){return G},J.getConnected=function(){return e},J.getUpgraded=function(){return H},J.setTrackerConnectionTime=function(e){O=e},J.getTrackerConnectionTime=function(){return O},J.setTrackerVersion=function(e){M=e},J.getTrackerVersion=function(){return M},J.setTrackerId=function(e){B=e},J.getTrackerId=function(){return B},J.incrementMissedIceCandidateCount=function(){F++},J.getMissedIceCandidateCount=function(){return F},J.setConnected=function(t){t!==e&&(e=t,ne.emit("change:connected"),t===!0&&ne.emit("tracker_ready"))},J.setUpgraded=function(){H=!0},J.getEE=function(){return ne},J.setConnectedToSignalingServer=function(){N=!0},J.setDisconnectedToSignalingServer=function(){N=!1},J.getConnectedToSignalingServer=function(){return N},J.computeMaxAndAvgSpeed=ie,J.setMeanInstantSpeed=function(e){c=e},J.getMeanInstantSpeed=function(){return c},J.setMyBufferLevel=function(e){re=e},J.getMyBufferLevel=function(){return re},J.onPeerUpdateRequest=oe,J.getPeerUpdateRequestCount=ae,J.onPeerUpdateResponse=se,J.getPeerUpdateResponseCount=ue,J.getPeerUpdateAvgResponseTime=le,J.getAttemptToSendChunkCount=function(){return W},J.incrementAttemptToSendChunkCount=function(){W++},J.getSentChunkCount=function(){return Y},J.incrementSentChunkCount=function(){Y++},J.getExpiredChunksToUpload=function(){return X},J.incrementExpiredChunksToUpload=function(){X++},J.getAddedChunksToUpload=function(){return Q},J.incrementAddedChunksToUploadQueue=function(){Q++},J.incrementCheckHeartbeatFailed=function(){Z++},J.getCheckHeartbeatFailed=function(){return Z}};n.default=a,t.exports=n.default},{eventemitter3:219}],45:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&(200===r.status?n(null,JSON.parse(r.responseText)):204===r.status?n(null,null):r.status>0&&n(new Error(r.status+": "+r.responseText),null))},r.onerror=function(){n(new Error("connection error"),null)},void 0!==t?(r.open("POST",e,!0),r.send((0,a.default)(t))):(r.open("GET",e,!0),r.send(null))}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/json/stringify"),a=r(o),s=e("babel-runtime/helpers/classCallCheck"),u=r(s),l=e("babel-runtime/helpers/createClass"),c=r(l),f=e("eventemitter3"),d=r(f),h=e("./Location"),p=r(h),_=e("../utils/Timers"),m=r(_),v=e("../utils/Options"),b=e("../utils/url"),g=e("../../defaultConf"),y=(r(g),function(){function e(t,n){(0,u.default)(this,e),this._conf=n.conf,this._status=n.status,this._moduleState=n.moduleState;var r=new d.default;this._p2pProtocolVersion=this._conf.P2P_PROTOCOL_VERSION,this._trackerProtocolVersion=this._conf.CLIENT_TRACKER_PROTOCOL_VERSION,this._playerInterface=t,this._connected=!1,this._delayReconnection=this._conf.TRACKER_DELAY_INIT,this._trackerURL=(0,b.formatUrl)(this._conf.TRACKER_URL),this._timers=new m.default,this._callQueue=[],this._pending=!1,this.getEE=function(){return r},this._init()}return(0,c.default)(e,[{key:"askPeers",value:function(e,t){var n=function(e,n){t(e,[n])},r={tracks:[this._moduleState.getVideoTrackHash()],exclusions:e,peer_number:this._conf.MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE,current_position:this._moduleState.videoCurrentTime,id:(0,v.unwrap)(this._peerID)};this._sendRequest("peers",r,n,!0)}},{key:"dispose",value:function(){this._disconnect(),this._timers.clearAll()}},{key:"_init",value:function(){var e=(0,v.unwrap)(this._moduleState.content),t=this._p2pProtocolVersion,n=this._conf.ID_CLIENT,r=this._playerInterface.isLive(),i=this._status.getTrackerId(),o=void 0;if(r){var a=this._playerInterface.getBufferLevelMax();o={content:e,p2p_protocol:t,customer_id:n,is_live:r,buffer_level_max:a,tracker_id:i}}else o={content:e,p2p_protocol:t,customer_id:n,is_live:r,tracker_id:i};this._initStartTime=Date.now(),this._sendRequest("init",o,this._onTrackerReady.bind(this),!0)}},{key:"_onTrackerReady",value:function(e,t){if(!e){var n=Date.now()-this._initStartTime;if(this._status.incrementTrackerConnectionCount(),this._status.setTrackerConnectionTime(n),this._status.setConnected(!0),this._status.setTrackerId(t.tracker_id),this._connected=!0,this._playerInterface.isLive()){var r=(0,v.unwrap)(t.buffer_level);this._status.setMyBufferLevel(r),this._playerInterface.setBufferMarginLive(r)}this._peerID=t.peer_id,this._status.setMyPeerId(this._peerID),this._askGeolocation(this._conf.GEOLOCATION_REQUEST_MAX_RETRY),this._timers.setNamedInterval("tracks",this._publishTracks.bind(this),this._conf.SEND_TRACKS_INTERVAL),this.getEE().emit("tracker_ready")}}},{key:"_publishTracks",value:function(){var e={tracks:[this._moduleState.getVideoTrackHash()],id:(0,v.unwrap)(this._peerID),current_position:this._moduleState.videoCurrentTime};this._sendRequest("tracks",e,function(){},!0)}},{key:"_askGeolocation",value:function(e){var t=this;this._timers.setNamedTimeout("geoloc",function(){t._sendRequest("geo",void 0,t._makeGeolocationAnswerHandler(e),!1)},this._conf.GEOLOCATION_REQUEST_TIMEOUT)}},{key:"_makeGeolocationAnswerHandler",value:function(e){var t=this;return function(n,r){if(n)0!==e&&t._askGeolocation(e-1);else{var i=new p.default(r.city,r.country,r.latitude,r.longitude);t._status.setMyLocation(i)}}}},{key:"_sendRequest",value:function(e,t,n,r){var o=this,a=function(e,t){if(e&&r)return o._disconnect(),o._schedulReconnect(),void n(e,t);var a=o._callQueue.shift();void 0===a?o._pending=!1:i(a.url,a.data,a.callback),n(e,t)},s=this._trackerURL+e;this._pending?this._callQueue.push({url:s,data:t,callback:a}):(this._pending=!0,i(s,t,a))}},{key:"_disconnect",value:function(){this._timers.clearNamedInterval("tracks"),this._timers.clearNamedTimeout("geoloc"),this._timers.clearNamedTimeout("reconnect"),this._pending=!1,this._callQueue=[],this._connected===!0&&(this._delayReconnection=this._conf.TRACKER_DELAY_INIT,this._status.setConnected(!1),this._connected=!1,i(this._trackerURL+"bye",{id:(0,v.unwrap)(this._peerID)},function(){}),this.getEE().emit("tracker_disconnected"))}},{key:"_schedulReconnect",value:function(){this._timers.setNamedTimeout("reconnect",this._init.bind(this),this._delayReconnection),this._delayReconnection=Math.min(2*this._delayReconnection,this._conf.TRACKER_DELAY_MAX)}}]),e}());n.default=y,t.exports=n.default},{"../../defaultConf":1,"../utils/Options":90,"../utils/Timers":95,"../utils/url":101,"./Location":25,"babel-runtime/core-js/json/stringify":108,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,eventemitter3:219}],46:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("underscore"),l=r(u),c=e("./SpeedCalculator"),f=r(c),d=e("../utils/Timers"),h=r(d),p=e("../utils/Delta"),_=e("../errors/ErrorFunnel"),m=r(_),v=function(){function e(t){(0,o.default)(this,e),this._status=t.status,this._conf=t.conf,this._globalEventBus=t.eventBus,this.queue=[],this.peerTimeouts={},this.saturated=!1,this.uploadSpeedCalculator=new f.default(this._conf),this.uploadLimitation=0,this._increaseUploadLimitation(this._conf.MAX_UP_SPEED),this._timers=new h.default}return(0,s.default)(e,[{key:"add",value:function(e,t,n,r,i){this.queue.push({peer:e,segmentCoord:t,id_chunk:n,chunk:r,timeStamp:i}),this._status.incrementAddedChunksToUploadQueue(),this._resetPeerTimeout(e),this._sendChunk()}},{key:"_removeFirstChunk",value:function(){this.queue.splice(0,1)}},{key:"_getChunkToSend",value:function(){for(var e=Date.now();this.queue.length>0;){if(e-this.queue[0].timeStamp<this._conf.CHUNK_UP_TIMEOUT)return this.queue[0];this._removeFirstChunk(),this._status.incrementExpiredChunksToUpload(),this._globalEventBus.emit("uploadSaturated")}}},{key:"_increaseUploadLimitation",value:function(e){this.uploadLimitation+=e,this._globalEventBus.emit("uploadLimitationChange",this.uploadLimitation)}},{key:"_sendChunk",value:function(e){this._status.incrementAttemptToSendChunkCount();var t=this.uploadSpeedCalculator.calculateSpeed();if(t<this.uploadLimitation&&(!this.saturated||e)){var n=this._getChunkToSend();if(!n)return void this._unsetSaturated();var r=n.peer.getBufferedAmount();if((0,p.isNumeric)(r)&&r<this._conf.UP_MAX_BUFFERED_AMOUNT){this.uploadSpeedCalculator.addChunkTransfer();try{return n.peer.sendChunk(n.segmentCoord,n.id_chunk,n.chunk),this._status.incrementSentChunkCount(),this._removeFirstChunk(),this._resetPeerTimeout(n.peer),this._unsetSaturated(),void this._increaseUploadLimitation(5)}catch(e){m.default.notifyError(e),this.uploadLimitation>this._conf.MAX_UP_SPEED&&this._increaseUploadLimitation(this._conf.MAX_UP_SPEED-this.uploadLimitation),this.uploadLimitation>400?this._increaseUploadLimitation(-200):this.uploadLimitation>100?this._increaseUploadLimitation(-50):this._increaseUploadLimitation(-Math.floor(this.uploadLimitation/2)),this._setSaturated()}this._checkPeerTimeout(n.peer)}else this.uploadLimitation>30&&(this._increaseUploadLimitation(-20),this._setSaturated())}this._setSaturated()}},{key:"_checkPeerTimeout",value:function(e){var t=Date.now();this.peerTimeouts[e.getId()]?t-this.peerTimeouts[e.getId()]>this._conf.PEER_UP_TIMEOUT&&this._clearChunksForPeer(e.getId()):this.peerTimeouts[e.getId()]=t}},{key:"_resetPeerTimeout",value:function(e){delete this.peerTimeouts[e.getId()]}},{key:"_clearChunksForPeer",value:function(e){this.queue=l.default.reject(this.queue,function(t){return t.peer.getId()===e})}},{key:"_setSaturated",value:function(){if(!this.saturated){this.saturated=!0;var e=this._conf.CHUNK_SIZE/1024/(this._conf.MAX_UP_SPEED/1e3);void 0===this.sendInterval&&(this.sendInterval=this._timers.setInterval(function(){this._sendChunk(!0)}.bind(this),e))}}},{key:"_unsetSaturated",value:function(){this.saturated===!0,this.saturated=!1,this.queue.length||(this._timers.clearInterval(this.sendInterval),this.sendInterval=void 0)}},{key:"dispose",value:function(){this._timers.clearAll()}}]),e}();n.default=v,t.exports=n.default},{"../errors/ErrorFunnel":13,"../utils/Delta":85,"../utils/Timers":95,"./SpeedCalculator":43,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,underscore:226}],47:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return new a.default(e)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./browser/Segment"),a=r(o),s=e("./mobile/Segment");r(s),n.default=i,t.exports=n.default},{"./browser/Segment":50,"./mobile/Segment":52}],48:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=function(){function e(){(0,o.default)(this,e)}return(0,s.default)(e,[{key:"getBinaryData",value:function(e,t,n){throw new Error("must be implemented")}},{key:"setBinaryData",value:function(e,t){throw new Error("must be implemented")}},{key:"destroy",value:function(){}},{key:"byteLength",get:function(){return this._byteLength},set:function(e){this._byteLength=e}}]),e}();n.default=u,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=ArrayBuffer,t.exports=n.default},{}],50:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/get-prototype-of"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(c),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("../SegmentInterface"),_=r(p),m=e("./BinaryData"),v=r(m),b=function(e){function t(e){(0,s.default)(this,t);var n=(0,f.default)(this,(0,o.default)(t).call(this));if("number"==typeof e){var r=e;n._binData=new Uint8Array(r)}else{if(!(e instanceof v.default))throw new TypeError("Wrong parameter in Segment Constructor");var i=e;n._binData=new Uint8Array(i)}return n}return(0,h.default)(t,e),(0,l.default)(t,[{key:"getBinaryData",value:function(e,t,n){n(new Uint8Array(this._binData.buffer.slice(e,e+t)).buffer)}},{key:"setBinaryData",value:function(e,t){this._binData.set(new Uint8Array(e),t)}},{key:"byteLength",get:function(){return this._binData.byteLength},set:function(e){throw new TypeError("Should not manually set the byteLength")}}]),t}(_.default);n.default=b,t.exports=n.default},{"../SegmentInterface":48,"./BinaryData":49,"babel-runtime/core-js/object/get-prototype-of":116,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,"babel-runtime/helpers/inherits":125,"babel-runtime/helpers/possibleConstructorReturn":126}],51:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=function e(t,n){if((0,o.default)(this,e),!(t instanceof String||"number"==typeof n))throw new TypeError("Wrong parameter");this.id=t,this.byteLength=n};n.default=a,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123}],52:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return e+"-"+t}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/get-prototype-of"),a=r(o),s=e("babel-runtime/helpers/classCallCheck"),u=r(s),l=e("babel-runtime/helpers/createClass"),c=r(l),f=e("babel-runtime/helpers/possibleConstructorReturn"),d=r(f),h=e("babel-runtime/helpers/inherits"),p=r(h),_=e("../SegmentInterface"),m=r(_),v=e("./BinaryData"),b=r(v),g=e("uuid"),y=r(g),C=e("../../../utils/nativeCalls"),w={},S=function(e){function t(e){(0,u.default)(this,t);var n=(0,d.default)(this,(0,a.default)(t).call(this));if(n.id=n._generateId(),"number"==typeof e)n.byteLength=e,(0,C.nativeCall)("segment_created",{id:n.id,size:e});else{if(!(e instanceof b.default))throw new TypeError("Wrong parameter in Segment Constructor");n.byteLength=e.byteLength,(0,C.nativeCall)("segment_created",{id:n.id,binaryDataId:e.id})}return n.callbacks={},n}return(0,p.default)(t,e),(0,c.default)(t,[{key:"_generateId",value:function(){return y.default.v4()}},{key:"getBinaryData",value:function(e,t,n){var r=i(e,t);w[r]=n;var o={segmentId:this.id,offset:e,size:t};(0,C.nativeCall)("get_binary_data",o)}},{key:"setBinaryData",value:function(e,t){if(!(e instanceof b.default||"number"==typeof t))throw new TypeError("Wrong parameter");var n={segmentId:this.id,offset:t,binaryDataId:e.id};(0,C.nativeCall)("set_binary_data",n)}},{key:"destroy",value:function(){var e={segmentId:this.id};(0,C.nativeCall)("destroy_segment",e)}}],[{key:"getBinaryDataCallback",value:function(e,t,n,r){var o=i(t,r),a=w[o],s=new b.default(n,parseInt(r,10));a(s)}}]),t}(m.default);n.default=S,t.exports=n.default},{"../../../utils/nativeCalls":98,"../SegmentInterface":48,"./BinaryData":51,"babel-runtime/core-js/object/get-prototype-of":116,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,"babel-runtime/helpers/inherits":125,"babel-runtime/helpers/possibleConstructorReturn":126,uuid:230}],53:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=function(){function e(){(0,o.default)(this,e)}return(0,s.default)(e,[{key:"sendMessage",value:function(){throw new Error("One should not call sendMessage on a PeerConnection that has already been destroyed")}},{key:"sendBinaryData",value:function(){throw new Error("One should not call sendBinaryData on a PeerConnection that has already been destroyed")}},{key:"getRtt",value:function(){throw new Error("One should not call getRtt on a PeerConnection that has already been destroyed")}},{key:"getBufferedAmount",value:function(){throw new Error("One should not call getBufferedAmount on a PeerConnection that has already been destroyed")}},{key:"destroy",value:function(){throw new Error("One should not call destroy on a PeerConnection that has already been destroyed")}},{key:"close",value:function(){throw new Error("One should not call close on a PeerConnection that has already been destroyed")}},{key:"on",value:function(){throw new Error("One should not call on on a PeerConnection that has already been destroyed")}}]),e}();n.default=u,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],54:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r){function i(){t.onclose=function(){D()},t.onerror=function(e){D()},t.onmessage=k,e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":case"closed":e.oniceconnectionstatechange=function(){},P(),D();break;case"disconnected":}},j(),x.setInterval(h,A.PEER_COMPUTE_RTT_INTERVAL)}function o(e,n){if("open"===t.readyState){var r=(0,c.default)({type:e,args:n});return M.increaseRawDataUploadedBy(r.length),t.send(r),!0}return l("sendMessage failed: DataChannel readyState is not open but "+t.readyState),!1}function s(e,n,r){var i=(0,v.encodeMetaData)(r,n,e);return"open"===t.readyState?(t.send(i),!0):(l("sendBinaryData failed: DataChannel readyState is not open but "+t.readyState),!1)}function l(e){var t=new Error(e);C.default.notifyError(t),D()}function f(){return L}function h(){g.default.getPeerConnectionRTT(e,function(e){L=e},function(e){})}function _(){return t.bufferedAmount}function b(){P(),I.destroy()}function y(){x.clearAll(),(0,u.default)(I,new m.default)}function w(e,t){R.on(e,t)}function S(e,t){R.once(e,t)}function k(e){switch(O=!0,(0,a.default)(e.data)){case"string":E(e.data);break;default:T(e.data)}}function E(e){M.increaseRawDataDownloadedBy(e.length);var t=JSON.parse(e);switch(t.type){case"heartbeat":break;default:R.emit("message_received",t.type,t.args)}}function T(e){M.increaseRawDataDownloadedBy(e.byteLength);var t=(0,v.parseMetaData)(e,n.fromArrayBuffer);R.emit("binarydata_received",t.data,t.id_chunk,t.segmentCoord)}function j(){x.setInterval(function(){O||(M.incrementCheckHeartbeatFailed(),P(),D()),O=!1},A.CHECK_HEARTBEAT_INTERVAL),x.setInterval(function(){return o("heartbeat")},A.SEND_HEARTBEAT_INTERVAL)}function D(){return N?(N=!1,void R.emit("disconnected")):void C.default.notifyError(new Error("Guarded attempt to trigger 'disconnected' event on PeerConnection more than once"))}function P(){"closing"!==t.readyState&&"closed"!==t.readyState&&t.close(),"closed"!==e.signalingState&&e.close()}var I=this,M=r.status,A=r.conf,R=new d.default,x=new p.default,O=!0,N=!0,L=-1;this.sendMessage=o,this.sendBinaryData=s,this.getRtt=f,this.getBufferedAmount=_,this.destroy=y,this.close=b,this.on=w,this.once=S,i()}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/typeof"),a=r(o),s=e("babel-runtime/core-js/object/assign"),u=r(s),l=e("babel-runtime/core-js/json/stringify"),c=r(l),f=e("eventemitter3"),d=r(f),h=e("../../utils/Timers"),p=r(h),_=e("./DestroyedPeerConnection"),m=r(_),v=e("../../utils/ChunkMetadata"),b=e("../../utils/WebRTC"),g=r(b),y=e("../../errors/ErrorFunnel"),C=r(y);n.default=i,t.exports=n.default},{"../../errors/ErrorFunnel":13,"../../utils/ChunkMetadata":83,"../../utils/Timers":95,"../../utils/WebRTC":96,"./DestroyedPeerConnection":53,"babel-runtime/core-js/json/stringify":108,"babel-runtime/core-js/object/assign":110,"babel-runtime/helpers/typeof":129,eventemitter3:219}],55:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r){return new s.default(e,t,n,r)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./mobile/PeerConnector"),a=(r(o),e("./browser/PeerConnector")),s=r(a);n.default=i,t.exports=n.default},{"./browser/PeerConnector":57,"./mobile/PeerConnector":59}],56:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/json/stringify"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=e("underscore"),f=r(c),d=function(){function e(t){(0,s.default)(this,e),this._conf=t.conf,this._status=t.status,this._init()}return(0,l.default)(e,[{key:"connect",value:function(e,t){this._url=e,this._id=t,this._createConnection()}},{key:"send",value:function(e){if(this._connection&&this._connection.readyState===WebSocket.OPEN){var t=e.receiver_id+","+(0,o.default)(f.default.omit(e,"receiver_id"));this._connection.send(t)}else this._msgBuffer.push(e)}},{key:"on",value:function(e,t){this._handlers[e]=t}},{key:"close",value:function(){this._disposing=!0,this._status.setDisconnectedToSignalingServer(),this._stopReconnectionLoop(),this._connection&&this._connection.close(),void 0!==this._connectionTimeout&&(clearTimeout(this._connectionTimeout),delete this._connectionTimeout),void 0!==this._nextReconnectAttempt&&(clearTimeout(this._nextReconnectAttempt),delete this._nextReconnectAttempt),this._init()}},{key:"_createConnection",value:function(){!this._connection||this._connection.readyState!==WebSocket.CONNECTING&&this._connection.readyState!==WebSocket.OPEN||this.close();var e="4.3.0";this._connection=new WebSocket(this._url+"?id="+this._id+"&p2pVersion="+e+"&client_id="+this._conf.ID_CLIENT);var t=this._connection;this._connectionTimeout=setTimeout(function(){t.close()},1e4),this._handleConnectionSuccess(),this._handleErrorAndClose(),this._handleMessages()}},{key:"_handleErrorAndClose",value:function(){var e=this,t=this._connection,n=function(){t===e._connection&&(e._status.setDisconnectedToSignalingServer(),e._tryReconnect())};this._connection.onerror=n,this._connection.onclose=n}},{key:"_tryReconnect",value:function(){var e=this,t=function(){delete e._nextReconnectAttempt,e._createConnection(),e._updateDelay()};void 0!==this._nextReconnectAttempt||this._disposing||(this._nextReconnectAttempt=setTimeout(t,this._delayReconnection))}},{key:"_updateDelay",value:function(){this._delayReconnection=Math.min(this._delayReconnection+this._conf.SIGNALING_DELAY_STEP,this._conf.SIGNALING_DELAY_MAX)}},{key:"_handleConnectionSuccess",value:function(){var e=this;this._connection.onopen=function(){e._status.setConnectedToSignalingServer(),clearTimeout(e._connectionTimeout),delete e._connectionTimeout,e._stopReconnectionLoop(),e._sendMessagesInBuffer()}}},{key:"_handleMessages",value:function(){var e=this;this._connection.onmessage=function(t){var n=JSON.parse(t.data);if(e._handlers[n.type]){var r=f.default.omit(n,"type");e._handlers[n.type](r)}}}},{key:"_init",value:function(){this._handlers={},this._delayReconnection=0,this._msgBuffer=[]}},{key:"_stopReconnectionLoop",value:function(){this._delayReconnection=0}},{key:"_sendMessagesInBuffer",value:function(){this._msgBuffer.forEach(this.send.bind(this)),this._msgBuffer=[]}}]),e}();n.default=d,t.exports=n.default},{"babel-runtime/core-js/json/stringify":108,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,underscore:226}],57:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/get-iterator"),a=r(o),s=e("babel-runtime/core-js/map"),u=r(s),l=e("babel-runtime/helpers/classCallCheck"),c=r(l),f=e("babel-runtime/helpers/createClass"),d=r(f),h=e("../SignalingClient"),p=r(h),_=e("../PeerConnection"),m=r(_),v=e("../../../errors/ErrorFunnel"),b=r(v),g=e("../../../utils/WebRTC"),y=r(g),C=e("../../../utils/Bucket"),w=r(C),S=e("../../../utils/Timers"),k=r(S),E=function(){function e(t,n,r,i){(0,c.default)(this,e),this._sharedState=i,this._conf=i.conf,this._status=i.status,this._signalingClient=new p.default(i),this._myPeerId=t,this._peerPool=n,this._analyticsData=i.analyticsData,this._signalingClient.connect(this._conf.SIGNALING_URL,t),this._signalingClient.on("webrtc_offer",this._onOffer.bind(this)),this._signalingClient.on("webrtc_answer",this._onAnswer.bind(this)),this._signalingClient.on("webrtc_icecandidate",this._onIceCandidate.bind(this)),this._peerConnectionCollection=new u.default,this.SegmentCoord=r,this._timers=new k.default}return(0,d.default)(e,[{key:"createPeerConnection",value:function(e){var t=this,n=Math.random().toString().substr(2),r=y.default.createPeerConnection(this._conf),o=r.createDataChannel("comm",{ordered:!1,maxPacketLifeTime:1e3});o.binaryType="arraybuffer";var a=this._timers.setTimeout(function(){t._onConnexionTimeout(e,n)},this._conf.PEER_CONNECTION_TIMEOUT),s=this._createOpenDataChannelHandler(r,o,a,e,n);o.onopen=s,this._peerConnectionCollection.set(n,{rtcPeerConnection:r,connectionTimeout:a,rtcDataChannel:o}),r.createOffer(function(o){r.setLocalDescription(o,function(){var r=y.default.transformOutgoingSdp(o.sdp),i={type:"webrtc_offer",connexion_id:n,sender_id:t._myPeerId,receiver_id:e,sdp:r};t._signalingClient.send(i)},i)},i),this._manageIceCandidate(r,e,n)}},{key:"_manageIceCandidate",value:function(e,t,n){var r=this._createIceCandidateBucket(this._myPeerId,t,n);e.onicecandidate=function(e){e.candidate&&r.addElement(e.candidate)}}},{key:"_onConnexionRefused",value:function(e,t){var n=this._peerConnectionCollection.get(t),r=n.rtcPeerConnection;r.close(),this._peerConnectionCollection.delete(t),this._peerPool.offerDeclined(e)}},{key:"_onConnexionTimeout",value:function(e,t){var n=this._peerConnectionCollection.get(t),r=n.rtcPeerConnection;r.close(),this._peerConnectionCollection.delete(t),this._peerPool.connectionAttemptTimeout(e)}},{key:"_onOffer",value:function(e){var t=this;this._analyticsData.offer++;var n=e.sender_id,r=e.connexion_id;if(this._peerPool.isFull()){var o={type:"webrtc_answer",connexion_id:r,sender_id:this._myPeerId,receiver_id:n,accepted:!1};return void this._signalingClient.send(o)}var a=y.default.createPeerConnection(this._conf);this._peerConnectionCollection.set(r,{rtcPeerConnection:a}),this._manageIceCandidate(a,n,r);var s={sdp:e.sdp,type:"offer"},u=new y.default.SessionDescription(s);a.setRemoteDescription(u,function(){a.createAnswer(function(e){a.setLocalDescription(e,function(){e.sdp=y.default.transformOutgoingSdp(e.sdp);
var i={type:"webrtc_answer",connexion_id:r,sender_id:t._myPeerId,receiver_id:n,accepted:!0,sdp:e.sdp};t._signalingClient.send(i)},i)},i)},i);var l=this._timers.setTimeout(function(){t._onConnexionTimeout(n,r)},this._conf.PEER_CONNECTION_TIMEOUT);a.ondatachannel=function(e){var o=e.channel||e;o.binaryType="arraybuffer";var s=t._createOpenDataChannelHandler(a,o,l,n,r);"connecting"===o.readyState?o.onopen=s:s(),o.onerror=i}}},{key:"_createOpenDataChannelHandler",value:function(e,t,n,r,i){var o=this;return function(){if(o._peerConnectionCollection.get(i)){o._peerConnectionCollection.delete(i),o._timers.clearTimeout(n);var a=new m.default(e,t,o.SegmentCoord,o._sharedState);o._peerPool.addPeerConnection(r,a)}}}},{key:"_onAnswer",value:function(e){var t=e.sender_id,n=e.connexion_id;if(this._peerConnectionCollection.get(n)){var r=this._peerConnectionCollection.get(n),o=r.rtcPeerConnection,a=r.connectionTimeout;if(o)if(e.accepted){var s={sdp:e.sdp,type:"answer"},u=new y.default.SessionDescription(s);o.setRemoteDescription(u,function(){},i)}else this._timers.clearTimeout(a),this._onConnexionRefused(t,n)}}},{key:"_onIceCandidate",value:function(e){var t=this,n=e.connexion_id;if(this._peerConnectionCollection.get(n)){var r=this._peerConnectionCollection.get(n),i=r.rtcPeerConnection;e.icecandidate_array.forEach(function(e){t._addIceCandidate(i,e)})}}},{key:"_addIceCandidate",value:function(e,t){try{e.addIceCandidate(new y.default.IceCandidate(t))}catch(e){b.default.notifyError(e)}}},{key:"_createIceCandidateBucket",value:function(e,t,n){var r=this,i=function(i){var o={type:"webrtc_icecandidate",connexion_id:n,sender_id:e,receiver_id:t,icecandidate_array:i};r._signalingClient.send(o)},o=new w.default(i,this._status.incrementMissedIceCandidateCount,this._conf.ICECANDIDATES_TIMEOUT);return o}},{key:"dispose",value:function(){this._signalingClient.close(),this._timers.clearAll();var e=!0,t=!1,n=void 0;try{for(var r,i=(0,a.default)(this._peerConnectionCollection.values());!(e=(r=i.next()).done);e=!0){var o=r.value.rtcPeerConnection;o.close()}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"getPendingConnectionDebugInfos",value:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var i,o=(0,a.default)(this._peerConnectionCollection.values());!(t=(i=o.next()).done);t=!0){var s=i.value,u=s.rtcPeerConnection,l=u.iceGatheringState,c=u.signalingState,f=u.iceConnectionState,d=s.rtcDataChannel?s.rtcDataChannel.readyState:null;e.push({iceGatheringState:l,signalingState:c,iceConnectionState:f,readyState:d})}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return e}}]),e}();n.default=E,t.exports=n.default},{"../../../errors/ErrorFunnel":13,"../../../utils/Bucket":80,"../../../utils/Timers":95,"../../../utils/WebRTC":96,"../PeerConnection":54,"../SignalingClient":56,"babel-runtime/core-js/get-iterator":106,"babel-runtime/core-js/map":109,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],58:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/json/stringify"),o=r(i),a=e("babel-runtime/core-js/object/get-prototype-of"),s=r(a),u=e("babel-runtime/helpers/classCallCheck"),l=r(u),c=e("babel-runtime/helpers/createClass"),f=r(c),d=e("babel-runtime/helpers/possibleConstructorReturn"),h=r(d),p=e("babel-runtime/helpers/inherits"),_=r(p),m=e("eventemitter3"),v=r(m),b=e("../../../utils/nativeCalls"),g=e("../../../utils/Timers"),y=r(g),C=e("../../binaryAbstraction/mobile/BinaryData"),w=r(C),S={},k=function(e){function t(e,n){(0,l.default)(this,t);var r=(0,h.default)(this,(0,s.default)(t).call(this));return r._conf=n,S[e]=r,r.connectionId=e,r._timers=new y.default,r._manageHeartbeat(),r._isCommunicating=!0,r}return(0,_.default)(t,e),(0,f.default)(t,[{key:"sendMessage",value:function(e,t){var n=(0,o.default)({type:e,args:t}),r={connection_id:this.connectionId,message:n};(0,b.nativeCall)("peer_connection_send_message",r)}},{key:"sendBinaryData",value:function(e,t,n){var r={connection_id:this.connectionId,binary_data_id:e.id,chunk_id:t,segment_coord:n};return(0,b.nativeCall)("peer_connection_send_data",r),!0}},{key:"getRtt",value:function(){return-1}},{key:"getBufferedAmount",value:function(){return 0}},{key:"destroy",value:function(){delete S[this.connectionId],this._timers.clearAll()}},{key:"close",value:function(){(0,b.nativeCall)("peer_connection_close",{connectionId:this.connectionId}),this.destroy()}},{key:"_manageHeartbeat",value:function(){var e=this;this._timers.setInterval(function(){e._isCommunicating===!0?e._isCommunicating=!1:(e.emit("disconnected"),(0,b.nativeCall)("peer_connection_close",{connection_id:e.connectionId}))},this._conf.CHECK_HEARTBEAT_INTERVAL),this._timers.setInterval(function(){return e.sendMessage("heartbeat")},this._conf.SEND_HEARTBEAT_INTERVAL)}}],[{key:"receivedMessage",value:function(e,t){var n=JSON.parse(t);switch(n.type){case"heartbeat":break;default:var r=S[e];r._isCommunicating=!0,r.emit("message_received",n.type,n.args)}}},{key:"receivedData",value:function(e,t,n,r,i){var o=new w.default(t,parseInt(n,10)),a=S[e];a._isCommunicating=!0,a.emit("binarydata_received",o,r,i)}},{key:"onDisconnect",value:function(e){var t=S[e];t&&t.emit("disconnected")}}]),t}(v.default);n.default=k,t.exports=n.default},{"../../../utils/Timers":95,"../../../utils/nativeCalls":98,"../../binaryAbstraction/mobile/BinaryData":51,"babel-runtime/core-js/json/stringify":108,"babel-runtime/core-js/object/get-prototype-of":116,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,"babel-runtime/helpers/inherits":125,"babel-runtime/helpers/possibleConstructorReturn":126,eventemitter3:219}],59:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("../../../utils/nativeCalls"),l=e("./PeerConnection"),c=r(l),f=void 0,d=function(){function e(t,n,r){(0,o.default)(this,e),this._conf=r,this.myPeerId=t,f=n}return(0,s.default)(e,[{key:"createPeerConnection",value:function(e){var t={peerId:this.myPeerId,remotePeerId:e};(0,u.nativeCall)("signaling_create_peer_connection",t)}}],[{key:"peerConnectionCallback",value:function(e,t,n){switch(e){case"success":var r=new c.default(t,this._conf);f.addPeerConnection(n,r);break;case"timeout":f.connectionAttemptTimeout(n);break;case"declined":f.offerDeclined(n);break;default:(0,u.nativeError)("[SIGNALING] bad status")}}}]),e}();n.default=d,t.exports=n.default},{"../../../utils/nativeCalls":98,"./PeerConnection":58,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],60:[function(e,t,n){(function(e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t,n,r){var i=r.status,o=function(){var e,r={download:{p2pDownloaded:i.getP2PDownloaded(),p2pDownloadedNewAnalytics:i.getp2pDownloadedNewAnalytics(),p2pUploaded:i.getP2PUploaded(),cdnDownloaded:i.getCDNDownloaded(),dlSpeed:i.getDlSpeed(),upSpeed:i.getUpSpeed()},peers:{count:0},bufferLevel:i.getMyBufferLevel(),tracker:{connected:i.getConnected()},trackerConnected:i.getConnected(),sigConnected:i.getConnectedToSignalingServer(),isLive:n()},o=[];for(e=0;e<t.getPeerArray().length;e++){var a=t.getPeerArray()[e];a.getId()&&r.peers.count++,o.push(a.getDebugInfos())}return r.peerList=o,r},a=function(){e.SR_DISPLAY_INTERFACE={getStats:o}};a(),this.dispose=function(){delete window.SR_DISPLAY_INTERFACE}};n.default=r,t.exports=n.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],61:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=function(){function e(){(0,o.default)(this,e)}return(0,s.default)(e,[{key:"getSegmentTime",value:function(e){}},{key:"getSegmentList",value:function(e,t,n){}},{key:"getTrackList",value:function(){}}]),e}();n.default=u,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],62:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=function(){function e(){(0,o.default)(this,e)}return(0,s.default)(e,[{key:"isEqual",value:function(e){return!0}},{key:"viewToString",value:function(){return""}},{key:"toArrayBuffer",value:function(){return new ArrayBuffer(0)}},{key:"isInTrack",value:function(e){return!1}},{key:"getId",value:function(){return 0}}],[{key:"fromArrayBuffer",value:function(t){return new e}}]),e}();n.default=u,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],63:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=function(){function e(){(0,o.default)(this,e)}return(0,s.default)(e,[{key:"viewToString",value:function(){return""}},{key:"isEqual",value:function(e){return!0}}]),e}();n.default=u,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],64:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return new a.default(e,t)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./browser/HttpRequest"),a=r(o),s=e("./mobile/HttpRequest");r(s),i.progress=function(e,t,n){},i.response=function(e,t,n,r){},n.default=i,t.exports=n.default},{"./browser/HttpRequest":66,"./mobile/HttpRequest":67}],65:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=function(){function e(){(0,o.default)(this,e)}return(0,s.default)(e,[{key:"setHeaders",value:function(e){throw new Error("must be implemented")}},{key:"setWithCredentials",value:function(e){throw new Error("must be implemented")}},{key:"send",value:function(){throw arguments.length<=0||void 0===arguments[0]?null:arguments[0],new Error("must be implemented")}},{key:"abort",value:function(){throw new Error("must be implemented")}},{key:"validStatusCodeRange",get:function(){return this._statusCodeRange},set:function(e){this._statusCodeRange=e}},{key:"onresponse",set:function(e){throw new Error("must be implemented")},get:function(){throw new Error("must be implemented")}},{key:"onprogress",set:function(e){throw new Error("must be implemented")},get:function(){throw new Error("must be implemented")}}]),e}();n.default=u,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],66:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/keys"),o=r(i),a=e("babel-runtime/core-js/get-iterator"),s=r(a),u=e("babel-runtime/core-js/object/get-prototype-of"),l=r(u),c=e("babel-runtime/helpers/classCallCheck"),f=r(c),d=e("babel-runtime/helpers/createClass"),h=r(d),p=e("babel-runtime/helpers/possibleConstructorReturn"),_=r(p),m=e("babel-runtime/helpers/inherits"),v=r(m),b=e("../HttpRequestInterface"),g=r(b),y=function(e){function t(e,n){(0,f.default)(this,t);var r=(0,_.default)(this,(0,l.default)(t).call(this));return r._xhr=new XMLHttpRequest,r._xhr.open(e,n,!0),r._xhr.responseType="arraybuffer",r}return(0,v.default)(t,e),(0,h.default)(t,[{key:"setHeaders",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=(0,s.default)((0,o.default)(e));!(t=(i=a.next()).done);t=!0){var u=i.value;this._xhr.setRequestHeader(u,e[u])}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}},{key:"setWithCredentials",value:function(e){this._xhr.withCredentials=e}},{key:"send",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];this._xhr.send(e)}},{key:"abort",value:function(){this._xhr.abort()}},{key:"onresponse",set:function(e){var t=this;this._onreponseCallback=e,this._xhr.onloadend=function(e){var n=t._xhr.status,r=n>=t.validStatusCodeRange.start&&n<=t.validStatusCodeRange.end;r?t._onreponseCallback(null,t._xhr.response):t._onreponseCallback(e,null)},this._xhr.onerror=function(e){t._onreponseCallback(e,null)}},get:function(){return this._onreponseCallback}},{key:"onprogress",set:function(e){var t=this;this._onprogressCallback=e,this._xhr.onprogress=function(e){t._onprogressCallback(e.loaded,e.total)}},get:function(){return this._onprogressCallback}}]),t}(g.default);n.default=y,t.exports=n.default},{"../HttpRequestInterface":65,"babel-runtime/core-js/get-iterator":106,"babel-runtime/core-js/object/get-prototype-of":116,"babel-runtime/core-js/object/keys":118,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,"babel-runtime/helpers/inherits":125,"babel-runtime/helpers/possibleConstructorReturn":126}],67:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/get-prototype-of"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(c),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("../HttpRequestInterface"),_=r(p),m=e("uuid"),v=r(m),b=e("../../binaryAbstraction/mobile/BinaryData"),g=r(b),y=e("../../../utils/nativeCalls"),C={},w=function(e){function t(e,n){(0,s.default)(this,t);var r=(0,f.default)(this,(0,o.default)(t).call(this));return r.id=v.default.v4(),r._method=e,r._url=n,r._withCredentials=!1,r._headers=[],r}return(0,h.default)(t,e),(0,l.default)(t,[{key:"setHeaders",value:function(e){this._headers=e}},{key:"setWithCredentials",value:function(e){this._withCredentials=e}},{key:"send",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];C[this.id]=this;var t={id:this.id,method:this._method,url:this._url,headers:this._headers,with_credentials:this._withCredentials,valid_status_code_range:this.validStatusCodeRange};null!==e&&(t.body=e),(0,y.nativeCall)("send_http_request",t)}},{key:"abort",value:function(){}},{key:"onresponse",set:function(e){this._onreponseCallback=e},get:function(){return this._onreponseCallback}},{key:"onprogress",set:function(e){this._onprogressCallback=e},get:function(){return this._onprogressCallback}}],[{key:"progress",value:function(e,t,n){C[e].onprogress(t,n)}},{key:"response",value:function(e,t,n,r){var i=new g.default(t,parseInt(n,10));C[e].onresponse(r,i)}}]),t}(_.default);n.default=w,t.exports=n.default},{"../../../utils/nativeCalls":98,"../../binaryAbstraction/mobile/BinaryData":51,"../HttpRequestInterface":65,"babel-runtime/core-js/object/get-prototype-of":116,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,"babel-runtime/helpers/inherits":125,"babel-runtime/helpers/possibleConstructorReturn":126,uuid:230}],68:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/array/from"),o=r(i),a=e("babel-runtime/core-js/map"),s=r(a),u=e("babel-runtime/core-js/get-iterator"),l=r(u),c=e("babel-runtime/helpers/classCallCheck"),f=r(c),d=e("babel-runtime/helpers/createClass"),h=r(d),p=e("underscore"),_=r(p),m=e("../structures/TrackEdges"),v=r(m),b=e("../MediaMapCache"),g=r(b),y=e("../../../defaultConf"),C=(r(y),function(){function e(t,n,r,i,o){(0,f.default)(this,e),this._conf=o.conf,this._p2pCache=n,this._distributedSegmentList=r,this._currentTracks=i,this._mediaMapCache=new g.default(t,o),this._edges=new v.default(this._mediaMapCache,o)}return(0,h.default)(e,[{key:"updateCurrentTracks",value:function(e){this._currentTracks.update(e)}},{key:"_getSegmentsToDownloadByTrack",value:function(e,t){var n=[],r=void 0;if(r="audio"===t?this._edges.audio:this._edges.video){var i=this._mediaMapCache.getSegmentTime(r),o=this._mediaMapCache.getSegmentList(e,i,this._conf.MAX_BUFFER_DURATION),a=this._distributedSegmentList.getSegmentListAfter(r),s=this._mergeDedupe(o,a),u=this._p2pCache.listSegmentsToSkipForTrack(e);n=this._getDifference(s,u)}return n}},{key:"isSegmentRequested",value:function(e){var t=this.getSegmentListToDownload(),n=!0,r=!1,i=void 0;try{for(var o,a=(0,l.default)(t);!(n=(o=a.next()).done);n=!0){var s=o.value;if(e.isEqual(s))return!0}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return!1}},{key:"_getDifference",value:function(e,t){return _.default.reject(e,function(e){return void 0!==_.default.find(t,function(t){return e.isEqual(t)})})}},{key:"_mergeDedupe",value:function(e,t){var n=new s.default,r=!0,i=!1,a=void 0;try{for(var u,c=(0,l.default)(e);!(r=(u=c.next()).done);r=!0){var f=u.value;n.set(f.viewToString(),f)}}catch(e){i=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(i)throw a}}var d=!0,h=!1,p=void 0;try{for(var _,m=(0,l.default)(t);!(d=(_=m.next()).done);d=!0){var v=_.value;n.set(v.viewToString(),v)}}catch(e){h=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(h)throw p}}return(0,o.default)(n.values())}},{key:"getSegmentListToDownload",value:function(){throw new Error("Cannot call abstract method")}},{key:"updateTrackEdge",value:function(e){throw new Error("Cannot call abstract method")}}]),e}());n.default=C,t.exports=n.default},{"../../../defaultConf":1,"../MediaMapCache":26,"../structures/TrackEdges":75,"babel-runtime/core-js/array/from":105,"babel-runtime/core-js/get-iterator":106,"babel-runtime/core-js/map":109,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,underscore:226}],69:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/get-prototype-of"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(c),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("./AbstractScheduler"),_=r(p),m=function(e){function t(){return(0,s.default)(this,t),(0,f.default)(this,(0,o.default)(t).apply(this,arguments))}return(0,h.default)(t,e),(0,l.default)(t,[{key:"getSegmentListToDownload",value:function(){var e=[],t=this._currentTracks.audio;t&&(e=this._getSegmentsToDownloadByTrack(t,"audio"));var n=this._currentTracks.video;return n&&(e=e.concat(this._getSegmentsToDownloadByTrack(n,"video"))),e.sort(function(e,t){return e.getId()-t.getId()})}},{key:"updateTrackEdge",value:function(e){var t=this._findTrack(e);"audio"===t?this._edges.update({audio:e,video:null}):"video"===t&&this._edges.update({audio:null,video:e})}},{key:"_findTrack",value:function(e){var t=this._currentTracks.video;if(t&&e.isInTrack(t))return"video";var n=this._currentTracks.audio;return n&&e.isInTrack(n)?"audio":void 0}}]),t}(_.default);n.default=m,t.exports=n.default},{"./AbstractScheduler":68,"babel-runtime/core-js/object/get-prototype-of":116,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,"babel-runtime/helpers/inherits":125,"babel-runtime/helpers/possibleConstructorReturn":126}],70:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/get-prototype-of"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(c),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("./AbstractScheduler"),_=r(p),m=function(e){function t(){return(0,s.default)(this,t),(0,f.default)(this,(0,o.default)(t).apply(this,arguments))}return(0,h.default)(t,e),(0,l.default)(t,[{key:"getSegmentListToDownload",value:function(){var e=[],t=this._currentTracks.video;return t&&(e=this._getSegmentsToDownloadByTrack(t,"video")),e.sort(function(e,t){return e.getId()-t.getId()})}},{key:"updateTrackEdge",value:function(e){this._currentTracks.video&&e.isInTrack(this._currentTracks.video)&&this._edges.update({video:e,audio:null})}}]),t}(_.default);n.default=m,t.exports=n.default},{"./AbstractScheduler":68,"babel-runtime/core-js/object/get-prototype-of":116,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124,"babel-runtime/helpers/inherits":125,"babel-runtime/helpers/possibleConstructorReturn":126}],71:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r,i,o){return"hls"===r?new a.default(e,t,n,i,o):new u.default(e,t,n,i,o)}Object.defineProperty(n,"__esModule",{value:!0}),n.createScheduler=i;var o=e("./HlsScheduler"),a=r(o),s=e("./GenericScheduler"),u=r(s)},{"./GenericScheduler":69,"./HlsScheduler":70}],72:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.CurrentTracks=void 0;var i=e("babel-runtime/core-js/object/seal"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u);n.CurrentTracks=function(){function e(){(0,s.default)(this,e),this.audio=void 0,this.video=void 0,(0,o.default)(this)}return(0,l.default)(e,[{key:"update",value:function(e){var t=e.audio,n=e.video;if(!t&&!n)throw new Error("There must be at least one updated track");this.audio=t||this.audio,this.video=n||this.video}}]),e}()},{"babel-runtime/core-js/object/seal":119,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],73:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/freeze"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("../ChunkManager"),l=r(u),c=e("../Seeders"),f=r(c),d=e("../expectedInterfaces/SegmentCoordInterface"),h=r(d),p=e("../../utils/Interface"),_=function e(t,n,r,i,a){(0,s.default)(this,e),(0,p.checkInterface)(h.default,t),this.segmentCoord=t,this.chunkManager=new l.default(t,n,r,i,a),this.seeders=new f.default,(0,o.default)(this)};n.default=_,t.exports=n.default},{"../../utils/Interface":87,"../ChunkManager":18,"../Seeders":39,"../expectedInterfaces/SegmentCoordInterface":62,"babel-runtime/core-js/object/freeze":114,"babel-runtime/helpers/classCallCheck":123}],74:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/freeze"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("../../utils/Delta"),l=e("../expectedInterfaces/SegmentCoordInterface"),c=r(l),f=e("../../utils/Interface"),d=function e(t,n,r){if((0,s.default)(this,e),(0,f.checkInterface)(c.default,t),!(0,u.isNumeric)(n))throw new Error("Invalid value for size");if(!r)throw new Error("No hash");this.segmentCoord=t,this.size=n,this.hash=r,(0,o.default)(this)};n.default=d,t.exports=n.default},{"../../utils/Delta":85,"../../utils/Interface":87,"../expectedInterfaces/SegmentCoordInterface":62,"babel-runtime/core-js/object/freeze":114,"babel-runtime/helpers/classCallCheck":123}],75:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/seal"),o=r(i),a=e("babel-runtime/helpers/classCallCheck"),s=r(a),u=e("babel-runtime/helpers/createClass"),l=r(u),c=function(){function e(t,n){(0,s.default)(this,e),this.audio=void 0,this.video=void 0,this._mediaMapCache=t,this._moduleState=n.moduleState,(0,o.default)(this)}return(0,l.default)(e,[{key:"update",value:function(e){var t=e.audio,n=e.video;if(void 0===t&&void 0===n)throw new Error("There must be at least one updated track edge");t&&(this.audio=t),n&&(this.video=n,this._moduleState.videoCurrentTime=this._mediaMapCache.getSegmentTime(n))}}]),e}();n.default=c,t.exports=n.default},{"babel-runtime/core-js/object/seal":119,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],76:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("./browser/callHashWorker"),l=r(u),c=(e("./mobile/callHashWorker"),function(){function e(){(0,o.default)(this,e),this._disposed=!1}return(0,s.default)(e,[{key:"callHashWorker",value:function(e,t){var n=this,r=function(){n._disposed||t.apply(void 0,arguments)};return(0,l.default)(e,r)}},{key:"dispose",value:function(){this._disposed=!0}}]),e}());n.default=c,t.exports=n.default},{"./browser/callHashWorker":78,"./mobile/callHashWorker":79,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],77:[function(e,t,n){"use strict";function r(){var e={mul32:function(e,t){var n=65535&t,r=t-n;return(r*e|0)+(n*e|0)|0},hashBytes:function(e,t,n){for(var r=3432918353,i=461845907,o=n,a=t&-4,s=0;s<a;s+=4){var u=255&e[s]|(255&e[s+1])<<8|(255&e[s+2])<<16|(255&e[s+3])<<24;u=this.mul32(u,r),u=(131071&u)<<15|u>>>17,u=this.mul32(u,i),o^=u,o=(524287&o)<<13|o>>>19,o=5*o+3864292196|0}switch(u=0,t%4){case 3:u=(255&e[a+2])<<16;case 2:u|=(255&e[a+1])<<8;case 1:u|=255&e[a],u=this.mul32(u,r),u=(131071&u)<<15|u>>>17,u=this.mul32(u,i),o^=u}return o^=t,o^=o>>>16,o=this.mul32(o,2246822507),o^=o>>>13,o=this.mul32(o,3266489909),o^=o>>>16}};self.onmessage=function(t){var n=new Uint8Array(t.data.segmentData),r=e.hashBytes(n,n.length,0).toString();self.postMessage({segmentData:t.data.segmentData,jobIndex:t.data.jobIndex,hash:r},[t.data.segmentData])}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r,t.exports=n.default},{}],78:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(){var e=URL.createObjectURL(new Blob(["("+u.default.toString()+")()"],{type:"application/javascript"})),t=new Worker(e);return URL.revokeObjectURL(e),t}function o(e){var t=e.data,n=t.jobIndex,r=t.segmentData,i=t.hash,o=l[n];delete l[n],o(r,i)}function a(e,t){var n=l.push(t)-1;c.postMessage({segmentData:e,jobIndex:n},[e])}Object.defineProperty(n,"__esModule",{value:!0});var s=e("./HashWorker"),u=r(s),l=[],c=i();c.onmessage=o,n.default=a,t.exports=n.default},{"./HashWorker":77}],79:[function(e,t,n){"use strict";function r(e,t){o[e.id]=t,a[e.id]=e,window.webkit.messageHandlers.call_hash_worker.postMessage({binaryDataId:e.id})}function i(e,t){var n=a[e],r=o[e];r(n,t),delete o[e]}Object.defineProperty(n,"__esModule",{value:!0});var o={},a={};n.callHashWorkerMobile=r,n.hasherCallback=i},{}],80:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./Timers"),o=r(i),a=function(e,t,n){var r=[],i=!1,a=new o.default,s=function(e){i?t(e):r.push(e)},u=function(){a.setTimeout(function(){i=!0,e(r),r=[]},n)};u(),this.addElement=s};n.default=a,t.exports=n.default},{"./Timers":95}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){var t=Math.floor(e/256),n=e%256;return new Uint8Array([n,t])},i=function(e){var t=r(Math.floor(e/65536)),n=r(e%65536);return new Uint8Array([n[0],n[1],t[0],t[1]])};n.uint16ToUint8Array2=r,n.numToUint8Array4=i},{}],82:[function(e,t,n){"use strict";var r=function(e,t,n,r){var i=6371,o=(e-t)*Math.PI/180,a=(n-r)*Math.PI/180,s=e*Math.PI/180,u=t*Math.PI/180,l=Math.sin(o/2)*Math.sin(o/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(s)*Math.cos(u),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),f=i*c;return f};t.exports={getDistanceFromLatitudeLongitude:r}},{}],83:[function(e,t,n){"use strict";function r(e,t,n){var r=e.toArrayBuffer(),i=(0,o.numToUint8Array4)(t),a=n.byteLength,s=(0,o.uint16ToUint8Array2)(a),u=new Uint8Array(i.byteLength+s.byteLength+a+r.byteLength);return u.set(i,0),u.set(s,4),u.set(new Uint8Array(n),6),u.set(new Uint8Array(r),6+a),u.buffer}function i(e,t){var n=e.slice(0,4),r=e.slice(4,6),i=new Uint16Array(r)[0],o=e.slice(6,6+i),a=e.slice(6+i),s=new Uint32Array(n)[0],u=t(a);return{segmentCoord:u,id_chunk:s,data:o}}Object.defineProperty(n,"__esModule",{value:!0}),n.parseMetaData=n.encodeMetaData=void 0;var o=e("./Bytes");n.encodeMetaData=r,n.parseMetaData=i},{"./Bytes":81}],84:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if("string"!=typeof e||!e.length)throw new TypeError(t)}function o(e){var t=e.contentUrl,n=e.contentId;if(null!==n&&void 0!==n)return i(n,"Unvalid p2pConfig property: contentId needs to be a non-empty string"),n;i(t,"Unvalid PeerAgent constructor argument: contentUrl needs to be a non-empty string");var r=s.default.parse(t,!0,!0);return r.host+r.pathname}Object.defineProperty(n,"__esModule",{value:!0}),n.formatContentId=void 0;var a=e("url"),s=r(a);n.formatContentId=o},{url:227}],85:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return"number"==typeof e&&!isNaN(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.isNumeric=n.Delta=void 0;var o=e("babel-runtime/helpers/classCallCheck"),a=r(o),s=e("babel-runtime/helpers/createClass"),u=r(s),l=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0];(0,a.default)(this,e),this._lastDeltaValue=t}return(0,u.default)(e,[{key:"calcDelta",value:function(e){var t=e-this._lastDeltaValue;return this._lastDeltaValue=e,t}}]),e}();n.Delta=l,n.isNumeric=i},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="trackSwitch",i={Metrics:{TRACK_SWITCH:r}};n.default=i,t.exports=n.default},{}],87:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n=e.prototype,r=!0,i=!1,a=void 0;try{for(var s,u=(0,h.default)(o(n));!(r=(s=u.next()).done);r=!0){var l=s.value;if((0,f.default)(t[l])!==(0,f.default)(n[l])){var c=t.constructor.name;throw new Error("The method "+l+" of "+e.name+" is not defined in "+c)}}}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}}function o(e){var t=(0,l.default)(e).filter(function(e){return"constructor"!==e}),n=Object.prototype;if((0,s.default)(e)===n)return t;var r=(0,s.default)(e);return t.concat(o(r))}Object.defineProperty(n,"__esModule",{value:!0}),n._getEveryPropertyNames=n.checkInterface=void 0;var a=e("babel-runtime/core-js/object/get-prototype-of"),s=r(a),u=e("babel-runtime/core-js/object/get-own-property-names"),l=r(u),c=e("babel-runtime/helpers/typeof"),f=r(c),d=e("babel-runtime/core-js/get-iterator"),h=r(d);n.checkInterface=i,n._getEveryPropertyNames=o},{"babel-runtime/core-js/get-iterator":106,"babel-runtime/core-js/object/get-own-property-names":115,"babel-runtime/core-js/object/get-prototype-of":116,"babel-runtime/helpers/typeof":129}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t){return parseFloat(e.toFixed(t))};n.toDecimal=r},{}],89:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){(0,d.default)(e),(0,c.default)(e).forEach(function(t){var n=e[t];null===n||"object"!==("undefined"==typeof n?"undefined":(0,u.default)(n))||(0,a.default)(n)||i(n)})}Object.defineProperty(n,"__esModule",{value:!0}),n.deepFreeze=void 0;var o=e("babel-runtime/core-js/object/is-frozen"),a=r(o),s=e("babel-runtime/helpers/typeof"),u=r(s),l=e("babel-runtime/core-js/object/get-own-property-names"),c=r(l),f=e("babel-runtime/core-js/object/freeze"),d=r(f);
n.deepFreeze=i},{"babel-runtime/core-js/object/freeze":114,"babel-runtime/core-js/object/get-own-property-names":115,"babel-runtime/core-js/object/is-frozen":117,"babel-runtime/helpers/typeof":129}],90:[function(e,t,n){"use strict";function r(e){if(null===e)throw new Error("Panic! Attempted to unwrap null");if(void 0===e)throw new Error("Panic! Attempted to unwrap undefined");return e}Object.defineProperty(n,"__esModule",{value:!0}),n.unwrap=r},{}],91:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("../utils/Delta"),l=function(){function e(){(0,o.default)(this,e);var t=Date.now();this._metricSum=0,this._latestValue=0,this._integralTimestampDelta=new u.Delta(t),this._getterTimestampDelta=new u.Delta(t)}return(0,s.default)(e,[{key:"getAverage",value:function(){var e=Date.now(),t=this._integralTimestampDelta.calcDelta(e),n=this._getterTimestampDelta.calcDelta(e);this._metricSum+=this._latestValue*t;var r=n?this._metricSum/n:this._metricSum;return this._metricSum=0,r}},{key:"updateMetric",value:function(e){var t=Date.now(),n=this._integralTimestampDelta.calcDelta(t);this._metricSum+=this._latestValue*n,this._latestValue=e}}]),e}();n.default=l,t.exports=n.default},{"../utils/Delta":85,"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],92:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.assertStreamType=n.StreamTypes=void 0;var i=e("babel-runtime/core-js/object/values"),o=r(i),a=e("babel-runtime/core-js/object/freeze"),s=r(a),u={HLS:"hls",DASH:"dash",SMOOTH:"smooth"};(0,s.default)(u);var l=function(e){if((0,o.default)(u).indexOf(e)===-1)throw new TypeError('"'+e+'" is not a valid value for stream type.')};n.StreamTypes=u,n.assertStreamType=l},{"babel-runtime/core-js/object/freeze":114,"babel-runtime/core-js/object/values":121}],93:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(){var e=URL.createObjectURL(new Blob(["("+h.default.toString()+")()"],{type:"application/javascript"})),t=new Worker(e);return URL.revokeObjectURL(e),t}function o(e){var t=e.data,n=t.id,r=t.type,i=p[n];"setTimeout"===r&&delete p[n],i&&i()}function a(e,t,n){return m++,p[m]=t,_.postMessage({time:n,id:m,type:e}),m}function s(e,t){delete p[t],_.postMessage({id:t,type:e})}function u(e,t){return a("setTimeout",e,t)}function l(e,t){return a("setInterval",e,t)}function c(e){s("clearTimeout",e)}function f(e){s("clearInterval",e)}Object.defineProperty(n,"__esModule",{value:!0}),n.reliableSetTimeout=u,n.reliableSetInterval=l,n.reliableClearTimeout=c,n.reliableClearInterval=f;var d=e("./TimerWorker"),h=r(d),p={},_=void 0;_=i(),_.onmessage=o;var m=0},{"./TimerWorker":94}],94:[function(e,t,n){"use strict";function r(){function e(e,t){return function(){return self.postMessage({id:e,type:t})}}self.onmessage=function(t){var n=t.data,r=n.type,i=n.id;switch(r){case"setTimeout":var o=n.time;setTimeout(e(i,r),o);break;case"setInterval":var a=n.time;setInterval(e(i,r),a);break;case"clearTimeout":clearTimeout(i);break;case"clearInterval":clearInterval(i)}}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r,t.exports=n.default},{}],95:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/map"),o=r(i),a=e("./TimerAbstraction"),s=function(){var e=this,t=[],n=[],r=new o.default,i=new o.default,s=function(e,n){var r=(0,a.reliableSetTimeout)(function(){u(r),e()},n);return t.push(r),r},u=function(e){for(var n in t)if(t[n]===e){(0,a.reliableClearTimeout)(e),t.splice(n,1);break}},l=function(e,t){var r=(0,a.reliableSetInterval)(e,t);return n.push(r),r},c=function(e){for(var t in n)if(n[t]===e){(0,a.reliableClearInterval)(e),n.splice(t,1);break}},f=function(e,t,n){if(!r.get(e)){var i=(0,a.reliableSetTimeout)(function(){d(e),t()},n);return r.set(e,i),i}return!1},d=function(e){var t=r.get(e);t&&((0,a.reliableClearTimeout)(t),r.delete(e))},h=function(e,t,n){if(!i.get(e)){var r=(0,a.reliableSetInterval)(t,n);return i.set(e,r),r}return!1},p=function(e){var t=i.get(e);t&&((0,a.reliableClearInterval)(t),i.delete(e))},_=function(){t.forEach(function(e){(0,a.reliableClearTimeout)(e)}),t=[],n.forEach(function(e){(0,a.reliableClearInterval)(e)}),n=[],i.forEach(function(e){(0,a.reliableClearInterval)(e)}),i.clear(),r.forEach(function(e){(0,a.reliableClearTimeout)(e)}),r.clear()};e.setTimeout=s,e.clearTimeout=u,e.setInterval=l,e.clearInterval=c,e.clearAll=_,e.setNamedTimeout=f,e.clearNamedTimeout=d,e.setNamedInterval=h,e.clearNamedInterval=p,e._getTimeoutArray=function(){return t},e._getIntervalArray=function(){return n},e._getNamedTimeoutMap=function(){return r},e._getNamedIntervalMap=function(){return i}};t.exports=s},{"./TimerAbstraction":93,"babel-runtime/core-js/map":109}],96:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../defaultConf"),o=(r(i),window.RTCPeerConnection||window.webkitRTCPeerConnection),a=window.RTCIceCandidate,s=window.RTCSessionDescription,u=function(e){return e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:50\r\n"),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:256\r\n"),e=e.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:1638400\r\n")},l=function(e){return new o(c(e),{optional:[{DtlsSrtpKeyAgreement:!0}]})},c=function(e){var t=e.ENABLE_TURN;return t?{iceServers:e.TURNSERVERS.concat(e.STUNSERVERS)}:{iceServers:e.STUNSERVERS}},f=function(e,t,n){e||n("RTCPeerConnection is not defined or null");var r=function(){e.getStats(null,function(e){for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(void 0!==i.mozRtt){t(i.mozRtt);break}}n("Could not find RTT value in stats")},function(){})},i=function(){var r=void 0;e.getStats(function(e){var i,o,a=e.result();for(o=0;o<a.length;o++)if(i=a[o],""!==i.stat("googRtt")){r=i.stat("googRtt"),t(parseFloat(r));break}n("Could not find RTT value in stats")})};navigator.mozGetUserMedia?r():i()};n.default={transformOutgoingSdp:u,createPeerConnection:l,getPeerConnectionRTT:f,IceCandidate:a,SessionDescription:s},t.exports=n.default},{"../../defaultConf":1}],97:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){if(t.cacheSize&&(e.P2P_CACHE_MAX_SIZE=1024*t.cacheSize*1024,e.LIVE.P2P_CACHE_MAX_SIZE=e.P2P_CACHE_MAX_SIZE),void 0!==t.activateP2P&&(e.ALLOW_P2P=!!t.activateP2P),void 0!==t.debug&&(e.DEBUG=!!t.debug),t.signalingUrl&&(e.SIGNALING_URL=t.signalingUrl),t.trackerUrl&&(e.TRACKER_URL=t.trackerUrl),t.analyticsUrl&&(e.ANALYTICS.KLARA_URL=t.analyticsUrl),t.deviceInfo&&(e.DEVICE_INFO=t.deviceInfo),void 0!==t.rangeRequestEnabled&&(e.RANGE_REQUEST_ALLOWED=!!t.rangeRequestEnabled),!t.streamrootKey)throw new Error("There must be a streamrootKey in the P2PConfig object");e.ID_CLIENT=t.streamrootKey,e.P2P_PROTOCOL_VERSION+="-"+n}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../defaultConf");r(o),n.default=i,t.exports=n.default},{"../../defaultConf":1}],98:[function(e,t,n){"use strict";function r(e,t){}function i(e){r("log",e)}function o(e){}Object.defineProperty(n,"__esModule",{value:!0}),n.nativeCall=r,n.nativeLog=i,n.nativeError=o},{}],99:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){var r=u.default.v4();return c[r]=e,(0,l.nativeCall)("set_timer",{timer_id:r,interval:t,repeats:n}),r}function o(e){(0,l.nativeCall)("clear_timer",{timer_id:e})}function a(e){c[e]()}Object.defineProperty(n,"__esModule",{value:!0}),n.clearTimer=n.setTimer=n.timersCallback=void 0;var s=e("uuid"),u=r(s),l=e("./nativeCalls"),c={};n.timersCallback=a,n.setTimer=i,n.clearTimer=o},{"./nativeCalls":98,uuid:230}],100:[function(e,t,n){"use strict";var r=e("ua-parser-js"),i=new r;i.setUA(window.navigator.userAgent);var o=i.getResult();t.exports.isMobile=function(){var e="mobile"===o.device.type||"tablet"===o.device.type||"console"===o.device.type||"Android"===o.os.name||"iOS"===o.os.name;return e},t.exports.uaObject=o},{"ua-parser-js":225}],101:[function(e,t,n){"use strict";function r(){String.prototype.endsWith=function(e){var t=this.toString();return t.lastIndexOf(e)===t.length-1}}function i(e){return e.endsWith("/")?e:e+"/"}Object.defineProperty(n,"__esModule",{value:!0}),n.polyfillEndsWith=r,n.formatUrl=i,String.prototype.endsWith||r()},{}],102:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){var r=document.getElementsByTagName("video");if(1!==r.length)throw new Error("BufferDisplay debug tool requiresa page with a single video");var i=r[0],a=document.createElement("canvas");a.width=i.clientWidth||w;var s=document.getElementById("bufferDisplay");s||(s=document.createElement("div"),document.getElementsByTagName("body")[0].appendChild(s)),s.appendChild(a);var u=o.bind(null,a,i,e,t,n),l=setInterval(u,30),c=function(){clearInterval(l),s.removeChild(a)};return{dispose:c}}function o(e,t,n,r,i){var o=a(n,r);s(e,{video:t,cacheState:o,currentTracks:i})}function a(e,t){var n=t.getTrackList(),r=[],i=!0,o=!1,a=void 0;try{for(var s,u=(0,h.default)(n);!(i=(s=u.next()).done);i=!0){var l=s.value,c=new _.default(t),f=e.listDownloadedSegmentsForTrack(l),d=!0,p=!1,m=void 0;try{for(var v,b=(0,h.default)(f);!(d=(v=b.next()).done);d=!0){var g=v.value;c.addSegmentCoord(g)}}catch(e){p=!0,m=e}finally{try{!d&&b.return&&b.return()}finally{if(p)throw m}}r.push({vbm:c,coord:l})}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return r}function s(e,t){var n=t.video,r=t.cacheState,i=t.currentTracks,o=n.buffered,a=n.currentTime,s=e.getContext("2d");e.height=(m+b)*r.length;var d=1/0,p=0,_=!0,w=!1,S=void 0;try{for(var k,E=(0,h.default)(r);!(_=(k=E.next()).done);_=!0){var T=k.value.vbm;if(T.length){var j=T.start(0),D=T.end(T.length-1);j<d&&(d=j),D>p&&(p=D)}}}catch(e){w=!0,S=e}finally{try{!_&&E.return&&E.return()}finally{if(w)throw S}}if(o.length){var P=o.start(0),I=o.end(o.length-1);P<d&&(d=P),I>p&&(p=I)}for(var M={min:d,max:p,canvasWidth:e.width},A=0;A<r.length;A++){var R=r[A],T=R.vbm,x=R.coord,O=(m+b)*A,N={scale:M,height:m,yPosition:O,color:g};c(s,N,T);var L=O+m/2;if(l(s,x.viewToString(),L),u(x,i)){var $={scale:M,height:v,yPosition:O+(m-v),color:y};c(s,$,o)}}var U={height:e.height,color:C,scale:M};f(s,U,a)}function u(e,t){return e.isEqual(t.video)||e.isEqual(t.audio)}function l(e,t,n){e.fillStyle="green",e.font=k,e.fillText(t,0,n)}function c(e,t,n){for(var r=t.scale,i=t.height,o=t.yPosition,a=t.color,s=0;s<n.length;s++){var u=E(r,n.start(s)),l=E(r,n.end(s)),c=l-u>1?l-u:1;e.fillStyle=a,e.fillRect(u,o,c,i)}}function f(e,t,n){var r=t.color,i=t.scale,o=t.height,a=E(i,n);e.fillStyle=r,e.fillRect(a,0,1,o),e.fillStyle=r,e.font=k,e.fillText(n.toFixed(3),0,o)}Object.defineProperty(n,"__esModule",{value:!0});var d=e("babel-runtime/core-js/get-iterator"),h=r(d),p=e("./VirtualBufferedManager"),_=r(p),m=30,v=10,b=3,g="#97b9e2",y="#202429",C="#bf0101",w=460,S=60,k="12px Arial",E=function(e,t){var n=e.min,r=e.max,i=e.canvasWidth,o=i-S,a=Math.max(r-n,180);return S+(t-n)*o/a};n.default=i,t.exports=n.default},{"./VirtualBufferedManager":103,"babel-runtime/core-js/get-iterator":106}],103:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=function(){function e(t){(0,o.default)(this,e),this._buffered=[],this._mapManager=t}return(0,s.default)(e,[{key:"start",value:function(e){return e in this._buffered?this._buffered[e].start:0}},{key:"end",value:function(e){return e in this._buffered?this._buffered[e].end:0}},{key:"addSegmentCoord",value:function(e){var t=void 0,n=void 0;try{t=this._mapManager.getSegmentTime(e),n=t+this._mapManager.getSegmentDuration(e)}catch(e){return}if(!this._buffered.length)return void this._buffered.push({start:t,end:n});for(var r=void 0,i=void 0,o=0;o<this._buffered.length;o++){var a=this._buffered[o],s=this._buffered[o+1]||{start:1/0,end:1/0};if(a.end===t&&n===s.start){a.end=s.end,r=o+1;break}if(a.end===t&&n!==s.start){a.end=n;break}if(a.end!==t&&n===s.start){s.start=t;break}if(a.end<=t&&n<=s.start){i=o+1;break}}void 0!==r&&this._buffered.splice(r,1),void 0!==i&&this._buffered.splice(i,0,{start:t,end:n})}},{key:"length",get:function(){return this._buffered.length}}]),e}();t.exports=u},{"babel-runtime/helpers/classCallCheck":123,"babel-runtime/helpers/createClass":124}],104:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){var r=document.getElementsByTagName("video");if(1!==r.length)throw new Error("BufferDisplay debug tool requiresa page with a single video");var i=r[0],a=document.createElement("canvas"),s=document.getElementById("chunkDisplay");s||(s=document.createElement("div"),document.getElementsByTagName("body")[0].appendChild(s)),s.appendChild(a);var u=o.bind(null,a,e,t,i,n),l=setInterval(u,30),c=function(){clearInterval(l),s.removeChild(a)};return{dispose:c}}function o(e,t,n,r,i){for(var o=n.getTrackList(),s=new v.default,u=0;u<o.length;u++){var l=o[u];s.set(l,[])}for(var c=t.listSegmentsDownloadStatus(),d=i.getSegmentListToDownload(),h=0;h<c.length;h++)for(var p=c[h],m=p.segmentcoord,b=p.downloadStatusList,g=p.seederCount,y=0;y<o.length;y++){var C=o[y];if(m.isInTrack(C)){var w=f(b);try{for(var S=n.getSegmentTime(m),k=!1,E=0;E<d.length;E++)if(d[E].isEqual(m)){d.splice(E,1),k=!0;break}s.get(C).push({segmentAreas:w,id:m.viewToString(),time:S,length:b.length,seederCount:g,inSchedulerList:k})}catch(e){}}}var T=!0,j=!1,D=void 0;try{for(var P,I=(0,_.default)(d);!(T=(P=I.next()).done);T=!0){var M=P.value,A=!0,R=!1,x=void 0;try{for(var O,N=(0,_.default)(o);!(A=(O=N.next()).done);A=!0){var L=O.value;if(M.isInTrack(L)){var $=n.getSegmentTime(M);s.get(L).push({id:M.viewToString(),time:$,seederCount:0,inSchedulerList:!0})}}}catch(e){R=!0,x=e}finally{try{!A&&N.return&&N.return()}finally{if(R)throw x}}}}catch(e){j=!0,D=e}finally{try{!T&&I.return&&I.return()}finally{if(j)throw D}}a(e,s,r.currentTime)}function a(e,t,n){e.height=1e3,e.width=D*t.size;var r=void 0,i=e.getContext("2d"),o=0,a=!0,c=!1,f=void 0;try{for(var d,p=(0,_.default)(t);!(a=(d=p.next()).done);a=!0){var m=(0,h.default)(d.value,2),v=m[0],b=m[1];r=S,s(i,v,r,o);var g=!0,C=!1,w=void 0;try{for(var k,E=(0,_.default)(b);!(g=(k=E.next()).done);g=!0){var P=k.value,I=P.id,M=P.time,A=P.segmentAreas,R=P.length,x=P.seederCount,O=P.inSchedulerList;M>n-j&&(r+=T,A&&l(i,A,R,r,o),u(i,{id:I,time:M,seederCount:x,inSchedulerList:O},r,o),r+=y)}}catch(e){C=!0,w=e}finally{try{!g&&E.return&&E.return()}finally{if(C)throw w}}o++}}catch(e){c=!0,f=e}finally{try{!a&&p.return&&p.return()}finally{if(c)throw f}}}function s(e,t,n,r){var i=D*r;e.fillStyle=C,e.font=k,e.fillText(t.viewToString(),i,n)}function u(e,t,n,r){var i=t.id,o=t.time,a=t.seederCount,s=t.inSchedulerList,u=D*r;e.fillStyle=w,e.font=s?E:k,e.fillText(i+"  --  "+o.toFixed(1)+" -- "+a,u,n+y)}function l(e,t,n,r,i){var o=D*i,a=0,s=!0,u=!1,l=void 0;try{for(var f,d=(0,_.default)(t);!(s=(f=d.next()).done);s=!0){var h=f.value,p=(h.end-h.start)*g/n;e.fillStyle=c(h.status),e.fillRect(o+b+a,r,p,y),a+=p}}catch(e){u=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw l}}t.length||(e.fillStyle="#D490D4",e.fillRect(o+b,r,g,y))}function c(e){switch(e){case"pending":return"gray";case"downloading":return"blue";case"downloaded":return"green";case"CDNdownloaded":return"orange";case"failed":return"red"}}function f(e){for(var t=void 0,n=[],r=0;r<e.length;r++){var i=e[r];if(t===i)n[n.length-1].end++;else{var o={start:r,end:r+1,status:i};t=i,n.push(o)}}return n}Object.defineProperty(n,"__esModule",{value:!0});var d=e("babel-runtime/helpers/slicedToArray"),h=r(d),p=e("babel-runtime/core-js/get-iterator"),_=r(p),m=e("babel-runtime/core-js/map"),v=r(m),b=100,g=100,y=15,C="red",w="black",S=15,k=S+"px Arial",E="bold "+k,T=5,j=10,D=b+g+20;n.default=i,t.exports=n.default},{"babel-runtime/core-js/get-iterator":106,"babel-runtime/core-js/map":109,"babel-runtime/helpers/slicedToArray":127}],105:[function(e,t,n){t.exports={default:e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":130}],106:[function(e,t,n){t.exports={default:e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":131}],107:[function(e,t,n){t.exports={default:e("core-js/library/fn/is-iterable"),__esModule:!0}},{"core-js/library/fn/is-iterable":132}],108:[function(e,t,n){t.exports={default:e("core-js/library/fn/json/stringify"),__esModule:!0}},{"core-js/library/fn/json/stringify":133}],109:[function(e,t,n){t.exports={default:e("core-js/library/fn/map"),__esModule:!0}},{"core-js/library/fn/map":134}],110:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":135}],111:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":136}],112:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/define-properties"),__esModule:!0}},{"core-js/library/fn/object/define-properties":137}],113:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":138}],114:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/freeze"),__esModule:!0}},{"core-js/library/fn/object/freeze":139}],115:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/get-own-property-names"),__esModule:!0}},{"core-js/library/fn/object/get-own-property-names":140}],116:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":141}],117:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/is-frozen"),__esModule:!0}},{"core-js/library/fn/object/is-frozen":142}],118:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":143}],119:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/seal"),__esModule:!0}},{"core-js/library/fn/object/seal":144}],120:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":145}],121:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/values"),__esModule:!0}},{"core-js/library/fn/object/values":146}],122:[function(e,t,n){t.exports={default:e("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":147}],123:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],124:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../core-js/object/define-property"),o=r(i);n.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},{"../core-js/object/define-property":113}],125:[function(e,t,n){"use strict";var r=e("babel-runtime/core-js/object/create").default,i=e("babel-runtime/core-js/object/set-prototype-of").default;n.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=r(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i?i(e,t):e.__proto__=t)},n.__esModule=!0},{"babel-runtime/core-js/object/create":111,"babel-runtime/core-js/object/set-prototype-of":120}],126:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../helpers/typeof"),o=r(i);n.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":(0,o.default)(t))&&"function"!=typeof t?e:t}},{"../helpers/typeof":129}],127:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../core-js/is-iterable"),o=r(i),a=e("../core-js/get-iterator"),s=r(a);n.default=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=(0,s.default)(e);!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if((0,o.default)(Object(t)))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},{"../core-js/get-iterator":106,"../core-js/is-iterable":107}],128:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../core-js/array/from"),o=r(i);n.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,o.default)(e)}},{"../core-js/array/from":105}],129:[function(e,t,n){"use strict";var r=e("babel-runtime/core-js/symbol").default;n.default=function(e){return e&&e.constructor===r?"symbol":typeof e},n.__esModule=!0},{"babel-runtime/core-js/symbol":122}],130:[function(e,t,n){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/$.core").Array.from},{"../../modules/$.core":156,"../../modules/es6.array.from":202,"../../modules/es6.string.iterator":214}],131:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":200,"../modules/es6.string.iterator":214,"../modules/web.dom.iterable":218}],132:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.is-iterable")},{"../modules/core.is-iterable":201,"../modules/es6.string.iterator":214,"../modules/web.dom.iterable":218}],133:[function(e,t,n){var r=e("../../modules/$.core");t.exports=function(e){return(r.JSON&&r.JSON.stringify||JSON.stringify).apply(JSON,arguments)}},{"../../modules/$.core":156}],134:[function(e,t,n){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.map"),e("../modules/es7.map.to-json"),t.exports=e("../modules/$.core").Map},{"../modules/$.core":156,"../modules/es6.map":204,"../modules/es6.object.to-string":213,"../modules/es6.string.iterator":214,"../modules/es7.map.to-json":216,"../modules/web.dom.iterable":218}],135:[function(e,t,n){e("../../modules/es6.object.assign"),t.exports=e("../../modules/$.core").Object.assign},{"../../modules/$.core":156,"../../modules/es6.object.assign":205}],136:[function(e,t,n){var r=e("../../modules/$");t.exports=function(e,t){return r.create(e,t)}},{"../../modules/$":178}],137:[function(e,t,n){var r=e("../../modules/$");t.exports=function(e,t){return r.setDescs(e,t)}},{"../../modules/$":178}],138:[function(e,t,n){var r=e("../../modules/$");t.exports=function(e,t,n){return r.setDesc(e,t,n)}},{"../../modules/$":178}],139:[function(e,t,n){e("../../modules/es6.object.freeze"),t.exports=e("../../modules/$.core").Object.freeze},{"../../modules/$.core":156,"../../modules/es6.object.freeze":206}],140:[function(e,t,n){var r=e("../../modules/$");e("../../modules/es6.object.get-own-property-names"),t.exports=function(e){return r.getNames(e)}},{"../../modules/$":178,"../../modules/es6.object.get-own-property-names":207}],141:[function(e,t,n){e("../../modules/es6.object.get-prototype-of"),t.exports=e("../../modules/$.core").Object.getPrototypeOf},{"../../modules/$.core":156,"../../modules/es6.object.get-prototype-of":208}],142:[function(e,t,n){e("../../modules/es6.object.is-frozen"),t.exports=e("../../modules/$.core").Object.isFrozen},{"../../modules/$.core":156,"../../modules/es6.object.is-frozen":209}],143:[function(e,t,n){e("../../modules/es6.object.keys"),t.exports=e("../../modules/$.core").Object.keys},{"../../modules/$.core":156,"../../modules/es6.object.keys":210}],144:[function(e,t,n){e("../../modules/es6.object.seal"),t.exports=e("../../modules/$.core").Object.seal},{"../../modules/$.core":156,"../../modules/es6.object.seal":211}],145:[function(e,t,n){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/$.core").Object.setPrototypeOf},{"../../modules/$.core":156,"../../modules/es6.object.set-prototype-of":212}],146:[function(e,t,n){e("../../modules/es7.object.values"),t.exports=e("../../modules/$.core").Object.values},{"../../modules/$.core":156,"../../modules/es7.object.values":217}],147:[function(e,t,n){e("../../modules/es6.symbol"),e("../../modules/es6.object.to-string"),t.exports=e("../../modules/$.core").Symbol},{"../../modules/$.core":156,"../../modules/es6.object.to-string":213,"../../modules/es6.symbol":215}],148:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],149:[function(e,t,n){t.exports=function(){}},{}],150:[function(e,t,n){var r=e("./$.is-object");t.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},{"./$.is-object":171}],151:[function(e,t,n){var r=e("./$.cof"),i=e("./$.wks")("toStringTag"),o="Arguments"==r(function(){return arguments}());t.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=(t=Object(e))[i])?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},{"./$.cof":152,"./$.wks":198}],152:[function(e,t,n){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],153:[function(e,t,n){"use strict";var r=e("./$"),i=e("./$.hide"),o=e("./$.redefine-all"),a=e("./$.ctx"),s=e("./$.strict-new"),u=e("./$.defined"),l=e("./$.for-of"),c=e("./$.iter-define"),f=e("./$.iter-step"),d=e("./$.uid")("id"),h=e("./$.has"),p=e("./$.is-object"),_=e("./$.set-species"),m=e("./$.descriptors"),v=Object.isExtensible||p,b=m?"_s":"size",g=0,y=function(e,t){if(!p(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!h(e,d)){if(!v(e))return"F";if(!t)return"E";i(e,d,++g)}return"O"+e[d]},C=function(e,t){var n,r=y(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};t.exports={getConstructor:function(e,t,n,i){var c=e(function(e,o){s(e,c,t),e._i=r.create(null),e._f=void 0,e._l=void 0,e[b]=0,void 0!=o&&l(o,n,e[i],e)});return o(c.prototype,{clear:function(){for(var e=this,t=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete t[n.i];e._f=e._l=void 0,e[b]=0},delete:function(e){var t=this,n=C(t,e);if(n){var r=n.n,i=n.p;delete t._i[n.i],n.r=!0,i&&(i.n=r),r&&(r.p=i),t._f==n&&(t._f=r),t._l==n&&(t._l=i),t[b]--}return!!n},forEach:function(e){for(var t,n=a(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.n:this._f;)for(n(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!C(this,e)}}),m&&r.setDesc(c.prototype,"size",{get:function(){return u(this[b])}}),c},def:function(e,t,n){var r,i,o=C(e,t);return o?o.v=n:(e._l=o={i:i=y(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[b]++,"F"!==i&&(e._i[i]=o)),e},getEntry:C,setStrong:function(e,t,n){c(e,t,function(e,t){this._t=e,this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?"keys"==t?f(0,n.k):"values"==t?f(0,n.v):f(0,[n.k,n.v]):(e._t=void 0,f(1))},n?"entries":"values",!n,!0),_(t)}}},{"./$":178,"./$.ctx":157,"./$.defined":158,"./$.descriptors":159,"./$.for-of":163,"./$.has":166,"./$.hide":167,"./$.is-object":171,"./$.iter-define":174,"./$.iter-step":176,"./$.redefine-all":185,"./$.set-species":188,"./$.strict-new":191,"./$.uid":197}],154:[function(e,t,n){var r=e("./$.for-of"),i=e("./$.classof");t.exports=function(e){return function(){if(i(this)!=e)throw TypeError(e+"#toJSON isn't generic");var t=[];return r(this,!1,t.push,t),t}}},{"./$.classof":151,"./$.for-of":163}],155:[function(e,t,n){"use strict";var r=e("./$"),i=e("./$.global"),o=e("./$.export"),a=e("./$.fails"),s=e("./$.hide"),u=e("./$.redefine-all"),l=e("./$.for-of"),c=e("./$.strict-new"),f=e("./$.is-object"),d=e("./$.set-to-string-tag"),h=e("./$.descriptors");t.exports=function(e,t,n,p,_,m){var v=i[e],b=v,g=_?"set":"add",y=b&&b.prototype,C={};return h&&"function"==typeof b&&(m||y.forEach&&!a(function(){(new b).entries().next()}))?(b=t(function(t,n){c(t,b,e),t._c=new v,void 0!=n&&l(n,_,t[g],t)}),r.each.call("add,clear,delete,forEach,get,has,set,keys,values,entries".split(","),function(e){var t="add"==e||"set"==e;e in y&&(!m||"clear"!=e)&&s(b.prototype,e,function(n,r){if(!t&&m&&!f(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,r);return t?this:i})}),"size"in y&&r.setDesc(b.prototype,"size",{get:function(){return this._c.size}})):(b=p.getConstructor(t,e,_,g),u(b.prototype,n)),d(b,e),C[e]=b,o(o.G+o.W+o.F,C),m||p.setStrong(b,e,_),b}},{"./$":178,"./$.descriptors":159,"./$.export":161,"./$.fails":162,"./$.for-of":163,"./$.global":165,"./$.hide":167,"./$.is-object":171,"./$.redefine-all":185,"./$.set-to-string-tag":189,"./$.strict-new":191}],156:[function(e,t,n){var r=t.exports={version:"1.2.6"};"number"==typeof __e&&(__e=r)},{}],157:[function(e,t,n){var r=e("./$.a-function");t.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},{"./$.a-function":148}],158:[function(e,t,n){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],159:[function(e,t,n){t.exports=!e("./$.fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./$.fails":162}],160:[function(e,t,n){var r=e("./$");t.exports=function(e){var t=r.getKeys(e),n=r.getSymbols;if(n)for(var i,o=n(e),a=r.isEnum,s=0;o.length>s;)a.call(e,i=o[s++])&&t.push(i);return t}},{"./$":178}],161:[function(e,t,n){var r=e("./$.global"),i=e("./$.core"),o=e("./$.ctx"),a="prototype",s=function(e,t,n){var u,l,c,f=e&s.F,d=e&s.G,h=e&s.S,p=e&s.P,_=e&s.B,m=e&s.W,v=d?i:i[t]||(i[t]={}),b=d?r:h?r[t]:(r[t]||{})[a];d&&(n=t);for(u in n)l=!f&&b&&u in b,l&&u in v||(c=l?b[u]:n[u],v[u]=d&&"function"!=typeof b[u]?n[u]:_&&l?o(c,r):m&&b[u]==c?function(e){var t=function(t){return this instanceof e?new e(t):e(t)};return t[a]=e[a],t}(c):p&&"function"==typeof c?o(Function.call,c):c,p&&((v[a]||(v[a]={}))[u]=c))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,t.exports=s},{"./$.core":156,"./$.ctx":157,"./$.global":165}],162:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],163:[function(e,t,n){var r=e("./$.ctx"),i=e("./$.iter-call"),o=e("./$.is-array-iter"),a=e("./$.an-object"),s=e("./$.to-length"),u=e("./core.get-iterator-method");t.exports=function(e,t,n,l){var c,f,d,h=u(e),p=r(n,l,t?2:1),_=0;if("function"!=typeof h)throw TypeError(e+" is not iterable!");if(o(h))for(c=s(e.length);c>_;_++)t?p(a(f=e[_])[0],f[1]):p(e[_]);else for(d=h.call(e);!(f=d.next()).done;)i(d,p,f.value,t)}},{"./$.an-object":150,"./$.ctx":157,"./$.is-array-iter":169,"./$.iter-call":172,"./$.to-length":195,"./core.get-iterator-method":199}],164:[function(e,t,n){var r=e("./$.to-iobject"),i=e("./$").getNames,o={}.toString,a="object"==typeof window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(e){try{return i(e)}catch(e){return a.slice()}};t.exports.get=function(e){return a&&"[object Window]"==o.call(e)?s(e):i(r(e))}},{"./$":178,"./$.to-iobject":194}],165:[function(e,t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],166:[function(e,t,n){var r={}.hasOwnProperty;t.exports=function(e,t){
return r.call(e,t)}},{}],167:[function(e,t,n){var r=e("./$"),i=e("./$.property-desc");t.exports=e("./$.descriptors")?function(e,t,n){return r.setDesc(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},{"./$":178,"./$.descriptors":159,"./$.property-desc":184}],168:[function(e,t,n){var r=e("./$.cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},{"./$.cof":152}],169:[function(e,t,n){var r=e("./$.iterators"),i=e("./$.wks")("iterator"),o=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},{"./$.iterators":177,"./$.wks":198}],170:[function(e,t,n){var r=e("./$.cof");t.exports=Array.isArray||function(e){return"Array"==r(e)}},{"./$.cof":152}],171:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],172:[function(e,t,n){var r=e("./$.an-object");t.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},{"./$.an-object":150}],173:[function(e,t,n){"use strict";var r=e("./$"),i=e("./$.property-desc"),o=e("./$.set-to-string-tag"),a={};e("./$.hide")(a,e("./$.wks")("iterator"),function(){return this}),t.exports=function(e,t,n){e.prototype=r.create(a,{next:i(1,n)}),o(e,t+" Iterator")}},{"./$":178,"./$.hide":167,"./$.property-desc":184,"./$.set-to-string-tag":189,"./$.wks":198}],174:[function(e,t,n){"use strict";var r=e("./$.library"),i=e("./$.export"),o=e("./$.redefine"),a=e("./$.hide"),s=e("./$.has"),u=e("./$.iterators"),l=e("./$.iter-create"),c=e("./$.set-to-string-tag"),f=e("./$").getProto,d=e("./$.wks")("iterator"),h=!([].keys&&"next"in[].keys()),p="@@iterator",_="keys",m="values",v=function(){return this};t.exports=function(e,t,n,b,g,y,C){l(n,t,b);var w,S,k=function(e){if(!h&&e in D)return D[e];switch(e){case _:return function(){return new n(this,e)};case m:return function(){return new n(this,e)}}return function(){return new n(this,e)}},E=t+" Iterator",T=g==m,j=!1,D=e.prototype,P=D[d]||D[p]||g&&D[g],I=P||k(g);if(P){var M=f(I.call(new e));c(M,E,!0),!r&&s(D,p)&&a(M,d,v),T&&P.name!==m&&(j=!0,I=function(){return P.call(this)})}if(r&&!C||!h&&!j&&D[d]||a(D,d,I),u[t]=I,u[E]=v,g)if(w={values:T?I:k(m),keys:y?I:k(_),entries:T?k("entries"):I},C)for(S in w)S in D||o(D,S,w[S]);else i(i.P+i.F*(h||j),t,w);return w}},{"./$":178,"./$.export":161,"./$.has":166,"./$.hide":167,"./$.iter-create":173,"./$.iterators":177,"./$.library":180,"./$.redefine":186,"./$.set-to-string-tag":189,"./$.wks":198}],175:[function(e,t,n){var r=e("./$.wks")("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],a=o[r]();a.next=function(){return{done:n=!0}},o[r]=function(){return a},e(o)}catch(e){}return n}},{"./$.wks":198}],176:[function(e,t,n){t.exports=function(e,t){return{value:t,done:!!e}}},{}],177:[function(e,t,n){t.exports={}},{}],178:[function(e,t,n){var r=Object;t.exports={create:r.create,getProto:r.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:r.getOwnPropertyDescriptor,setDesc:r.defineProperty,setDescs:r.defineProperties,getKeys:r.keys,getNames:r.getOwnPropertyNames,getSymbols:r.getOwnPropertySymbols,each:[].forEach}},{}],179:[function(e,t,n){var r=e("./$"),i=e("./$.to-iobject");t.exports=function(e,t){for(var n,o=i(e),a=r.getKeys(o),s=a.length,u=0;s>u;)if(o[n=a[u++]]===t)return n}},{"./$":178,"./$.to-iobject":194}],180:[function(e,t,n){t.exports=!0},{}],181:[function(e,t,n){var r=e("./$"),i=e("./$.to-object"),o=e("./$.iobject");t.exports=e("./$.fails")(function(){var e=Object.assign,t={},n={},r=Symbol(),i="abcdefghijklmnopqrst";return t[r]=7,i.split("").forEach(function(e){n[e]=e}),7!=e({},t)[r]||Object.keys(e({},n)).join("")!=i})?function(e,t){for(var n=i(e),a=arguments,s=a.length,u=1,l=r.getKeys,c=r.getSymbols,f=r.isEnum;s>u;)for(var d,h=o(a[u++]),p=c?l(h).concat(c(h)):l(h),_=p.length,m=0;_>m;)f.call(h,d=p[m++])&&(n[d]=h[d]);return n}:Object.assign},{"./$":178,"./$.fails":162,"./$.iobject":168,"./$.to-object":196}],182:[function(e,t,n){var r=e("./$.export"),i=e("./$.core"),o=e("./$.fails");t.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],a={};a[e]=t(n),r(r.S+r.F*o(function(){n(1)}),"Object",a)}},{"./$.core":156,"./$.export":161,"./$.fails":162}],183:[function(e,t,n){var r=e("./$"),i=e("./$.to-iobject"),o=r.isEnum;t.exports=function(e){return function(t){for(var n,a=i(t),s=r.getKeys(a),u=s.length,l=0,c=[];u>l;)o.call(a,n=s[l++])&&c.push(e?[n,a[n]]:a[n]);return c}}},{"./$":178,"./$.to-iobject":194}],184:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],185:[function(e,t,n){var r=e("./$.redefine");t.exports=function(e,t){for(var n in t)r(e,n,t[n]);return e}},{"./$.redefine":186}],186:[function(e,t,n){t.exports=e("./$.hide")},{"./$.hide":167}],187:[function(e,t,n){var r=e("./$").getDesc,i=e("./$.is-object"),o=e("./$.an-object"),a=function(e,t){if(o(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,i){try{i=e("./$.ctx")(Function.call,r(Object.prototype,"__proto__").set,2),i(t,[]),n=!(t instanceof Array)}catch(e){n=!0}return function(e,t){return a(e,t),n?e.__proto__=t:i(e,t),e}}({},!1):void 0),check:a}},{"./$":178,"./$.an-object":150,"./$.ctx":157,"./$.is-object":171}],188:[function(e,t,n){"use strict";var r=e("./$.core"),i=e("./$"),o=e("./$.descriptors"),a=e("./$.wks")("species");t.exports=function(e){var t=r[e];o&&t&&!t[a]&&i.setDesc(t,a,{configurable:!0,get:function(){return this}})}},{"./$":178,"./$.core":156,"./$.descriptors":159,"./$.wks":198}],189:[function(e,t,n){var r=e("./$").setDesc,i=e("./$.has"),o=e("./$.wks")("toStringTag");t.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},{"./$":178,"./$.has":166,"./$.wks":198}],190:[function(e,t,n){var r=e("./$.global"),i="__core-js_shared__",o=r[i]||(r[i]={});t.exports=function(e){return o[e]||(o[e]={})}},{"./$.global":165}],191:[function(e,t,n){t.exports=function(e,t,n){if(!(e instanceof t))throw TypeError(n+": use the 'new' operator!");return e}},{}],192:[function(e,t,n){var r=e("./$.to-integer"),i=e("./$.defined");t.exports=function(e){return function(t,n){var o,a,s=String(i(t)),u=r(n),l=s.length;return u<0||u>=l?e?"":void 0:(o=s.charCodeAt(u),o<55296||o>56319||u+1===l||(a=s.charCodeAt(u+1))<56320||a>57343?e?s.charAt(u):o:e?s.slice(u,u+2):(o-55296<<10)+(a-56320)+65536)}}},{"./$.defined":158,"./$.to-integer":193}],193:[function(e,t,n){var r=Math.ceil,i=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)}},{}],194:[function(e,t,n){var r=e("./$.iobject"),i=e("./$.defined");t.exports=function(e){return r(i(e))}},{"./$.defined":158,"./$.iobject":168}],195:[function(e,t,n){var r=e("./$.to-integer"),i=Math.min;t.exports=function(e){return e>0?i(r(e),9007199254740991):0}},{"./$.to-integer":193}],196:[function(e,t,n){var r=e("./$.defined");t.exports=function(e){return Object(r(e))}},{"./$.defined":158}],197:[function(e,t,n){var r=0,i=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+i).toString(36))}},{}],198:[function(e,t,n){var r=e("./$.shared")("wks"),i=e("./$.uid"),o=e("./$.global").Symbol;t.exports=function(e){return r[e]||(r[e]=o&&o[e]||(o||i)("Symbol."+e))}},{"./$.global":165,"./$.shared":190,"./$.uid":197}],199:[function(e,t,n){var r=e("./$.classof"),i=e("./$.wks")("iterator"),o=e("./$.iterators");t.exports=e("./$.core").getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||o[r(e)]}},{"./$.classof":151,"./$.core":156,"./$.iterators":177,"./$.wks":198}],200:[function(e,t,n){var r=e("./$.an-object"),i=e("./core.get-iterator-method");t.exports=e("./$.core").getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},{"./$.an-object":150,"./$.core":156,"./core.get-iterator-method":199}],201:[function(e,t,n){var r=e("./$.classof"),i=e("./$.wks")("iterator"),o=e("./$.iterators");t.exports=e("./$.core").isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||o.hasOwnProperty(r(t))}},{"./$.classof":151,"./$.core":156,"./$.iterators":177,"./$.wks":198}],202:[function(e,t,n){"use strict";var r=e("./$.ctx"),i=e("./$.export"),o=e("./$.to-object"),a=e("./$.iter-call"),s=e("./$.is-array-iter"),u=e("./$.to-length"),l=e("./core.get-iterator-method");i(i.S+i.F*!e("./$.iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,c,f=o(e),d="function"==typeof this?this:Array,h=arguments,p=h.length,_=p>1?h[1]:void 0,m=void 0!==_,v=0,b=l(f);if(m&&(_=r(_,p>2?h[2]:void 0,2)),void 0==b||d==Array&&s(b))for(t=u(f.length),n=new d(t);t>v;v++)n[v]=m?_(f[v],v):f[v];else for(c=b.call(f),n=new d;!(i=c.next()).done;v++)n[v]=m?a(c,_,[i.value,v],!0):i.value;return n.length=v,n}})},{"./$.ctx":157,"./$.export":161,"./$.is-array-iter":169,"./$.iter-call":172,"./$.iter-detect":175,"./$.to-length":195,"./$.to-object":196,"./core.get-iterator-method":199}],203:[function(e,t,n){"use strict";var r=e("./$.add-to-unscopables"),i=e("./$.iter-step"),o=e("./$.iterators"),a=e("./$.to-iobject");t.exports=e("./$.iter-define")(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,n):"values"==t?i(0,e[n]):i(0,[n,e[n]])},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},{"./$.add-to-unscopables":149,"./$.iter-define":174,"./$.iter-step":176,"./$.iterators":177,"./$.to-iobject":194}],204:[function(e,t,n){"use strict";var r=e("./$.collection-strong");e("./$.collection")("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(this,e);return t&&t.v},set:function(e,t){return r.def(this,0===e?0:e,t)}},r,!0)},{"./$.collection":155,"./$.collection-strong":153}],205:[function(e,t,n){var r=e("./$.export");r(r.S+r.F,"Object",{assign:e("./$.object-assign")})},{"./$.export":161,"./$.object-assign":181}],206:[function(e,t,n){var r=e("./$.is-object");e("./$.object-sap")("freeze",function(e){return function(t){return e&&r(t)?e(t):t}})},{"./$.is-object":171,"./$.object-sap":182}],207:[function(e,t,n){e("./$.object-sap")("getOwnPropertyNames",function(){return e("./$.get-names").get})},{"./$.get-names":164,"./$.object-sap":182}],208:[function(e,t,n){var r=e("./$.to-object");e("./$.object-sap")("getPrototypeOf",function(e){return function(t){return e(r(t))}})},{"./$.object-sap":182,"./$.to-object":196}],209:[function(e,t,n){var r=e("./$.is-object");e("./$.object-sap")("isFrozen",function(e){return function(t){return!r(t)||!!e&&e(t)}})},{"./$.is-object":171,"./$.object-sap":182}],210:[function(e,t,n){var r=e("./$.to-object");e("./$.object-sap")("keys",function(e){return function(t){return e(r(t))}})},{"./$.object-sap":182,"./$.to-object":196}],211:[function(e,t,n){var r=e("./$.is-object");e("./$.object-sap")("seal",function(e){return function(t){return e&&r(t)?e(t):t}})},{"./$.is-object":171,"./$.object-sap":182}],212:[function(e,t,n){var r=e("./$.export");r(r.S,"Object",{setPrototypeOf:e("./$.set-proto").set})},{"./$.export":161,"./$.set-proto":187}],213:[function(e,t,n){},{}],214:[function(e,t,n){"use strict";var r=e("./$.string-at")(!0);e("./$.iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},{"./$.iter-define":174,"./$.string-at":192}],215:[function(e,t,n){"use strict";var r=e("./$"),i=e("./$.global"),o=e("./$.has"),a=e("./$.descriptors"),s=e("./$.export"),u=e("./$.redefine"),l=e("./$.fails"),c=e("./$.shared"),f=e("./$.set-to-string-tag"),d=e("./$.uid"),h=e("./$.wks"),p=e("./$.keyof"),_=e("./$.get-names"),m=e("./$.enum-keys"),v=e("./$.is-array"),b=e("./$.an-object"),g=e("./$.to-iobject"),y=e("./$.property-desc"),C=r.getDesc,w=r.setDesc,S=r.create,k=_.get,E=i.Symbol,T=i.JSON,j=T&&T.stringify,D=!1,P=h("_hidden"),I=r.isEnum,M=c("symbol-registry"),A=c("symbols"),R="function"==typeof E,x=Object.prototype,O=a&&l(function(){return 7!=S(w({},"a",{get:function(){return w(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=C(x,t);r&&delete x[t],w(e,t,n),r&&e!==x&&w(x,t,r)}:w,N=function(e){var t=A[e]=S(E.prototype);return t._k=e,a&&D&&O(x,e,{configurable:!0,set:function(t){o(this,P)&&o(this[P],e)&&(this[P][e]=!1),O(this,e,y(1,t))}}),t},L=function(e){return"symbol"==typeof e},$=function(e,t,n){return n&&o(A,t)?(n.enumerable?(o(e,P)&&e[P][t]&&(e[P][t]=!1),n=S(n,{enumerable:y(0,!1)})):(o(e,P)||w(e,P,y(1,{})),e[P][t]=!0),O(e,t,n)):w(e,t,n)},U=function(e,t){b(e);for(var n,r=m(t=g(t)),i=0,o=r.length;o>i;)$(e,n=r[i++],t[n]);return e},H=function(e,t){return void 0===t?S(e):U(S(e),t)},B=function(e){var t=I.call(this,e);return!(t||!o(this,e)||!o(A,e)||o(this,P)&&this[P][e])||t},F=function(e,t){var n=C(e=g(e),t);return!n||!o(A,t)||o(e,P)&&e[P][t]||(n.enumerable=!0),n},q=function(e){for(var t,n=k(g(e)),r=[],i=0;n.length>i;)o(A,t=n[i++])||t==P||r.push(t);return r},V=function(e){for(var t,n=k(g(e)),r=[],i=0;n.length>i;)o(A,t=n[i++])&&r.push(A[t]);return r},z=function(e){if(void 0!==e&&!L(e)){for(var t,n,r=[e],i=1,o=arguments;o.length>i;)r.push(o[i++]);return t=r[1],"function"==typeof t&&(n=t),!n&&v(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!L(t))return t}),r[1]=t,j.apply(T,r)}},K=l(function(){var e=E();return"[null]"!=j([e])||"{}"!=j({a:e})||"{}"!=j(Object(e))});R||(E=function(){if(L(this))throw TypeError("Symbol is not a constructor");return N(d(arguments.length>0?arguments[0]:void 0))},u(E.prototype,"toString",function(){return this._k}),L=function(e){return e instanceof E},r.create=H,r.isEnum=B,r.getDesc=F,r.setDesc=$,r.setDescs=U,r.getNames=_.get=q,r.getSymbols=V,a&&!e("./$.library")&&u(x,"propertyIsEnumerable",B,!0));var G={for:function(e){return o(M,e+="")?M[e]:M[e]=E(e)},keyFor:function(e){return p(M,e)},useSetter:function(){D=!0},useSimple:function(){D=!1}};r.each.call("hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),function(e){var t=h(e);G[e]=R?t:N(t)}),D=!0,s(s.G+s.W,{Symbol:E}),s(s.S,"Symbol",G),s(s.S+s.F*!R,"Object",{create:H,defineProperty:$,defineProperties:U,getOwnPropertyDescriptor:F,getOwnPropertyNames:q,getOwnPropertySymbols:V}),T&&s(s.S+s.F*(!R||K),"JSON",{stringify:z}),f(E,"Symbol"),f(Math,"Math",!0),f(i.JSON,"JSON",!0)},{"./$":178,"./$.an-object":150,"./$.descriptors":159,"./$.enum-keys":160,"./$.export":161,"./$.fails":162,"./$.get-names":164,"./$.global":165,"./$.has":166,"./$.is-array":170,"./$.keyof":179,"./$.library":180,"./$.property-desc":184,"./$.redefine":186,"./$.set-to-string-tag":189,"./$.shared":190,"./$.to-iobject":194,"./$.uid":197,"./$.wks":198}],216:[function(e,t,n){var r=e("./$.export");r(r.P,"Map",{toJSON:e("./$.collection-to-json")("Map")})},{"./$.collection-to-json":154,"./$.export":161}],217:[function(e,t,n){var r=e("./$.export"),i=e("./$.object-to-array")(!1);r(r.S,"Object",{values:function(e){return i(e)}})},{"./$.export":161,"./$.object-to-array":183}],218:[function(e,t,n){e("./es6.array.iterator");var r=e("./$.iterators");r.NodeList=r.HTMLCollection=r.Array},{"./$.iterators":177,"./es6.array.iterator":203}],219:[function(e,t,n){"use strict";function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){}var o=Object.prototype.hasOwnProperty,a="function"!=typeof Object.create&&"~";i.prototype._events=void 0,i.prototype.eventNames=function(){var e,t=this._events,n=[];if(!t)return n;for(e in t)o.call(t,e)&&n.push(a?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},i.prototype.listeners=function(e,t){var n=a?a+e:e,r=this._events&&this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s},i.prototype.emit=function(e,t,n,r,i,o){var s=a?a+e:e;if(!this._events||!this._events[s])return!1;var u,l,c=this._events[s],f=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,o),!0}for(l=1,u=new Array(f-1);l<f;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var d,h=c.length;for(l=0;l<h;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;default:if(!u)for(d=1,u=new Array(f-1);d<f;d++)u[d-1]=arguments[d];c[l].fn.apply(c[l].context,u)}}return!0},i.prototype.on=function(e,t,n){var i=new r(t,n||this),o=a?a+e:e;return this._events||(this._events=a?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],i]:this._events[o].push(i):this._events[o]=i,this},i.prototype.once=function(e,t,n){var i=new r(t,n||this,!0),o=a?a+e:e;return this._events||(this._events=a?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],i]:this._events[o].push(i):this._events[o]=i,this},i.prototype.removeListener=function(e,t,n,r){var i=a?a+e:e;if(!this._events||!this._events[i])return this;var o=this._events[i],s=[];if(t)if(o.fn)(o.fn!==t||r&&!o.once||n&&o.context!==n)&&s.push(o);else for(var u=0,l=o.length;u<l;u++)(o[u].fn!==t||r&&!o[u].once||n&&o[u].context!==n)&&s.push(o[u]);return s.length?this._events[i]=1===s.length?s[0]:s:delete this._events[i],this},i.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[a?a+e:e]:this._events=a?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=a,"undefined"!=typeof t&&(t.exports=i)},{}],220:[function(t,n,r){(function(t){!function(i){function o(e){throw RangeError(x[e])}function a(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function s(e,t){var n=e.split("@"),r="";n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(R,".");var i=e.split("."),o=a(i,t).join(".");return r+o}function u(e){for(var t,n,r=[],i=0,o=e.length;i<o;)t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<o?(n=e.charCodeAt(i++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--)):r.push(t);return r}function l(e){return a(e,function(e){var t="";return e>65535&&(e-=65536,t+=L(e>>>10&1023|55296),e=56320|1023&e),t+=L(e)}).join("")}function c(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:S}function f(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function d(e,t,n){var r=0;for(e=n?N(e/j):e>>1,e+=N(e/t);e>O*E>>1;r+=S)e=N(e/O);return N(r+(O+1)*e/(e+T))}function h(e){var t,n,r,i,a,s,u,f,h,p,_=[],m=e.length,v=0,b=P,g=D;for(n=e.lastIndexOf(I),n<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&o("not-basic"),_.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<m;){for(a=v,s=1,u=S;i>=m&&o("invalid-input"),f=c(e.charCodeAt(i++)),(f>=S||f>N((w-v)/s))&&o("overflow"),v+=f*s,h=u<=g?k:u>=g+E?E:u-g,!(f<h);u+=S)p=S-h,s>N(w/p)&&o("overflow"),s*=p;t=_.length+1,g=d(v-a,t,0==a),N(v/t)>w-b&&o("overflow"),b+=N(v/t),v%=t,_.splice(v++,0,b)}return l(_)}function p(e){var t,n,r,i,a,s,l,c,h,p,_,m,v,b,g,y=[];for(e=u(e),m=e.length,t=P,n=0,a=D,s=0;s<m;++s)_=e[s],_<128&&y.push(L(_));for(r=i=y.length,i&&y.push(I);r<m;){for(l=w,s=0;s<m;++s)_=e[s],_>=t&&_<l&&(l=_);for(v=r+1,l-t>N((w-n)/v)&&o("overflow"),n+=(l-t)*v,t=l,s=0;s<m;++s)if(_=e[s],_<t&&++n>w&&o("overflow"),_==t){for(c=n,h=S;p=h<=a?k:h>=a+E?E:h-a,!(c<p);h+=S)g=c-p,b=S-p,y.push(L(f(p+g%b,0))),c=N(g/b);y.push(L(f(c,0))),a=d(n,v,r==i),n=0,++r}++n,++t}return y.join("")}function _(e){return s(e,function(e){return M.test(e)?h(e.slice(4).toLowerCase()):e})}function m(e){return s(e,function(e){return A.test(e)?"xn--"+p(e):e})}var v="object"==typeof r&&r&&!r.nodeType&&r,b="object"==typeof n&&n&&!n.nodeType&&n,g="object"==typeof t&&t;g.global!==g&&g.window!==g&&g.self!==g||(i=g);var y,C,w=2147483647,S=36,k=1,E=26,T=38,j=700,D=72,P=128,I="-",M=/^xn--/,A=/[^\x20-\x7E]/,R=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},O=S-k,N=Math.floor,L=String.fromCharCode;if(y={version:"1.3.2",ucs2:{decode:u,encode:l},decode:h,encode:p,toASCII:m,toUnicode:_},"function"==typeof e&&"object"==typeof e.amd&&e.amd)e("punycode",function(){return y});else if(v&&b)if(n.exports==v)b.exports=y;else for(C in y)y.hasOwnProperty(C)&&(v[C]=y[C]);else i.punycode=y}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],221:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,o){t=t||"&",n=n||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var u=1e3;o&&"number"==typeof o.maxKeys&&(u=o.maxKeys);var l=e.length;u>0&&l>u&&(l=u);for(var c=0;c<l;++c){var f,d,h,p,_=e[c].replace(s,"%20"),m=_.indexOf(n);m>=0?(f=_.substr(0,m),d=_.substr(m+1)):(f=_,d=""),h=decodeURIComponent(f),p=decodeURIComponent(d),r(a,h)?i(a[h])?a[h].push(p):a[h]=[a[h],p]:a[h]=p}return a};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],222:[function(e,t,n){"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(a(e),function(a){var s=encodeURIComponent(i(a))+n;return o(e[a])?r(e[a],function(e){return s+encodeURIComponent(i(e))}).join(t):s+encodeURIComponent(i(e[a]))}).join(t):s?encodeURIComponent(i(s))+n+encodeURIComponent(i(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],223:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":221,"./encode":222}],224:[function(t,n,r){(function(i){!function(t){if("object"==typeof r&&"undefined"!=typeof n)n.exports=t();else if("function"==typeof e&&e.amd)e([],t);else{var o;o="undefined"!=typeof window?window:"undefined"!=typeof i?i:"undefined"!=typeof self?self:this,o.QoSAnalytics=t()}}(function(){return function e(n,r,i){function o(s,u){if(!r[s]){if(!n[s]){var l="function"==typeof t&&t;if(!u&&l)return l(s,!0);if(a)return a(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[s]={exports:{}};n[s][0].call(f.exports,function(e){var t=n[s][1][e];return o(t?t:e)},f,f.exports,e,n,r,i)}return r[s].exports}for(var a="function"==typeof t&&t,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("./utils/VideoEventHandlers"),s=r(a),u=e("streamroot-utils-client").Timers,l=function e(t,n){function r(){te===J&&(ne>=re?(ne=0,te=ee):ne++);var e=Date.now();te===Z||A.paused||(z+=(e-B)/1e3),B=e}function i(){var e=Date.now();te!==ee||A.paused||(G+=(e-q)/1e3),q=e}function a(){var e=Date.now();te!==ee||A.paused||(K+=(e-F)/1e3),F=e}function l(){d(),f(),B||(B=Date.now())}function c(){B&&(x.clearInterval(Y),r(),B=void 0)}function f(){F&&(x.clearInterval(W),a(),F=void 0)}function d(){q&&(x.clearInterval(X),i(),q=void 0)}function h(e){$=H?e-H:e-U}function p(){d(),F||(F=Date.now(),O=!0,c(),d(),W=x.setInterval(a,Q))}function _(){O=!1}function m(){var e=Date.now();void 0===$&&h(e),B||(l(),Y=x.setInterval(r,Q))}function v(){O?O=!1:(f(),!q&&$&&(q=Date.now(),te===ee&&V++,X=x.setInterval(i,Q))),c()}function b(){H||(H=Date.now()),N=!1}function g(){H||(d(),f())}function y(){te===ee&&(f(),d(),c(),N=!0,L=!0,C())}function C(){B=0,F=0,q=0,V=0,z=0,K=0,G=0,W=0,Y=0,X=0}function w(){R.addEvent("seeking",p),R.addEvent("seeked",_),R.addEvent("play",b),R.addEvent("canplay",g),R.addEvent("ended",y)}function S(){return!!B}function k(){return!!q}function E(){return!!F}function T(){return N}function j(){var e=A.webkitDroppedFrameCount||A.droppedFrameCount;return void 0!==e?e:0}function D(){return{startupTime:$,rebufferingCount:V,timeSpentRebuffering:G,timeSpentPlaying:z,timeSpentSeeking:K,droppedFrameCount:j(),endedOnce:L}}function P(){ne=0,te=J}function I(){te=Z}function M(){R.removeEvent("seeking"),R.removeEvent("seeked"),R.removeEvent("play"),R.removeEvent("canplay"),R.removeEvent("ended"),x.clearAll()}(0,o.default)(this,e);var A=t,R=new s.default(A),x=new u,O=!1,N=!1,L=!1,$=void 0,U=n,H=0,B=0,F=0,q=0,V=0,z=0,K=0,G=0,W=0,Y=0,X=0,Q=100,Z="detached",J="attaching",ee="attached",te=ee;w();var ne=0,re=1e3/Q;this.onPlaying=m,this.onWaiting=v,this.onEnded=y,this.isPlaying=S,this.isRebuffering=k,this.isSeeking=E,this.isEnded=T,this.stopBufferingTimestamp=d,this.stopSeekingTimestamp=f,this.getVideoStats=D,this.attach=P,this.detach=I,this.dispose=M,this._incrementBufferingTime=i,this._incrementPlayingTime=r,this._incrementSeekingTime=a};n.default=l,t.exports=n.default},{"./utils/VideoEventHandlers":3,"babel-runtime/helpers/classCallCheck":7,"streamroot-utils-client":65}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("./workaround"),s=function e(t){(0,o.default)(this,e);var n=Date.now(),r=new a.QoSAnalyticsWithWorkaround(t,n);window.StreamRoot=window.StreamRoot||{},window.StreamRoot.getQoSAnalytics=r.getVideoStats.bind(r),this.getQoSAnalytics=r.getVideoStats.bind(r),this.attach=function(){r.attach()},this.detach=function(){r.detach()},this.dispose=function(){r.dispose()}};n.default=s,t.exports=n.default},{"./workaround":4,"babel-runtime/helpers/classCallCheck":7}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("babel-runtime/helpers/createClass"),s=r(a),u=e("babel-runtime/core-js/symbol"),l=r(u),c=(0,l.default)(),f=(0,l.default)(),d=function(){function e(t){(0,o.default)(this,e),this[f]=t,this[c]=[]}return(0,s.default)(e,[{key:"addEvent",value:function(e,t){if(this[c][e])throw new Error("this event has already been registered");this[c][e]=t,this[f].addEventListener(e,t)}},{key:"removeEvent",value:function(e){this[f].removeEventListener(e,this[c][e])}}]),e}();n.default=d,t.exports=n.default},{"babel-runtime/core-js/symbol":6,"babel-runtime/helpers/classCallCheck":7,"babel-runtime/helpers/createClass":8}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.UIStatusEnum=n.videoStatusEnum=n.QoSAnalyticsWithWorkaround=void 0;var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),a=e("./analyticsCalculator"),s=r(a),u=e("./utils/VideoEventHandlers"),l=r(u),c=e("streamroot-utils-client").Timers,f={ENDED:0,PLAYING:1,REBUFFERING:3,SEEKING:4},d={PLAY:0,PAUSE:1},h=function e(t,n){function r(e){clearTimeout(b),v=e}function i(){var e=g.currentTime;w<e?m===f.PLAYING||C.isPlaying()||(C.onPlaying(),m=f.PLAYING):v!==d.PAUSE&&(m===f.REBUFFERING||m===f.SEEKING||C.isRebuffering()||C.isSeeking()||(m=f.REBUFFERING,C.onWaiting())),v===d.PAUSE&&!C.isEnded()&&g.currentTime+.5>=g.duration&&C.onEnded(),w=e}function a(){w=g.currentTime,m=f.SEEKING}function u(){b=setTimeout(function(){r(d.PLAY)},100)}function h(){r(d.PAUSE)}function p(){y.addEvent("seeking",a),y.addEvent("play",u),y.addEvent("pause",h)}(0,o.default)(this,e);var _=new c,m=f.ENDED,v=d.PAUSE,b=void 0,g=t,y=new l.default(g),C=new s.default(g,n),w=g.currentTime;p(),_.setInterval(i,100),this.getVideoStats=function(){return C.getVideoStats()},this.attach=function(){C.attach()},this.detach=function(){C.detach()},this.dispose=function(){y.removeEvent("seeking"),y.removeEvent("play"),y.removeEvent("pause"),C.dispose()},this._analyticsCalculator=C,this._onPlay=u,this._onPause=h,this._onSeeking=a,this._getInterfaceState=function(){return v},this._getVideoState=function(){return m}};n.QoSAnalyticsWithWorkaround=h,n.videoStatusEnum=f,n.UIStatusEnum=d},{"./analyticsCalculator":1,"./utils/VideoEventHandlers":3,"babel-runtime/helpers/classCallCheck":7,"streamroot-utils-client":65}],5:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":9}],6:[function(e,t,n){t.exports={default:e("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":10}],7:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../core-js/object/define-property"),o=r(i);n.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},{"../core-js/object/define-property":5}],9:[function(e,t,n){e("../../modules/es6.object.define-property");var r=e("../../modules/_core").Object;t.exports=function(e,t,n){return r.defineProperty(e,t,n)}},{"../../modules/_core":15,"../../modules/es6.object.define-property":59}],10:[function(e,t,n){e("../../modules/es6.symbol"),e("../../modules/es6.object.to-string"),e("../../modules/es7.symbol.async-iterator"),e("../../modules/es7.symbol.observable"),t.exports=e("../../modules/_core").Symbol},{"../../modules/_core":15,"../../modules/es6.object.to-string":60,"../../modules/es6.symbol":61,"../../modules/es7.symbol.async-iterator":62,"../../modules/es7.symbol.observable":63}],11:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],12:[function(e,t,n){var r=e("./_is-object");t.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":31}],13:[function(e,t,n){var r=e("./_to-iobject"),i=e("./_to-length"),o=e("./_to-index");t.exports=function(e){return function(t,n,a){var s,u=r(t),l=i(u.length),c=o(a,l);if(e&&n!=n){for(;l>c;)if(s=u[c++],s!=s)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}}},{"./_to-index":50,"./_to-iobject":52,"./_to-length":53}],14:[function(e,t,n){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],15:[function(e,t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},{}],16:[function(e,t,n){var r=e("./_a-function");t.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":11}],17:[function(e,t,n){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],18:[function(e,t,n){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":23}],19:[function(e,t,n){var r=e("./_is-object"),i=e("./_global").document,o=r(i)&&r(i.createElement);t.exports=function(e){return o?i.createElement(e):{}}},{"./_global":24,"./_is-object":31}],20:[function(e,t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",");
},{}],21:[function(e,t,n){var r=e("./_object-keys"),i=e("./_object-gops"),o=e("./_object-pie");t.exports=function(e){var t=r(e),n=i.f;if(n)for(var a,s=n(e),u=o.f,l=0;s.length>l;)u.call(e,a=s[l++])&&t.push(a);return t}},{"./_object-gops":41,"./_object-keys":43,"./_object-pie":44}],22:[function(e,t,n){var r=e("./_global"),i=e("./_core"),o=e("./_ctx"),a=e("./_hide"),s="prototype",u=function(e,t,n){var l,c,f,d=e&u.F,h=e&u.G,p=e&u.S,_=e&u.P,m=e&u.B,v=e&u.W,b=h?i:i[t]||(i[t]={}),g=b[s],y=h?r:p?r[t]:(r[t]||{})[s];h&&(n=t);for(l in n)c=!d&&y&&void 0!==y[l],c&&l in b||(f=c?y[l]:n[l],b[l]=h&&"function"!=typeof y[l]?n[l]:m&&c?o(f,r):v&&y[l]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[s]=e[s],t}(f):_&&"function"==typeof f?o(Function.call,f):f,_&&((b.virtual||(b.virtual={}))[l]=f,e&u.R&&g&&!g[l]&&a(g,l,f)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,t.exports=u},{"./_core":15,"./_ctx":16,"./_global":24,"./_hide":26}],23:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],24:[function(e,t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],25:[function(e,t,n){var r={}.hasOwnProperty;t.exports=function(e,t){return r.call(e,t)}},{}],26:[function(e,t,n){var r=e("./_object-dp"),i=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":18,"./_object-dp":36,"./_property-desc":45}],27:[function(e,t,n){t.exports=e("./_global").document&&document.documentElement},{"./_global":24}],28:[function(e,t,n){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":18,"./_dom-create":19,"./_fails":23}],29:[function(e,t,n){var r=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},{"./_cof":14}],30:[function(e,t,n){var r=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==r(e)}},{"./_cof":14}],31:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],32:[function(e,t,n){var r=e("./_object-keys"),i=e("./_to-iobject");t.exports=function(e,t){for(var n,o=i(e),a=r(o),s=a.length,u=0;s>u;)if(o[n=a[u++]]===t)return n}},{"./_object-keys":43,"./_to-iobject":52}],33:[function(e,t,n){t.exports=!0},{}],34:[function(e,t,n){var r=e("./_uid")("meta"),i=e("./_is-object"),o=e("./_has"),a=e("./_object-dp").f,s=0,u=Object.isExtensible||function(){return!0},l=!e("./_fails")(function(){return u(Object.preventExtensions({}))}),c=function(e){a(e,r,{value:{i:"O"+ ++s,w:{}}})},f=function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!u(e))return"F";if(!t)return"E";c(e)}return e[r].i},d=function(e,t){if(!o(e,r)){if(!u(e))return!0;if(!t)return!1;c(e)}return e[r].w},h=function(e){return l&&p.NEED&&u(e)&&!o(e,r)&&c(e),e},p=t.exports={KEY:r,NEED:!1,fastKey:f,getWeak:d,onFreeze:h}},{"./_fails":23,"./_has":25,"./_is-object":31,"./_object-dp":36,"./_uid":55}],35:[function(e,t,n){var r=e("./_an-object"),i=e("./_object-dps"),o=e("./_enum-bug-keys"),a=e("./_shared-key")("IE_PROTO"),s=function(){},u="prototype",l=function(){var t,n=e("./_dom-create")("iframe"),r=o.length,i="<",a=">";for(n.style.display="none",e("./_html").appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write(i+"script"+a+"document.F=Object"+i+"/script"+a),t.close(),l=t.F;r--;)delete l[u][o[r]];return l()};t.exports=Object.create||function(e,t){var n;return null!==e?(s[u]=r(e),n=new s,s[u]=null,n[a]=e):n=l(),void 0===t?n:i(n,t)}},{"./_an-object":12,"./_dom-create":19,"./_enum-bug-keys":20,"./_html":27,"./_object-dps":37,"./_shared-key":48}],36:[function(e,t,n){var r=e("./_an-object"),i=e("./_ie8-dom-define"),o=e("./_to-primitive"),a=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":12,"./_descriptors":18,"./_ie8-dom-define":28,"./_to-primitive":54}],37:[function(e,t,n){var r=e("./_object-dp"),i=e("./_an-object"),o=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){i(e);for(var n,a=o(t),s=a.length,u=0;s>u;)r.f(e,n=a[u++],t[n]);return e}},{"./_an-object":12,"./_descriptors":18,"./_object-dp":36,"./_object-keys":43}],38:[function(e,t,n){var r=e("./_object-pie"),i=e("./_property-desc"),o=e("./_to-iobject"),a=e("./_to-primitive"),s=e("./_has"),u=e("./_ie8-dom-define"),l=Object.getOwnPropertyDescriptor;n.f=e("./_descriptors")?l:function(e,t){if(e=o(e),t=a(t,!0),u)try{return l(e,t)}catch(e){}if(s(e,t))return i(!r.f.call(e,t),e[t])}},{"./_descriptors":18,"./_has":25,"./_ie8-dom-define":28,"./_object-pie":44,"./_property-desc":45,"./_to-iobject":52,"./_to-primitive":54}],39:[function(e,t,n){var r=e("./_to-iobject"),i=e("./_object-gopn").f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(e){try{return i(e)}catch(e){return a.slice()}};t.exports.f=function(e){return a&&"[object Window]"==o.call(e)?s(e):i(r(e))}},{"./_object-gopn":40,"./_to-iobject":52}],40:[function(e,t,n){var r=e("./_object-keys-internal"),i=e("./_enum-bug-keys").concat("length","prototype");n.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},{"./_enum-bug-keys":20,"./_object-keys-internal":42}],41:[function(e,t,n){n.f=Object.getOwnPropertySymbols},{}],42:[function(e,t,n){var r=e("./_has"),i=e("./_to-iobject"),o=e("./_array-includes")(!1),a=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var n,s=i(e),u=0,l=[];for(n in s)n!=a&&r(s,n)&&l.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~o(l,n)||l.push(n));return l}},{"./_array-includes":13,"./_has":25,"./_shared-key":48,"./_to-iobject":52}],43:[function(e,t,n){var r=e("./_object-keys-internal"),i=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return r(e,i)}},{"./_enum-bug-keys":20,"./_object-keys-internal":42}],44:[function(e,t,n){n.f={}.propertyIsEnumerable},{}],45:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],46:[function(e,t,n){t.exports=e("./_hide")},{"./_hide":26}],47:[function(e,t,n){var r=e("./_object-dp").f,i=e("./_has"),o=e("./_wks")("toStringTag");t.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},{"./_has":25,"./_object-dp":36,"./_wks":58}],48:[function(e,t,n){var r=e("./_shared")("keys"),i=e("./_uid");t.exports=function(e){return r[e]||(r[e]=i(e))}},{"./_shared":49,"./_uid":55}],49:[function(e,t,n){var r=e("./_global"),i="__core-js_shared__",o=r[i]||(r[i]={});t.exports=function(e){return o[e]||(o[e]={})}},{"./_global":24}],50:[function(e,t,n){var r=e("./_to-integer"),i=Math.max,o=Math.min;t.exports=function(e,t){return e=r(e),e<0?i(e+t,0):o(e,t)}},{"./_to-integer":51}],51:[function(e,t,n){var r=Math.ceil,i=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)}},{}],52:[function(e,t,n){var r=e("./_iobject"),i=e("./_defined");t.exports=function(e){return r(i(e))}},{"./_defined":17,"./_iobject":29}],53:[function(e,t,n){var r=e("./_to-integer"),i=Math.min;t.exports=function(e){return e>0?i(r(e),9007199254740991):0}},{"./_to-integer":51}],54:[function(e,t,n){var r=e("./_is-object");t.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":31}],55:[function(e,t,n){var r=0,i=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+i).toString(36))}},{}],56:[function(e,t,n){var r=e("./_global"),i=e("./_core"),o=e("./_library"),a=e("./_wks-ext"),s=e("./_object-dp").f;t.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},{"./_core":15,"./_global":24,"./_library":33,"./_object-dp":36,"./_wks-ext":57}],57:[function(e,t,n){n.f=e("./_wks")},{"./_wks":58}],58:[function(e,t,n){var r=e("./_shared")("wks"),i=e("./_uid"),o=e("./_global").Symbol,a="function"==typeof o,s=t.exports=function(e){return r[e]||(r[e]=a&&o[e]||(a?o:i)("Symbol."+e))};s.store=r},{"./_global":24,"./_shared":49,"./_uid":55}],59:[function(e,t,n){var r=e("./_export");r(r.S+r.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":18,"./_export":22,"./_object-dp":36}],60:[function(e,t,n){},{}],61:[function(e,t,n){"use strict";var r=e("./_global"),i=e("./_has"),o=e("./_descriptors"),a=e("./_export"),s=e("./_redefine"),u=e("./_meta").KEY,l=e("./_fails"),c=e("./_shared"),f=e("./_set-to-string-tag"),d=e("./_uid"),h=e("./_wks"),p=e("./_wks-ext"),_=e("./_wks-define"),m=e("./_keyof"),v=e("./_enum-keys"),b=e("./_is-array"),g=e("./_an-object"),y=e("./_to-iobject"),C=e("./_to-primitive"),w=e("./_property-desc"),S=e("./_object-create"),k=e("./_object-gopn-ext"),E=e("./_object-gopd"),T=e("./_object-dp"),j=e("./_object-keys"),D=E.f,P=T.f,I=k.f,M=r.Symbol,A=r.JSON,R=A&&A.stringify,x="prototype",O=h("_hidden"),N=h("toPrimitive"),L={}.propertyIsEnumerable,$=c("symbol-registry"),U=c("symbols"),H=c("op-symbols"),B=Object[x],F="function"==typeof M,q=r.QObject,V=!q||!q[x]||!q[x].findChild,z=o&&l(function(){return 7!=S(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=D(B,t);r&&delete B[t],P(e,t,n),r&&e!==B&&P(B,t,r)}:P,K=function(e){var t=U[e]=S(M[x]);return t._k=e,t},G=F&&"symbol"==typeof M.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof M},W=function(e,t,n){return e===B&&W(H,t,n),g(e),t=C(t,!0),g(n),i(U,t)?(n.enumerable?(i(e,O)&&e[O][t]&&(e[O][t]=!1),n=S(n,{enumerable:w(0,!1)})):(i(e,O)||P(e,O,w(1,{})),e[O][t]=!0),z(e,t,n)):P(e,t,n)},Y=function(e,t){g(e);for(var n,r=v(t=y(t)),i=0,o=r.length;o>i;)W(e,n=r[i++],t[n]);return e},X=function(e,t){return void 0===t?S(e):Y(S(e),t)},Q=function(e){var t=L.call(this,e=C(e,!0));return!(this===B&&i(U,e)&&!i(H,e))&&(!(t||!i(this,e)||!i(U,e)||i(this,O)&&this[O][e])||t)},Z=function(e,t){if(e=y(e),t=C(t,!0),e!==B||!i(U,t)||i(H,t)){var n=D(e,t);return!n||!i(U,t)||i(e,O)&&e[O][t]||(n.enumerable=!0),n}},J=function(e){for(var t,n=I(y(e)),r=[],o=0;n.length>o;)i(U,t=n[o++])||t==O||t==u||r.push(t);return r},ee=function(e){for(var t,n=e===B,r=I(n?H:y(e)),o=[],a=0;r.length>a;)!i(U,t=r[a++])||n&&!i(B,t)||o.push(U[t]);return o};F||(M=function(){if(this instanceof M)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function(n){this===B&&t.call(H,n),i(this,O)&&i(this[O],e)&&(this[O][e]=!1),z(this,e,w(1,n))};return o&&V&&z(B,e,{configurable:!0,set:t}),K(e)},s(M[x],"toString",function(){return this._k}),E.f=Z,T.f=W,e("./_object-gopn").f=k.f=J,e("./_object-pie").f=Q,e("./_object-gops").f=ee,o&&!e("./_library")&&s(B,"propertyIsEnumerable",Q,!0),p.f=function(e){return K(h(e))}),a(a.G+a.W+a.F*!F,{Symbol:M});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)h(te[ne++]);for(var te=j(h.store),ne=0;te.length>ne;)_(te[ne++]);a(a.S+a.F*!F,"Symbol",{for:function(e){return i($,e+="")?$[e]:$[e]=M(e)},keyFor:function(e){if(G(e))return m($,e);throw TypeError(e+" is not a symbol!")},useSetter:function(){V=!0},useSimple:function(){V=!1}}),a(a.S+a.F*!F,"Object",{create:X,defineProperty:W,defineProperties:Y,getOwnPropertyDescriptor:Z,getOwnPropertyNames:J,getOwnPropertySymbols:ee}),A&&a(a.S+a.F*(!F||l(function(){var e=M();return"[null]"!=R([e])||"{}"!=R({a:e})||"{}"!=R(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!G(e)){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);return t=r[1],"function"==typeof t&&(n=t),!n&&b(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!G(t))return t}),r[1]=t,R.apply(A,r)}}}),M[x][N]||e("./_hide")(M[x],N,M[x].valueOf),f(M,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},{"./_an-object":12,"./_descriptors":18,"./_enum-keys":21,"./_export":22,"./_fails":23,"./_global":24,"./_has":25,"./_hide":26,"./_is-array":30,"./_keyof":32,"./_library":33,"./_meta":34,"./_object-create":35,"./_object-dp":36,"./_object-gopd":38,"./_object-gopn":40,"./_object-gopn-ext":39,"./_object-gops":41,"./_object-keys":43,"./_object-pie":44,"./_property-desc":45,"./_redefine":46,"./_set-to-string-tag":47,"./_shared":49,"./_to-iobject":52,"./_to-primitive":54,"./_uid":55,"./_wks":58,"./_wks-define":56,"./_wks-ext":57}],62:[function(e,t,n){e("./_wks-define")("asyncIterator")},{"./_wks-define":56}],63:[function(e,t,n){e("./_wks-define")("observable")},{"./_wks-define":56}],64:[function(e,t,n){var r=function(){var e=this,t=[],n=[],r=function(e,n){var r=setTimeout(function(){i(r),e()},n);return t.push(r),r},i=function(e){for(var n in t)if(t[n]===e){clearTimeout(e),t.slice(n,1);break}},o=function(e,t){var r=setInterval(e,t);return n.push(r),r},a=function(e){for(var t in n)if(n[t]===e){clearInterval(e),n.slice(t,1);break}},s=function(){t.forEach(function(e){clearTimeout(e)}),t=[],n.forEach(function(e){clearInterval(e)}),n=[]};e.setTimeout=r,e.clearTimeout=i,e.setInterval=o,e.clearInterval=a,e.clearAll=s};t.exports=r},{}],65:[function(e,t,n){t.exports.Timers=e("./app/Timers")},{"./app/Timers":64}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],225:[function(t,n,r){!function(t,i){"use strict";var o="0.7.10",a="",s="?",u="function",l="undefined",c="object",f="string",d="major",h="model",p="name",_="type",m="vendor",v="version",b="architecture",g="console",y="mobile",C="tablet",w="smarttv",S="wearable",k="embedded",E={extend:function(e,t){for(var n in t)"browser cpu device engine os".indexOf(n)!==-1&&t[n].length%2===0&&(e[n]=t[n].concat(e[n]));return e},has:function(e,t){return"string"==typeof e&&t.toLowerCase().indexOf(e.toLowerCase())!==-1},lowerize:function(e){return e.toLowerCase()},major:function(e){return typeof e===f?e.split(".")[0]:i}},T={rgx:function(){for(var e,t,n,r,o,a,s,f=0,d=arguments;f<d.length&&!a;){var h=d[f],p=d[f+1];if(typeof e===l){e={};for(r in p)p.hasOwnProperty(r)&&(o=p[r],typeof o===c?e[o[0]]=i:e[o]=i)}for(t=n=0;t<h.length&&!a;)if(a=h[t++].exec(this.getUA()))for(r=0;r<p.length;r++)s=a[++n],o=p[r],typeof o===c&&o.length>0?2==o.length?typeof o[1]==u?e[o[0]]=o[1].call(this,s):e[o[0]]=o[1]:3==o.length?typeof o[1]!==u||o[1].exec&&o[1].test?e[o[0]]=s?s.replace(o[1],o[2]):i:e[o[0]]=s?o[1].call(this,s,o[2]):i:4==o.length&&(e[o[0]]=s?o[3].call(this,s.replace(o[1],o[2])):i):e[o]=s?s:i;f+=2}return e},str:function(e,t){for(var n in t)if(typeof t[n]===c&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(E.has(t[n][r],e))return n===s?i:n}else if(E.has(t[n],e))return n===s?i:n;return e}},j={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},D={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[p,v],[/\s(opr)\/([\w\.]+)/i],[[p,"Opera"],v],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[p,v],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[p,"IE"],v],[/(edge)\/((\d+)?[\w\.]+)/i],[p,v],[/(yabrowser)\/([\w\.]+)/i],[[p,"Yandex"],v],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],v],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[p,v],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/JUC.+(ucweb)[\/\s]?([\w\.]+)/i],[[p,"UCBrowser"],v],[/(dolfin)\/([\w\.]+)/i],[[p,"Dolphin"],v],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[p,"Chrome"],v],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[v,[p,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[v,[p,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[v,[p,"Facebook"]],[/fxios\/([\w\.-]+)/i],[v,[p,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[v,[p,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[v,p],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[p,[v,T.str,j.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[p,v],[/(navigator|netscape)\/([\w\.-]+)/i],[[p,"Netscape"],v],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[p,v]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[b,"amd64"]],[/(ia32(?=;))/i],[[b,E.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[b,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[b,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[b,/ower/,"",E.lowerize]],[/(sun4\w)[;\)]/i],[[b,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[b,E.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[h,m,[_,C]],[/applecoremedia\/[\w\.]+ \((ipad)/],[h,[m,"Apple"],[_,C]],[/(apple\s{0,1}tv)/i],[[h,"Apple TV"],[m,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[m,h,[_,C]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[h,[m,"Amazon"],[_,C]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[h,T.str,j.device.amazon.model],[m,"Amazon"],[_,y]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[h,m,[_,y]],[/\((ip[honed|\s\w*]+);/i],[h,[m,"Apple"],[_,y]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[m,h,[_,y]],[/\(bb10;\s(\w+)/i],[h,[m,"BlackBerry"],[_,y]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[h,[m,"Asus"],[_,C]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[m,"Sony"],[h,"Xperia Tablet"],[_,C]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[m,"Sony"],[h,"Xperia Phone"],[_,y]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[m,h,[_,g]],[/android.+;\s(shield)\sbuild/i],[h,[m,"Nvidia"],[_,g]],[/(playstation\s[34portablevi]+)/i],[h,[m,"Sony"],[_,g]],[/(sprint\s(\w+))/i],[[m,T.str,j.device.sprint.vendor],[h,T.str,j.device.sprint.model],[_,y]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[m,h,[_,C]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[m,[h,/_/g," "],[_,y]],[/(nexus\s9)/i],[h,[m,"HTC"],[_,C]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[h,[m,"Microsoft"],[_,g]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[m,"Microsoft"],[_,y]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s[6])/i],[h,[m,"Motorola"],[_,y]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[h,[m,"Motorola"],[_,C]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[m,"Samsung"],h,[_,C]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[m,"Samsung"],h,[_,y]],[/(samsung);smarttv/i],[m,h,[_,w]],[/\(dtv[\);].+(aquos)/i],[h,[m,"Sharp"],[_,w]],[/sie-(\w+)*/i],[h,[m,"Siemens"],[_,y]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[m,"Nokia"],h,[_,y]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[h,[m,"Acer"],[_,C]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[m,"LG"],h,[_,C]],[/(lg) netcast\.tv/i],[m,h,[_,w]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[h,[m,"LG"],[_,y]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[h,[m,"Lenovo"],[_,C]],[/linux;.+((jolla));/i],[m,h,[_,y]],[/((pebble))app\/[\d\.]+\s/i],[m,h,[_,S]],[/android.+;\s(glass)\s\d/i],[h,[m,"Google"],[_,S]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i],[[h,/_/g," "],[m,"Xiaomi"],[_,y]],[/\s(tablet)[;\/\s]/i,/\s(mobile)[;\/\s]/i],[[_,E.lowerize],m,h]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[v,[p,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[p,v],[/rv\:([\w\.]+).*(gecko)/i],[v,p]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[p,v],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[p,[v,T.str,j.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[p,"Windows"],[v,T.str,j.os.windows.version]],[/\((bb)(10);/i],[[p,"BlackBerry"],v],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[p,v],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[p,"Symbian"],v],[/\((series40);/i],[p],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[p,"Firefox OS"],v],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[p,v],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[p,"Chromium OS"],v],[/(sunos)\s?([\w\.]+\d)*/i],[[p,"Solaris"],v],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[p,v],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[p,"iOS"],[v,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[p,"Mac OS"],[v,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[p,v]]},P=function(e,n){if(!(this instanceof P))return new P(e,n).getResult();var r=e||(t&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:a),i=n?E.extend(D,n):D;return this.getBrowser=function(){var e=T.rgx.apply(this,i.browser);return e.major=E.major(e.version),e},this.getCPU=function(){return T.rgx.apply(this,i.cpu)},this.getDevice=function(){return T.rgx.apply(this,i.device)},this.getEngine=function(){return T.rgx.apply(this,i.engine)},this.getOS=function(){return T.rgx.apply(this,i.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r=e,this},this.setUA(r),this};P.VERSION=o,P.BROWSER={NAME:p,MAJOR:d,VERSION:v},P.CPU={ARCHITECTURE:b},P.DEVICE={MODEL:h,VENDOR:m,TYPE:_,CONSOLE:g,MOBILE:y,SMARTTV:w,TABLET:C,WEARABLE:S,EMBEDDED:k},P.ENGINE={NAME:p,VERSION:v},P.OS={NAME:p,VERSION:v},typeof r!==l?(typeof n!==l&&n.exports&&(r=n.exports=P),r.UAParser=P):typeof e===u&&e.amd?e(function(){return P}):t.UAParser=P;var I=t.jQuery||t.Zepto;if(typeof I!==l){var M=new P;I.ua=M.getResult(),I.ua.get=function(){return M.getUA()},I.ua.set=function(e){M.setUA(e);var t=M.getResult();for(var n in t)I.ua[n]=t[n]}}}("object"==typeof window?window:this)},{}],226:[function(t,n,r){(function(){function t(e){function t(t,n,r,i,o,a){for(;o>=0&&o<a;o+=e){var s=i?i[o]:o;r=n(r,t[s],s,t)}return r}return function(n,r,i,o){r=w(r,o,4);var a=!P(n)&&C.keys(n),s=(a||n).length,u=e>0?0:s-1;return arguments.length<3&&(i=n[a?a[u]:u],u+=e),t(n,r,i,a,u,s)}}function i(e){return function(t,n,r){n=S(n,r);for(var i=D(t),o=e>0?0:i-1;o>=0&&o<i;o+=e)if(n(t[o],o,t))return o;return-1}}function o(e,t,n){return function(r,i,o){var a=0,s=D(r);if("number"==typeof o)e>0?a=o>=0?o:Math.max(o+s,a):s=o>=0?Math.min(o+1,s):o+s+1;else if(n&&o&&s)return o=n(r,i),r[o]===i?o:-1;if(i!==i)return o=t(h.call(r,a,s),C.isNaN),o>=0?o+a:-1;for(o=e>0?a:s-1;o>=0&&o<s;o+=e)if(r[o]===i)return o;return-1}}function a(e,t){var n=x.length,r=e.constructor,i=C.isFunction(r)&&r.prototype||c,o="constructor";for(C.has(e,o)&&!C.contains(t,o)&&t.push(o);n--;)o=x[n],o in e&&e[o]!==i[o]&&!C.contains(t,o)&&t.push(o)}var s=this,u=s._,l=Array.prototype,c=Object.prototype,f=Function.prototype,d=l.push,h=l.slice,p=c.toString,_=c.hasOwnProperty,m=Array.isArray,v=Object.keys,b=f.bind,g=Object.create,y=function(){},C=function(e){return e instanceof C?e:this instanceof C?void(this._wrapped=e):new C(e)};"undefined"!=typeof r?("undefined"!=typeof n&&n.exports&&(r=n.exports=C),r._=C):s._=C,C.VERSION="1.8.3";var w=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)}}return function(){return e.apply(t,arguments)}},S=function(e,t,n){return null==e?C.identity:C.isFunction(e)?w(e,t,n):C.isObject(e)?C.matcher(e):C.property(e)};C.iteratee=function(e,t){return S(e,t,1/0)};var k=function(e,t){return function(n){var r=arguments.length;if(r<2||null==n)return n;for(var i=1;i<r;i++)for(var o=arguments[i],a=e(o),s=a.length,u=0;u<s;u++){var l=a[u];t&&void 0!==n[l]||(n[l]=o[l])}return n}},E=function(e){if(!C.isObject(e))return{};if(g)return g(e);y.prototype=e;var t=new y;return y.prototype=null,t},T=function(e){return function(t){return null==t?void 0:t[e]}},j=Math.pow(2,53)-1,D=T("length"),P=function(e){var t=D(e);return"number"==typeof t&&t>=0&&t<=j};C.each=C.forEach=function(e,t,n){t=w(t,n);var r,i;if(P(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var o=C.keys(e);for(r=0,i=o.length;r<i;r++)t(e[o[r]],o[r],e)}return e},C.map=C.collect=function(e,t,n){t=S(t,n);for(var r=!P(e)&&C.keys(e),i=(r||e).length,o=Array(i),a=0;a<i;a++){var s=r?r[a]:a;o[a]=t(e[s],s,e)}return o},C.reduce=C.foldl=C.inject=t(1),C.reduceRight=C.foldr=t(-1),C.find=C.detect=function(e,t,n){var r;if(r=P(e)?C.findIndex(e,t,n):C.findKey(e,t,n),void 0!==r&&r!==-1)return e[r]},C.filter=C.select=function(e,t,n){var r=[];return t=S(t,n),C.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r},C.reject=function(e,t,n){return C.filter(e,C.negate(S(t)),n)},C.every=C.all=function(e,t,n){t=S(t,n);for(var r=!P(e)&&C.keys(e),i=(r||e).length,o=0;o<i;o++){var a=r?r[o]:o;if(!t(e[a],a,e))return!1}return!0},C.some=C.any=function(e,t,n){t=S(t,n);for(var r=!P(e)&&C.keys(e),i=(r||e).length,o=0;o<i;o++){var a=r?r[o]:o;if(t(e[a],a,e))return!0}return!1},C.contains=C.includes=C.include=function(e,t,n,r){return P(e)||(e=C.values(e)),("number"!=typeof n||r)&&(n=0),C.indexOf(e,t,n)>=0},C.invoke=function(e,t){var n=h.call(arguments,2),r=C.isFunction(t);return C.map(e,function(e){var i=r?t:e[t];return null==i?i:i.apply(e,n)})},C.pluck=function(e,t){return C.map(e,C.property(t))},C.where=function(e,t){return C.filter(e,C.matcher(t))},C.findWhere=function(e,t){return C.find(e,C.matcher(t))},C.max=function(e,t,n){var r,i,o=-(1/0),a=-(1/0);if(null==t&&null!=e){e=P(e)?e:C.values(e);for(var s=0,u=e.length;s<u;s++)r=e[s],r>o&&(o=r)}else t=S(t,n),C.each(e,function(e,n,r){i=t(e,n,r),(i>a||i===-(1/0)&&o===-(1/0))&&(o=e,a=i)});return o},C.min=function(e,t,n){var r,i,o=1/0,a=1/0;if(null==t&&null!=e){e=P(e)?e:C.values(e);for(var s=0,u=e.length;s<u;s++)r=e[s],r<o&&(o=r)}else t=S(t,n),C.each(e,function(e,n,r){i=t(e,n,r),(i<a||i===1/0&&o===1/0)&&(o=e,a=i)});return o},C.shuffle=function(e){for(var t,n=P(e)?e:C.values(e),r=n.length,i=Array(r),o=0;o<r;o++)t=C.random(0,o),t!==o&&(i[o]=i[t]),i[t]=n[o];return i},C.sample=function(e,t,n){return null==t||n?(P(e)||(e=C.values(e)),e[C.random(e.length-1)]):C.shuffle(e).slice(0,Math.max(0,t))},C.sortBy=function(e,t,n){return t=S(t,n),C.pluck(C.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index}),"value")};var I=function(e){return function(t,n,r){var i={};return n=S(n,r),C.each(t,function(r,o){var a=n(r,o,t);e(i,r,a)}),i}};C.groupBy=I(function(e,t,n){C.has(e,n)?e[n].push(t):e[n]=[t]}),C.indexBy=I(function(e,t,n){e[n]=t}),C.countBy=I(function(e,t,n){C.has(e,n)?e[n]++:e[n]=1}),C.toArray=function(e){return e?C.isArray(e)?h.call(e):P(e)?C.map(e,C.identity):C.values(e):[]},C.size=function(e){return null==e?0:P(e)?e.length:C.keys(e).length},C.partition=function(e,t,n){t=S(t,n);var r=[],i=[];return C.each(e,function(e,n,o){(t(e,n,o)?r:i).push(e)}),[r,i]},C.first=C.head=C.take=function(e,t,n){if(null!=e)return null==t||n?e[0]:C.initial(e,e.length-t)},C.initial=function(e,t,n){return h.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},C.last=function(e,t,n){if(null!=e)return null==t||n?e[e.length-1]:C.rest(e,Math.max(0,e.length-t))},C.rest=C.tail=C.drop=function(e,t,n){return h.call(e,null==t||n?1:t)},C.compact=function(e){return C.filter(e,C.identity)};var M=function(e,t,n,r){for(var i=[],o=0,a=r||0,s=D(e);a<s;a++){var u=e[a];if(P(u)&&(C.isArray(u)||C.isArguments(u))){t||(u=M(u,t,n));var l=0,c=u.length;for(i.length+=c;l<c;)i[o++]=u[l++]}else n||(i[o++]=u)}return i};C.flatten=function(e,t){return M(e,t,!1)},C.without=function(e){return C.difference(e,h.call(arguments,1))},C.uniq=C.unique=function(e,t,n,r){C.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=S(n,r));for(var i=[],o=[],a=0,s=D(e);a<s;a++){var u=e[a],l=n?n(u,a,e):u;t?(a&&o===l||i.push(u),o=l):n?C.contains(o,l)||(o.push(l),i.push(u)):C.contains(i,u)||i.push(u)}return i},C.union=function(){return C.uniq(M(arguments,!0,!0))},C.intersection=function(e){for(var t=[],n=arguments.length,r=0,i=D(e);r<i;r++){var o=e[r];if(!C.contains(t,o)){for(var a=1;a<n&&C.contains(arguments[a],o);a++);a===n&&t.push(o)}}return t},C.difference=function(e){var t=M(arguments,!0,!0,1);return C.filter(e,function(e){return!C.contains(t,e)})},C.zip=function(){return C.unzip(arguments)},C.unzip=function(e){for(var t=e&&C.max(e,D).length||0,n=Array(t),r=0;r<t;r++)n[r]=C.pluck(e,r);return n},C.object=function(e,t){for(var n={},r=0,i=D(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},C.findIndex=i(1),C.findLastIndex=i(-1),C.sortedIndex=function(e,t,n,r){n=S(n,r,1);for(var i=n(t),o=0,a=D(e);o<a;){var s=Math.floor((o+a)/2);n(e[s])<i?o=s+1:a=s}return o},C.indexOf=o(1,C.findIndex,C.sortedIndex),C.lastIndexOf=o(-1,C.findLastIndex),C.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),o=0;o<r;o++,e+=n)i[o]=e;return i};var A=function(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var o=E(e.prototype),a=e.apply(o,i);return C.isObject(a)?a:o};C.bind=function(e,t){if(b&&e.bind===b)return b.apply(e,h.call(arguments,1));if(!C.isFunction(e))throw new TypeError("Bind must be called on a function");var n=h.call(arguments,2),r=function(){return A(e,r,t,this,n.concat(h.call(arguments)))};return r},C.partial=function(e){var t=h.call(arguments,1),n=function(){
for(var r=0,i=t.length,o=Array(i),a=0;a<i;a++)o[a]=t[a]===C?arguments[r++]:t[a];for(;r<arguments.length;)o.push(arguments[r++]);return A(e,n,this,this,o)};return n},C.bindAll=function(e){var t,n,r=arguments.length;if(r<=1)throw new Error("bindAll must be passed function names");for(t=1;t<r;t++)n=arguments[t],e[n]=C.bind(e[n],e);return e},C.memoize=function(e,t){var n=function(r){var i=n.cache,o=""+(t?t.apply(this,arguments):r);return C.has(i,o)||(i[o]=e.apply(this,arguments)),i[o]};return n.cache={},n},C.delay=function(e,t){var n=h.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},C.defer=C.partial(C.delay,C,1),C.throttle=function(e,t,n){var r,i,o,a=null,s=0;n||(n={});var u=function(){s=n.leading===!1?0:C.now(),a=null,o=e.apply(r,i),a||(r=i=null)};return function(){var l=C.now();s||n.leading!==!1||(s=l);var c=t-(l-s);return r=this,i=arguments,c<=0||c>t?(a&&(clearTimeout(a),a=null),s=l,o=e.apply(r,i),a||(r=i=null)):a||n.trailing===!1||(a=setTimeout(u,c)),o}},C.debounce=function(e,t,n){var r,i,o,a,s,u=function(){var l=C.now()-a;l<t&&l>=0?r=setTimeout(u,t-l):(r=null,n||(s=e.apply(o,i),r||(o=i=null)))};return function(){o=this,i=arguments,a=C.now();var l=n&&!r;return r||(r=setTimeout(u,t)),l&&(s=e.apply(o,i),o=i=null),s}},C.wrap=function(e,t){return C.partial(t,e)},C.negate=function(e){return function(){return!e.apply(this,arguments)}},C.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},C.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},C.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},C.once=C.partial(C.before,2);var R=!{toString:null}.propertyIsEnumerable("toString"),x=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];C.keys=function(e){if(!C.isObject(e))return[];if(v)return v(e);var t=[];for(var n in e)C.has(e,n)&&t.push(n);return R&&a(e,t),t},C.allKeys=function(e){if(!C.isObject(e))return[];var t=[];for(var n in e)t.push(n);return R&&a(e,t),t},C.values=function(e){for(var t=C.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r},C.mapObject=function(e,t,n){t=S(t,n);for(var r,i=C.keys(e),o=i.length,a={},s=0;s<o;s++)r=i[s],a[r]=t(e[r],r,e);return a},C.pairs=function(e){for(var t=C.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},C.invert=function(e){for(var t={},n=C.keys(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},C.functions=C.methods=function(e){var t=[];for(var n in e)C.isFunction(e[n])&&t.push(n);return t.sort()},C.extend=k(C.allKeys),C.extendOwn=C.assign=k(C.keys),C.findKey=function(e,t,n){t=S(t,n);for(var r,i=C.keys(e),o=0,a=i.length;o<a;o++)if(r=i[o],t(e[r],r,e))return r},C.pick=function(e,t,n){var r,i,o={},a=e;if(null==a)return o;C.isFunction(t)?(i=C.allKeys(a),r=w(t,n)):(i=M(arguments,!1,!1,1),r=function(e,t,n){return t in n},a=Object(a));for(var s=0,u=i.length;s<u;s++){var l=i[s],c=a[l];r(c,l,a)&&(o[l]=c)}return o},C.omit=function(e,t,n){if(C.isFunction(t))t=C.negate(t);else{var r=C.map(M(arguments,!1,!1,1),String);t=function(e,t){return!C.contains(r,t)}}return C.pick(e,t,n)},C.defaults=k(C.allKeys,!0),C.create=function(e,t){var n=E(e);return t&&C.extendOwn(n,t),n},C.clone=function(e){return C.isObject(e)?C.isArray(e)?e.slice():C.extend({},e):e},C.tap=function(e,t){return t(e),e},C.isMatch=function(e,t){var n=C.keys(t),r=n.length;if(null==e)return!r;for(var i=Object(e),o=0;o<r;o++){var a=n[o];if(t[a]!==i[a]||!(a in i))return!1}return!0};var O=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof C&&(e=e._wrapped),t instanceof C&&(t=t._wrapped);var i=p.call(e);if(i!==p.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var o="[object Array]"===i;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,s=t.constructor;if(a!==s&&!(C.isFunction(a)&&a instanceof a&&C.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];for(var u=n.length;u--;)if(n[u]===e)return r[u]===t;if(n.push(e),r.push(t),o){if(u=e.length,u!==t.length)return!1;for(;u--;)if(!O(e[u],t[u],n,r))return!1}else{var l,c=C.keys(e);if(u=c.length,C.keys(t).length!==u)return!1;for(;u--;)if(l=c[u],!C.has(t,l)||!O(e[l],t[l],n,r))return!1}return n.pop(),r.pop(),!0};C.isEqual=function(e,t){return O(e,t)},C.isEmpty=function(e){return null==e||(P(e)&&(C.isArray(e)||C.isString(e)||C.isArguments(e))?0===e.length:0===C.keys(e).length)},C.isElement=function(e){return!(!e||1!==e.nodeType)},C.isArray=m||function(e){return"[object Array]"===p.call(e)},C.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},C.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){C["is"+e]=function(t){return p.call(t)==="[object "+e+"]"}}),C.isArguments(arguments)||(C.isArguments=function(e){return C.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(C.isFunction=function(e){return"function"==typeof e||!1}),C.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},C.isNaN=function(e){return C.isNumber(e)&&e!==+e},C.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===p.call(e)},C.isNull=function(e){return null===e},C.isUndefined=function(e){return void 0===e},C.has=function(e,t){return null!=e&&_.call(e,t)},C.noConflict=function(){return s._=u,this},C.identity=function(e){return e},C.constant=function(e){return function(){return e}},C.noop=function(){},C.property=T,C.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},C.matcher=C.matches=function(e){return e=C.extendOwn({},e),function(t){return C.isMatch(t,e)}},C.times=function(e,t,n){var r=Array(Math.max(0,e));t=w(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},C.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},C.now=Date.now||function(){return(new Date).getTime()};var N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},L=C.invert(N),$=function(e){var t=function(t){return e[t]},n="(?:"+C.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};C.escape=$(N),C.unescape=$(L),C.result=function(e,t,n){var r=null==e?void 0:e[t];return void 0===r&&(r=n),C.isFunction(r)?r.call(e):r};var U=0;C.uniqueId=function(e){var t=++U+"";return e?e+t:t},C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},F=/\\|'|\r|\n|\u2028|\u2029/g,q=function(e){return"\\"+B[e]};C.template=function(e,t,n){!t&&n&&(t=n),t=C.defaults({},t,C.templateSettings);var r=RegExp([(t.escape||H).source,(t.interpolate||H).source,(t.evaluate||H).source].join("|")+"|$","g"),i=0,o="__p+='";e.replace(r,function(t,n,r,a,s){return o+=e.slice(i,s).replace(F,q),i=s+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":a&&(o+="';\n"+a+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(t.variable||"obj","_",o)}catch(e){throw e.source=o,e}var s=function(e){return a.call(this,e,C)},u=t.variable||"obj";return s.source="function("+u+"){\n"+o+"}",s},C.chain=function(e){var t=C(e);return t._chain=!0,t};var V=function(e,t){return e._chain?C(t).chain():t};C.mixin=function(e){C.each(C.functions(e),function(t){var n=C[t]=e[t];C.prototype[t]=function(){var e=[this._wrapped];return d.apply(e,arguments),V(this,n.apply(C,e))}})},C.mixin(C),C.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=l[e];C.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],V(this,n)}}),C.each(["concat","join","slice"],function(e){var t=l[e];C.prototype[e]=function(){return V(this,t.apply(this._wrapped,arguments))}}),C.prototype.value=function(){return this._wrapped},C.prototype.valueOf=C.prototype.toJSON=C.prototype.value,C.prototype.toString=function(){return""+this._wrapped},"function"==typeof e&&e.amd&&e("underscore",[],function(){return C})}).call(this)},{}],227:[function(e,t,n){"use strict";function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(e,t,n){if(e&&l.isObject(e)&&e instanceof r)return e;var i=new r;return i.parse(e,t,n),i}function o(e){return l.isString(e)&&(e=i(e)),e instanceof r?e.format():r.prototype.format.call(e)}function a(e,t){return i(e,!1,!0).resolve(t)}function s(e,t){return e?i(e,!1,!0).resolveObject(t):t}var u=e("punycode"),l=e("./util");n.parse=i,n.resolve=a,n.resolveObject=s,n.format=o,n.Url=r;var c=/^([a-z0-9.+-]+:)/i,f=/:[0-9]*$/,d=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,h=["<",">",'"',"`"," ","\r","\n","\t"],p=["{","}","|","\\","^","`"].concat(h),_=["'"].concat(p),m=["%","/","?",";","#"].concat(_),v=["/","?","#"],b=255,g=/^[+a-z0-9A-Z_-]{0,63}$/,y=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,C={javascript:!0,"javascript:":!0},w={javascript:!0,"javascript:":!0},S={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},k=e("querystring");r.prototype.parse=function(e,t,n){if(!l.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),i=r!==-1&&r<e.indexOf("#")?"?":"#",o=e.split(i),a=/\\/g;o[0]=o[0].replace(a,"/"),e=o.join(i);var s=e;if(s=s.trim(),!n&&1===e.split("#").length){var f=d.exec(s);if(f)return this.path=s,this.href=s,this.pathname=f[1],f[2]?(this.search=f[2],t?this.query=k.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var h=c.exec(s);if(h){h=h[0];var p=h.toLowerCase();this.protocol=p,s=s.substr(h.length)}if(n||h||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===s.substr(0,2);!E||h&&w[h]||(s=s.substr(2),this.slashes=!0)}if(!w[h]&&(E||h&&!S[h])){for(var T=-1,j=0;j<v.length;j++){var D=s.indexOf(v[j]);D!==-1&&(T===-1||D<T)&&(T=D)}var P,I;I=T===-1?s.lastIndexOf("@"):s.lastIndexOf("@",T),I!==-1&&(P=s.slice(0,I),s=s.slice(I+1),this.auth=decodeURIComponent(P)),T=-1;for(var j=0;j<m.length;j++){var D=s.indexOf(m[j]);D!==-1&&(T===-1||D<T)&&(T=D)}T===-1&&(T=s.length),this.host=s.slice(0,T),s=s.slice(T),this.parseHost(),this.hostname=this.hostname||"";var M="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!M)for(var A=this.hostname.split(/\./),j=0,R=A.length;j<R;j++){var x=A[j];if(x&&!x.match(g)){for(var O="",N=0,L=x.length;N<L;N++)O+=x.charCodeAt(N)>127?"x":x[N];if(!O.match(g)){var $=A.slice(0,j),U=A.slice(j+1),H=x.match(y);H&&($.push(H[1]),U.unshift(H[2])),U.length&&(s="/"+U.join(".")+s),this.hostname=$.join(".");break}}}this.hostname.length>b?this.hostname="":this.hostname=this.hostname.toLowerCase(),M||(this.hostname=u.toASCII(this.hostname));var B=this.port?":"+this.port:"",F=this.hostname||"";this.host=F+B,this.href+=this.host,M&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!C[p])for(var j=0,R=_.length;j<R;j++){var q=_[j];if(s.indexOf(q)!==-1){var V=encodeURIComponent(q);V===q&&(V=escape(q)),s=s.split(q).join(V)}}var z=s.indexOf("#");z!==-1&&(this.hash=s.substr(z),s=s.slice(0,z));var K=s.indexOf("?");if(K!==-1?(this.search=s.substr(K),this.query=s.substr(K+1),t&&(this.query=k.parse(this.query)),s=s.slice(0,K)):t&&(this.search="",this.query={}),s&&(this.pathname=s),S[p]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var B=this.pathname||"",G=this.search||"";this.path=B+G}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&l.isObject(this.query)&&Object.keys(this.query).length&&(o=k.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||S[t])&&i!==!1?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),a=a.replace("#","%23"),t+i+n+a+r},r.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(l.isString(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var n=new r,i=Object.keys(this),o=0;o<i.length;o++){var a=i[o];n[a]=this[a]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),u=0;u<s.length;u++){var c=s[u];"protocol"!==c&&(n[c]=e[c])}return S[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!S[e.protocol]){for(var f=Object.keys(e),d=0;d<f.length;d++){var h=f[d];n[h]=e[h]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||w[e.protocol])n.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var _=n.pathname||"",m=n.search||"";n.path=_+m}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var v=n.pathname&&"/"===n.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),g=b||v||n.host&&e.pathname,y=g,C=n.pathname&&n.pathname.split("/")||[],p=e.pathname&&e.pathname.split("/")||[],k=n.protocol&&!S[n.protocol];if(k&&(n.hostname="",n.port=null,n.host&&(""===C[0]?C[0]=n.host:C.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),g=g&&(""===p[0]||""===C[0])),b)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,C=p;else if(p.length)C||(C=[]),C.pop(),C=C.concat(p),n.search=e.search,n.query=e.query;else if(!l.isNullOrUndefined(e.search)){if(k){n.hostname=n.host=C.shift();var E=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");E&&(n.auth=E.shift(),n.host=n.hostname=E.shift())}return n.search=e.search,n.query=e.query,l.isNull(n.pathname)&&l.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!C.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var T=C.slice(-1)[0],j=(n.host||e.host||C.length>1)&&("."===T||".."===T)||""===T,D=0,P=C.length;P>=0;P--)T=C[P],"."===T?C.splice(P,1):".."===T?(C.splice(P,1),D++):D&&(C.splice(P,1),D--);if(!g&&!y)for(;D--;D)C.unshift("..");!g||""===C[0]||C[0]&&"/"===C[0].charAt(0)||C.unshift(""),j&&"/"!==C.join("/").substr(-1)&&C.push("");var I=""===C[0]||C[0]&&"/"===C[0].charAt(0);if(k){n.hostname=n.host=I?"":C.length?C.shift():"";var E=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");E&&(n.auth=E.shift(),n.host=n.hostname=E.shift())}return g=g||n.host&&C.length,g&&!I&&C.unshift(""),C.length?n.pathname=C.join("/"):(n.pathname=null,n.path=null),l.isNull(n.pathname)&&l.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=f.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":228,punycode:220,querystring:223}],228:[function(e,t,n){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],229:[function(e,t,n){(function(e){var n;if(e.crypto&&crypto.getRandomValues){var r=new Uint8Array(16);n=function(){return crypto.getRandomValues(r),r}}if(!n){var i=new Array(16);n=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],230:[function(e,t,n){function r(e,t,n){var r=t&&n||0,i=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){i<16&&(t[r+i++]=l[e])});i<16;)t[r+i++]=0;return t}function i(e,t){var n=t||0,r=u;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}function o(e,t,n){var r=t&&n||0,o=t||[];e=e||{};var a=void 0!==e.clockseq?e.clockseq:h,s=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:_+1,l=s-p+(u-_)/1e4;if(l<0&&void 0===e.clockseq&&(a=a+1&16383),(l<0||s>p)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=s,_=u,h=a,s+=122192928e5;var c=(1e4*(268435455&s)+u)%4294967296;o[r++]=c>>>24&255,o[r++]=c>>>16&255,o[r++]=c>>>8&255,o[r++]=255&c;var f=s/4294967296*1e4&268435455;o[r++]=f>>>8&255,o[r++]=255&f,o[r++]=f>>>24&15|16,o[r++]=f>>>16&255,o[r++]=a>>>8|128,o[r++]=255&a;for(var m=e.node||d,v=0;v<6;v++)o[r+v]=m[v];return t?t:i(o)}function a(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var o=e.random||(e.rng||s)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;a++)t[r+a]=o[a];return t||i(o)}for(var s=e("./rng"),u=[],l={},c=0;c<256;c++)u[c]=(c+256).toString(16).substr(1),l[u[c]]=c;var f=s(),d=[1|f[0],f[1],f[2],f[3],f[4],f[5]],h=16383&(f[6]<<8|f[7]),p=0,_=0,m=a;m.v1=o,m.v4=a,m.parse=r,m.unparse=i,t.exports=m},{"./rng":229}]},{},[37])(37)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],53:[function(_dereq_,module,exports){!function(i,s){"use strict";var e="0.7.10",o="",r="?",n="function",a="undefined",t="object",w="string",l="major",d="model",p="name",c="type",u="vendor",m="version",f="architecture",b="console",g="mobile",h="tablet",v="smarttv",x="wearable",y="embedded",k={extend:function(i,s){for(var e in s)"browser cpu device engine os".indexOf(e)!==-1&&s[e].length%2===0&&(i[e]=s[e].concat(i[e]));return i},has:function(i,s){return"string"==typeof i&&s.toLowerCase().indexOf(i.toLowerCase())!==-1},lowerize:function(i){return i.toLowerCase()},major:function(i){return typeof i===w?i.split(".")[0]:s}},A={rgx:function(){for(var i,e,o,r,w,l,d,p=0,c=arguments;p<c.length&&!l;){var u=c[p],m=c[p+1];if(typeof i===a){i={};for(r in m)m.hasOwnProperty(r)&&(w=m[r],typeof w===t?i[w[0]]=s:i[w]=s)}for(e=o=0;e<u.length&&!l;)if(l=u[e++].exec(this.getUA()))for(r=0;r<m.length;r++)d=l[++o],w=m[r],typeof w===t&&w.length>0?2==w.length?typeof w[1]==n?i[w[0]]=w[1].call(this,d):i[w[0]]=w[1]:3==w.length?typeof w[1]!==n||w[1].exec&&w[1].test?i[w[0]]=d?d.replace(w[1],w[2]):s:i[w[0]]=d?w[1].call(this,d,w[2]):s:4==w.length&&(i[w[0]]=d?w[3].call(this,d.replace(w[1],w[2])):s):i[w]=d?d:s;p+=2}return i},str:function(i,e){for(var o in e)if(typeof e[o]===t&&e[o].length>0){for(var n=0;n<e[o].length;n++)if(k.has(e[o][n],i))return o===r?s:o}else if(k.has(e[o],i))return o===r?s:o;return i}},E={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},S={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[p,m],[/\s(opr)\/([\w\.]+)/i],[[p,"Opera"],m],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[p,m],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[p,"IE"],m],[/(edge)\/((\d+)?[\w\.]+)/i],[p,m],[/(yabrowser)\/([\w\.]+)/i],[[p,"Yandex"],m],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],m],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[p,m],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/JUC.+(ucweb)[\/\s]?([\w\.]+)/i],[[p,"UCBrowser"],m],[/(dolfin)\/([\w\.]+)/i],[[p,"Dolphin"],m],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[p,"Chrome"],m],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[m,[p,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[m,[p,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[m,[p,"Facebook"]],[/fxios\/([\w\.-]+)/i],[m,[p,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[m,[p,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[m,p],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[p,[m,A.str,E.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[p,m],[/(navigator|netscape)\/([\w\.-]+)/i],[[p,"Netscape"],m],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[p,m]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,k.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[f,/ower/,"",k.lowerize]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[f,k.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[d,u,[c,h]],[/applecoremedia\/[\w\.]+ \((ipad)/],[d,[u,"Apple"],[c,h]],[/(apple\s{0,1}tv)/i],[[d,"Apple TV"],[u,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[u,d,[c,h]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[d,[u,"Amazon"],[c,h]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[d,A.str,E.device.amazon.model],[u,"Amazon"],[c,g]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[d,u,[c,g]],[/\((ip[honed|\s\w*]+);/i],[d,[u,"Apple"],[c,g]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[u,d,[c,g]],[/\(bb10;\s(\w+)/i],[d,[u,"BlackBerry"],[c,g]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[d,[u,"Asus"],[c,h]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[u,"Sony"],[d,"Xperia Tablet"],[c,h]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[u,"Sony"],[d,"Xperia Phone"],[c,g]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[u,d,[c,b]],[/android.+;\s(shield)\sbuild/i],[d,[u,"Nvidia"],[c,b]],[/(playstation\s[34portablevi]+)/i],[d,[u,"Sony"],[c,b]],[/(sprint\s(\w+))/i],[[u,A.str,E.device.sprint.vendor],[d,A.str,E.device.sprint.model],[c,g]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[u,d,[c,h]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[u,[d,/_/g," "],[c,g]],[/(nexus\s9)/i],[d,[u,"HTC"],[c,h]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[d,[u,"Microsoft"],[c,b]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[u,"Microsoft"],[c,g]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s[6])/i],[d,[u,"Motorola"],[c,g]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[d,[u,"Motorola"],[c,h]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[u,"Samsung"],d,[c,h]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[u,"Samsung"],d,[c,g]],[/(samsung);smarttv/i],[u,d,[c,v]],[/\(dtv[\);].+(aquos)/i],[d,[u,"Sharp"],[c,v]],[/sie-(\w+)*/i],[d,[u,"Siemens"],[c,g]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[u,"Nokia"],d,[c,g]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[d,[u,"Acer"],[c,h]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[u,"LG"],d,[c,h]],[/(lg) netcast\.tv/i],[u,d,[c,v]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[d,[u,"LG"],[c,g]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[d,[u,"Lenovo"],[c,h]],[/linux;.+((jolla));/i],[u,d,[c,g]],[/((pebble))app\/[\d\.]+\s/i],[u,d,[c,x]],[/android.+;\s(glass)\s\d/i],[d,[u,"Google"],[c,x]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i],[[d,/_/g," "],[u,"Xiaomi"],[c,g]],[/\s(tablet)[;\/\s]/i,/\s(mobile)[;\/\s]/i],[[c,k.lowerize],u,d]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[m,[p,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[p,m],[/rv\:([\w\.]+).*(gecko)/i],[m,p]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[p,m],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[p,[m,A.str,E.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[p,"Windows"],[m,A.str,E.os.windows.version]],[/\((bb)(10);/i],[[p,"BlackBerry"],m],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[p,m],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[p,"Symbian"],m],[/\((series40);/i],[p],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[p,"Firefox OS"],m],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[p,m],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[p,"Chromium OS"],m],[/(sunos)\s?([\w\.]+\d)*/i],[[p,"Solaris"],m],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[p,m],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[p,"iOS"],[m,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[p,"Mac OS"],[m,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[p,m]]},T=function(s,e){if(!(this instanceof T))return new T(s,e).getResult();var r=s||(i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:o),n=e?k.extend(S,e):S;return this.getBrowser=function(){var i=A.rgx.apply(this,n.browser);return i.major=k.major(i.version),i},this.getCPU=function(){return A.rgx.apply(this,n.cpu)},this.getDevice=function(){return A.rgx.apply(this,n.device)},this.getEngine=function(){return A.rgx.apply(this,n.engine)},this.getOS=function(){return A.rgx.apply(this,n.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(i){return r=i,this},this.setUA(r),this};T.VERSION=e,T.BROWSER={NAME:p,MAJOR:l,VERSION:m},T.CPU={ARCHITECTURE:f},T.DEVICE={MODEL:d,VENDOR:u,TYPE:c,CONSOLE:b,MOBILE:g,SMARTTV:v,TABLET:h,WEARABLE:x,EMBEDDED:y},T.ENGINE={NAME:p,VERSION:m},T.OS={NAME:p,VERSION:m},typeof exports!==a?(typeof module!==a&&module.exports&&(exports=module.exports=T),exports.UAParser=T):typeof define===n&&define.amd?define(function(){return T}):i.UAParser=T;var N=i.jQuery||i.Zepto;if(typeof N!==a){var O=new T;N.ua=O.getResult(),N.ua.get=function(){return O.getUA()},N.ua.set=function(i){O.setUA(i);var s=O.getResult();for(var e in s)N.ua[e]=s[e]}}}("object"==typeof window?window:this)},{}],54:[function(_dereq_,module,exports){var bundleFn=arguments[3],sources=arguments[4],cache=arguments[5],stringify=JSON.stringify;module.exports=function(r,e){for(var t,n=Object.keys(cache),o=0,a=n.length;o<a;o++){var i=n[o],s=cache[i].exports;if(s===r||s&&s.default===r){t=i;break}}if(!t){t=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var u={},o=0,a=n.length;o<a;o++){var i=n[o];u[i]=i}sources[t]=[Function(["require","module","exports"],"("+r+")(self)"),u]}var f=Math.floor(Math.pow(16,8)*Math.random()).toString(16),c={};c[t]=t,sources[f]=[Function(["require"],"var f = require("+stringify(t)+");(f.default ? f.default : f)(self);"),c];var l="("+bundleFn+")({"+Object.keys(sources).map(function(r){return stringify(r)+":["+sources[r][0]+","+stringify(sources[r][1])+"]"}).join(",")+"},{},["+stringify(f)+"])",d=window.URL||window.webkitURL||window.mozURL||window.msURL,g=new Blob([l],{type:"text/javascript"});if(e&&e.bare)return g;var w=d.createObjectURL(g),h=new Worker(w);return h.objectURL=w,h}},{}],55:[function(_dereq_,module,exports){"use strict";function useGlobal(){var e=window||e;e.XMLHttpRequest=XMLHttpRequestShim}var BaseXHR=_dereq_("./src/base-xhr"),objectMirrors=_dereq_("./src/object-mirrors"),XMLHttpRequestShim=_dereq_("./src/shim");module.exports={BaseXHR:BaseXHR,XMLHttpRequest:XMLHttpRequestShim,useGlobal:useGlobal,objectMirrors:objectMirrors}},{"./src/base-xhr":56,"./src/object-mirrors":57,"./src/shim":59}],56:[function(_dereq_,module,exports){"use strict";var objectMirrors=_dereq_("./object-mirrors"),BaseXHR=function(r){var o={},e=r||{};return objectMirrors.mirrorRwProp(o,e,"responseType"),objectMirrors.mirrorRwProp(o,e,"timeout"),objectMirrors.mirrorRwProp(o,e,"withCredentials"),objectMirrors.mirrorReadOnlyProp(o,e,"readyState"),objectMirrors.mirrorReadOnlyProp(o,e,"response"),objectMirrors.mirrorReadOnlyProp(o,e,"responseText"),objectMirrors.mirrorReadOnlyProp(o,e,"responseURL"),objectMirrors.mirrorReadOnlyProp(o,e,"responseXML"),objectMirrors.mirrorReadOnlyProp(o,e,"status"),objectMirrors.mirrorReadOnlyProp(o,e,"statusText"),objectMirrors.mirrorReadOnlyProp(o,e,"upload"),objectMirrors.mirrorFunc(o,e,"abort"),objectMirrors.mirrorFunc(o,e,"open"),objectMirrors.mirrorFunc(o,e,"send"),objectMirrors.mirrorFunc(o,e,"setRequestHeader"),objectMirrors.mirrorFunc(o,e,"getResponseHeader"),objectMirrors.mirrorFunc(o,e,"overrideMimeType"),objectMirrors.mirrorFunc(o,e,"getAllResponseHeaders"),objectMirrors.mirrorFunc(o,e,"addRemoveEventListener"),objectMirrors.mirrorFunc(o,e,"removeRemoveEventListener"),objectMirrors.mirrorRwProp(o,e,"onload"),objectMirrors.mirrorRwProp(o,e,"onloadstart"),objectMirrors.mirrorRwProp(o,e,"onloadend"),objectMirrors.mirrorRwProp(o,e,"onabort"),objectMirrors.mirrorRwProp(o,e,"onerror"),objectMirrors.mirrorRwProp(o,e,"onprogress"),objectMirrors.mirrorRwProp(o,e,"ontimeout"),objectMirrors.mirrorRwProp(o,e,"onreadystatechange"),o};module.exports=BaseXHR},{"./object-mirrors":57}],57:[function(_dereq_,module,exports){"use strict";function checkProperty(r,e){if("undefined"==typeof r[e])throw new Error(ERROR_SOURCE_PROPERTY_NOT_IMPLEMENTED+": "+e);
}function readProperty(r,e,o,n){if(n){var t=n(r,e,o);if(t.override)return t.value}return checkProperty(e,o),e[o]}function writeProperty(r,e,o,n,t){if(t){var i=t(r,e,o,n);if(i.override)return}checkProperty(o,n),o[n]=r}function mirrorReadOnlyProp(r,e,o,n){Object.defineProperty(r,o,{get:function(){return readProperty(r,e,o,n)},configurable:!0})}function mirrorRwProp(r,e,o,n,t){Object.defineProperty(r,o,{get:function(){return readProperty(r,e,o,t)},set:function(t){return writeProperty(t,r,e,o,n)},configurable:!0})}function mirrorFunc(r,e,o){r[o]=function(){return checkProperty(e,o),e[o].apply(e,arguments)}}var ERROR_SOURCE_PROPERTY_NOT_IMPLEMENTED="Requiring undefined property on source object";module.exports={mirrorFunc:mirrorFunc,mirrorRwProp:mirrorRwProp,mirrorReadOnlyProp:mirrorReadOnlyProp}},{}],58:[function(_dereq_,module,exports){var XHRShaper=function(){var e=1/0,n=0,t=0,r=0;Object.defineProperty(this,"maxBandwidth",{get:function(){return Math.min(e,XHRShaper.maxBandwidth)},set:function(n){e=n}}),Object.defineProperty(this,"minLatency",{get:function(){return Math.max(n,XHRShaper.minLatency)},set:function(e){n=e}}),Object.defineProperty(this,"minProgressEvents",{get:function(){return Math.max(t,XHRShaper.minProgressEvents)},set:function(e){t=e}}),Object.defineProperty(this,"randomness",{get:function(){return Math.max(r,XHRShaper.randomness)},set:function(e){r=e}})};XHRShaper.maxBandwidth=1/0,XHRShaper.minLatency=0,XHRShaper.minProgressEvents=0,XHRShaper.randomness=0,module.exports=XHRShaper},{}],59:[function(_dereq_,module,exports){var BaseXHR=_dereq_("./base-xhr"),XHRShaper=_dereq_("./shaper"),objectMirrors=_dereq_("./object-mirrors"),WindowXHR=window.XMLHttpRequest,XMLHttpRequest=function(){var e,r,t,a,n,o,i,s,u,c,d,w=new WindowXHR,h=new XHRShaper,p=0,m=[],R=!1;w.onloadend=function(e){d=e,t&&4===w.readyState&&t(e)},w.onreadystatechange=function(f){function b(r){e&&e(r)}switch(w.readyState){case 0:b(f);break;case 1:a=Date.now(),b(f);break;case 2:n=Date.now(),b(f);break;case 3:o=Date.now(),b(f);break;case 4:var v=0,H=0;i=Date.now();var X=i-a;if(X<h.minLatency&&(v=h.minLatency-X),u>h.maxBandwidth&&(H=u/h.maxBandwidth*X-X),v||H){setTimeout(function(){p!==s||R||(clearTimeout(c),r(m[m.length-1])),b(f),d&&t&&t(d)},Math.max(v,H));break}b(f)}},w.onprogress=function(e){function t(e){p===s&&(R=!0),r&&r(e)}var n,o=Date.now(),i=o-a;return p=e.loaded,s=e.total,u=8*p/i,u>h.maxBandwidth?(n=u/h.maxBandwidth*i-i,m.push(e),void(c=setTimeout(function(){t(e)},n))):void t(e)};var f=new BaseXHR(w);return objectMirrors.mirrorRwProp(f,w,"onreadystatechange",function(r){return e=r,{override:!0}}),objectMirrors.mirrorRwProp(f,w,"onprogress",function(e){return r=e,{override:!0}}),objectMirrors.mirrorRwProp(f,w,"onloadend",function(e){return t=e,{override:!0}}),f.shaper=h,f};XMLHttpRequest.Shaper=XHRShaper,module.exports=XMLHttpRequest},{"./base-xhr":56,"./object-mirrors":57,"./shaper":58}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(require,module,exports){(function(global){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};!function(f){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.VideoEventPolyfill=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default={WAITING:"polyfillWaiting",PLAYING:"polyfillPlaying",ENDED:"polyfillEnded"},module.exports=exports.default},{}],2:[function(_dereq_,module,exports){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==("undefined"==typeof call?"undefined":_typeof(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof superClass?"undefined":_typeof(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=_dereq_("events"),_events2=_interopRequireDefault(_events),_eventStruct=_dereq_("./eventStruct"),_eventStruct2=_interopRequireDefault(_eventStruct),VideoEventPolyfill=function(_EventEmitter){function VideoEventPolyfill(video){_classCallCheck(this,VideoEventPolyfill);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(VideoEventPolyfill).call(this));return _this.video=video,_this.IDLE=0,_this.BUFFERING=1,_this.PLAYING=2,_this.TOLERANCE=.1,_this.state=_this.IDLE,_this.onPl=_this.onPlay.bind(_this),_this.onPling=_this.onPlaying.bind(_this),_this.video.paused?_this.start():_this.onPlay(),_this}return _inherits(VideoEventPolyfill,_EventEmitter),_createClass(VideoEventPolyfill,null,[{key:"Events",get:function(){return _eventStruct2.default}}]),_createClass(VideoEventPolyfill,[{key:"start",value:function(){this.video.addEventListener("play",this.onPl)}},{key:"onPlay",value:function(){this.state=this.BUFFERING,this.emit(_eventStruct2.default.WAITING),this.tickInterval=setInterval(this.tick.bind(this),200),this.video.removeEventListener("play",this.onPl)}},{key:"onPlaying",value:function(){this.emit(_eventStruct2.default.PLAYING),this.video.removeEventListener("playing",this.onPling)}},{key:"onEnded",value:function(){clearInterval(this.tickInterval),this.state=this.IDLE,this.emit(_eventStruct2.default.ENDED),this.video&&this.video.addEventListener("play",this.onPl)}},{key:"getBufferLength",value:function(){for(var i=0;i<this.video.buffered.length;i++)if(this.video.buffered.start(i)<=this.video.currentTime&&this.video.currentTime<=this.video.buffered.end(i))return this.video.buffered.end(i)-this.video.currentTime;return 0}},{key:"tick",value:function(){if(void 0!==this.isLive&&!this.isLive){if(this.video.duration&&(this.video.duration-this.video.currentTime<.5||this.video.duration-this.video.currentTime<1&&this.lastCurrentTime-this.video.currentTime<.01&&!this.video.paused&&this.video.playbackRate>0||this.video.currentTime>0&&isNaN(this.video.duration)))return void this.onEnded();this.lastCurrentTime=this.video.currentTime}var bufferLength=this.getBufferLength();switch(this.state){case this.BUFFERING:bufferLength>this.TOLERANCE&&(this.state=this.PLAYING,this.video.paused?this.video.addEventListener("playing",this.onPling):this.emit(_eventStruct2.default.PLAYING));break;case this.PLAYING:bufferLength<this.TOLERANCE?(this.state=this.BUFFERING,this.video.paused||this.emit(_eventStruct2.default.WAITING)):this.video.paused&&this.video.addEventListener("playing",this.onPling);break;case this.IDLE:default:return}}},{key:"setLive",value:function(isLive){this.isLive=isLive}},{key:"dispose",value:function(){clearInterval(this.tickInterval),this.video&&(this.video.removeEventListener("play",this.onPl),this.video.removeEventListener("playing",this.onPling),delete this.video),this.removeAllListeners()}}]),VideoEventPolyfill}(_events2.default);exports.default=VideoEventPolyfill,module.exports=exports.default},{"./eventStruct":1,events:3}],3:[function(_dereq_,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"===("undefined"==typeof arg?"undefined":_typeof(arg))&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),listeners=handler.slice(),len=listeners.length,i=0;i<len;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,"function"==typeof console.trace)),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)}},{}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);
